<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>期間選択UI</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    label {
      display: inline-block;
      width: 80px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
    }
    input {
      margin: 5px 0;
    }
  </style>
</head>
<body>

  <h2>期間を選択</h2>

  <!-- 単位の選択 -->
  <label for="unit">単位:</label>
  <select id="unit">
    <option value="year">年</option>
    <option value="month">月</option>
    <option value="week">週</option>
    <option value="day">日</option>
  </select>

  <!-- 動的に変わる入力欄 -->
  <div id="input-area"></div>

  <!-- 結果表示 -->
  <div class="result">
    開始日: <span id="displayStart">-</span><br>
    終了日: <span id="displayEnd">-</span>
  </div>

  <script>
    const unit = document.getElementById('unit');
    const inputArea = document.getElementById('input-area');
    const displayStart = document.getElementById('displayStart');
    const displayEnd = document.getElementById('displayEnd');

    unit.addEventListener('change', renderInput);
    renderInput(); // 初期表示

    function renderInput() {
      inputArea.innerHTML = ''; // リセット
      const type = unit.value;

      const input = document.createElement('input');

      switch (type) {
        case 'year':
          input.type = 'number';
          input.min = 2000;
          input.max = 2099;
          input.placeholder = '例: 2025';
          break;
        case 'month':
          input.type = 'month';
          break;
        case 'week':
          input.type = 'week';
          break;
        case 'day':
          input.type = 'date';
          break;
      }

      input.addEventListener('change', () => handleInput(type, input.value));
      inputArea.appendChild(input);
    }

    function handleInput(type, value) {
      if (!value) return;
      let startDate, endDate;

      switch (type) {
        case 'year':
          const y = parseInt(value);
          startDate = new Date(y, 0, 1);
          endDate = new Date(y, 11, 31);
          break;
        case 'month':
          const [yM, mM] = value.split('-').map(Number);
          startDate = new Date(yM, mM - 1, 1);
          endDate = new Date(yM, mM, 0); // 月末
          break;
        case 'week':
          const [yW, wW] = value.split('-W').map(Number);
          startDate = getDateOfISOWeek(wW, yW);
          endDate = new Date(startDate);
          endDate.setDate(endDate.getDate() + 6);
          break;
        case 'day':
          startDate = new Date(value);
          endDate = new Date(value);
          break;
      }

      displayStart.textContent = formatDate(startDate);
      displayEnd.textContent = formatDate(endDate);
    }

    // ISO週番号 → 月曜日の日付
    function getDateOfISOWeek(week, year) {
      const simple = new Date(year, 0, 1 + (week - 1) * 7);
      const dow = simple.getDay();
      const ISOweekStart = simple;
      if (dow <= 4)
        ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
      else
        ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
      return ISOweekStart;
    }

    function formatDate(date) {
      const y = date.getFullYear();
      const m = ('0' + (date.getMonth() + 1)).slice(-2);
      const d = ('0' + date.getDate()).slice(-2);
      return `${y}-${m}-${d}`;
    }
  </script>

</body>
</html>