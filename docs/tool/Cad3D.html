<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>3D CADデータ表示サンプル</title>
  
  <!-- React and ReactDOM -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
  
  <!-- MUI (Material-UI) v5 -->
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.11.15/umd/material-ui.production.min.js" crossorigin="anonymous"></script>
  
  <!-- Emotion ライブラリ (MUI v5 の依存関係) -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.0/dist/emotion-react.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js" crossorigin="anonymous"></script>
  
  <!-- Babel for JSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.0/babel.min.js" crossorigin="anonymous"></script>
  
  <!-- Three.js CDN (修正済み) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" crossorigin="anonymous"></script>
  
  <!-- Material-UI CDN -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
  
  <style>
    /* 3Dレンダリング用のキャンバススタイル */
    #three-canvas {
      width: 100%;
      height: 600px;
      display: block;
    }
  </style>
  
  <!-- Faviconを指定（エラー対策） -->
  <link rel="icon" href="data:,">
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useRef } = React;
    const { Button, AppBar, Toolbar, Typography, Container } = MaterialUI;

    function App() {
      const mountRef = useRef(null);

      useEffect(() => {
        // シーン、カメラ、レンダラーの初期化
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xeeeeee);

        const camera = new THREE.PerspectiveCamera(
          75,
          mountRef.current.clientWidth / mountRef.current.clientHeight,
          0.1,
          1000
        );
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
        mountRef.current.appendChild(renderer.domElement);

        // ライトの追加
        const ambientLight = new THREE.AmbientLight(0x404040); // ソフトな白色光
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(1, 1, 1).normalize();
        scene.add(directionalLight);

        // 立方体の作成
        const geometry = new THREE.BoxGeometry();
        const material = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
        const cube = new THREE.Mesh(geometry, material);
        scene.add(cube);

        // アニメーションループ
        const animate = function () {
          requestAnimationFrame(animate);

          // 立方体を回転
          cube.rotation.x += 0.01;
          cube.rotation.y += 0.01;

          renderer.render(scene, camera);
        };

        animate();

        // リサイズ対応
        const handleResize = () => {
          const width = mountRef.current.clientWidth;
          const height = mountRef.current.clientHeight;
          renderer.setSize(width, height);
          camera.aspect = width / height;
          camera.updateProjectionMatrix();
        };

        window.addEventListener('resize', handleResize);

        // クリーンアップ
        return () => {
          window.removeEventListener('resize', handleResize);
          mountRef.current.removeChild(renderer.domElement);
        };
      }, []);

      return (
        <div>
          <AppBar position="static">
            <Toolbar>
              <Typography variant="h6">3D CADデータ表示</Typography>
            </Toolbar>
          </AppBar>
          <Container style={{ marginTop: '20px' }}>
            <div ref={mountRef} id="three-canvas"></div>
            <Button variant="contained" color="primary" style={{ marginTop: '20px' }}>
              ボタン
            </Button>
          </Container>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
