<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ§‹é€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
</head>
<body>
    <div id="root"></div>

    <!-- React and ReactDOM -->
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js" crossorigin="anonymous"></script>

    <!-- MUI (Material-UI) v5 -->
    <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.11.15/umd/material-ui.production.min.js" crossorigin="anonymous"></script>

    <!-- Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.0/babel.min.js" crossorigin="anonymous"></script>

    <script type="text/babel">
        const { useState } = React;
        const {
            Box,
            Button,
            TextField,
            Typography,
            Table,
            TableBody,
            TableCell,
            TableHead,
            TableRow,
            IconButton,
            Tabs,
            Tab,
            Select,
            MenuItem,
            FormControl,
            InputLabel,
        } = MaterialUI;

        function App() {
            const [selectedTab, setSelectedTab] = useState(0);
            const [structures, setStructures] = useState([
                {
                    name: "é¡§å®¢æƒ…å ±",
                    fields: [
                        { name: "åå‰", type: "text" },
                        { name: "å¹´é½¢", type: "number" },
                        { name: "ç™»éŒ²æ—¥", type: "date" },
                    ],
                    records: [
                        { åå‰: "å±±ç”°å¤ªéƒ", å¹´é½¢: 30, ç™»éŒ²æ—¥: "2024-01-15" },
                        { åå‰: "éˆ´æœ¨èŠ±å­", å¹´é½¢: 25, ç™»éŒ²æ—¥: "2024-02-20" },
                    ],
                },
                // ä»–ã®ã‚µãƒ³ãƒ—ãƒ«æ§‹é€ ä½“ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã“ã“ã«è¨˜è¿°
            ]);
            const [selectedStructureIndex, setSelectedStructureIndex] = useState(0); // åˆæœŸé¸æŠã‚’ã‚µãƒ³ãƒ—ãƒ«æ§‹é€ ä½“ã«è¨­å®š
            const [newStructureName, setNewStructureName] = useState("");
            const [newFieldName, setNewFieldName] = useState("");
            const [newFieldType, setNewFieldType] = useState("text");
            const [newRecord, setNewRecord] = useState({});

            // 1. æ§‹é€ å®šç¾©
            const addStructure = () => {
                if (newStructureName.trim()) {
                    setStructures([...structures, { name: newStructureName.trim(), fields: [], records: [] }]);
                    setNewStructureName("");
                }
            };

            const selectStructure = (index) => {
                setSelectedStructureIndex(index);
                // è‡ªå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
                setSelectedTab(0);
            };

            // 2. æ§‹é€ é …ç›®å®šç¾©
            const addFieldDefinition = () => {
                if (newFieldName.trim()) {
                    const updatedStructures = [...structures];
                    updatedStructures[selectedStructureIndex].fields.push({ name: newFieldName.trim(), type: newFieldType });
                    setStructures(updatedStructures);
                    setNewFieldName("");
                    setNewFieldType("text");
                }
            };

            // 3. ãƒ‡ãƒ¼ã‚¿ç™»éŒ²
            const addRecord = () => {
                if (selectedStructureIndex === null) return;
                const updatedStructures = [...structures];
                updatedStructures[selectedStructureIndex].records.push(newRecord);
                setStructures(updatedStructures);
                setNewRecord({});
            };

            const updateRecord = (recordIndex, fieldName, value) => {
                const updatedStructures = [...structures];
                updatedStructures[selectedStructureIndex].records[recordIndex][fieldName] = value;
                setStructures(updatedStructures);
            };

            const deleteRecord = (recordIndex) => {
                const updatedStructures = [...structures];
                updatedStructures[selectedStructureIndex].records.splice(recordIndex, 1);
                setStructures(updatedStructures);
            };

            const handleTabChange = (event, newValue) => {
                // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ–ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹0ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å‰ã«æ§‹é€ ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
                if (newValue === 1 && selectedStructureIndex === null) {
                    alert("æ§‹é€ ç®¡ç†ã‚’è¡Œã†ã«ã¯ã€ã¾ãšæ§‹é€ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
                    return;
                }
                setSelectedTab(newValue);
            };

            // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹æ§‹é€ ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ã¨ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
            const currentFields = selectedStructureIndex !== null ? structures[selectedStructureIndex].fields : [];
            const currentRecords = selectedStructureIndex !== null ? structures[selectedStructureIndex].records : [];
            const currentStructureName = selectedStructureIndex !== null ? structures[selectedStructureIndex].name : "";

            return (
                <Box sx={{ padding: 3 }}>
                    <Typography variant="h4" gutterBottom>
                        æ§‹é€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
                    </Typography>

                    {/* ã‚¿ãƒ–ã®å®šç¾© */}
                    <Tabs value={selectedTab} onChange={handleTabChange} aria-label="æ§‹é€ ç®¡ç†ã‚¿ãƒ–">
                        <Tab label="ãƒ‡ãƒ¼ã‚¿ç®¡ç†" />
                        <Tab label="æ§‹é€ ç®¡ç†" />
                    </Tabs>

                    {/* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                    {selectedTab === 0 && selectedStructureIndex !== null && (
                        <Box sx={{ marginTop: 3 }}>
                            {/* 3. ãƒ‡ãƒ¼ã‚¿CRUD */}
                            <Box sx={{ marginY: 3 }}>
                                <Typography variant="h6">3. ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹</Typography>
                                <Typography>
                                    é¸æŠä¸­ã®æ§‹é€ : {currentStructureName}
                                </Typography>
                                <Box sx={{ display: "flex", gap: 2, marginBottom: 2, flexWrap: 'wrap' }}>
                                    {currentFields.map((field, index) => (
                                        <TextField
                                            key={index}
                                            label={field.name}
                                            type={field.type}
                                            value={newRecord[field.name] || ""}
                                            onChange={(e) =>
                                                setNewRecord({
                                                    ...newRecord,
                                                    [field.name]: e.target.value,
                                                })
                                            }
                                        />
                                    ))}
                                    <Button variant="contained" onClick={addRecord}>
                                        ä¿å­˜
                                    </Button>
                                </Box>
                                <Table>
                                    <TableHead>
                                        <TableRow>
                                            <TableCell>æ§‹é€ å</TableCell>
                                            {currentFields.map((field, index) => (
                                                <TableCell key={index}>{field.name}</TableCell>
                                            ))}
                                            <TableCell>æ“ä½œ</TableCell>
                                        </TableRow>
                                    </TableHead>
                                    <TableBody>
                                        {currentRecords.map((record, recordIndex) => (
                                            <TableRow key={recordIndex}>
                                                <TableCell>{currentStructureName}</TableCell>
                                                {currentFields.map((field, fieldIndex) => (
                                                    <TableCell key={fieldIndex}>
                                                        <TextField
                                                            value={record[field.name] || ""}
                                                            type={field.type}
                                                            onChange={(e) =>
                                                                updateRecord(recordIndex, field.name, e.target.value)
                                                            }
                                                        />
                                                    </TableCell>
                                                ))}
                                                <TableCell>
                                                    <IconButton
                                                        onClick={() => deleteRecord(recordIndex)}
                                                    >
                                                        ğŸ—‘ï¸
                                                    </IconButton>
                                                </TableCell>
                                            </TableRow>
                                        ))}
                                    </TableBody>
                                </Table>
                            </Box>
                        </Box>
                    )}

                    {selectedTab === 1 && (
                        <Box sx={{ marginTop: 3 }}>
                            {/* 1. æ§‹é€ å®šç¾© */}
                            <Box sx={{ marginY: 3 }}>
                                <Typography variant="h6">1. æ§‹é€ ã‚’å®šç¾©ã™ã‚‹</Typography>
                                <Box sx={{ display: "flex", gap: 2, marginBottom: 2 }}>
                                    <TextField
                                        label="æ§‹é€ å"
                                        value={newStructureName}
                                        onChange={(e) => setNewStructureName(e.target.value)}
                                    />
                                    <Button variant="contained" onClick={addStructure}>
                                        æ§‹é€ ã‚’è¿½åŠ 
                                    </Button>
                                </Box>
                                <Table>
                                    <TableHead>
                                        <TableRow>
                                            <TableCell>æ§‹é€ å</TableCell>
                                            <TableCell>æ“ä½œ</TableCell>
                                        </TableRow>
                                    </TableHead>
                                    <TableBody>
                                        {structures.map((structure, index) => (
                                            <TableRow key={index}>
                                                <TableCell>{structure.name}</TableCell>
                                                <TableCell>
                                                    <Button
                                                        variant="outlined"
                                                        onClick={() => selectStructure(index)}
                                                    >
                                                        é¸æŠ
                                                    </Button>
                                                </TableCell>
                                            </TableRow>
                                        ))}
                                    </TableBody>
                                </Table>
                            </Box>

                            {/* 2. æ§‹é€ é …ç›®å®šç¾© */}
                            {selectedStructureIndex !== null && (
                                <Box sx={{ marginY: 3 }}>
                                    <Typography variant="h6">2. æ§‹é€ é …ç›®ã‚’å®šç¾©ã™ã‚‹</Typography>
                                    <Typography>
                                        é¸æŠä¸­ã®æ§‹é€ : {structures[selectedStructureIndex].name}
                                    </Typography>
                                    <Box sx={{ display: "flex", gap: 2, marginBottom: 2 }}>
                                        <TextField
                                            label="é …ç›®å"
                                            value={newFieldName}
                                            onChange={(e) => setNewFieldName(e.target.value)}
                                        />
                                        <FormControl sx={{ minWidth: 120 }}>
                                            <InputLabel id="field-type-label">é …ç›®ã‚¿ã‚¤ãƒ—</InputLabel>
                                            <Select
                                                labelId="field-type-label"
                                                value={newFieldType}
                                                label="é …ç›®ã‚¿ã‚¤ãƒ—"
                                                onChange={(e) => setNewFieldType(e.target.value)}
                                            >
                                                <MenuItem value="text">ãƒ†ã‚­ã‚¹ãƒˆ</MenuItem>
                                                <MenuItem value="number">æ•°å€¤</MenuItem>
                                                <MenuItem value="date">æ—¥ä»˜</MenuItem>
                                            </Select>
                                        </FormControl>
                                        <Button variant="contained" onClick={addFieldDefinition}>
                                            é …ç›®ã‚’è¿½åŠ 
                                        </Button>
                                    </Box>
                                    <Table>
                                        <TableHead>
                                            <TableRow>
                                                <TableCell>é …ç›®å</TableCell>
                                                <TableCell>ã‚¿ã‚¤ãƒ—</TableCell>
                                            </TableRow>
                                        </TableHead>
                                        <TableBody>
                                            {currentFields.map((field, index) => (
                                                <TableRow key={index}>
                                                    <TableCell>{field.name}</TableCell>
                                                    <TableCell>{field.type}</TableCell>
                                                </TableRow>
                                            ))}
                                        </TableBody>
                                    </Table>
                                </Box>
                            )}
                        </Box>
                    )}
                </Box>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>
