<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>ポータル：通知＋ショートカット＋会員情報取得（申請フロー）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts / Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>

  <!-- React / Babel / MUI (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js" crossorigin></script>

  <style>
    html, body, #root {
      height: 100%;
    }
    body {
      margin: 0;
      font-family: Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    a.cardLink {
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .iconXL {
      font-size: 44px;
    }
    .dropzone {
      border: 1.5px dashed rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      transition: 0.15s ease-in-out;
    }
    .dropzone.dragover {
      border-color: #1976d2;
      background: rgba(25,118,210,0.06);
    }
    .tableWrap {
      overflow: auto;
      max-height: 360px;
    }
    .mono {
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    .cellInput {
      width: 160px;
    }
    .muted {
      color: rgba(0,0,0,0.54);
    }
    .rowNum {
      width: 56px;
      text-align: right;
      padding-right: 8px;
      color: rgba(0,0,0,0.54);
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const {
  ThemeProvider,
  createTheme,
  CssBaseline,
  Container,
  AppBar,
  Toolbar,
  Typography,
  Grid,
  Card,
  CardActionArea,
  CardContent,
  Stack,
  Chip,
  Tooltip,
  IconButton,
  Alert,
  AlertTitle,
  Box,
  Button,
  Divider,
  LinearProgress,
  Snackbar,
  Tabs,
  Tab,
  TextField,
  Paper,
  Table,
  TableHead,
  TableRow,
  TableCell,
  TableBody,
  Collapse,
  Badge
} = MaterialUI;

const MOCK_DB = {
  "M-0001": { name: "山田 太郎", phone: "090-1234-5678", address: "東京都千代田区1-2-3" },
  "M-0002": { name: "佐藤 花子", phone: "080-5555-6666", address: "神奈川県横浜市青葉区4-5-6" },
  "M-0003": { name: "鈴木 次郎", phone: "070-7777-8888", address: "大阪府大阪市北区7-8-9" }
};
const lookupMember = async (memberId) => {
  await new Promise(r => setTimeout(r, 300));
  return MOCK_DB[memberId] || null;
};

const uid = () => 'REQ-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,8);
const fmtDateTime = (d) => new Date(d).toLocaleString();

const NotificationCenter = ({ pendingCount, onGoRequests }) => {
  const announcements = [
    { id:"info1", severity: "info", title: "メンテナンス案内", msg: "9/5(木) 02:00-03:00 システムメンテナンスを実施します。" },
    { id:"info2", severity: "success", title: "新機能", msg: "会員情報取得が『申請→承認→実行』フローに対応しました。" }
  ];
  return (
    <Box sx={{ my: 2 }}>
      <Grid container spacing={2}>
        <Grid item xs={12}>
          <Stack spacing={1.25}>
            {announcements.map(a => (
              <Alert key={a.id} severity={a.severity} variant="outlined">
                <AlertTitle>{a.title}</AlertTitle>
                {a.msg}
              </Alert>
            ))}
          </Stack>
        </Grid>
        <Grid item xs={12}>
          <Card>
            <CardContent>
              <Typography variant="subtitle1" gutterBottom>要対応タスク</Typography>
              <Stack divider={<Divider />} spacing={1}>
                <Stack direction="row" spacing={1} justifyContent="space-between" alignItems="center">
                  <Typography variant="body2">
                    承認待ちの取得申請が {pendingCount} 件あります
                  </Typography>
                  <Button
                    size="small"
                    onClick={onGoRequests}
                    endIcon={<span className="material-icons">arrow_forward</span>}
                  >
                    申請一覧へ
                  </Button>
                </Stack>
              </Stack>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
};

const ShortcutCard = ({ title, subtitle, icon, onClick, href }) => (
  <Grid item xs={12} sm={4}>
    <a
      className="cardLink"
      href={href}
      target={href ? "_blank" : undefined}
      rel={href ? "noopener noreferrer" : undefined}
      onClick={onClick}
    >
      <Card elevation={2}>
        <CardActionArea>
          <CardContent>
            <Stack spacing={1.5} alignItems="flex-start">
              <span className="material-icons iconXL">{icon}</span>
              <Typography variant="h6">{title}</Typography>
              <Typography variant="body2" color="text.secondary">{subtitle}</Typography>
              <Chip
                size="small"
                icon={<span className="material-icons" style={{fontSize: 18}}>open_in_new</span>}
                label={href ? "外部サービス" : "内部画面"}
              />
            </Stack>
          </CardContent>
        </CardActionArea>
      </Card>
    </a>
  </Grid>
);

const SpreadsheetInput = ({ value, onChange, onSubmit }) => {
  const [rows, setRows] = React.useState(value?.length ? value : Array.from({length:10},()=>({memberId:""})));
  const tableRef = React.useRef(null);
  React.useEffect(()=>{ onChange?.(rows); }, [rows]);
  const setCell = (idx, v) => {
    setRows(prev => {
      const next = [...prev];
      next[idx] = { memberId: v.trim() };
      return next;
    });
  };
  const addRows = (n=10) => setRows(prev => [...prev, ...Array.from({length:n},()=>({memberId:""}))]);
  const clearEmpty = () => setRows(prev => prev.filter(r=>r.memberId.trim()!=="").concat({memberId:""}));
  const downloadTemplate = () => {
    const csv = 'memberId\nM-0001\nM-0002\nM-0003\n';
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "member_template.csv";
    a.click();
    URL.revokeObjectURL(a.href);
  };
  const handlePaste = (startIdx, e) => {
    const text = e.clipboardData.getData('text');
    if (!text) return;
    e.preventDefault();
    const tokens = text.replace(/\r/g,"\n").split(/[\n,\t,]+/).map(s=>s.trim()).filter(Boolean);
    if (!tokens.length) return;
    setRows(prev => {
      const next = [...prev];
      for (let i=0; i<tokens.length; i++) {
        const idx = startIdx + i;
        if (idx >= next.length) next.push({memberId:""});
        next[idx] = { memberId: tokens[i] };
      }
      return next;
    });
  };
  const handleKeyDown = (idx, e) => {
    if (!["Enter","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(e.key)) return;
    e.preventDefault();
    const inputs = tableRef.current.querySelectorAll("input.cellInput");
    const cols = 1;
    const row = idx;
    let targetRow = row;
    if (e.key==="Enter" || e.key==="ArrowDown") targetRow = row+1;
    if (e.key==="ArrowUp") targetRow = Math.max(0,row-1);
    if (targetRow >= rows.length) {
      addRows(1);
      setTimeout(()=>{
        const newInputs = tableRef.current.querySelectorAll("input.cellInput");
        newInputs[targetRow*cols]?.focus();
      }, 50);
      return;
    }
    inputs[targetRow*cols]?.focus();
  };
  const ids = rows.map(r=>r.memberId.trim()).filter(Boolean);
  const uniqueCount = new Set(ids).size;
  const dupCount = ids.length - uniqueCount;
  return (
    <Paper variant="outlined" sx={{ p:2 }}>
      <Stack spacing={1.5}>
        <Typography variant="subtitle1">画面入力</Typography>
        <Typography variant="body2" color="text.secondary">
          セルに入力し、<b>複数行をそのまま貼り付け</b>できます。Enter/矢印で移動、最終行でEnterすると自動で行追加。空行は無視されます。
        </Typography>
        <Box className="tableWrap" ref={tableRef}>
          <Table size="small" aria-label="会員番号入力表">
            <TableHead>
              <TableRow>
                <TableCell className="rowNum">#</TableCell>
                <TableCell className="mono">memberId</TableCell>
              </TableRow>
            </TableHead>
            <TableBody>
              {rows.map((r, idx) => (
                <TableRow key={idx}>
                  <TableCell className="rowNum">{idx+1}</TableCell>
                  <TableCell>
                  <TextField
                    id={`cell-${idx}`}
                    size="small"
                    placeholder="例: M-0001"
                    value={r.memberId}
                    onChange={e => setCell(idx, e.target.value)}
                    onPaste={e => handlePaste(idx, e)}
                    onKeyDown={e => {
                      if (["Enter","ArrowDown","ArrowUp"].includes(e.key)) {
                        e.preventDefault();
                        let target = idx;
                        if (e.key === "Enter" || e.key === "ArrowDown") {
                          target = idx + 1;
                        } else if (e.key === "ArrowUp") {
                          target = Math.max(0, idx - 1);
                        }
                        if (target >= rows.length) {
                          // 新しい行を追加
                          addRows(1);
                          setTimeout(() => {
                            const el = document.getElementById(`cell-${target}`);
                            el?.focus();
                          }, 0);
                        } else {
                          const el = document.getElementById(`cell-${target}`);
                          el?.focus();
                        }
                      }
                    }}
                    className="cellInput mono"
                  />

                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </Box>
        <Stack direction="row" spacing={1} flexWrap="wrap">
          <Button onClick={()=>addRows(10)} startIcon={<span className="material-icons">add</span>}>行を10行追加</Button>
          <Button onClick={clearEmpty} startIcon={<span className="material-icons">filter_alt</span>}>空行を削除</Button>
          <Button onClick={downloadTemplate} startIcon={<span className="material-icons">download</span>}>テンプレートCSV</Button>
          <Box sx={{ flexGrow:1 }} />
          <Chip label={`入力件数: ${ids.length}`} />
          <Chip color={dupCount>0 ? "warning" : "default"} label={`重複: ${dupCount}`} />
          <Button variant="contained" disabled={ids.length===0} onClick={()=>onSubmit(ids)} startIcon={<span className="material-icons">send</span>}>
            取得申請を作成
          </Button>
        </Stack>
      </Stack>
    </Paper>
  );
};
const FileUploadPanel = ({ onSubmit }) => {
  const [dragOver, setDragOver] = React.useState(false);
  const [ids, setIds] = React.useState([]);

  const parseIds = (text) => {
    const lines = text.replace(/\r/g, "\n").split("\n").filter(l=>l!=="");
    if (!lines.length) return [];
    const first = lines[0];
    const isCSV = first.includes(",");
    const isTSV = first.includes("\t");
    let vals = [];
    if (isCSV || isTSV) {
      const sep = isCSV ? "," : "\t";
      const header = first.split(sep).map(s=>s.trim().toLowerCase());
      const idx = header.findIndex(h => ["memberid","member_id","会員id","会員番号","会員ナンバー","id"].includes(h));
      const startRow = idx>=0 ? 1 : 0;
      const col = idx>=0 ? idx : 0;
      for (let i=startRow; i<lines.length; i++) {
        const cols = lines[i].split(sep);
        const raw = (cols[col] ?? "").trim().replace(/^"+|"+$/g, "");
        if (raw) vals.push(raw);
      }
    } else {
      vals = lines.map(s=>s.trim());
    }
    return Array.from(new Set(vals.filter(Boolean)));
  };

  const handleFiles = async (file) => {
    if (!file) return;
    const text = await file.text();
    const list = parseIds(text);
    setIds(list);
  };

  const onDrop = (e) => {
    e.preventDefault();
    setDragOver(false);
    const file = e.dataTransfer.files?.[0];
    handleFiles(file);
  };

  const [fileInput, setFileInput] = React.useState();

  return (
    <Paper variant="outlined" sx={{ p:2 }}>
      <Stack spacing={1.5}>
        <Typography variant="subtitle1">ファイルアップロード</Typography>
        <Typography variant="body2" color="text.secondary">
          CSV / TSV / 改行区切り（UTF-8）。ヘッダー名の例：<code className="mono">memberId</code> / <code className="mono">会員番号</code>など。
        </Typography>
        <Box
          className={`dropzone ${dragOver ? "dragover" : ""}`}
          onDragOver={(e)=>{e.preventDefault(); setDragOver(true);}}
          onDragLeave={()=>setDragOver(false)}
          onDrop={onDrop}
          role="group"
          aria-label="ファイルドロップ領域"
        >
          <Stack spacing={1} alignItems="center">
            <span className="material-icons">file_upload</span>
            <Typography>ここにファイルをドラッグ＆ドロップ</Typography>
            <Typography variant="caption" color="text.secondary">または</Typography>
            <Button variant="outlined" onClick={()=>fileInput?.click()} startIcon={<span className="material-icons">upload_file</span>}>
              ファイルを選択
            </Button>
            <input
              ref={r=>setFileInput(r)}
              type="file" accept=".csv,.tsv,.txt"
              onChange={(e)=>handleFiles(e.target.files?.[0])}
              style={{ display:"none" }}
            />
          </Stack>
        </Box>

        {!!ids.length && (
          <Paper variant="outlined" className="tableWrap">
            <Table size="small" aria-label="読み込みプレビュー">
              <TableHead>
                <TableRow>
                  <TableCell className="mono">memberId</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {ids.map((id, i)=>(
                  <TableRow key={id+i}><TableCell className="mono">{id}</TableCell></TableRow>
                ))}
              </TableBody>
            </Table>
          </Paper>
        )}

        <Stack direction="row" spacing={1}>
          <Button variant="outlined" onClick={()=>setIds([])} startIcon={<span className="material-icons">clear_all</span>} disabled={!ids.length}>クリア</Button>
          <Box sx={{ flexGrow:1 }} />
          <Chip label={`読み込み件数: ${ids.length}`} />
          <Button variant="contained" disabled={!ids.length} onClick={()=>onSubmit(ids)} startIcon={<span className="material-icons">send</span>}>
            取得申請を作成
          </Button>
        </Stack>
      </Stack>
    </Paper>
  );
};

const RequestsPanel = ({ requests, onApprove, onReject, onExport, onExpandToggle }) => {
  const pending = requests.filter(r=>r.status==="申請中").length;
  return (
    <Paper variant="outlined" sx={{ p:2 }}>
      <Stack spacing={1.5}>
        <Stack direction="row" alignItems="center" spacing={1}>
          <Typography variant="h6">申請一覧</Typography>
          <Chip label={`承認待ち: ${pending}`} />
        </Stack>
        <div className="tableWrap">
          <Table size="small" aria-label="申請一覧">
            <TableHead>
              <TableRow>
                <TableCell>申請ID</TableCell>
                <TableCell>作成日時</TableCell>
                <TableCell>方式</TableCell>
                <TableCell align="right">対象件数</TableCell>
                <TableCell>状態</TableCell>
                <TableCell>操作</TableCell>
              </TableRow>
            </TableHead>
            <TableBody>
              {requests.map(req=>(
                <React.Fragment key={req.id}>
                  <TableRow hover>
                    <TableCell className="mono">{req.id}</TableCell>
                    <TableCell>{fmtDateTime(req.createdAt)}</TableCell>
                    <TableCell>{req.source === "manual" ? "画面入力" : "ファイル"}</TableCell>
                    <TableCell align="right">{req.memberIds.length}</TableCell>
                    <TableCell>
                      <Stack direction="row" spacing={1} alignItems="center">
                        <Chip size="small" color={
                          req.status==="申請中" ? "default" :
                          req.status==="承認済み(未実行)" ? "info" :
                          req.status==="実行中" ? "warning" :
                          req.status==="実行済み" ? "success" : "error"
                        } label={req.status} />
                        {typeof req.progress === "number" && req.status!=="実行済み" && (
                          <Typography variant="caption" className="mono">{Math.round(req.progress*100)}%</Typography>
                        )}
                      </Stack>
                    </TableCell>
                    <TableCell>
                      <Stack direction="row" spacing={1} flexWrap="wrap">
                        <Button size="small" onClick={()=>onExpandToggle(req.id)} startIcon={<span className="material-icons">unfold_more</span>}>詳細</Button>
                        {req.status==="申請中" && (
                          <>
                            <Button size="small" onClick={()=>onApprove(req.id)} startIcon={<span className="material-icons">check</span>}>承認（本部）</Button>
                            <Button size="small" color="error" onClick={()=>onReject(req.id)} startIcon={<span className="material-icons">close</span>}>却下</Button>
                          </>
                        )}
                        {req.status==="実行済み" && (
                          <Button size="small" onClick={()=>onExport(req.id)} startIcon={<span className="material-icons">download</span>}>CSV</Button>
                        )}
                      </Stack>
                    </TableCell>
                  </TableRow>
                  <TableRow>
                    <TableCell colSpan={6} sx={{ p:0, border:0 }}>
                      <Collapse in={!!req.expanded} unmountOnExit>
                        <Box sx={{ p:2, bgcolor: 'action.hover' }}>
                          {req.status==="実行中" && (
                            <Box sx={{ mb:2 }}>
                              <LinearProgress variant="determinate" value={Math.round((req.progress||0)*100)} />
                              <Typography variant="caption" color="text.secondary">実行中…</Typography>
                            </Box>
                          )}
                          {(req.results?.length>0) ? (
                            <div className="tableWrap">
                              <Table size="small">
                                <TableHead>
                                  <TableRow>
                                    <TableCell className="mono">memberId</TableCell>
                                    <TableCell>名前</TableCell>
                                    <TableCell>電話番号</TableCell>
                                    <TableCell>住所</TableCell>
                                    <TableCell>ステータス</TableCell>
                                  </TableRow>
                                </TableHead>
                                <TableBody>
                                  {req.results.map((r,i)=>(
                                    <TableRow key={r.memberId + i}>
                                      <TableCell className="mono">{r.memberId}</TableCell>
                                      <TableCell>{r.name || "-"}</TableCell>
                                      <TableCell>{r.phone || "-"}</TableCell>
                                      <TableCell>{r.address || "-"}</TableCell>
                                      <TableCell>
                                        <Chip size="small" color={r.status==="OK" ? "success" : "warning"} label={r.status} />
                                      </TableCell>
                                    </TableRow>
                                  ))}
                                </TableBody>
                              </Table>
                            </div>
                          ) : (
                            <Typography variant="body2" className="muted">結果はまだありません。</Typography>
                          )}
                        </Box>
                      </Collapse>
                    </TableCell>
                  </TableRow>
                </React.Fragment>
              ))}
              {requests.length===0 && (
                <TableRow><TableCell colSpan={6} align="center">申請はまだありません。</TableCell></TableRow>
              )}
            </TableBody>
          </Table>
        </div>
      </Stack>
    </Paper>
  );
};

const MemberPage = ({ goHome }) => {
  const [tab, setTab] = React.useState(0); // 0: 申請状況
  const [sheetRows, setSheetRows] = React.useState([]);
  const [requests, setRequests] = React.useState([]);
  const [snack, setSnack] = React.useState(null);

  const createRequest = (ids, source) => {
    const memberIds = Array.from(new Set(ids.map(s=>s.trim()).filter(Boolean)));
    if (memberIds.length === 0) {
      setSnack({severity:"warning", msg:"会員番号がありません。"});
      return;
    }
    const req = {
      id: uid(),
      createdAt: Date.now(),
      source,
      memberIds,
      status: "申請中",
      results: [],
      progress: undefined,
      expanded: true
    };
    setRequests(prev => [req, ...prev]);
    setSnack({severity:"success", msg:`取得申請を作成しました（${memberIds.length}件）。`});
    setTab(0);
  };

  const executeRequest = async (reqId) => {
    setRequests(prev => prev.map(r => r.id===reqId ? { ...r, status:"実行中", progress:0, results:[] } : r));
    const req = requests.find(r=>r.id===reqId);
    if (!req) return;
    const total = req.memberIds.length;
    const results = [];
    for (let i=0; i<total; i++) {
      const id = req.memberIds[i];
      const data = await lookupMember(id);
      if (data) {
        results.push({ memberId: id, ...data, status: "OK" });
      } else {
        results.push({ memberId: id, name:"", phone:"", address:"", status: "NOT_FOUND" });
      }
      const p = (i+1)/total;
      setRequests(prev => prev.map(r => r.id===reqId ? { ...r, progress: p } : r));
    }
    setRequests(prev => prev.map(r => r.id===reqId ? { ...r, status:"実行済み", progress:1, results } : r));
    setSnack({severity:"success", msg:"取得が完了しました。"});
  };

  const approve = (reqId) => {
    setRequests(prev => prev.map(r => r.id===reqId ? { ...r, status:"承認済み(未実行)" } : r));
    setTimeout(()=>executeRequest(reqId), 300);
  };

  const reject = (reqId) => {
    setRequests(prev => prev.map(r => r.id===reqId ? { ...r, status:"却下" } : r));
    setSnack({severity:"info", msg:"申請を却下しました。"});
  };

  const exportCSV = (reqId) => {
    const req = requests.find(r=>r.id===reqId);
    if (!req || !req.results?.length) return;
    const header = ["memberId","name","phone","address","status"];
    const csv = [header.join(",")].concat(
      req.results.map(x => [x.memberId, x.name, x.phone, x.address, x.status]
        .map(v => `"${String(v??"").replace(/"/g,'""')}"`).join(","))
    ).join("\n");
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `member_results_${req.id}.csv`;
    a.click();
    URL.revokeObjectURL(a.href);
  };

  const toggleExpand = (reqId) => setRequests(prev => prev.map(r => r.id===reqId ? ({...r, expanded: !r.expanded}) : r));

  return (
    <Container maxWidth="lg" sx={{ py:3 }}>
      <Stack direction="row" spacing={1} alignItems="center" sx={{ mb: 1 }}>
        <Button onClick={goHome} startIcon={<span className="material-icons">arrow_back</span>}>戻る</Button>
        <Typography variant="h5">会員情報取得</Typography>
      </Stack>
      <Tabs value={tab} onChange={(e,v)=>setTab(v)} sx={{ mb:2 }}>
        <Tab label="申請状況" />
        <Tab label="画面入力" />
        <Tab label="ファイルアップロード" />
      </Tabs>
      {tab===0 && (
        <RequestsPanel
          requests={requests}
          onApprove={approve}
          onReject={reject}
          onExport={exportCSV}
          onExpandToggle={toggleExpand}
        />
      )}
      {tab===1 && (
        <SpreadsheetInput
          value={sheetRows}
          onChange={setSheetRows}
          onSubmit={(ids)=>createRequest(ids, "manual")}
        />
      )}
      {tab===2 && (
        <FileUploadPanel onSubmit={(ids)=>createRequest(ids, "file")} />
      )}
      <Snackbar open={!!snack} autoHideDuration={2500} onClose={()=>setSnack(null)} anchorOrigin={{ vertical:'bottom', horizontal:'center' }}>
        <Alert severity={snack?.severity||"info"} variant="filled" onClose={()=>setSnack(null)}>
          {snack?.msg}
        </Alert>
      </Snackbar>
    </Container>
  );
};

const Home = ({ goMember, pendingCount }) => (
  <Container maxWidth="lg" sx={{ py:3 }}>
    <NotificationCenter pendingCount={pendingCount} onGoRequests={goMember} />
    <Typography variant="h5" gutterBottom>各サービス</Typography>
    <Grid container spacing={2}>
      <ShortcutCard
        title="カード管理"
        subtitle="カード発行・停止・履歴の確認"
        icon="credit_card"
        href="https://example.com/cards"
      />
      <ShortcutCard
        title="会員情報メンテナンス"
        subtitle="会員属性・連絡先・ランクの更新"
        icon="manage_accounts"
        href="https://example.com/member/edit"
      />
      <ShortcutCard
        title="会員情報取得"
        subtitle="番号リストから照会（申請フロー）"
        icon="person_search"
        onClick={(e)=>{ e.preventDefault?.(); goMember(); }}
      />
    </Grid>
  </Container>
);

const App = () => {
  const theme = createTheme({ palette: { mode: 'light' }});
  const [route, setRoute] = React.useState(location.hash.replace('#','') || '/');
  const go = (path) => { location.hash = path; };
  React.useEffect(()=>{
    const onHash = () => setRoute(location.hash.replace('#','') || '/');
    addEventListener('hashchange', onHash);
    return () => removeEventListener('hashchange', onHash);
  }, []);
  const [requests, setRequests] = React.useState([]);
  const pendingCount = requests.filter(r=>r.status==="申請中").length;
  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <AppBar position="sticky" elevation={1}>
        <Toolbar>
          <Typography variant="h6" sx={{ flexGrow: 1 }}>ポータル</Typography>
          <Tooltip title="通知">
            <IconButton color="inherit" size="large">
              <Badge color="error" badgeContent={pendingCount}>
                <span className="material-icons">notifications</span>
              </Badge>
            </IconButton>
          </Tooltip>
        </Toolbar>
      </AppBar>
      {route === '/' && <Home goMember={()=>go('/member')} pendingCount={pendingCount} />}
      {route === '/member' && <MemberPage goHome={()=>go('/')} />}
    </ThemeProvider>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
