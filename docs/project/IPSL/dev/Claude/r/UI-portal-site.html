<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>統合ダッシュボード完全版（折り畳み式デモ機能・説明つき）</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Fonts / Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>

  <!-- React / Babel / MUI -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js" crossorigin></script>

  <style>
    :root{
      --gap-xxs:6px; --gap-xs:8px; --gap-s:12px; --gap:16px; --gap-l:20px; --gap-xl:24px;
      --muted:#6b7280; --paper:#fff; --bg:#fafafa; --primary:#1976d2;
      --bar1:#64b5f6; --bar2:#42a5f5; --cmpbg:#e8eef5; --cmpbd:#d5e2f1;
    }
    html,body{ height:100% }
    body{ margin:0; font-family: Roboto, "Noto Sans JP", system-ui, -apple-system, Segoe UI, "Helvetica Neue", Arial, "Noto Sans"; background:var(--bg); color:#1f2937; }
    a, a:visited{ color:var(--primary); text-decoration:none }
    .mono{ font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1; }
    .zero-row{ background:#f5f7fa; }
    .muted{ color:var(--muted) }

    /* レイアウト */
    .domain-grid{ display:grid; grid-template-columns:1fr; gap:var(--gap) } /* 1列縦並び */
    .panel-grid{ display:grid; grid-template-columns:1.3fr 1fr; gap:var(--gap) }
    .kpi-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:var(--gap-s) }
    @media(min-width:1200px){ .kpi-grid{ grid-template-columns:repeat(5,1fr) } }

    /* 棒グラフ／比較 */
    .bar{ background: linear-gradient(180deg,#90caf9,var(--bar1)); border-radius:6px 6px 0 0; }
    .bar.zero{ outline:2px dashed #9aa1a9; outline-offset:-2px; background:transparent }
    .cmp-bar{ height:12px; background:var(--cmpbg); border-radius:999px; position:relative; overflow:hidden; border:1px solid var(--cmpbd) }
    .cmp-fill{ height:100%; background: linear-gradient(90deg,var(--bar1),var(--bar2)) }
    .cmp-line{ position:absolute; right:0; top:0; bottom:0; width:2px; background: rgba(0,0,0,.35) }

    /* 施設カバー */
    .cover { width:100%; aspect-ratio:16/9; border-radius:10px; background:linear-gradient(135deg,#eef5ff,#f7fbff); border:1px solid #e3edf9; display:flex; align-items:center; justify-content:center; color:#1f5fbf; }

    /* パネル内の上部ツールバーを固定（スクロール時に見える） */
    .sticky-actions{ position:sticky; top:-1px; z-index:2; background:var(--paper); padding-bottom:8px }
    .table-toolbar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px }
    .nowrap{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="text/babel">
    const {
      Box, Container, Typography, Stack, Chip, Divider, Button,
      FormControl, InputLabel, Select, MenuItem, OutlinedInput,
      Checkbox, ListItemText, TextField, Card, CardContent,
      Table, TableBody, TableCell, TableContainer, TableHead, TableRow,
      Paper, Grid, Tooltip, ThemeProvider, createTheme, IconButton,
      Dialog, DialogTitle, DialogContent, DialogActions, Snackbar, Alert, Menu, Collapse,
      Accordion, AccordionSummary, AccordionDetails, Switch, FormControlLabel
    } = MaterialUI;

    /* ========== テーマ ========== */
    const theme = createTheme({
      palette:{ mode:'light', primary:{ main:'#1976d2' }, background:{ default:'#fafafa', paper:'#ffffff' } },
      shape:{ borderRadius:12 },
      typography:{ fontSize:14 },
      components:{
        MuiCard:{ styleOverrides:{ root:{ border:'1px solid #e5e7eb' } } },
        MuiTableHead:{ styleOverrides:{ root:{ background:'#f3f6fb' } } },
        MuiTooltip:{ defaultProps:{ arrow:true } }
      }
    });

    /* ========== マスタ ========== */
    const FACILITY_MASTER = [
      { id:'HQ', name:'本社', type:'管理拠点', address:'東京都千代田区1-1-1', openHours:'平日 9:00-18:00', manager:'田中', phone:'03-0000-0000', floorArea:1200, pos:8,  parking:20, lastRenovation:'2023-10-01', tenantCount:0 },
      { id:'S1', name:'店舗A（工場A 併設）', type:'店舗', address:'神奈川県川崎市川崎区2-3-4', openHours:'年中無休 10:00-21:00', manager:'佐藤', phone:'044-000-0000', floorArea:1800, pos:14, parking:60, lastRenovation:'2024-04-12', tenantCount:4 },
      { id:'S2', name:'店舗B', type:'店舗', address:'埼玉県さいたま市大宮区5-6-7', openHours:'年中無休 9:00-22:00', manager:'鈴木', phone:'048-000-0000', floorArea:1500, pos:12, parking:35, lastRenovation:'2022-11-20', tenantCount:6 },
      { id:'DC', name:'物流センター', type:'物流', address:'千葉県市川市8-9-10', openHours:'24H/365D', manager:'高橋', phone:'047-000-0000', floorArea:5000, pos:4,  parking:30, lastRenovation:'2021-08-01', tenantCount:0 },
      { id:'R1', name:'研究棟', type:'研究', address:'神奈川県横浜市港北区11-12-13', openHours:'平日 9:00-18:00', manager:'伊藤', phone:'045-000-0000', floorArea:900,  pos:2,  parking:10, lastRenovation:'2024-07-15', tenantCount:0 }
    ];
    const FACILITIES = FACILITY_MASTER.map(f=>({id:f.id, label:f.name}));
    const labelOfFacility = (id)=> FACILITIES.find(f=>f.id===id)?.label || id;

    const DOMAINS = [
      { id:'client',  name:'取引先管理' },
      { id:'store',   name:'店舗管理' },
      { id:'equip',   name:'設備管理' },
      { id:'tenant',  name:'テナント管理' },
      { id:'neighbor',name:'近隣管理' },
      { id:'history', name:'履歴管理' },
      { id:'sales',   name:'売上管理' },
      { id:'building',name:'建物情報管理' },
      { id:'land',    name:'土地情報管理' },
      { id:'ops',     name:'店舗営業管理' },
      { id:'contract',name:'契約・法令管理' }
    ];

    const CATEGORY_MASTER = {
      client:{ main:[{id:'client-supplier',name:'仕入先'},{id:'client-customer',name:'販売先'},{id:'client-outsourcing',name:'サービス委託先'}],
        sub:{ 'client-supplier':[ {id:'client-supplier-major',name:'大手'},{id:'client-supplier-local',name:'地域'},{id:'client-supplier-new',name:'新規'} ],
              'client-customer':[ {id:'client-customer-major',name:'大手'},{id:'client-customer-local',name:'地域'},{id:'client-customer-warning',name:'要注意'},{id:'client-customer-stop',name:'停止'} ],
              'client-outsourcing':[ {id:'client-outsourcing-system',name:'システム'},{id:'client-outsourcing-logi',name:'物流'} ] } },
      store:{ main:[{id:'store-direct',name:'直営'},{id:'store-fc',name:'FC'},{id:'store-coop',name:'共同運営'}],
        sub:{ 'store-direct':[ {id:'store-direct-large',name:'大型'},{id:'store-direct-mid',name:'中型'},{id:'store-direct-small',name:'小型'} ],
              'store-fc':[ {id:'store-fc-station',name:'駅前'},{id:'store-fc-suburb',name:'郊外'} ],
              'store-coop':[ {id:'store-coop-temp',name:'期間限定'} ] } },
      equip:{ main:[{id:'equip-plant',name:'機械設備'},{id:'equip-facility',name:'店舗施設'},{id:'equip-gear',name:'装備'},{id:'equip-fixture',name:'備品'},{id:'equip-vehicle',name:'車両'}],
        sub:{ 'equip-plant':[ {id:'equip-plant-ac',name:'空調'},{id:'equip-plant-power',name:'電源'},{id:'equip-plant-camera',name:'監視'} ],
              'equip-facility':[ {id:'equip-facility-doors',name:'自動ドア'},{id:'equip-facility-pos',name:'POS'},{id:'equip-facility-shelf',name:'什器'} ],
              'equip-gear':[ {id:'equip-gear-tools',name:'工具'},{id:'equip-gear-esl',name:'電子棚札GW'} ],
              'equip-fixture':[ {id:'equip-fixture-rack',name:'ラック'} ],
              'equip-vehicle':[ {id:'equip-vehicle-car',name:'車両'} ] } },
      tenant:{ main:[{id:'tenant-direct',name:'本社直営'},{id:'tenant-leasing',name:'リーシング'},{id:'tenant-event',name:'短期催事'}],
        sub:{ 'tenant-direct':[ {id:'tenant-direct-food',name:'飲食'},{id:'tenant-direct-goods',name:'物販'},{id:'tenant-direct-service',name:'サービス'} ],
              'tenant-leasing':[ {id:'tenant-leasing-limited',name:'期間限定'} ],
              'tenant-event':[ {id:'tenant-event-weekend',name:'週末'} ] } },
      neighbor:{ main:[{id:'neighbor-competitor',name:'競合'},{id:'neighbor-public',name:'公共施設'},{id:'neighbor-transport',name:'交通拠点'}],
        sub:{ 'neighbor-competitor':[ {id:'neighbor-competitor-large',name:'大型SC'},{id:'neighbor-competitor-gms',name:'GMS'},{id:'neighbor-competitor-cvs',name:'コンビニ'} ],
              'neighbor-public':[ {id:'neighbor-public-school',name:'学校'},{id:'neighbor-public-hospital',name:'病院'} ],
              'neighbor-transport':[ {id:'neighbor-transport-station',name:'駅'} ] } },
      history:{ main:[{id:'history-inspection',name:'点検'},{id:'history-repair',name:'修繕'},{id:'history-accident',name:'事故'},{id:'history-claim',name:'クレーム'},{id:'history-audit',name:'監査'}],
        sub:{ 'history-inspection':[ {id:'history-inspection-done',name:'是正済'},{id:'history-inspection-pending',name:'未是正'} ],
              'history-repair':[ {id:'history-repair-minor',name:'軽微'},{id:'history-repair-major',name:'重大'} ],
              'history-accident':[ {id:'history-accident-mid',name:'中'},{id:'history-accident-major',name:'重大'} ],
              'history-claim':[ {id:'history-claim-open',name:'未解決'},{id:'history-claim-closed',name:'解決'} ],
              'history-audit':[ {id:'history-audit-done',name:'実施済'},{id:'history-audit-nd',name:'未実施'} ] } },
      sales:{ main:[{id:'sales-total',name:'総売上'},{id:'sales-dept',name:'部門売上'},{id:'sales-channel',name:'チャネル'}],
        sub:{ 'sales-total':[ {id:'sales-total-store',name:'店舗'},{id:'sales-total-ec',name:'EC'} ],
              'sales-dept':[ {id:'sales-dept-food',name:'食品'},{id:'sales-dept-daily',name:'日用品'},{id:'sales-dept-elec',name:'家電'} ],
              'sales-channel':[ {id:'sales-channel-to',name:'テイクアウト'},{id:'sales-channel-dine',name:'イートイン'} ] } },
      building:{ main:[{id:'bld-structure',name:'構造'},{id:'bld-use',name:'用途'},{id:'bld-seismic',name:'耐震'},{id:'bld-fire',name:'消防'}],
        sub:{ 'bld-structure':[ {id:'bld-structure-s',name:'S造'},{id:'bld-structure-rc',name:'RC造'} ],
              'bld-use':[ {id:'bld-use-retail',name:'商業施設'},{id:'bld-use-office',name:'オフィス'} ],
              'bld-seismic':[ {id:'bld-seismic-ok',name:'適合'},{id:'bld-seismic-need',name:'要改善'} ],
              'bld-fire':[ {id:'bld-fire-ok',name:'適合'},{id:'bld-fire-need',name:'要改善'} ] } },
      land:{ main:[{id:'land-own',name:'所有'},{id:'land-lease',name:'賃借'},{id:'land-easement',name:'地役権'}],
        sub:{ 'land-own':[ {id:'land-own-long',name:'長期'},{id:'land-own-mid',name:'中期'} ],
              'land-lease':[ {id:'land-lease-short',name:'短期'},{id:'land-lease-undec',name:'更新未定'} ],
              'land-easement':[ {id:'land-easement-road',name:'通路'} ] } },
      ops:{ main:[{id:'ops-hours',name:'営業時間'},{id:'ops-staff',name:'人員配置'},{id:'ops-promo',name:'販促'}],
        sub:{ 'ops-hours':[ {id:'ops-hours-normal',name:'通常'},{id:'ops-hours-extended',name:'延長'},{id:'ops-hours-short',name:'短縮'} ],
              'ops-staff':[ {id:'ops-staff-more',name:'増員'},{id:'ops-staff-less',name:'削減'} ],
              'ops-promo':[ {id:'ops-promo-campaign',name:'キャンペーン'} ] } },
      contract:{ main:[{id:'ctr-rent',name:'賃貸'},{id:'ctr-maint',name:'保守'},{id:'ctr-outs',name:'委託'},{id:'law',name:'法令'}],
        sub:{ 'ctr-rent':[ {id:'ctr-rent-new',name:'新規'},{id:'ctr-rent-renew',name:'更新'},{id:'ctr-rent-close',name:'解約予定'} ],
              'ctr-maint':[ {id:'ctr-maint-active',name:'稼働'},{id:'ctr-maint-exp',name:'期限切れ'} ],
              'ctr-outs':[ {id:'ctr-outs-active',name:'稼働'},{id:'ctr-outs-exp',name:'期限切れ'} ],
              'law':[ {id:'law-comply',name:'遵守'},{id:'law-pending',name:'未対応'},{id:'law-expired',name:'期限切れ'} ] } }
    };

    /* ========== ユーティリティ / モック ========== */
    function seededRandom(seed){ let t = seed + 0x6D2B79F5; return () => { t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; }; }
    const pick = (rnd, arr) => arr[Math.floor(rnd()*arr.length)];
    const randDate = (rnd, start, end) => new Date(start.getTime() + rnd()*(end.getTime()-start.getTime()));
    const asISO = (d)=> d instanceof Date ? d.toISOString().slice(0,10) : d;

    function generateMock(domainId, {seed=11, count=220}={}){
      const rnd = seededRandom(seed);
      const facilityIds = FACILITIES.map(f=>f.id);
      const commonNames = ['案件','記録','項目','タスク','対象','エントリ','申請','通知','検収','レポート'];
      const mains = CATEGORY_MASTER[domainId].main.map(m=>m.id);
      const arr=[]; let seq=1000;

      const base = (rec)=>({
        id: rec.id || `${domainId.toUpperCase()}-${seq++}`,
        name: rec.name || (pick(rnd, commonNames)+'-'+Math.floor(rnd()*900+100)),
        main: rec.main || pick(rnd, mains),
        sub:  rec.sub  || (CATEGORY_MASTER[domainId].sub[rec.main]||[])[0]?.id,
        facility: rec.facility || pick(rnd, facilityIds),
        status: rec.status || pick(rnd, ['稼働','点検中','故障']),
        date1: rec.date1 || asISO(randDate(rnd, new Date(2021,0,1), new Date(2025,5,1))),
        date2: rec.date2 || asISO(randDate(rnd, new Date(2025,6,1), new Date(2026,3,1))),
        owner: rec.owner || pick(rnd, ['店長','副店長','担当']),
        ...rec.extra
      });

      if(domainId==='sales'){
        for(let i=0;i<count;i++){
          const main = pick(rnd, mains);
          const subs = CATEGORY_MASTER[domainId].sub[main]||[];
          const sub = pick(rnd, subs.map(s=>s.id));
          const amount = Math.round(((main==='sales-dept-elec'?22:(main==='sales-dept-food'?9:12)) + rnd()*10)*100); // 千円
          const qty = Math.round(((main==='sales-dept-food'?200:70) + rnd()*140));
          const period = `2025-${String(1+Math.floor(rnd()*9)).padStart(2,'0')}`;
          arr.push(base({main, sub, status:'稼働', extra:{ amount, qty, unitPrice: qty? Math.round((amount*1000)/qty): 0, period }}));
        }
        return arr;
      }
      if(domainId==='contract'){
        const cStatuses = ['稼働','期限切れ','解約予定'];
        for(let i=0;i<count;i++){
          const main = pick(rnd, mains);
          const subs = CATEGORY_MASTER[domainId].sub[main]||[];
          const sub = pick(rnd, subs.map(s=>s.id));
          const due = asISO(randDate(rnd, new Date(2025,6,1), new Date(2026,5,30)));
          arr.push(base({main, sub, status: pick(rnd, cStatuses), extra:{ due, partner: pick(rnd,['A商事','Bサービス','C建設','D保守']) }}));
        }
        return arr;
      }
      for(let i=0;i<count;i++){
        const main = pick(rnd, mains);
        const subs = CATEGORY_MASTER[domainId].sub[main]||[];
        const sub = subs.length? pick(rnd, subs.map(s=>s.id)) : undefined;
        arr.push(base({main, sub}));
      }
      return arr;
    }

    /* ========== フィルタ／集計／比較 ========== */
    function filterRecords(list, {facilities, q, statuses}){
      return list.filter(a=>{
        if(facilities.length && !facilities.includes(a.facility)) return false;
        if(statuses.length && a.status && !statuses.includes(a.status)) return false;
        if(q){
          const s = (a.id+' '+a.name+' '+a.facility+' '+a.owner+' '+(a.partner||'')+' '+(a.period||'') ).toLowerCase();
          if(!s.includes(q.toLowerCase())) return false;
        }
        return true;
      });
    }

    function summarizeByCategory(domainId, records, level){
      const dom = CATEGORY_MASTER[domainId];
      const total = records.length;

      if(level==='main'){
        const base = dom.main.map(m=>({ id:m.id, name:m.name, count:0, run:0, alerts:0 }));
        const map = new Map(base.map(x=>[x.id,x]));
        records.forEach(r=>{
          const o = map.get(r.main); if(!o) return;
          o.count++; if(r.status==='稼働') o.run++; if(r.date2 && new Date(r.date2)<new Date()) o.alerts++;
        });
        const rows = dom.main.map(m=>{
          const o = map.get(m.id);
          const runrate = o.count? (o.run/o.count*100) : null;
          return { id:m.id, name:m.name, count:o.count, ratio: total? (o.count/total*100) : null, runrate, alerts:o.alerts, muted:o.count===0 };
        });
        return { rows, total };
      } else {
        const baseRows=[]; dom.main.forEach(m=> (dom.sub[m.id]||[]).forEach(s=> baseRows.push({ id:s.id, name:`${m.name} / ${s.name}`, count:0, run:0, alerts:0 })));
        const map = new Map(baseRows.map(x=>[x.id,x]));
        records.forEach(r=>{
          const o = map.get(r.sub); if(!o) return;
          o.count++; if(r.status==='稼働') o.run++; if(r.date2 && new Date(r.date2)<new Date()) o.alerts++;
        });
        const rows=[]; dom.main.forEach(m=> (dom.sub[m.id]||[]).forEach(s=>{
          const o = map.get(s.id);
          const runrate = o.count? (o.run/o.count*100) : null;
          rows.push({ id:s.id, name:`${m.name} / ${s.name}`, count:o.count, ratio: total? (o.count/total*100) : null, runrate, alerts:o.alerts, muted:o.count===0 });
        }));
        return { rows, total };
      }
    }

    function buildCompareMetrics(domainId, all, filtered){
      const make = (label, sn, sd, an, ad, noteSel, noteAll) => {
        const aR = ad? (an/ad*100) : 0;
        const sR = sd? (sn/sd*100) : 0;
        return {
          label,
          sel: aR? (sR/aR*100) : 0,
          detail:`選択:${sd? sR.toFixed(1)+'%':'—'} / 全体:${ad? aR.toFixed(1)+'%':'—'}${noteSel||noteAll?`（${noteSel||''}${noteSel&&noteAll?' / ':''}${noteAll||''}）`:''}`
        };
      };

      const totalAll = all.length, totalSel = filtered.length;
      const arr = [ make('件数構成比', totalSel, totalSel, totalAll, totalAll) ];

      if(domainId==='sales'){
        const amtAll = all.reduce((s,a)=>s+(a.amount||0),0);
        const amtSel = filtered.reduce((s,a)=>s+(a.amount||0),0);
        arr.push( make('売上構成比', amtSel, amtSel, amtAll, amtAll, `選択=${amtSel.toLocaleString()}千円`, `全体=${amtAll.toLocaleString()}千円`) );
        const qtyAll = all.reduce((s,a)=>s+(a.qty||0),0);
        const qtySel = filtered.reduce((s,a)=>s+(a.qty||0),0);
        arr.push( make('客数構成比', qtySel, qtySel, qtyAll, qtyAll, `選択=${qtySel.toLocaleString()}`, `全体=${qtyAll.toLocaleString()}`) );
        return arr;
      }

      if(domainId==='contract'){
        const expAll = all.filter(a=>a.status==='期限切れ').length;
        const expSel = filtered.filter(a=>a.status==='期限切れ').length;
        const dueAll = all.filter(a=>a.due && (new Date(a.due)-new Date())/(1000*60*60*24)<=30 && (new Date(a.due)>=new Date())).length;
        const dueSel = filtered.filter(a=>a.due && (new Date(a.due)-new Date())/(1000*60*60*24)<=30 && (new Date(a.due)>=new Date())).length;
        arr.push( make('期限切れ率', expSel, totalSel, expAll, totalAll) );
        arr.push( make('到来(30日)率', dueSel, totalSel, dueAll, totalAll) );
        return arr;
      }

      const faultAll = all.filter(a=>a.status==='故障').length;
      const faultSel = filtered.filter(a=>a.status==='故障').length;
      const chkAll = all.filter(a=>a.date2 && new Date(a.date2)>=new Date()).length;
      const chkSel = filtered.filter(a=>a.date2 && new Date(a.date2)>=new Date()).length;
      arr.push( make('故障率', faultSel, totalSel, faultAll, totalAll) );
      arr.push( make('点検遵守率', chkSel, totalSel, chkAll, totalAll) );
      return arr;
    }

    /* ========== CSV ========== */
    function downloadCSV(filename, rows){
      const csv = rows.map(r=> r.map(v=>{
        if(v==null) return '';
        const s = String(v).replace(/"/g,'""');
        return /[",\n]/.test(s) ? `"${s}"` : s;
      }).join(',')).join('\n');
      const blob = new Blob(["\ufeff"+csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click();
      URL.revokeObjectURL(a.href);
    }

    /* ========== 施設概要 ========== */
    function FacilityOverview({facilityId, allRecords}){
      const f = FACILITY_MASTER.find(x=>x.id===facilityId);
      if(!f) return null;
      const assets = allRecords.filter(a=>a.facility===facilityId);
      const total = assets.length;
      const faults = assets.filter(a=>a.status==='故障' || a.status==='期限切れ').length;
      const running = assets.filter(a=>a.status==='稼働').length;
      const coming30 = assets.filter(a=>{
        const d = a.date2 || a.due; if(!d) return false;
        const dd = new Date(d); const diff=(dd - new Date())/(1000*60*60*24);
        return diff>=0 && diff<=30;
      }).length;
      const chain = {
        floorAreaAvg: Math.round(FACILITY_MASTER.reduce((s,x)=>s+x.floorArea,0)/FACILITY_MASTER.length),
        posAvg: Math.round(FACILITY_MASTER.reduce((s,x)=>s+x.pos,0)/FACILITY_MASTER.length)
      };
      return (
        <Card sx={{mb:2}}>
          <CardContent>
            <Stack direction={{xs:'column', md:'row'}} spacing={2}>
              <Box sx={{minWidth:280, maxWidth:420, flex:1}}>
                <Box className="cover"><span className="material-icons" style={{marginRight:8}}>storefront</span>{f.name}（{f.type}）</Box>
                <Box sx={{mt:1}}>
                  <Typography variant="body2" color="text.secondary"><span className="material-icons" style={{fontSize:16,verticalAlign:'-3px',marginRight:4}}>place</span>{f.address}</Typography>
                  <Typography variant="body2" color="text.secondary"><span className="material-icons" style={{fontSize:16,verticalAlign:'-3px',marginRight:4}}>schedule</span>{f.openHours}</Typography>
                  <Typography variant="body2" color="text.secondary"><span className="material-icons" style={{fontSize:16,verticalAlign:'-3px',marginRight:4}}>call</span>{f.phone}</Typography>
                </Box>
              </Box>
              <Box sx={{flex:2}}>
                <Typography variant="h6" gutterBottom>施設概要</Typography>
                <Grid container spacing={1}>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">売場面積</Typography>
                    <Typography variant="h5" className="mono">{f.floorArea.toLocaleString()} ㎡</Typography>
                    <Typography variant="caption" color="text.secondary">チェーン平均 {chain.floorAreaAvg} ㎡</Typography>
                  </CardContent></Card></Grid>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">POS台数</Typography>
                    <Typography variant="h5" className="mono">{f.pos}</Typography>
                    <Typography variant="caption" color="text.secondary">チェーン平均 {chain.posAvg}</Typography>
                  </CardContent></Card></Grid>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">テナント数</Typography>
                    <Typography variant="h5" className="mono">{f.tenantCount}</Typography>
                    <Typography variant="caption" color="text.secondary">最終改装 {f.lastRenovation}</Typography>
                  </CardContent></Card></Grid>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">駐車台数</Typography>
                    <Typography variant="h5" className="mono">{f.parking}</Typography>
                    <Typography variant="caption" color="text.secondary">責任者 {f.manager}</Typography>
                  </CardContent></Card></Grid>
                </Grid>

                <Divider sx={{my:2}} />

                <Grid container spacing={1}>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">関連レコード数</Typography>
                    <Typography variant="h5" className="mono">{total}</Typography>
                  </CardContent></Card></Grid>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">稼働率（参考）</Typography>
                    <Typography variant="h5" className="mono">{total? Math.round(running/total*100):'—'}%</Typography>
                    <Typography variant="caption" color="text.secondary">稼働 {running}/{total}</Typography>
                  </CardContent></Card></Grid>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">故障/期限切れ</Typography>
                    <Typography variant="h5" className="mono">{faults}</Typography>
                  </CardContent></Card></Grid>
                  <Grid item xs={6} md={3}><Card variant="outlined"><CardContent>
                    <Typography color="text.secondary" variant="body2">30日以内到来</Typography>
                    <Typography variant="h5" className="mono">{coming30}</Typography>
                  </CardContent></Card></Grid>
                </Grid>
              </Box>
            </Stack>
          </CardContent>
        </Card>
      );
    }

    /* ========== 編集ダイアログ（ダミー） ========== */
    function EditDialog({open, onClose, record, onSave}){
      const [form, setForm] = React.useState(record||{});
      React.useEffect(()=>setForm(record||{}),[record]);
      const set = (k)=>(e)=> setForm(s=>({...s,[k]:e.target.value}));
      return (
        <Dialog open={open} onClose={onClose} fullWidth maxWidth="sm">
          <DialogTitle>レコード編集（デモ）</DialogTitle>
          <DialogContent dividers sx={{display:'grid', gap:1.5, pt:2}}>
            <TextField label="ID" value={form.id||''} onChange={set('id')} />
            <TextField label="名称" value={form.name||''} onChange={set('name')} />
            <TextField label="主カテゴリ" value={form.main||''} onChange={set('main')} />
            <TextField label="サブカテゴリ" value={form.sub||''} onChange={set('sub')} />
            <TextField label="施設" value={form.facility||''} onChange={set('facility')} />
            <TextField label="状態" value={form.status||''} onChange={set('status')} />
            <TextField label="基準日1" value={form.date1||''} onChange={set('date1')} />
            <TextField label="基準日2/期限" value={form.date2||form.due||''} onChange={set('date2')} />
            <TextField label="担当" value={form.owner||''} onChange={set('owner')} />
          </DialogContent>
          <DialogActions>
            <Button onClick={onClose}>キャンセル</Button>
            <Button variant="contained" onClick={()=>onSave(form)}>保存（ダミー）</Button>
          </DialogActions>
        </Dialog>
      );
    }

    /* ========== ドメインパネル ========== */
    function DomainBlock({domainId, title, list, filters, allForCompare, demoMode}){
      const [localQ, setLocalQ] = React.useState('');
      const [sortKey, setSortKey] = React.useState('count');
      const [sortAsc, setSortAsc] = React.useState(false);
      const [anchorEl, setAnchorEl] = React.useState(null);
      const [editTarget, setEditTarget] = React.useState(null);
      const [snack, setSnack] = React.useState({open:false, msg:''});

      const filteredBase = React.useMemo(()=>filterRecords(list, filters), [list, filters.facilities, filters.q, filters.statuses]);
      const filtered = React.useMemo(()=>{
        if(!localQ) return filteredBase;
        const q = localQ.toLowerCase();
        return filteredBase.filter(a=>{
          const s = (a.id+' '+a.name+' '+a.main+' '+a.sub).toLowerCase();
          return s.includes(q);
        });
      }, [filteredBase, localQ]);

      const sMainRaw = React.useMemo(()=>summarizeByCategory(domainId, filtered, 'main'), [domainId, filtered]);

      const sMain = React.useMemo(()=>{
        const rows = [...sMainRaw.rows];
        rows.sort((a,b)=>{
          const A = a[sortKey]==null?-Infinity:a[sortKey];
          const B = b[sortKey]==null?-Infinity:b[sortKey];
          const cmp = A<B ? -1 : A>B ? 1 : 0;
          return sortAsc? cmp : -cmp;
        });
        return { ...sMainRaw, rows };
      }, [sMainRaw, sortKey, sortAsc]);

      const kpis = React.useMemo(()=>{
        const total = filtered.length;
        const running = filtered.filter(a=>a.status==='稼働').length;
        const alerts  = filtered.filter(a=>a.date2 && new Date(a.date2) < new Date()).length;
        const facilityCount = new Set(filtered.map(a=>a.facility)).size;
        if(domainId==='sales'){
          const amount = Math.round(filtered.reduce((s,a)=>s+(a.amount||0),0));
          const qty = filtered.reduce((s,a)=>s+(a.qty||0),0);
          const up = qty? Math.round((amount*1000)/qty) : 0;
          return [
            {label:'レコード数', val: total},
            {label:'売上合計(千円)', val: amount.toLocaleString()},
            {label:'客数', val: qty.toLocaleString()},
            {label:'客単価(円)', val: up.toLocaleString()},
            {label:'施設数', val: facilityCount}
          ];
        }
        if(domainId==='contract'){
          const due30 = filtered.filter(a=>a.due && (new Date(a.due)-new Date())/(1000*60*60*24)<=30 && (new Date(a.due)>=new Date())).length;
          const expired = filtered.filter(a=>a.status==='期限切れ').length;
          return [
            {label:'契約件数', val: total},
            {label:'30日以内期限到来', val: due30},
            {label:'期限切れ', val: expired},
            {label:'相手先数', val: new Set(filtered.map(a=>a.partner).filter(Boolean)).size},
            {label:'施設数', val: facilityCount}
          ];
        }
        return [
          {label:'総件数', val: total},
          {label:'稼働率', val: total? Math.round(running/total*100)+'%':'—', sub:`稼働 ${running}/${total}`},
          {label:'アラート件数', val: alerts},
          {label:'施設数', val: facilityCount},
          {label:'主分類数', val: sMain.rows.length}
        ];
      }, [filtered, sMain.rows.length, domainId]);

      const compare = React.useMemo(()=>buildCompareMetrics(domainId, allForCompare, filtered),
        [domainId, allForCompare, filtered]);
      const barMax = Math.max(1, ...sMain.rows.map(r=>r.count));

      const exportCSV = ()=>{
        const rows = [["カテゴリ","件数","全体比(%)","稼働率/遵守率(%)","アラート件数"]];
        sMain.rows.forEach(r=> rows.push([r.name, r.count, sMain.total? (r.ratio?.toFixed(1)) : '—', r.runrate==null?'—':r.runrate.toFixed(1), r.alerts]));
        downloadCSV(`${title}_主分類サマリ.csv`, rows);
      };

      const handleSave = (form)=>{
        setSnack({open:true, msg:`${title}: ${form.id || '(新規)'} を保存しました（ダミー）`});
        setEditTarget(null);
      };

      return (
        <Card>
          <CardContent>
            {/* タイトル行 */}
            <Stack direction="row" justifyContent="space-between" alignItems="center" sx={{mb:1}}>
              <Typography variant="h6">{title}</Typography>
              <Typography color="text.secondary" variant="body2">対象 {filtered.length} 件</Typography>
            </Stack>

            {/* デモ機能：折り畳み（ローカル検索・CSV・並び替え・新規） */}
            <Collapse in={demoMode} unmountOnExit>
              <Box className="sticky-actions">
                <Box className="table-toolbar">
                  <TextField size="small" label="このドメイン内検索（主・サブ・名称）" value={localQ} onChange={(e)=>setLocalQ(e.target.value)} sx={{minWidth:320}} />
                  <Button size="small" variant="outlined" onClick={exportCSV} startIcon={<span className="material-icons">download</span>}>CSV</Button>
                  <Button size="small" onClick={(e)=>setAnchorEl(e.currentTarget)} startIcon={<span className="material-icons">sort</span>}>
                    並び替え
                  </Button>
                  <Menu anchorEl={anchorEl} open={Boolean(anchorEl)} onClose={()=>setAnchorEl(null)}>
                    {[
                      {k:'count',label:'件数'}, {k:'name',label:'名称'}, {k:'ratio',label:'全体比'}, {k:'runrate',label:'稼働/遵守率'}
                    ].map(opt=>(
                      <MenuItem key={opt.k} onClick={()=>{ setSortKey(opt.k); setAnchorEl(null); }}>
                        {sortKey===opt.k ? <span className="material-icons" style={{fontSize:18,marginRight:6}}>check</span> : null}
                        {opt.label}
                      </MenuItem>
                    ))}
                    <Divider />
                    <MenuItem onClick={()=>{ setSortAsc(a=>!a); setAnchorEl(null); }}>
                      <span className="material-icons" style={{fontSize:18,marginRight:6}}>{sortAsc?'arrow_upward':'arrow_downward'}</span>
                      {sortAsc?'昇順':'降順'}
                    </MenuItem>
                  </Menu>
                  <Button size="small" variant="contained" onClick={()=>setEditTarget({})} startIcon={<span className="material-icons">add</span>}>新規（ダミー）</Button>
                </Box>
              </Box>
            </Collapse>

            {/* KPI */}
            <Box className="kpi-grid" style={{marginBottom:16}}>
              {kpis.map(k=>(
                <Card key={k.label} variant="outlined" sx={{p:2}}>
                  <Typography color="text.secondary" variant="body2">{k.label}</Typography>
                  <Typography variant="h5" className="mono">{k.val}</Typography>
                  {k.sub && <Typography color="text.secondary" variant="caption">{k.sub}</Typography>}
                </Card>
              ))}
            </Box>

            {/* 主分類サマリ ＆ 比較 */}
            <Box className="panel-grid">
              <Box>
                <Typography variant="subtitle2" gutterBottom>分類別サマリー（主カテゴリ）</Typography>

                {/* グラフ */}
                <Box sx={{overflowX:'auto', mb:1.5}}>
                  <Box sx={{display:'flex', alignItems:'end', gap:1, height:200, p:1}}>
                    {sMain.rows.map(r=>(
                      <Tooltip key={r.id} title={`${r.name}: ${r.count}件`}>
                        <Box sx={{display:'flex', flexDirection:'column', alignItems:'center', minWidth:48}}>
                          <Box className={r.count===0?'bar zero':'bar'} sx={{width:28, height:(r.count/barMax*165)+12}}/>
                          <Typography variant="caption" color="text.secondary" className="nowrap" style={{maxWidth:72,marginTop:6}}>{r.name}</Typography>
                        </Box>
                      </Tooltip>
                    ))}
                  </Box>
                </Box>

                {/* テーブル（操作列はデモ時のみ） */}
                <TableContainer component={Paper} variant="outlined">
                  <Table size="small" stickyHeader>
                    <TableHead>
                      <TableRow>
                        <TableCell>カテゴリ</TableCell>
                        <TableCell align="right">件数</TableCell>
                        <TableCell align="right">全体比(%)</TableCell>
                        <TableCell align="right">稼働率/遵守率(%)</TableCell>
                        <TableCell align="right">アラート件数</TableCell>
                        {demoMode && <TableCell align="center">操作</TableCell>}
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {sMain.rows.map(r=>(
                        <TableRow key={r.id} className={r.muted?'zero-row':''}>
                          <TableCell>{r.name}</TableCell>
                          <TableCell align="right" className="mono">{r.count}</TableCell>
                          <TableCell align="right" className="mono">{sMain.total? (r.ratio?.toFixed(1)) : '—'}</TableCell>
                          <TableCell align="right" className="mono">{r.runrate===null? '—' : r.runrate.toFixed(1)}</TableCell>
                          <TableCell align="right" className="mono">{r.alerts}</TableCell>
                          {demoMode && (
                            <TableCell align="center">
                              <Tooltip title="編集（ダミー）">
                                <IconButton size="small" onClick={()=>setEditTarget({
                                  id: `${domainId.toUpperCase()}-${r.id}`,
                                  name: `${title}:${r.name}`,
                                  main: r.id, sub:'', facility: '', status: '稼働',
                                  date1: '', date2: '', owner:'担当'
                                })}>
                                  <span className="material-icons" style={{fontSize:18}}>edit</span>
                                </IconButton>
                              </Tooltip>
                            </TableCell>
                          )}
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </Box>

              {/* 比較 */}
              <Box>
                <Typography variant="subtitle2" gutterBottom>比較パネル（全体＝100%基準）</Typography>
                <Typography variant="body2" color="text.secondary" sx={{mb:1}}>
                  全体を常に<b>100%</b>とし、選択対象の相対値（%）を表示。ツールチップに実比率を表記します。
                </Typography>

                <Stack gap={1.5}>
                  {compare.map((m)=>(
                    <Box key={m.label}>
                      <Stack direction="row" justifyContent="space-between" sx={{mb:.25}}>
                        <Typography>{m.label}</Typography>
                        <Tooltip title={m.detail}><Typography color="text.secondary">{m.detail}</Typography></Tooltip>
                      </Stack>
                      <Box className="cmp-bar">
                        <Box className="cmp-fill" sx={{width: `${Math.min(100, Math.max(0,m.sel)).toFixed(1)}%`}} />
                        <Box className="cmp-line" title="全体=100%"></Box>
                      </Box>
                      <Stack direction="row" gap={1} sx={{mt:.25}}>
                        <Chip size="small" label="全体=100%" />
                        <Chip size="small" color="primary" variant="outlined"
                          label={`選択=${Math.min(100, Math.max(0,m.sel)).toFixed(1)}%`} />
                      </Stack>
                    </Box>
                  ))}
                </Stack>
              </Box>
            </Box>

            {/* デモ用ダイアログ＆スナックは demoMode のときだけ読み込み */}
            {demoMode && (
              <>
                <EditDialog open={!!editTarget} record={editTarget} onClose={()=>setEditTarget(null)} onSave={handleSave}/>
                <Snackbar open={snack.open} autoHideDuration={2200} onClose={()=>setSnack({open:false,msg:''})}>
                  <Alert severity="success" variant="filled">{snack.msg}</Alert>
                </Snackbar>
              </>
            )}
          </CardContent>
        </Card>
      );
    }

    /* ========== メイン ========== */
    function App(){
      // ▼ デモ機能一括トグル（ONで説明・デモ設定・ドメイン内ツールバーが表示）
      const [demoMode, setDemoMode] = React.useState(true);

      // ▼ デモ設定：モックデータ生成のためのシード・件数
      const [seed, setSeed]   = React.useState(11);
      const [count, setCount] = React.useState(220);

      // ▼ 初期データ生成（各ドメイン分）
      const [recordsByDomain, setRecordsByDomain] = React.useState(()=>{
        const m={}; DOMAINS.forEach(d=> m[d.id]=generateMock(d.id,{seed, count})); return m;
      });

      // ▼ 共通フィルタ（実運用想定：常時表示）
      const [facSel, setFacSel] = React.useState([]);
      const [q, setQ]           = React.useState('');
      const [sts, setSts]       = React.useState(['稼働','点検中','故障','期限切れ','解約予定']);

      // ▼ デモ：データ再生成
      const regen = ()=>{
        const m={}; DOMAINS.forEach(d=> m[d.id]=generateMock(d.id,{seed, count}));
        setRecordsByDomain(m);
      };

      const allRecordsFlat = React.useMemo(()=> Object.values(recordsByDomain).flat(), [recordsByDomain]);
      const filters = { facilities: facSel, q, statuses: sts };

      return (
        <ThemeProvider theme={theme}>
          <Container maxWidth={false} sx={{py:2, px:{xs:1.5, sm:2, md:3, lg:4}}}>
            {/* ヘッダー & 共通フィルタ */}
            <Card sx={{mb:2}}>
              <CardContent>
                <Stack direction={{xs:'column', md:'row'}} alignItems={{xs:'start', md:'center'}} justifyContent="space-between" spacing={2}>
                  <Typography variant="h5">統合ダッシュボード（KPI → 主分類サマリ＋比較／11ドメイン）</Typography>

                  {/* デモ機能の一括トグル（折り畳みON/OFF） */}
                  <FormControlLabel
                    control={<Switch checked={demoMode} onChange={(e)=>setDemoMode(e.target.checked)} />}
                    label="デモ機能・説明を表示"
                  />
                </Stack>

                {/* ▼▼▼ デモ用UIはここに集約して折り畳み（デフォルトON） ▼▼▼ */}
                <Collapse in={demoMode} unmountOnExit>
                  {/* 説明アコーディオン */}
                  <Accordion defaultExpanded sx={{mt:1}}>
                    <AccordionSummary expandIcon={<span className="material-icons">expand_more</span>}>
                      <Stack direction="row" gap={1} alignItems="center" flexWrap="wrap">
                        <Chip label="未出現カテゴリ=0で可視" variant="outlined" />
                        <Chip label="全体=100%比較" color="primary" variant="outlined" />
                        <Chip label="単一施設で概要表示" variant="outlined" />
                        <Typography className="muted" sx={{ml:1}}>（デモ向け機能／説明は折り畳み可能）</Typography>
                      </Stack>
                    </AccordionSummary>
                    <AccordionDetails>
                      <Typography variant="body2" color="text.secondary" sx={{mb:1}}>
                        本ページはブラウザ内でモックデータを生成するデモUIです。各ドメインの上部にある検索・CSV出力・並び替え・新規作成、表の「編集」ボタンはダミー実装です。
                        上のスイッチをOFFにすると、これらのデモ用UIとこの説明を一括で非表示にできます。
                      </Typography>
                    </AccordionDetails>
                  </Accordion>

                  {/* ★ 新規追加：デモ設定（モックデータ生成）を折り畳み */}
                  <Accordion sx={{mt:1}}>
                    <AccordionSummary expandIcon={<span className="material-icons">expand_more</span>}>
                      <Stack direction="row" gap={1} alignItems="center" flexWrap="wrap">
                        <span className="material-icons" style={{fontSize:18}}>science</span>
                        <Typography>デモ設定（モックデータ生成）</Typography>
                        <Chip size="small" label="seed / 件数 / 再生成" className="muted" />
                      </Stack>
                    </AccordionSummary>
                    <AccordionDetails>
                      <Stack direction="row" gap={2} flexWrap="wrap" alignItems="center">
                        {/* 乱数シード（デモ） */}
                        <TextField
                          type="number" label="乱数シード"
                          value={seed}
                          onChange={e=>setSeed(Number(e.target.value)||0)}
                          sx={{maxWidth:160}}
                          helperText="同じシード＝同じデータ"
                        />
                        {/* 件数（デモ） */}
                        <TextField
                          type="number" label="件数/ドメイン"
                          value={count}
                          onChange={e=>setCount(Math.max(80, Number(e.target.value)||80))}
                          sx={{maxWidth:180}}
                          helperText="最小80件（負荷対策）"
                        />
                        {/* 再生成（デモ） */}
                        <Button variant="contained" onClick={regen} startIcon={<span className="material-icons">refresh</span>}>
                          データ再生成
                        </Button>
                      </Stack>
                      <Typography variant="caption" color="text.secondary" sx={{display:'block', mt:1}}>
                        ※ この設定はデモ用です。OFFにするとUIごと非表示になります。
                      </Typography>
                    </AccordionDetails>
                  </Accordion>
                </Collapse>
                {/* ▲▲▲ デモ用UIの折り畳み ここまで ▲▲▲ */}

                <Divider sx={{my:2}} />

                {/* 共通フィルタ（実運用想定のため常時表示） */}
                <Stack direction="row" gap={2} flexWrap="wrap">
                  {/* 施設（複数） */}
                  <FormControl sx={{minWidth:260}}>
                    <InputLabel id="fac-label">施設（複数選択可）</InputLabel>
                    <Select
                      labelId="fac-label" multiple value={facSel}
                      onChange={(e)=>setFacSel(e.target.value)}
                      input={<OutlinedInput label="施設（複数選択可）" />}
                      renderValue={(selected)=>selected.map(labelOfFacility).join(', ')}
                    >
                      {FACILITIES.map(f=>(
                        <MenuItem key={f.id} value={f.id}>
                          <Checkbox checked={facSel.indexOf(f.id) > -1} />
                          <ListItemText primary={f.label} />
                        </MenuItem>
                      ))}
                    </Select>
                  </FormControl>

                  {/* 状態 */}
                  <FormControl sx={{minWidth:240}}>
                    <InputLabel id="st-label">状態</InputLabel>
                    <Select
                      labelId="st-label" multiple value={sts}
                      onChange={(e)=>setSts(e.target.value)}
                      input={<OutlinedInput label="状態" />}
                      renderValue={(selected)=>selected.join(', ')}
                    >
                      {['稼働','点検中','故障','期限切れ','解約予定'].map(s=>(
                        <MenuItem key={s} value={s}>
                          <Checkbox checked={sts.indexOf(s) > -1} />
                          <ListItemText primary={s} />
                        </MenuItem>
                      ))}
                    </Select>
                  </FormControl>

                  {/* キーワード検索（全体） */}
                  <TextField label="検索（ID/名称/相手先/期間など）" value={q} onChange={(e)=>setQ(e.target.value)} sx={{minWidth:300}} />
                </Stack>
              </CardContent>
            </Card>

            {/* 単一施設選択時：概要 */}
            {facSel.length===1 && (
              <FacilityOverview facilityId={facSel[0]} allRecords={allRecordsFlat} />
            )}

            {/* ドメインセクション */}
            <Box className="domain-grid">
              {DOMAINS.map(d=>(
                <DomainBlock
                  key={d.id}
                  domainId={d.id}
                  title={d.name}
                  list={recordsByDomain[d.id]||[]}
                  filters={filters}
                  allForCompare={recordsByDomain[d.id]||[]}
                  demoMode={demoMode}
                />
              ))}
            </Box>

            {/* フッターの注意もデモと連動して折り畳み */}
            <Collapse in={demoMode} unmountOnExit>
              <Box sx={{textAlign:'right', my:3}}>
                <Typography color="text.secondary" variant="caption">
                  ※デモUI（ブラウザ内でモック生成）。主/サブカテゴリはマスタ基準でゼロも可視化。比較は全体=100%基準の相対表示です。
                </Typography>
              </Box>
            </Collapse>
          </Container>
        </ThemeProvider>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App />);
  </script>
</body>
</html>
