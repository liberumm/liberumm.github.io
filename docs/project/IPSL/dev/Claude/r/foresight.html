<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>計画</title>
  <!-- MUI用フォント＆アイコン -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
  <style>
    body { margin: 20px; font-family: Roboto, sans-serif; }
    .header-cell { white-space: nowrap; font-weight: bold; background-color: #f5f5f5; text-align: center; }
    .editable-cell { min-width: 40px; height: 24px; line-height: 24px; text-align: right; border: 1px solid #ccc; padding: 2px; outline: none; }
    .editable-cell:focus { border-color: #1976d2; background-color: #e3f2fd; }
    .disabled-cell { background-color: #f5f5f5; color: #999; pointer-events: none; }
    .group-header { background-color: #e0e0e0; cursor: pointer; font-weight: bold; }
    .sub-group-header { background-color: #eeeeee; cursor: pointer; font-weight: bold; }
    .chip-area > * { margin-right: 5px; }
    /* MUI TableCell のパディング調整 */
    .css-1pj6zck {
      padding: 2px !important;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- ライブラリ群 -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js" crossorigin></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- 各コンポーネントの読み込み -->
  <script type="text/babel" src="components/header.js"></script>
  <script type="text/babel" src="components/filter.js"></script>
  <script type="text/babel" src="components/forecast-ChartComponent.js"></script>
  <script type="text/babel" src="components/forecast-GraphDataTable.js"></script>
  <script type="text/babel" src="components/forecast-IntegratedTable.js"></script>
  <script type="text/babel" src="components/forecast-LastYearTable.js"></script>
  <script type="text/babel" src="components/forecast-GroupDetailTable.js"></script>
  <script type="text/babel" src="components/footer.js"></script>

  <!-- メインアプリケーション（App.js の内容を index.html 内に記述） -->
  <script type="text/babel">
    const {
      AppBar, Box, Container, CssBaseline,
      Paper, Typography, ThemeProvider, createTheme,
      Toolbar
    } = MaterialUI;
  
    const theme = createTheme({
      palette: {
        primary: { main: "#1976d2" },
        background: { default: "#f0f2f5" },
      },
    });

    // メインアプリケーション
    function MainApp() {
      // 各種状態（年度、表示対象、フィルタ用チップ）
      const [selectedYear, setSelectedYear] = React.useState(new Date().getFullYear());
      const [selectedDisplay, setSelectedDisplay] = React.useState("全社");
      const [selectedDeptChip, setSelectedDeptChip] = React.useState(null);
      const [selectedCornerChip, setSelectedCornerChip] = React.useState(null);

      // 以下はダミーデータ生成例（実際のロジックに合わせて更新してください）
      const parentColumns = ["年度合計", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月", "1月", "2月", "3月", "4月"];
      const monthlyData = {};
      parentColumns.slice(1).forEach((month, index) => {
        monthlyData[index+1] = {
          old: Math.floor(Math.random()*100),
          factor: Math.floor(Math.random()*100),
          actual: Math.floor(Math.random()*100)
        };
      });
      const currentPlanData = {};
      const progressData = {};
      const lastYearData = {};
      parentColumns.slice(1).forEach((month, index) => {
        currentPlanData[index+1] = {
          header: Math.floor(Math.random()*1000),
          beginningCost: Math.floor(Math.random()*1000),
          beginningPrice: Math.floor(Math.random()*1000),
          sales: Math.floor(Math.random()*1000),
          grossProfit: Math.floor(Math.random()*1000),
          midPurchaseCost: Math.floor(Math.random()*1000),
          midPurchasePrice: Math.floor(Math.random()*1000),
          priceIncrease: Math.floor(Math.random()*1000),
          priceDecrease: Math.floor(Math.random()*1000),
          lossRate: Math.floor(Math.random()*1000),
          rebateCost: Math.floor(Math.random()*1000),
          endingCost: Math.floor(Math.random()*1000),
          endingPrice: Math.floor(Math.random()*1000),
          turnoverDays: Math.floor(Math.random()*1000)
        };
        progressData[index+1] = {
          header: Math.floor(Math.random()*1000),
          beginningCost: Math.floor(Math.random()*1000),
          beginningPrice: Math.floor(Math.random()*1000),
          sales: Math.floor(Math.random()*1000),
          grossProfit: Math.floor(Math.random()*1000),
          midPurchaseCost: Math.floor(Math.random()*1000),
          midPurchasePrice: Math.floor(Math.random()*1000),
          priceIncrease: Math.floor(Math.random()*1000),
          priceDecrease: Math.floor(Math.random()*1000),
          lossRate: Math.floor(Math.random()*1000),
          rebateCost: Math.floor(Math.random()*1000),
          endingCost: Math.floor(Math.random()*1000),
          endingPrice: Math.floor(Math.random()*1000),
          turnoverDays: Math.floor(Math.random()*1000)
        };
        lastYearData[index+1] = {
          header: Math.floor(Math.random()*1000),
          beginningCost: Math.floor(Math.random()*1000),
          beginningPrice: Math.floor(Math.random()*1000),
          sales: Math.floor(Math.random()*1000),
          grossProfit: Math.floor(Math.random()*1000),
          midPurchaseCost: Math.floor(Math.random()*1000),
          midPurchasePrice: Math.floor(Math.random()*1000),
          priceIncrease: Math.floor(Math.random()*1000),
          priceDecrease: Math.floor(Math.random()*1000),
          lossRate: Math.floor(Math.random()*1000),
          rebateCost: Math.floor(Math.random()*1000),
          endingCost: Math.floor(Math.random()*1000),
          endingPrice: Math.floor(Math.random()*1000),
          turnoverDays: Math.floor(Math.random()*1000)
        };
      });

      return (
        <React.Fragment>
        {/* header.js の Header コンポーネントを表示 */}
        <Header />

        <Container maxWidth={true} sx={{ mt: 2, mb:2, px: { xs: 1, sm: 2, md: 3 } }}>
          <Filter 
            selectedYear={selectedYear}
            setSelectedYear={setSelectedYear}
            selectedDisplay={selectedDisplay}
            setSelectedDisplay={setSelectedDisplay}
            selectedDeptChip={selectedDeptChip}
            setSelectedDeptChip={setSelectedDeptChip}
            selectedCornerChip={selectedCornerChip}
            setSelectedCornerChip={setSelectedCornerChip}
          />
          <h1>計画（{selectedDisplay}）</h1>
          <ChartComponent monthlyData={monthlyData} />
          <GraphDataTable monthlyData={monthlyData} />
          <IntegratedTable 
            currentPlanData={currentPlanData} 
            progressData={progressData} 
            lastYearData={lastYearData} 
          />
          <LastYearTable lastYearData={lastYearData} />

          <GroupDetailTable 
            selectedYear={selectedYear}
            selectedDisplay={selectedDisplay}
            selectedDeptChip={selectedDeptChip}
            selectedCornerChip={selectedCornerChip}
          />
        </Container>
        <Footer />
      </React.Fragment>
      );
    }

    ReactDOM.render(
      <ThemeProvider theme={theme}>
      <CssBaseline />
      <MainApp />
      </ThemeProvider>
    , document.getElementById("root"));
  </script>
</body>
</html>

