<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>react-pivottable (CDN 版サンプル)</title>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- PropTypes（react-pivottable の依存）-->
  <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

  <!-- Plotly（グラフ表示が不要なら省略可）-->
  <script src="https://cdn.plot.ly/plotly-basic-latest.min.js"></script>

  <!-- react-pivottable (UMD ビルド) -->
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/react-pivottable@0.11.0/pivottable.css"/>
  <script src="https://cdn.jsdelivr.net/npm/react-pivottable@0.11.0/PivotTableUI.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-pivottable@0.11.0/TableRenderers.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-pivottable@0.11.0/PlotlyRenderers.js"></script>

  <!-- JSX をブラウザで変換する Babel (開発用) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
    #root{padding:24px}
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- ========================= アプリ本体 ========================= -->
  <script type="text/babel">
    // react-pivottable のグローバル（UMD 読み込みなので window 直下）
    const { PivotTableUI, TableRenderers, PlotlyRenderers } = window;

    // 例として 2 次元配列形式のデータ
    const data = [
      ['日付',       'カテゴリ', '売上'],
      ['2025-04-01', 'A',        100],
      ['2025-04-01', 'B',        200],
      ['2025-04-02', 'A',        150],
      ['2025-04-02', 'B',        120],
      // …必要に応じて API から取得して setState で更新可能
    ];

    function App() {
      // ピボット設定を保持
      const [pivotState, setPivotState] = React.useState({});

      return (
        <div>
          <h2>ピボットテーブル分析（CDN 版）</h2>

          <PivotTableUI
            data={data}
            onChange={s => setPivotState(s)}
            // テーブル＋Plotly レンダラーを結合
            renderers={{ ...TableRenderers, ...PlotlyRenderers }}
            {...pivotState}     // 現在の設定を展開
          />
        </div>
      );
    }

    // ルートへマウント
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
