<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚µãƒŸãƒƒãƒˆ è¦‹å­¦ãƒ»ä½“é¨“ç”³è¾¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- ======================= ãƒ•ã‚©ãƒ³ãƒˆ & ã‚¢ã‚¤ã‚³ãƒ³ ======================= -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <!-- ======================= React / Babel / MUI (CDN) =============== -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <!-- Emotion + Material-UI -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/lab@5.0.0-alpha.148/umd/material-ui-lab.production.min.js"></script>
  <!-- Sortable.jsï¼ˆã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ©ãƒƒã‚°ä¸¦ã¹æ›¿ãˆç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <!-- ======================= å…±é€šã‚¹ã‚¿ã‚¤ãƒ« ============================= -->
  <style>
    body{
      margin:0;
      min-height:100vh;
      font-family:'Noto Sans JP',sans-serif;
      background:linear-gradient(135deg,#a1c4fd 0%,#c2e9fb 100%);
    }
    .glass{
      background:rgba(255,255,255,0.93);
      backdrop-filter:blur(18px);
      border:1px solid rgba(255,255,255,0.4);
      border-radius:16px;
      box-shadow:0 8px 32px rgba(0,0,0,0.08);
    }
    .entry-card{
      cursor:pointer;
      transition:transform .18s,box-shadow .18s;
    }
    .entry-card:hover{
      transform:translateY(-4px);
      box-shadow:0 8px 24px rgba(0,0,0,0.14);
    }
    .glass-effect{background:rgba(255,255,255,0.93);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.3);box-shadow:0 8px 32px rgba(0,0,0,0.09);}
    .glass-form-section{background:rgba(255,255,255,0.97);border-radius:14px;margin-bottom:36px;box-shadow:0 2px 12px 0 rgba(25,118,210,0.07);border:1.5px solid #e3e6ef;overflow:hidden;}
    .glass-section-header{background:linear-gradient(90deg,#2196f3 10%,#1565c0 100%);color:white;padding:18px 28px 14px 22px;font-weight:600;font-size:1.15rem;display:flex;align-items:center;gap:10px;letter-spacing:1px;border-bottom:1px solid #e3e6ef;}
    .glass-section-header.notice{background:linear-gradient(90deg,#ffe082,#fff176 90%) !important;color:#795548 !important;font-weight:700 !important;font-size:1.13rem !important;letter-spacing:0.04em;border-bottom:none !important;box-shadow:0 1px 6px 0 #ffe08240;align-items:center;}
    .glass-notice-section{background:#fffde7;border:2px solid #ffe082;margin-bottom:32px;border-radius:14px;}
    .req-bg .MuiInputBase-input{background:#fffde7 !important;}
    .MuiChip-root{font-weight:600;letter-spacing:1px;}
    .drag-handle{cursor:grab;color:#1976d2;margin-right:8px;margin-top:12px;font-size:30px;}
    .sortable-chosen{background:#e3f2fd !important;}
    .sortable-drag{background:#bbdefb !important;}
    .add-btn{font-weight:700 !important;min-width:120px;box-shadow:0 1px 4px 0 rgba(25,118,210,0.10);margin-right:8px;}
    .del-btn{min-width:38px !important;min-height:38px !important;border-radius:50%;margin-top:6px;margin-left:4px;font-size:1.3rem !important;}
    @media(max-width:600px){
      .glass-section-header{padding:14px 12px 10px 14px;font-size:1rem;}
      .glass-form-section{border-radius:8px;}
      .drag-handle{font-size:24px;margin-right:5px;}
    }
    .MuiToggleButtonGroup-root{margin-bottom:16px;}
  </style>
</head>
<body>
  <div id="root"></div>
  <!-- ======================= React ã‚¢ãƒ—ãƒªæœ¬ä½“ ======================== -->
  <script type="text/babel">

  // ------------------------------------------------------------
  // MUIã‚¨ã‚¤ãƒªã‚¢ã‚¹
  // ------------------------------------------------------------
  const {
    Box, Typography, Paper, Grid, Button, Snackbar, Alert, Tabs, Tab,
    Card, CardContent, CardActions, Chip, IconButton, TextField, Collapse,
    RadioGroup, FormControlLabel, Radio, FormLabel, FormControl,
    ToggleButtonGroup, ToggleButton, Table, TableHead, TableRow, TableCell,
    TableBody, TableContainer,Checkbox, Dialog, DialogTitle, DialogContent, DialogActions,
  } = MaterialUI;

  // -------------------------------------------------------------------
  // ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ç”¨ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒªã‚¢
  // -------------------------------------------------------------------
  function FileDropZone({ file, onFile }) {
    const [dragOver, setDragOver] = React.useState(false);
    const inputRef = React.useRef();

    const handleDrop = (e) => {
      e.preventDefault();
      setDragOver(false);
      if (e.dataTransfer.files && e.dataTransfer.files[0])
        onFile({ target: { files: [e.dataTransfer.files[0]] } });
    };

    return (
      <Box
        onDrop={handleDrop}
        onDragOver={e => { e.preventDefault(); setDragOver(true); }}
        onDragLeave={() => setDragOver(false)}
        onClick={() => inputRef.current.click()}
        role="button"
        tabIndex={0}
        aria-label="ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã¾ãŸã¯ãƒ‰ãƒ­ãƒƒãƒ—"
        sx={{
          border: dragOver ? '2.5px solid #1976d2' : '2px dashed #b0bec5',
          borderRadius:3, bgcolor: dragOver ? '#e3f2fd' : '#f8fafc',
          textAlign:'center', p:3, cursor:'pointer', transition:'all 0.16s'
        }}
      >
        <input ref={inputRef} type="file"
               accept=".pdf,.xlsx,.doc,.docx,image/*"
               style={{ display:'none' }} onChange={onFile}/>
        <span className="material-icons"
              style={{fontSize:32,color:'#1976d2',marginBottom:6}}>upload_file</span>
        <Typography sx={{fontWeight:600,color:'#1976d2',mb:1.5}}>
          ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—<br/>ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ
        </Typography>
        {file
          ? <Typography sx={{color:'#37474f',fontWeight:500,mt:1}}>
              é¸æŠä¸­: {file.name}
            </Typography>
          : <Typography sx={{color:'text.secondary',fontSize:'0.99em'}}>
              ï¼ˆPDFã€xlsxã€Wordã€ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãªã©æ·»ä»˜ã§ãã¾ã™ï¼‰
            </Typography>}
      </Box>
    );
  }

  // -------------------------------------------------------------------
  // ç”³è¾¼å¸Œæœ›ãƒ¬ã‚³ãƒ¼ãƒ‰ã®åˆæœŸã²ãªå½¢ & ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã®åˆæœŸå€¤
  // -------------------------------------------------------------------
  const getPrefItem = () => ({
    id: Date.now() + Math.random(),
    store:'', altApplicable:'ãªã—', altStore:'',
    date:'', start:'', end:'',
    count:'', classCount:'', escortCount:'',
    preVisit:'ãªã—', preVisitDate:'', preVisitTime:''
  });

  const getInitialForm = () => ({
    schoolName:'', grade:'', contactName:'',
    tel1:'',tel2:'',tel3:'', fax1:'',fax2:'',fax3:'',
    email:'', sendMethod:'ãƒ¡ãƒ¼ãƒ«', remarks:'',
    preferences:[getPrefItem()],
    contactNotes:'', file:null, ack:false,
    applicationType: '',        // ç”³ã—è¾¼ã¿å†…å®¹ï¼ˆãƒ©ã‚¸ã‚ªé¸æŠï¼‰
    applicationOther: '',       // ãã®ä»–ï¼šå…·ä½“çš„å†…å®¹
    supportType: '',            // å¸Œæœ›å¯¾å¿œå†…å®¹ï¼ˆãƒ©ã‚¸ã‚ªé¸æŠï¼‰
    supportOther: '',           // ãã®ä»–ï¼šå…·ä½“çš„å†…å®¹
  });

  // -------------------------------------------------------------------
  // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆãƒ‰ãƒ©ãƒƒã‚°ä¸¦ã¹æ›¿ãˆä»˜ãï¼‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  // -------------------------------------------------------------------
  function PreferencesSortable({ prefs, setPrefs }){
    const listRef = React.useRef(null);

    React.useEffect(()=>{
      if(!listRef.current) return;
      const sortable = Sortable.create(listRef.current,{
        animation:160, handle:".drag-handle", ghostClass:"sortable-drag",
        chosenClass:"sortable-chosen",
        onEnd:e=>{
          if(e.oldIndex===e.newIndex) return;
          const arr=[...prefs];
          const [moved]=arr.splice(e.oldIndex,1);
          arr.splice(e.newIndex,0,moved);
          setPrefs(arr);
        }
      });
      return ()=>sortable.destroy();
    },[prefs]);

    return(
      <div ref={listRef}>
        {prefs.map((pref,idx)=>(

          <Paper key={pref.id}
                 sx={{p:{xs:2,sm:3}, mb:3, borderRadius:3,
                      boxShadow:'0 2px 10px 0 rgba(25,118,210,0.09)',
                      borderLeft:'7px solid #1976d2', position:'relative',
                      background:'#f9fbff'}}>
            {/* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ï¼‹Chipï¼‹å‰Šé™¤ï¼‰ */}
            <Box sx={{display:'flex',alignItems:'center',mb:2,pl:1,
                      pb:0.5,borderBottom:'1.5px dashed #90caf9'}}>
              <span className="material-icons drag-handle"
                    style={{color:'#1565c0',fontSize:30,marginRight:8}}>
                drag_indicator
              </span>
              <Chip icon={<span className="material-icons"
                               style={{fontSize:19,verticalAlign:'-4px'}}>star</span>}
                    label={`ç¬¬${idx+1}å¸Œæœ›`} color="primary" size="small"
                    sx={{fontWeight:800,fontSize:'1.07rem',px:1.5,py:0.4}}/>
              <Box sx={{flexGrow:1}} />
              {prefs.length>1 && (
                <Button size="small" color="error" className="del-btn"
                        variant="contained"
                        sx={{minWidth:40,minHeight:40,borderRadius:'50%',
                             bgcolor:'#fff0f0',color:'#d32f2f',
                             '&:hover':{bgcolor:'#ffeaea'}}}
                        onClick={()=>setPrefs(prefs.filter((_,i)=>i!==idx))}>
                  <span className="material-icons">delete</span>
                </Button>
              )}
            </Box>

            {/* --- å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç¾¤ï¼ˆGrid ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ --- */}
            <Grid container spacing={2.2} alignItems="center">
              <Grid item xs={12} sm={3}>
                <TextField required fullWidth label="åº—èˆ—å"
                  value={pref.store}
                  className="req-bg"
                  InputProps={{startAdornment:
                    <span className="material-icons"
                          style={{color:'#90caf9',marginRight:8,fontSize:20}}>
                      store
                    </span>}}
                  onChange={e=>{
                    const arr=[...prefs]; arr[idx].store=e.target.value; setPrefs(arr);
                  }}/>
              </Grid>
              <Grid item xs={6} sm={2.2}>
                <TextField required fullWidth type="date" label="æ—¥ä»˜"
                  InputLabelProps={{shrink:true}}
                  value={pref.date} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].date=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.6}>
                <TextField required fullWidth type="time" label="é–‹å§‹"
                  InputLabelProps={{shrink:true}}
                  value={pref.start} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].start=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.6}>
                <TextField required fullWidth type="time" label="çµ‚äº†"
                  InputLabelProps={{shrink:true}}
                  value={pref.end} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].end=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.2}>
                <TextField required fullWidth type="number" label="äººæ•°"
                  value={pref.count} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].count=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.2}>
                <TextField fullWidth type="number" label="ã‚¯ãƒ©ã‚¹æ•°"
                  value={pref.classCount} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].classCount=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.2}>
                <TextField fullWidth type="number" label="ä»˜ãæ·»ã„"
                  value={pref.escortCount} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].escortCount=e.target.value;setPrefs(a);}}/>
              </Grid>
            </Grid>

            {/* --- æŒ¯æ›¿åº—èˆ— & äº‹å‰è¨ªå• ã‚ªãƒ—ã‚·ãƒ§ãƒ³ --- */}
            <Grid container spacing={2} alignItems="center" sx={{mt:1.5}}>
              <Grid item xs={12} sm={4.5}>
                <FormControl component="fieldset" fullWidth>
                  <FormLabel component="legend" sx={{fontWeight:500,fontSize:'1.05em'}}>
                    æŒ¯æ›¿å¯èƒ½åº—èˆ—
                  </FormLabel>
                  <RadioGroup row value={pref.altApplicable}
                    onChange={e=>{
                      const a=[...prefs]; a[idx].altApplicable=e.target.value;
                      if(e.target.value==='ãªã—') a[idx].altStore='';
                      setPrefs(a);
                    }}>
                    <FormControlLabel value="ãªã—" control={<Radio/>} label="ãªã—"/>
                    <FormControlLabel value="ã‚ã‚Š" control={<Radio/>} label="ã‚ã‚Š"/>
                  </RadioGroup>
                </FormControl>
              </Grid>
              {pref.altApplicable==='ã‚ã‚Š' && (
                <Grid item xs={12} sm={4}>
                  <TextField fullWidth label="æŒ¯æ›¿åº—èˆ—å"
                    value={pref.altStore}
                    InputProps={{startAdornment:
                      <span className="material-icons"
                            style={{color:'#90caf9',marginRight:8,fontSize:19}}>
                        storefront
                      </span>}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].altStore=e.target.value;setPrefs(a);}}/>
                </Grid>
              )}
            </Grid>

            <Grid container spacing={2} alignItems="center" sx={{mt:0.7}}>
              <Grid item xs={12} sm={4.5}>
                <FormControl component="fieldset" fullWidth>
                  <FormLabel component="legend" sx={{fontWeight:500,fontSize:'1.05em'}}>
                    äº‹å‰è¨ªå•å¸Œæœ›
                  </FormLabel>
                  <RadioGroup row value={pref.preVisit}
                    onChange={e=>{
                      const a=[...prefs];a[idx].preVisit=e.target.value;
                      if(e.target.value==='ãªã—'){
                        a[idx].preVisitDate='';a[idx].preVisitTime='';
                      }
                      setPrefs(a);}}>
                    <FormControlLabel value="ãªã—" control={<Radio/>} label="ãªã—"/>
                    <FormControlLabel value="ã‚ã‚Š" control={<Radio/>} label="ã‚ã‚Š"/>
                  </RadioGroup>
                </FormControl>
              </Grid>
              {pref.preVisit==='ã‚ã‚Š'&&(
                <>
                  <Grid item xs={6} sm={4}>
                    <TextField fullWidth type="date" label="è¨ªå•æ—¥"
                      InputLabelProps={{shrink:true}}
                      value={pref.preVisitDate}
                      onChange={e=>{
                        const a=[...prefs];a[idx].preVisitDate=e.target.value;setPrefs(a);}}/>
                  </Grid>
                  <Grid item xs={6} sm={4}>
                    <TextField fullWidth type="time" label="è¨ªå•æ™‚é–“"
                      InputLabelProps={{shrink:true}}
                      value={pref.preVisitTime}
                      onChange={e=>{
                        const a=[...prefs];a[idx].preVisitTime=e.target.value;setPrefs(a);}}/>
                  </Grid>
                </>
              )}
            </Grid>
          </Paper>
        ))}
        {/* --- å¸Œæœ›è¿½åŠ ãƒœã‚¿ãƒ³ --- */}
        <Box textAlign="right" sx={{mt:2,mb:1}}>
          <Button variant="contained" color="primary" className="add-btn"
                  startIcon={<span className="material-icons">add_circle</span>}
                  disabled={prefs.length>=5}
                  onClick={()=>prefs.length<5 && setPrefs([...prefs,getPrefItem()])}>
            å¸Œæœ›ã‚’è¿½åŠ 
          </Button>
          <Typography variant="caption" sx={{ml:1,color:'text.secondary'}}>
            â€»æœ€å¤§5ä»¶ã¾ã§è¿½åŠ ã§ãã¾ã™
          </Typography>
        </Box>
      </div>
    );
  }

  // -------------------------------------------------------------------
  // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆæ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ãã®ã¾ã¾ï¼‰
  // -------------------------------------------------------------------
  function PreferencesTable({ prefs, setPrefs }){
    return(
      <TableContainer component={Paper} sx={{mb:2,bgcolor:"#f9fbff"}}>
        <Table size="small">
          <TableHead>
            <TableRow>
              {["ä¸¦ã³","åº—èˆ—å","æ—¥ä»˜","é–‹å§‹","çµ‚äº†","äººæ•°",
                "ã‚¯ãƒ©ã‚¹æ•°","ä»˜ãæ·»ã„","æŒ¯æ›¿åº—èˆ—","äº‹å‰è¨ªå•","æ“ä½œ"]
               .map(h=><TableCell key={h}>{h}</TableCell>)}
            </TableRow>
          </TableHead>
          <TableBody>
            {prefs.map((pref,idx)=>(

              <TableRow key={pref.id}>
                <TableCell>{idx+1}</TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" required
                    value={pref.store}
                    onChange={e=>{
                      const a=[...prefs];a[idx].store=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="date" required
                    value={pref.date} InputLabelProps={{shrink:true}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].date=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="time" required
                    value={pref.start} InputLabelProps={{shrink:true}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].start=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="time" required
                    value={pref.end} InputLabelProps={{shrink:true}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].end=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="number" required
                    value={pref.count}
                    onChange={e=>{
                      const a=[...prefs];a[idx].count=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="number"
                    value={pref.classCount}
                    onChange={e=>{
                      const a=[...prefs];a[idx].classCount=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="number"
                    value={pref.escortCount}
                    onChange={e=>{
                      const a=[...prefs];a[idx].escortCount=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  {pref.altApplicable==="ã‚ã‚Š"
                    ? <TextField size="small" variant="standard"
                        value={pref.altStore} placeholder="æŒ¯æ›¿åº—èˆ—å"
                        onChange={e=>{
                          const a=[...prefs];a[idx].altStore=e.target.value;setPrefs(a);}}/>
                    : <Button size="small" color="primary"
                        onClick={()=>{
                          const a=[...prefs];a[idx].altApplicable="ã‚ã‚Š";setPrefs(a);}}>
                        è¿½åŠ 
                      </Button>}
                </TableCell>
                <TableCell>
                  {pref.preVisit==="ã‚ã‚Š"
                    ? <>
                        <TextField size="small" variant="standard" type="date"
                                   sx={{mb:0.3}}
                                   value={pref.preVisitDate}
                                   onChange={e=>{
                                     const a=[...prefs];a[idx].preVisitDate=e.target.value;setPrefs(a);}}/>
                        <TextField size="small" variant="standard" type="time"
                                   value={pref.preVisitTime}
                                   onChange={e=>{
                                     const a=[...prefs];a[idx].preVisitTime=e.target.value;setPrefs(a);}}/>
                        <Button size="small" color="secondary"
                                onClick={()=>{
                                  const a=[...prefs];
                                  a[idx].preVisit="ãªã—";a[idx].preVisitDate='';a[idx].preVisitTime='';
                                  setPrefs(a);}}>
                          è§£é™¤
                        </Button>
                      </>
                    : <Button size="small" color="primary"
                        onClick={()=>{
                          const a=[...prefs];a[idx].preVisit="ã‚ã‚Š";setPrefs(a);}}>
                        è¿½åŠ 
                      </Button>}
                </TableCell>
                <TableCell>
                  {prefs.length>1 &&
                    <Button size="small" color="error"
                            onClick={()=>setPrefs(prefs.filter((_,i)=>i!==idx))}>
                      <span className="material-icons" style={{fontSize:20}}>delete</span>
                    </Button>}
                </TableCell>
              </TableRow>
            ))}
            <TableRow>
              <TableCell colSpan={11} align="right">
                <Button variant="contained" size="small" color="primary"
                        startIcon={<span className="material-icons">add_circle</span>}
                        disabled={prefs.length>=5}
                        onClick={()=>prefs.length<5 && setPrefs([...prefs,getPrefItem()])}>
                  å¸Œæœ›ã‚’è¿½åŠ 
                </Button>
                <Typography variant="caption" sx={{ml:2}}>â€»æœ€å¤§5ä»¶ã¾ã§</Typography>
              </TableCell>
            </TableRow>
          </TableBody>
        </Table>
      </TableContainer>
    );
  }

  // -------------------------------------------------------------------
  // ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ã®å…±é€šãƒœãƒ‡ã‚£ï¼ˆã‚«ãƒ¼ãƒ‰â‡”ãƒ†ãƒ¼ãƒ–ãƒ«åˆ‡æ›¿ã‚’å«ã‚€ï¼‰
  // -------------------------------------------------------------------
  function VisitFormBody({ form, setForm, onChange, onNum, onFile, type }){
    const [prefView,setPrefView]=React.useState("card");
    const setPrefs=prefs=>setForm(f=>({...f,preferences:prefs}));

    return(
      <Box>
        {/* ---------- ã”æ‹…å½“è€…æƒ…å ± ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">person</span>
            ã”æ‹…å½“è€…æƒ…å ± <Typography component="span" color="error"
                             sx={{ml:1,fontWeight:700,fontSize:'1.1em'}}>ï¼Šå¿…é ˆ</Typography>
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <Grid container spacing={2}>
              <Grid item xs={12}>
                <TextField required fullWidth label="å­¦æ ¡å"
                  value={form.schoolName} className="req-bg"
                  onChange={onChange('schoolName')}/>
              </Grid>
              <Grid item xs={12}>
                <TextField required fullWidth label="å­¦å¹´ï¼ˆå¹´ç”Ÿï¼‰"
                  value={form.grade} className="req-bg"
                  onChange={onChange('grade')}/>
              </Grid>
              <Grid item xs={12}>
                <TextField required fullWidth label="ã”æ‹…å½“è€…å"
                  value={form.contactName} className="req-bg"
                  onChange={onChange('contactName')}/>
              </Grid>
              <Grid item xs={12}>
                <FormLabel component="legend">é›»è©±ç•ªå·</FormLabel>
                <Box sx={{display:'flex',gap:1}}>
                  {['tel1','tel2','tel3'].map((k,i)=>(
                    <TextField key={k} size="small" sx={{flex:1}}
                      placeholder={i===0?'000':'0000'}
                      value={form[k]} className="req-bg"
                      inputProps={{maxLength:i===0?5:4}}
                      onChange={onNum(k)}/>
                  ))}
                </Box>
              </Grid>
              <Grid item xs={12}>
                <FormLabel component="legend">FAXç•ªå·</FormLabel>
                <Box sx={{display:'flex',gap:1}}>
                  {['fax1','fax2','fax3'].map((k,i)=>(
                    <TextField key={k} size="small" sx={{flex:1}}
                      placeholder={i===0?'000':'0000'}
                      value={form[k]}
                      inputProps={{maxLength:i===0?5:4}}
                      onChange={onNum(k)}/>
                  ))}
                </Box>
              </Grid>
              <Grid item xs={12}>
                <TextField required fullWidth type="email"
                  label="é€£çµ¡å¯èƒ½ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                  value={form.email} className="req-bg"
                  onChange={onChange('email')}/>
              </Grid>
              <Grid item xs={12}>
                <FormLabel component="legend">ã”å¸Œæœ›ã®è¿”ä¿¡æ–¹æ³•</FormLabel>
                <RadioGroup row value={form.sendMethod}
                  onChange={onChange('sendMethod')}>
                  <FormControlLabel value="ãƒ¡ãƒ¼ãƒ«" control={<Radio/>} label="ãƒ¡ãƒ¼ãƒ«"/>
                  <FormControlLabel value="FAX" control={<Radio/>} label="FAX"/>
                </RadioGroup>
                <Typography variant="body2" sx={{mt:1}}>
                  <span className="material-icons"
                        style={{verticalAlign:'middle',fontSize:16,marginRight:2,
                                color:'#ffb300'}}>info</span>
                  è¨˜éŒ²ã‚’æ®‹ã™ãŸã‚ã€é›»è©±ã§ã®é€£çµ¡ã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚ï¼ˆç·Šæ€¥ã®å ´åˆã¯é™¤ãï¼‰
                </Typography>
              </Grid>
              <Grid item xs={12}>
                <TextField fullWidth multiline rows={2} label="å‚™è€ƒ"
                  value={form.remarks} onChange={onChange('remarks')}/>
              </Grid>
            </Grid>
          </Box>
        </div>

  {type === "visit" && (
    <>
      {/* ---------- ç”³ã—è¾¼ã¿å†…å®¹ ---------- */}
      <div className="glass-form-section">
        <div className="glass-section-header">
          <span className="material-icons">assignment</span>
          ç”³ã—è¾¼ã¿å†…å®¹
        </div>
        <Box sx={{ p: { xs:2, sm:3 } }}>
          <FormControl component="fieldset" fullWidth>
            <FormLabel component="legend" sx={{ fontWeight:500 }}>ç”³è¾¼å†…å®¹</FormLabel>
            <RadioGroup
              value={form.applicationType}
              onChange={onChange('applicationType')}
            >
              {['å°å­¦ç”Ÿè¦‹å­¦','å°å­¦ç”Ÿç”ºãŸã‚“ã‘ã‚“','ä¸­å­¦ç”Ÿè·å ´è¨ªå•','ãã®ä»–'].map(val => (
                <FormControlLabel
                  key={val}
                  value={val}
                  control={<Radio />}
                  label={val}
                />
              ))}
            </RadioGroup>
            {form.applicationType === 'ãã®ä»–' && (
              <TextField
                fullWidth
                label="å…·ä½“çš„å†…å®¹ã‚’å…¥åŠ›"
                value={form.applicationOther}
                onChange={onChange('applicationOther')}
                sx={{ mt:2 }}
              />
            )}
          </FormControl>
        </Box>
      </div>

      {/* ---------- å¸Œæœ›å¯¾å¿œå†…å®¹ ---------- */}
      <div className="glass-form-section">
        <div className="glass-section-header">
          <span className="material-icons">support_agent</span>
          å¸Œæœ›å¯¾å¿œå†…å®¹
        </div>
        <Box sx={{ p: { xs:2, sm:3 } }}>
          <FormControl component="fieldset" fullWidth>
            <FormLabel component="legend" sx={{ fontWeight:500 }}>å¯¾å¿œæ–¹æ³•</FormLabel>
            <RadioGroup
              value={form.supportType}
              onChange={onChange('supportType')}
            >
              {['å¾“æ¥­å“¡ã«ã‚ˆã‚‹æ¡ˆå†…','å£²å ´è¦‹å­¦ï¼ˆæ¡ˆå†…ãªã—ã®è‡ªç”±è¦‹å­¦ï¼‰','ãã®ä»–'].map(val => (
                <FormControlLabel
                  key={val}
                  value={val}
                  control={<Radio />}
                  label={val}
                />
              ))}
            </RadioGroup>
            {form.supportType === 'ãã®ä»–' && (
              <TextField
                fullWidth
                label="å…·ä½“çš„å†…å®¹ã‚’å…¥åŠ›"
                value={form.supportOther}
                onChange={onChange('supportOther')}
                sx={{ mt:2 }}
              />
            )}
          </FormControl>
        </Box>
      </div>
    </>
  )}

        {/* ---------- å¸Œæœ›å†…å®¹ï¼ˆã‚«ãƒ¼ãƒ‰/ãƒ†ãƒ¼ãƒ–ãƒ«åˆ‡æ›¿ï¼‰ ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">list_alt</span>
            å¸Œæœ›å†…å®¹
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <ToggleButtonGroup value={prefView} exclusive
              onChange={(_,v)=>v&&setPrefView(v)} size="small" color="primary"
              sx={{mb:2}}>
              <ToggleButton value="card">
                <span className="material-icons" style={{verticalAlign:'middle'}}>
                  view_module
                </span> ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
              </ToggleButton>
              <ToggleButton value="table">
                <span className="material-icons" style={{verticalAlign:'middle'}}>
                  table_view
                </span> ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
              </ToggleButton>
            </ToggleButtonGroup>
            {type==="exp" && (
              <Box sx={{mb:2}}>
                <Alert severity="info" sx={{mb:1,fontWeight:500}}>
                  <strong>â€»1å­¦æ ¡ã®åŒæ—¥ç¨‹ã§ã®ãŠç”³ã—è¾¼ã¿å¯èƒ½åº—èˆ—æ•°ã¯3åº—èˆ—ã¾ã§ã§ã™ã€‚</strong>
                </Alert>
                <Alert severity="warning" sx={{fontWeight:500}}>
                  <strong>
                    â€»10:30~15:00ï¼ˆä¼‘æ†©1æ™‚é–“å«ï¼‰ã®å—ã‘å…¥ã‚ŒãŒåŸºæœ¬ã§ã™ã€‚<br/>
                    ãã®ä»–ã®ä½“é¨“æ™‚é–“ã§ã‚‚å¯èƒ½ãªå ´åˆãŒã‚ã‚Šã¾ã™ã®ã§ã”ç›¸è«‡ä¸‹ã•ã„ã€‚
                  </strong>
                </Alert>
              </Box>
            )}
            {prefView==="card"
              ? <PreferencesSortable prefs={form.preferences} setPrefs={setPrefs}/>
              : <PreferencesTable  prefs={form.preferences} setPrefs={setPrefs}/> }
          </Box>
        </div>
        {/* ---------- é€£çµ¡äº‹é … ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">chat_bubble_outline</span>
            é€£çµ¡äº‹é …
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <TextField fullWidth multiline rows={3}
              label={type==="exp"?"è¦‹å­¦å¸Œæœ›å†…å®¹ãªã©":"è¦‹å­¦ã®ç›®çš„ãƒ»è¦‹å­¦æ–¹æ³•ãªã©"}
              value={form.contactNotes} onChange={onChange('contactNotes')}/>
          </Box>
        </div>
        {/* ---------- ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">attach_file</span>
            ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <strong>â€»å­¦æ ¡ã§ä½œæˆã—ãŸè³‡æ–™ãªã©ãŠæŒã¡ã§ã—ãŸã‚‰æ·»ä»˜ã—ã¦ãã ã•ã„ã€‚</strong>
            <FileDropZone file={form.file} onFile={onFile}/>
          </Box>
        </div>
        {/* ---------- æ³¨æ„äº‹é …ï¼†åŒæ„ãƒã‚§ãƒƒã‚¯ ---------- */}
        <div className="glass-notice-section">
          <div className="glass-section-header notice">
            <span className="material-icons"
                  style={{fontSize:30,marginRight:10,color:'#ff9800'}}>warning_amber</span>
            <span style={{fontWeight:800,fontSize:'1.2em'}}>æ³¨æ„äº‹é …</span>
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            {type==="exp"
              ? <>
                  <Typography sx={{fontWeight:700,color:'#bf360c',mb:1.3,fontSize:'1.09em'}}>
                    ãŠç”³ã—è¾¼ã¿å‰ã«å¿…ãšã”ç¢ºèªãã ã•ã„
                  </Typography>
                  <ul style={{paddingLeft:18,marginBottom:8,color:'#795548',fontSize:'1.07em'}}>
                    <li><b>å­¦å¹´ã§ã¾ã¨ã‚ã¦</b>ãŠç”³è¾¼ã¿ãã ã•ã„ã¾ã™ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</li>
                    <li>åº—èˆ—ã¨æ‰“ã¡åˆã‚ã›å¾Œã€<b>æŠ˜ã‚Šè¿”ã—ã”é€£çµ¡</b>ã„ãŸã—ã¾ã™ã€‚<br/>
                        ãŠç”³è¾¼ã¿æ•°ã®å¤šã„æ™‚æœŸã¯ã€èª¿æ•´ã«æ—¥æ•°ãŒã‹ã‹ã‚‹ã“ã¨ã‚‚ã”ã–ã„ã¾ã™ã®ã§ã€
                        <b>å¸Œæœ›æ—¥ã¾ã§ä½™è£•ã‚’ã‚‚ã£ã¦</b>ãŠç”³è¾¼ã¿ãã ã•ã„ã€‚</li>
                    <li>è«¸äº‹æƒ…ã«ã‚ˆã‚Šã€å¸Œæœ›é€šã‚ŠãŠå—ã‘ã§ããªã„å ´åˆã‚‚ã”ã–ã„ã¾ã™ãŒã€ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
                    <li>ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ãŠæ—©ã‚ã«ã”é€£çµ¡ãã ã•ã„ã€‚
                        <b>ä¸€äººã§ã‚‚å¤šãã®æ–¹ã«ä½“é¨“</b>ã—ã¦ã„ãŸã ã‘ã‚‹ã‚ˆã†ã€ã”å”åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</li>
                    <li>ç”Ÿå¾’æ§˜ã®ä¸æ³¨æ„ã«ã‚ˆã‚‹ã‚±ã‚¬ã‚„äº‹æ•…ãŒç™ºç”Ÿã—ãŸéš›ã€
                        <b>å¾¡æ ¡ã§åŠ å…¥ã•ã‚Œã¦ã„ã‚‹å­¦æ ¡ä¿é™ºç­‰</b>ã§ã”å¯¾å¿œã„ãŸã ãã¾ã™ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</li>
                  </ul>
                  <Typography sx={{mt:2,fontWeight:700,color:'#4e342e',fontSize:'1.09em',mb:1.1}}>
                    ã€ åº—èˆ—ã§ä½“é¨“ã™ã‚‹ã«ã‚ãŸã£ã¦ ã€‘ï¼ˆã‚µãƒŸãƒƒãƒˆã‚¹ãƒˆã‚¢ã®ã¿ãƒ»ã‚³ãƒ«ãƒ¢ãƒ”ã‚¢ã¯é™¤ãï¼‰
                  </Typography>
                  <ul style={{paddingLeft:18,color:'#5d4037',fontSize:'1.06em'}}>
                    <li>å­¦æ ¡ã®åˆ¶æœã§åº—èˆ—ã¸å‡ºå‹¤ï¼ˆå…¥åº—ï¼‰ã—ã¦ãã ã•ã„ã€‚
                        æ›´è¡£å®¤ã«ã¦å­¦æ ¡æŒ‡å®šã®ã‚¸ãƒ£ãƒ¼ã‚¸ã«ç€æ›¿ãˆã¾ã™ã€‚ã‚¸ãƒ£ãƒ¼ã‚¸ã¯æ´—æ¿¯æ¸ˆã¿ã®ã‚‚ã®ã‚’æŒå‚ã—ã¦ãã ã•ã„ã€‚</li>
                    <li>åŸæ–™ãƒ»è£½å“ã¸ã®æ±šæŸ“ãŠã‚ˆã³ç•°ç‰©æ··å…¥ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã”å”åŠ›ãã ã•ã„ï¼ˆç¤¾å“¡ã¨åŒã˜ãƒ«ãƒ¼ãƒ«ã§ã™ï¼‰ã€‚</li>
                  </ul>
                </>
              : <>
                  <Typography sx={{fontWeight:700,color:'#bf360c',mb:1.3,fontSize:'1.09em'}}>
                    ãŠç”³ã—è¾¼ã¿å‰ã«å¿…ãšã”ç¢ºèªãã ã•ã„
                  </Typography>
                  <ul style={{paddingLeft:18,marginBottom:8,color:'#795548',fontSize:'1.07em'}}>
                    <li>åº—èˆ—ã¨æ‰“ã¡åˆã‚ã›å¾Œã€<b>æŠ˜ã‚Šè¿”ã—ã”é€£çµ¡</b>ã„ãŸã—ã¾ã™ã€‚ï¼ˆ1é€±é–“ç¨‹åº¦ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰<br/>
                        ãŠç”³è¾¼ã¿æ•°ã®å¤šã„æ™‚æœŸã¯ã€èª¿æ•´ã«æ—¥æ•°ãŒã‹ã‹ã‚‹ã“ã¨ã‚‚ã”ã–ã„ã¾ã™ã€‚<b>å¸Œæœ›æ—¥ã¾ã§ä½™è£•ã‚’ã‚‚ã£ã¦</b>ãŠç”³ã—è¾¼ã¿ãã ã•ã„ã€‚</li>
                    <li>è«¸äº‹æƒ…ã«ã‚ˆã‚Šã€å¸Œæœ›é€šã‚ŠãŠå—ã‘ã§ããªã„å ´åˆã‚‚ã”ã–ã„ã¾ã™ãŒã€ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
                    <li>ç”Ÿå¾’æ§˜ã®ä¸æ³¨æ„ã«ã‚ˆã‚‹ã‚±ã‚¬ã‚„äº‹æ•…ãŒç™ºç”Ÿã—ãŸéš›ã€
                        <b>å¾¡æ ¡ã§åŠ å…¥ã•ã‚Œã¦ã„ã‚‹å­¦æ ¡ä¿é™ºç­‰</b>ã§ã”å¯¾å¿œã„ãŸã ãã¾ã™ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</li>
                  </ul>
                  <Typography sx={{fontSize:'1em',color:'#8d6e63',mt:1}}>
                    ä¸Šè¨˜ã®ã€æ³¨æ„äº‹é …ã€‘ã‚’å¿…ãšãŠèª­ã¿ãã ã•ã„ã€‚
                  </Typography>
                  </>
            }
            <FormControlLabel
              control={<Checkbox checked={form.ack}
                                 onChange={onChange('ack','checked')}/>}
              label={<span>æ³¨æ„äº‹é …ã‚’èª­ã¿ã€å†…å®¹ã«åŒæ„ã—ã¾ã™</span>}
              sx={{mt:2,fontWeight:700,
                   color:form.ack?"#1976d2":"#d32f2f"}}/>
          </Box>
        </div>
      </Box>
    );
  }

  // -------------------------------------------------------------------
  // è¦‹å­¦ç”³è¾¼ / ä½“é¨“ç”³è¾¼ ãƒ•ã‚©ãƒ¼ãƒ æœ¬ä½“ï¼ˆé€ä¿¡ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ï¼‰
  //    - onClose: ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  // -------------------------------------------------------------------
  function VisitForm({ type, onClose }){
    const [form,setForm]=React.useState(getInitialForm());
    const [submitted,setSubmitted]=React.useState(false);
    const [showSnack,setShowSnack]=React.useState(false);

    /* text ç”¨å…±é€šãƒãƒ³ãƒ‰ãƒ© */
    const onChange=(k,prop='value')=>e=>setForm(f=>({...f,[k]:e.target[prop]}));

    /* æ•°å­—å…¥åŠ›ï¼šéæ•°æ–‡å­—ã‚’é™¤å» */
    const onNum=k=>e=>{
      const val=e.target.value.replace(/[^0-9]/g,'');
      setForm(f=>({...f,[k]:val}));
    };

    /* ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ */
    const onFile=e=>{
      if(e.target.files&&e.target.files[0])
        setForm(f=>({...f,file:e.target.files[0]}));
    };

    /* é€ä¿¡ï¼ˆãƒ‡ãƒ¢ãªã®ã§å®Ÿéš›ã«ã¯ä¿å­˜ã›ãš Snackbar è¡¨ç¤ºï¼‰ */
    const handleSubmit=e=>{
      e.preventDefault();
      setSubmitted(true);
      const isError = !form.schoolName || !form.grade || !form.contactName ||
        !form.tel1 || !form.tel2 || !form.tel3 || !form.email ||
        !form.preferences.some(p=>p.store&&p.date&&p.start&&p.end&&p.count) || !form.ack;
      if(isError) return;
      setShowSnack(true);
      setTimeout(()=>setForm(getInitialForm()),1800);
      setTimeout(()=>setSubmitted(false),2000);
    };

    /* ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹ã‹ã©ã†ã‹ï¼ˆé€ä¿¡å¾Œã®ã¿ãƒã‚§ãƒƒã‚¯ï¼‰ */
    const isError = submitted && (
      !form.schoolName || !form.grade || !form.contactName ||
      !form.tel1 || !form.tel2 || !form.tel3 ||
      !form.email || !form.preferences.some(p=>p.store&&p.date&&p.start&&p.end&&p.count) ||
      !form.ack
    );

    return(
      <form autoComplete="off" onSubmit={handleSubmit}>
        <VisitFormBody form={form} setForm={setForm}
          onChange={onChange} onNum={onNum} onFile={onFile} type={type}/>
        <Box sx={{textAlign:'center',py:4}}>
          <Button type="submit" size="large" variant="contained" color="primary"
            sx={{fontWeight:800,px:8,py:1.7,borderRadius:5,
                 background:'linear-gradient(90deg,#2196f3 30%,#1565c0 100%)'}}>
            ç”³è¾¼å†…å®¹ã‚’é€ä¿¡
          </Button>
        </Box>
        <Snackbar open={showSnack} autoHideDuration={2500}
          onClose={()=>setShowSnack(false)}
          anchorOrigin={{vertical:'top',horizontal:'center'}}>
          <Alert severity="success" variant="filled"
            sx={{fontWeight:600,fontSize:'1.12em'}}>
            ç”³è¾¼å†…å®¹ã‚’ä»®ç™»éŒ²ã—ã¾ã—ãŸã€‚<br/>æ‹…å½“è€…ã‚ˆã‚ŠæŠ˜ã‚Šè¿”ã—ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚
          </Alert>
        </Snackbar>
        {isError && (
          <Alert severity="error" sx={{mt:2,fontWeight:700}}>
            å…¥åŠ›ã«ä¸å‚™ãŒã‚ã‚Šã¾ã™ã€‚å¿…é ˆé …ç›®ã‚’ã”ç¢ºèªã®ä¸Šã€å†åº¦ã”é€ä¿¡ãã ã•ã„ã€‚
          </Alert>
        )}
      </form>
    );
  }

  // -------------------------------------------------------------------
  // ç”³è¾¼å†…å®¹ç¢ºèªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆEntryLookupï¼šå…ƒã‚³ãƒ¼ãƒ‰ã‚’å…¨ä¿æŒï¼‰
  //   - onClose: ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  // -------------------------------------------------------------------
  function EntryLookup({ onClose }){
    /* ---- â˜…ãƒ‡ãƒ¢ç”¨ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ ---- */
    const DUMMY_ENTRIES=[
      {
        id:"APP001",email:"sample1@example.com",
        tel1:"090",tel2:"1234",tel3:"5678",
        fax1:"03",fax2:"1111",fax3:"2222",
        confirmCode:"ABC123", name:"ç”°ä¸­ å¤ªéƒ",
        company:"æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«",
        applicationDate:"2025-05-20", visitDate:"2025-06-15",
        visitTime:"14:00", purpose:"åº—èˆ—è¦‹å­¦", participants:3,
        status:"confirmed", notes:"é§è»Šå ´ã®åˆ©ç”¨ã‚’å¸Œæœ›"
      },
      {
        id:"APP002",email:"test@company.co.jp",
        tel1:"080",tel2:"5555",tel3:"2222",
        fax1:"03",fax2:"3333",fax3:"4444",
        confirmCode:"XYZ999", name:"ä½è—¤ èŠ±å­",
        company:"ãƒ†ã‚¹ãƒˆå•†äº‹",
        applicationDate:"2025-05-22", visitDate:"2025-06-20",
        visitTime:"10:30", purpose:"è·å ´ä½“é¨“", participants:1,
        status:"pending", notes:""
      },
      {
        id:"APP003",email:"",
        tel1:"070",tel2:"9999",tel3:"0000",
        fax1:"",fax2:"",fax3:"",
        confirmCode:"DEF456", name:"å±±ç”° æ¬¡éƒ",
        company:"å€‹äººäº‹æ¥­ä¸»",
        applicationDate:"2025-05-25", visitDate:"2025-07-01",
        visitTime:"13:00", purpose:"åº—èˆ—è¦‹å­¦", participants:2,
        status:"cancelled", notes:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç†ç”±ï¼šæ—¥ç¨‹èª¿æ•´å›°é›£"
      }
    ];
    const [search,setSearch]=React.useState({email:'',tel:'',fax:'',code:''});
    const [status,setStatus]=React.useState('');
    const [foundEntry,setFoundEntry]=React.useState(null);
    const [errorDetails,setErrorDetails]=React.useState(null);
    const [nextStep,setNextStep]=React.useState('');
    const [showErrDetail,setShowErrDetail]=React.useState(false);

    const analyzeError=searchData=>{
      const errs=[];
      if(!searchData.code.trim()){
        errs.push({type:"missing_required",
                   message:"ç”³è¾¼ç¢ºèªç•ªå·ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“",
                   solution:"ãƒ¡ãƒ¼ãƒ«ã¾ãŸã¯é›»è©±ã§å—ã‘å–ã£ãŸç¢ºèªç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"});
      }
      if(!searchData.email.trim() && !searchData.tel.trim() && !searchData.fax.trim()){
        errs.push({type:"missing_contact",
                   message:"é€£çµ¡å…ˆæƒ…å ±ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“",
                   solution:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é›»è©±ç•ªå·ã€FAXç•ªå·ã®ã„ãšã‚Œã‹1ã¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"});
      }
      const codeMatch = DUMMY_ENTRIES.find(e=>e.confirmCode===searchData.code.trim().toUpperCase());
      const contactMatch = DUMMY_ENTRIES.find(e=>
        (searchData.email && e.email && e.email===searchData.email.trim()) ||
        (searchData.tel && (e.tel1+e.tel2+e.tel3)===searchData.tel.trim()) ||
        (searchData.fax && (e.fax1+e.fax2+e.fax3)===searchData.fax.trim())
      );
      if(!codeMatch && !contactMatch){
        errs.push({type:"not_found",
                   message:"è©²å½“ã™ã‚‹ç”³è¾¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
                   solution:"å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã‹ã€ç”³è¾¼æ™‚ã®è³‡æ–™ã‚’ã”ç¢ºèªãã ã•ã„"});
      }else if(codeMatch && !contactMatch){
        errs.push({type:"contact_mismatch",
                   message:"ç¢ºèªç•ªå·ã¯æ­£ã—ã„ã§ã™ãŒã€é€£çµ¡å…ˆæƒ…å ±ãŒä¸€è‡´ã—ã¾ã›ã‚“",
                   solution:"ç”³è¾¼æ™‚ã«ä½¿ç”¨ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"});
      }else if(!codeMatch && contactMatch){
        errs.push({type:"code_mismatch",
                   message:"é€£çµ¡å…ˆã¯æ­£ã—ã„ã§ã™ãŒã€ç¢ºèªç•ªå·ãŒä¸€è‡´ã—ã¾ã›ã‚“",
                   solution:"ç”³è¾¼å®Œäº†æ™‚ã«ç™ºè¡Œã•ã‚ŒãŸç¢ºèªç•ªå·ã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„"});
      }
      return errs;
    };

    const handleSearch=()=>{
      setNextStep('');
      const errs=analyzeError(search);
      if(errs.length>0){
        setStatus('error'); setErrorDetails(errs); setFoundEntry(null);
        return;
      }
      const found = DUMMY_ENTRIES.find(e=>
        ((search.email && e.email && e.email===search.email.trim()) ||
         (search.tel && (e.tel1+e.tel2+e.tel3)===search.tel.trim()) ||
         (search.fax && (e.fax1+e.fax2+e.fax3)===search.fax.trim())) &&
        e.confirmCode === search.code.trim().toUpperCase()
      );
      if(found){
        setFoundEntry(found); setStatus('success'); setErrorDetails(null);
      }else{
        setStatus('error'); setErrorDetails([{type:"not_found",
          message:"è©²å½“ã™ã‚‹ç”³è¾¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
          solution:"å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„"}]);
      }
    };

    const renderReference=()=>{
      if(!foundEntry) return null;
      const colorMap={confirmed:'#4caf50',pending:'#ff9800',cancelled:'#f44336'};
      const textMap ={confirmed:'ç¢ºå®š',pending:'ç¢ºèªä¸­',cancelled:'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'};
      return(
        <Card className="reference-card status-card">
          <CardContent>
            <Box display="flex" justifyContent="space-between" alignItems="center" mb={2}>
              <Typography variant="h6" sx={{fontWeight:600,color:'#4a148c'}}>
                <span className="material-icons"
                      style={{verticalAlign:'middle',marginRight:8}}>assignment</span>
                ç”³è¾¼è©³ç´°æƒ…å ±
              </Typography>
              <Chip label={textMap[foundEntry.status]||'ä¸æ˜'}
                    sx={{backgroundColor:colorMap[foundEntry.status]||'#9e9e9e',
                         color:'#fff',fontWeight:600}}/>
            </Box>
            <Grid container spacing={3}>
              <Grid item xs={12} md={6}>
                <Paper sx={{p:2,background:'rgba(255,255,255,0.7)'}}>
                  <Typography variant="subtitle2" color="primary"
                    sx={{fontWeight:600,mb:1}}>åŸºæœ¬æƒ…å ±</Typography>
                  <ul style={{margin:0,paddingLeft:18}}>
                    <li>æ°åï¼š{foundEntry.name}</li>
                    <li>ä¼šç¤¾åï¼š{foundEntry.company}</li>
                    <li>ç”³è¾¼ç•ªå·ï¼š{foundEntry.id}</li>
                  </ul>
                </Paper>
              </Grid>
              <Grid item xs={12} md={6}>
                <Paper sx={{p:2,background:'rgba(255,255,255,0.7)'}}>
                  <Typography variant="subtitle2" color="primary"
                    sx={{fontWeight:600,mb:1}}>è¨ªå•äºˆå®š</Typography>
                  <ul style={{margin:0,paddingLeft:18}}>
                    <li>è¨ªå•æ—¥ï¼š{foundEntry.visitDate}</li>
                    <li>æ™‚é–“ï¼š{foundEntry.visitTime}</li>
                    <li>å‚åŠ äººæ•°ï¼š{foundEntry.participants}å</li>
                  </ul>
                </Paper>
              </Grid>
              <Grid item xs={12}>
                <Paper sx={{p:2,background:'rgba(255,255,255,0.7)'}}>
                  <Typography variant="subtitle2" color="primary"
                    sx={{fontWeight:600,mb:1}}>ç›®çš„ãƒ»å‚™è€ƒ</Typography>
                  ç›®çš„: {foundEntry.purpose}<br/>
                  {foundEntry.notes && <>å‚™è€ƒ: {foundEntry.notes}</>}
                </Paper>
              </Grid>
            </Grid>
            <Box mt={3} display="flex" gap={2} flexWrap="wrap">
              <Button variant="contained" color="primary"
                startIcon={<span className="material-icons">visibility</span>}
                onClick={()=>setNextStep("detail")}>è©³ç´°ã‚’è¡¨ç¤º</Button>
              <Button variant="outlined" color="warning"
                startIcon={<span className="material-icons">cancel</span>}
                onClick={()=>setNextStep("cancel")}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç”³è«‹</Button>
              <Button variant="outlined" color="secondary"
                startIcon={<span className="material-icons">edit_calendar</span>}
                onClick={()=>setNextStep("reschedule")}>æ—¥ç¨‹å¤‰æ›´ç”³è«‹</Button>
            </Box>
          </CardContent>
        </Card>
      );
    };

    const renderErrorDetails=()=>errorDetails&&(
      <Card className="status-card">
        <CardContent>
          <Box display="flex" alignItems="center" mb={2}>
            <span className="material-icons" style={{color:'#f44336',marginRight:8}}>
              error_outline
            </span>
            <Typography variant="h6" color="error" sx={{fontWeight:600}}>
              æ¤œç´¢ã‚¨ãƒ©ãƒ¼è©³ç´°
            </Typography>
            <IconButton size="small"
              onClick={()=>setShowErrDetail(!showErrDetail)} sx={{ml:'auto'}}>
              <span className="material-icons">
                {showErrDetail?'expand_less':'expand_more'}
              </span>
            </IconButton>
          </Box>
          <Collapse in={showErrDetail}>
            {errorDetails.map((err,i)=>(
              <Box key={i} mb={i<errorDetails.length-1?2:0}>
                <Typography variant="subtitle2"
                  sx={{fontWeight:600,color:'#d32f2f',mb:1}}>
                  <span className="material-icons"
                        style={{verticalAlign:'middle',marginRight:4,fontSize:18}}>
                    warning
                  </span>
                  {err.message}
                </Typography>
                <Typography variant="body2" sx={{color:'#5d4037',fontStyle:'italic'}}>
                  ğŸ’¡ {err.solution}
                </Typography>
              </Box>
            ))}
          </Collapse>
        </CardContent>
      </Card>
    );

    const renderNextFlow=()=>{
      const map={
        detail:{title:"ç”³è¾¼è©³ç´°ç…§ä¼š",icon:"description",severity:"info"},
        cancel:{title:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç”³è«‹",icon:"cancel_presentation",severity:"warning"},
        reschedule:{title:"æ—¥ç¨‹å¤‰æ›´ç”³è«‹",icon:"date_range",severity:"success"}
      };
      const f=map[nextStep];
      return f?(
        <Alert severity={f.severity} sx={{mt:3,borderRadius:3}}>
          <Box display="flex" alignItems="center">
            <span className="material-icons" style={{marginRight:8}}>{f.icon}</span>
            <Typography sx={{fontWeight:600}}>
              {f.title}ãƒ•ãƒ­ãƒ¼ç”»é¢ã§ã™ï¼ˆãƒ‡ãƒ¢è¡¨ç¤ºï¼‰
            </Typography>
          </Box>
        </Alert>
      ):null;
    };

    return(
      <Box className="glass-effect"
           sx={{p:4,maxWidth:800,mx:'auto',mt:2,mb:4,borderRadius:4}}>
        <Typography variant="h5"
          sx={{mb:3,fontWeight:700,textAlign:'center',color:'#1565c0',
               display:'flex',justifyContent:'center',alignItems:'center',gap:1}}>
          <span className="material-icons" style={{fontSize:32}}>search</span>
          ç”³è¾¼å†…å®¹ã®ç¢ºèªãƒ»å‚ç…§
        </Typography>
        {status==='' && (
          <>
            <Alert severity="info" sx={{mb:3,borderRadius:3,fontWeight:500}}>
              ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ğŸ“ é›»è©±ç•ªå·ãƒ»ğŸ“  FAXç•ªå·ã®ã„ãšã‚Œã‹1ã¤ã¨ã€
              ğŸ”¢ ç”³è¾¼ç¢ºèªç•ªå·ã®çµ„ã¿åˆã‚ã›ã§æ¤œç´¢ã—ã¾ã™
            </Alert>
            <Box>
              <TextField fullWidth label="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" sx={{mb:2}}
                value={search.email}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#42a5f5',marginRight:8}}>email</span>}}
                onChange={e=>setSearch({...search,email:e.target.value,tel:'',fax:''})}/>
              <Typography align="center"
                          sx={{my:1,fontWeight:600,color:'#90a4ae'}}>ã¾ãŸã¯</Typography>
              <TextField fullWidth label="é›»è©±ç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³ç„¡ã—ï¼‰" sx={{mb:2}}
                value={search.tel}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#66bb6a',marginRight:8}}>phone</span>}}
                onChange={e=>setSearch({...search,tel:e.target.value,email:'',fax:''})}/>
              <Typography align="center"
                          sx={{my:1,fontWeight:600,color:'#90a4ae'}}>ã¾ãŸã¯</Typography>
              <TextField fullWidth label="FAXç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³ç„¡ã—ï¼‰"
                value={search.fax}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#ab47bc',marginRight:8}}>print</span>}}
                onChange={e=>setSearch({...search,fax:e.target.value,email:'',tel:''})}/>
            </Box>
            <Box sx={{mt:3}}>
              <TextField fullWidth label="ç”³è¾¼ç¢ºèªç•ªå·"
                value={search.code}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#ff7043',marginRight:8}}>vpn_key</span>}}
                onChange={e=>setSearch({...search,code:e.target.value})}/>
            </Box>
            <Button variant="contained" fullWidth sx={{py:2,fontSize:18,fontWeight:700,
                    background:'linear-gradient(45deg,#2196f3 30%,#21cbf3 90%)',mt:3}}
                    onClick={handleSearch}>
              <span className="material-icons" style={{marginRight:8}}>search</span>
              ç”³è¾¼å†…å®¹ã‚’æ¤œç´¢
            </Button>
          </>
        )}
        {status==='error' && (
          <>
            <Alert severity="error" sx={{borderRadius:3}}>
              ç”³è¾¼å†…å®¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ
            </Alert>
            {renderErrorDetails()}
            <Box mt={3}>
              <Button color="inherit" startIcon={<span className="material-icons">refresh</span>}
                onClick={()=>{setStatus('');setErrorDetails(null);}}>
                å†æ¤œç´¢ã™ã‚‹
              </Button>
              <Button color="inherit" sx={{ml:2}} onClick={onClose}>
                é–‰ã˜ã‚‹
              </Button>
            </Box>
          </>
        )}
        {status==='success' && (
          <>
            <Alert severity="success" sx={{borderRadius:3,mb:2,fontWeight:600}}>
              âœ… ç”³è¾¼æƒ…å ±ã®ç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸ
            </Alert>
            {renderReference()}
            {renderNextFlow()}
            <Box mt={3}>
              <Button color="inherit" onClick={onClose}>
                é–‰ã˜ã‚‹
              </Button>
            </Box>
          </>
        )}
      </Box>
    );
  }

  // -------------------------------------------------------------------
  // ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼‹å„ç”³è¾¼ãƒ¢ãƒ¼ãƒ€ãƒ«/ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åˆ¶å¾¡ï¼‰
  // -------------------------------------------------------------------
  function MainApp(){
    // openModal: false/0/1/2
    // 0=ä½“é¨“ç”³è¾¼  1=é€šå¸¸è¦‹å­¦ç”³è¾¼  2=ç”³è¾¼å†…å®¹å‚ç…§
    const [openModal,setOpenModal]=React.useState(false);

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¿ã‚¤ãƒˆãƒ«ï¼‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    const modalMap=[
      {
        title:"è¦‹å­¦ä½“é¨“ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆè·å ´ä½“é¨“ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ç­‰ï¼‰",
        content:(closeFn)=><VisitForm type="exp" onClose={closeFn}/>
      },
      {
        title:"é€šå¸¸è¦‹å­¦ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆæ–½è¨­è¦‹å­¦ï¼‰",
        content:(closeFn)=><VisitForm type="visit" onClose={closeFn}/>
      },
      {
        title:"ç”³è¾¼å†…å®¹ã®ç¢ºèªãƒ»å‚ç…§",
        content:(closeFn)=><EntryLookup onClose={closeFn}/>
      }
    ];

    // ãƒˆãƒƒãƒ—ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
    return(
<Box
  sx={{
    minHeight: '100vh',
    display: 'flex',
    flexDirection: 'column',
    justifyContent: 'center',
    background: 'none',
    py: { xs: 2, sm: 5 },
  }}
>
  <Box
    className="glass"
    sx={{
      maxWidth: 700,
      mx: 'auto',
      p: { xs: 2.5, sm: 5 },
      borderRadius: 5,
      boxShadow: '0 4px 32px rgba(25,118,210,0.10)',
      mt: { xs: 1, sm: 5 },
      mb: { xs: 2, sm: 5 },
    }}
  >
    <Typography
      variant="h4"
      className="hero-title"
      sx={{
        fontWeight: 900,
        textAlign: 'center',
        color: '#0d47a1',
        mb: 2,
      }}
    >
      <span
        className="material-icons"
        style={{ fontSize: 38, verticalAlign: 'middle' }}
      >
        groups
      </span>
      ã‚µãƒŸãƒƒãƒˆ è¦‹å­¦ãƒ»ä½“é¨“ç”³è¾¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
    </Typography>
    <Typography align="center" sx={{ mb: 5, color: '#424242' }}>
      <span style={{ fontWeight: 700 }}>
        åº—èˆ—è¦‹å­¦ãƒ»è·å ´ä½“é¨“ã®ç”³è¾¼ï¼ç…§ä¼š
      </span>
      ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§è¡Œãˆã¾ã™ã€‚<br />
      ãŠç”³è¾¼å¾Œã€æ‹…å½“è€…ã‚ˆã‚ŠæŠ˜ã‚Šè¿”ã—ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚
    </Typography>

    <Grid container spacing={3}>
      {/* ä½“é¨“ç”³è¾¼ */}
      <Grid item xs={12} sm={4}>
        <Paper
          elevation={3}
          sx={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            p: 2,
            borderRadius: 3,
            transition: 'transform .2s, box-shadow .2s',
            '&:hover': {
              transform: 'translateY(-4px) scale(1.02)',
              boxShadow: '0 12px 24px rgba(0,0,0,0.15)',
            },
          }}
        >
          <Box sx={{ textAlign: 'center' }}>
            <span
              className="material-icons"
              style={{ fontSize: 46, color: '#1976d2', marginBottom: 8 }}
            >
              school
            </span>
            <Typography
              variant="h6"
              sx={{ fontWeight: 800, color: '#1565c0', mb: 1 }}
            >
              è¦‹å­¦ä½“é¨“ç”³è¾¼
            </Typography>
            <Typography variant="body2" sx={{ color: '#1976d2' }}>
              è·å ´ä½“é¨“ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ãƒ»å­¦å¤–å­¦ç¿’ç­‰
            </Typography>
          </Box>
          <Box sx={{ flexGrow: 1, mt: 1 }}>
            <Typography
              variant="body2"
              sx={{ textAlign: 'center', color: 'text.secondary', px: 1 }}
            >
              è·å ´ä½“é¨“ã®è©³ç´°ã‚’ã”ç¢ºèªã„ãŸã ãã€ã“ã¡ã‚‰ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ãã ã•ã„ã€‚
            </Typography>
          </Box>
          <Box sx={{ textAlign: 'center', mt: 2 }}>
            <Button
              variant="contained"
              size="small"
              onClick={() => setOpenModal(0)}
            >
              ä½“é¨“ç”³è¾¼
            </Button>
          </Box>
        </Paper>
      </Grid>

      {/* é€šå¸¸è¦‹å­¦ç”³è¾¼ */}
      <Grid item xs={12} sm={4}>
        <Paper
          elevation={3}
          sx={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            p: 2,
            borderRadius: 3,
            transition: 'transform .2s, box-shadow .2s',
            '&:hover': {
              transform: 'translateY(-4px) scale(1.02)',
              boxShadow: '0 12px 24px rgba(0,0,0,0.15)',
            },
          }}
        >
          <Box sx={{ textAlign: 'center' }}>
            <span
              className="material-icons"
              style={{ fontSize: 46, color: '#43a047', marginBottom: 8 }}
            >
              store
            </span>
            <Typography
              variant="h6"
              sx={{ fontWeight: 800, color: '#388e3c', mb: 1 }}
            >
              é€šå¸¸è¦‹å­¦ç”³è¾¼
            </Typography>
            <Typography variant="body2" sx={{ color: '#43a047' }}>
              æ–½è¨­è¦‹å­¦ãƒ»æ¥­ç•Œç ”ç©¶ãƒ»è¦–å¯Ÿç­‰
            </Typography>
          </Box>
          <Box sx={{ flexGrow: 1, mt: 1 }}>
            <Typography
              variant="body2"
              sx={{ textAlign: 'center', color: 'text.secondary', px: 1 }}
            >
              æ–½è¨­è¦‹å­¦ã®æ¦‚è¦ã‚’ç¢ºèªã—ã¦ã“ã¡ã‚‰ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ãã ã•ã„ã€‚
            </Typography>
          </Box>
          <Box sx={{ textAlign: 'center', mt: 2 }}>
            <Button
              variant="contained"
              size="small"
              onClick={() => setOpenModal(1)}
            >
              è¦‹å­¦ç”³è¾¼
            </Button>
          </Box>
        </Paper>
      </Grid>

      {/* ç”³è¾¼çŠ¶æ³ç¢ºèª */}
      <Grid item xs={12} sm={4}>
        <Paper
          elevation={3}
          sx={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            p: 2,
            borderRadius: 3,
            transition: 'transform .2s, box-shadow .2s',
            '&:hover': {
              transform: 'translateY(-4px) scale(1.02)',
              boxShadow: '0 12px 24px rgba(0,0,0,0.15)',
            },
          }}
        >
          <Box sx={{ textAlign: 'center' }}>
            <span
              className="material-icons"
              style={{ fontSize: 46, color: '#ff9800', marginBottom: 8 }}
            >
              assignment
            </span>
            <Typography
              variant="h6"
              sx={{ fontWeight: 800, color: '#f57c00', mb: 1 }}
            >
              ç”³è¾¼çŠ¶æ³ç¢ºèª
            </Typography>
            <Typography variant="body2" sx={{ color: '#ff9800' }}>
              ç”³è¾¼å†…å®¹ã®å‚ç…§ãƒ»å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒã§ãã¾ã™
            </Typography>
          </Box>
          <Box sx={{ flexGrow: 1, mt: 1 }}>
            <Typography
              variant="body2"
              sx={{ textAlign: 'center', color: 'text.secondary', px: 1 }}
            >
              ã”è‡ªèº«ã®ç”³è¾¼çŠ¶æ³ã‚’ã“ã“ã‹ã‚‰ã”ç¢ºèªãã ã•ã„ã€‚
            </Typography>
          </Box>
          <Box sx={{ textAlign: 'center', mt: 2 }}>
            <Button
              variant="contained"
              size="small"
              onClick={() => setOpenModal(2)}
            >
              ç¢ºèªã™ã‚‹
            </Button>
          </Box>
        </Paper>
      </Grid>
    </Grid>
  </Box>

        {/* ================= ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼‰ ================== */}
        <Dialog open={openModal!==false}
          onClose={()=>setOpenModal(false)}
          maxWidth="md" fullWidth scroll="body"
          PaperProps={{sx:{borderRadius:6}}}>
          <DialogTitle sx={{fontWeight:900,py:3,px:4,fontSize:'1.28em'}}>
            {openModal!==false && modalMap[openModal]?.title}
          </DialogTitle>
          <DialogContent sx={{pb:2,px:{xs:1,sm:4},pt:0}}>
            {openModal!==false && modalMap[openModal].content(()=>setOpenModal(false))}
          </DialogContent>
          <DialogActions>
            <Button onClick={()=>setOpenModal(false)} color="inherit">é–‰ã˜ã‚‹</Button>
          </DialogActions>
        </Dialog>
      </Box>
    );
  }

  // ---------------------- ãƒ«ãƒ¼ãƒˆDOMãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ----------------------
  ReactDOM.createRoot(document.getElementById("root")).render(<MainApp/>);

  </script>
</body>
</html>
