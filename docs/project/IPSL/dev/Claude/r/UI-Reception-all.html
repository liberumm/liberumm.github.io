<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>サミット 見学・体験申込管理システム</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- ======================= フォント & アイコン ======================= -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <!-- ======================= React / Babel / MUI (CDN) =============== -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <!-- Emotion + Material-UI -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/lab@5.0.0-alpha.148/umd/material-ui-lab.production.min.js"></script>
  <!-- Sortable.js（カードドラッグ並べ替え用） -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <!-- ======================= 共通スタイル ============================= -->
  <style>
    body{
      margin:0;
      min-height:100vh;
      font-family:'Noto Sans JP',sans-serif;
      background:linear-gradient(135deg,#a1c4fd 0%,#c2e9fb 100%);
    }
    .glass{
      background:rgba(255,255,255,0.93);
      backdrop-filter:blur(18px);
      border:1px solid rgba(255,255,255,0.4);
      border-radius:16px;
      box-shadow:0 8px 32px rgba(0,0,0,0.08);
    }
    .entry-card{
      cursor:pointer;
      transition:transform .18s,box-shadow .18s;
    }
    .entry-card:hover{
      transform:translateY(-4px);
      box-shadow:0 8px 24px rgba(0,0,0,0.14);
    }
    .glass-effect{background:rgba(255,255,255,0.93);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.3);box-shadow:0 8px 32px rgba(0,0,0,0.09);}
    .glass-form-section{background:rgba(255,255,255,0.97);border-radius:14px;margin-bottom:36px;box-shadow:0 2px 12px 0 rgba(25,118,210,0.07);border:1.5px solid #e3e6ef;overflow:hidden;}
    .glass-section-header{background:linear-gradient(90deg,#2196f3 10%,#1565c0 100%);color:white;padding:18px 28px 14px 22px;font-weight:600;font-size:1.15rem;display:flex;align-items:center;gap:10px;letter-spacing:1px;border-bottom:1px solid #e3e6ef;}
    .glass-section-header.notice{background:linear-gradient(90deg,#ffe082,#fff176 90%) !important;color:#795548 !important;font-weight:700 !important;font-size:1.13rem !important;letter-spacing:0.04em;border-bottom:none !important;box-shadow:0 1px 6px 0 #ffe08240;align-items:center;}
    .glass-notice-section{background:#fffde7;border:2px solid #ffe082;margin-bottom:32px;border-radius:14px;}
    .req-bg .MuiInputBase-input{background:#fffde7 !important;}
    .MuiChip-root{font-weight:600;letter-spacing:1px;}
    .drag-handle{cursor:grab;color:#1976d2;margin-right:8px;margin-top:12px;font-size:30px;}
    .sortable-chosen{background:#e3f2fd !important;}
    .sortable-drag{background:#bbdefb !important;}
    .add-btn{font-weight:700 !important;min-width:120px;box-shadow:0 1px 4px 0 rgba(25,118,210,0.10);margin-right:8px;}
    .del-btn{min-width:38px !important;min-height:38px !important;border-radius:50%;margin-top:6px;margin-left:4px;font-size:1.3rem !important;}
    @media(max-width:600px){
      .glass-section-header{padding:14px 12px 10px 14px;font-size:1rem;}
      .glass-form-section{border-radius:8px;}
      .drag-handle{font-size:24px;margin-right:5px;}
    }
    .MuiToggleButtonGroup-root{margin-bottom:16px;}
  </style>
</head>
<body>
  <div id="root"></div>
  <!-- ======================= React アプリ本体 ======================== -->
  <script type="text/babel">

  // ------------------------------------------------------------
  // MUIエイリアス
  // ------------------------------------------------------------
  const {
    Box, Typography, Paper, Grid, Button, Snackbar, Alert, Tabs, Tab,
    Card, CardContent, CardActions, Chip, IconButton, TextField, Collapse,
    RadioGroup, FormControlLabel, Radio, FormLabel, FormControl,
    ToggleButtonGroup, ToggleButton, Table, TableHead, TableRow, TableCell,
    TableBody, TableContainer,Checkbox, Dialog, DialogTitle, DialogContent, DialogActions,
  } = MaterialUI;

  // -------------------------------------------------------------------
  // ファイル添付用ドラッグ＆ドロップエリア
  // -------------------------------------------------------------------
  function FileDropZone({ file, onFile }) {
    const [dragOver, setDragOver] = React.useState(false);
    const inputRef = React.useRef();

    const handleDrop = (e) => {
      e.preventDefault();
      setDragOver(false);
      if (e.dataTransfer.files && e.dataTransfer.files[0])
        onFile({ target: { files: [e.dataTransfer.files[0]] } });
    };

    return (
      <Box
        onDrop={handleDrop}
        onDragOver={e => { e.preventDefault(); setDragOver(true); }}
        onDragLeave={() => setDragOver(false)}
        onClick={() => inputRef.current.click()}
        role="button"
        tabIndex={0}
        aria-label="ファイルを選択またはドロップ"
        sx={{
          border: dragOver ? '2.5px solid #1976d2' : '2px dashed #b0bec5',
          borderRadius:3, bgcolor: dragOver ? '#e3f2fd' : '#f8fafc',
          textAlign:'center', p:3, cursor:'pointer', transition:'all 0.16s'
        }}
      >
        <input ref={inputRef} type="file"
               accept=".pdf,.xlsx,.doc,.docx,image/*"
               style={{ display:'none' }} onChange={onFile}/>
        <span className="material-icons"
              style={{fontSize:32,color:'#1976d2',marginBottom:6}}>upload_file</span>
        <Typography sx={{fontWeight:600,color:'#1976d2',mb:1.5}}>
          ここにファイルをドラッグ＆ドロップ<br/>またはクリックで選択
        </Typography>
        {file
          ? <Typography sx={{color:'#37474f',fontWeight:500,mt:1}}>
              選択中: {file.name}
            </Typography>
          : <Typography sx={{color:'text.secondary',fontSize:'0.99em'}}>
              （PDF、xlsx、Word、画像ファイルなど添付できます）
            </Typography>}
      </Box>
    );
  }

  // -------------------------------------------------------------------
  // 申込希望レコードの初期ひな形 & フォーム全体の初期値
  // -------------------------------------------------------------------
  const getPrefItem = () => ({
    id: Date.now() + Math.random(),
    store:'', altApplicable:'なし', altStore:'',
    date:'', start:'', end:'',
    count:'', classCount:'', escortCount:'',
    preVisit:'なし', preVisitDate:'', preVisitTime:''
  });

  const getInitialForm = () => ({
    schoolName:'', grade:'', contactName:'',
    tel1:'',tel2:'',tel3:'', fax1:'',fax2:'',fax3:'',
    email:'', sendMethod:'メール', remarks:'',
    preferences:[getPrefItem()],
    contactNotes:'', file:null, ack:false,
    applicationType: '',        // 申し込み内容（ラジオ選択）
    applicationOther: '',       // その他：具体的内容
    supportType: '',            // 希望対応内容（ラジオ選択）
    supportOther: '',           // その他：具体的内容
  });

  // -------------------------------------------------------------------
  // カード表示（ドラッグ並べ替え付き）コンポーネント
  // -------------------------------------------------------------------
  function PreferencesSortable({ prefs, setPrefs }){
    const listRef = React.useRef(null);

    React.useEffect(()=>{
      if(!listRef.current) return;
      const sortable = Sortable.create(listRef.current,{
        animation:160, handle:".drag-handle", ghostClass:"sortable-drag",
        chosenClass:"sortable-chosen",
        onEnd:e=>{
          if(e.oldIndex===e.newIndex) return;
          const arr=[...prefs];
          const [moved]=arr.splice(e.oldIndex,1);
          arr.splice(e.newIndex,0,moved);
          setPrefs(arr);
        }
      });
      return ()=>sortable.destroy();
    },[prefs]);

    return(
      <div ref={listRef}>
        {prefs.map((pref,idx)=>(

          <Paper key={pref.id}
                 sx={{p:{xs:2,sm:3}, mb:3, borderRadius:3,
                      boxShadow:'0 2px 10px 0 rgba(25,118,210,0.09)',
                      borderLeft:'7px solid #1976d2', position:'relative',
                      background:'#f9fbff'}}>
            {/* カードヘッダ（ドラッグハンドル＋Chip＋削除） */}
            <Box sx={{display:'flex',alignItems:'center',mb:2,pl:1,
                      pb:0.5,borderBottom:'1.5px dashed #90caf9'}}>
              <span className="material-icons drag-handle"
                    style={{color:'#1565c0',fontSize:30,marginRight:8}}>
                drag_indicator
              </span>
              <Chip icon={<span className="material-icons"
                               style={{fontSize:19,verticalAlign:'-4px'}}>star</span>}
                    label={`第${idx+1}希望`} color="primary" size="small"
                    sx={{fontWeight:800,fontSize:'1.07rem',px:1.5,py:0.4}}/>
              <Box sx={{flexGrow:1}} />
              {prefs.length>1 && (
                <Button size="small" color="error" className="del-btn"
                        variant="contained"
                        sx={{minWidth:40,minHeight:40,borderRadius:'50%',
                             bgcolor:'#fff0f0',color:'#d32f2f',
                             '&:hover':{bgcolor:'#ffeaea'}}}
                        onClick={()=>setPrefs(prefs.filter((_,i)=>i!==idx))}>
                  <span className="material-icons">delete</span>
                </Button>
              )}
            </Box>

            {/* --- 入力フィールド群（Grid レイアウト） --- */}
            <Grid container spacing={2.2} alignItems="center">
              <Grid item xs={12} sm={3}>
                <TextField required fullWidth label="店舗名"
                  value={pref.store}
                  className="req-bg"
                  InputProps={{startAdornment:
                    <span className="material-icons"
                          style={{color:'#90caf9',marginRight:8,fontSize:20}}>
                      store
                    </span>}}
                  onChange={e=>{
                    const arr=[...prefs]; arr[idx].store=e.target.value; setPrefs(arr);
                  }}/>
              </Grid>
              <Grid item xs={6} sm={2.2}>
                <TextField required fullWidth type="date" label="日付"
                  InputLabelProps={{shrink:true}}
                  value={pref.date} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].date=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.6}>
                <TextField required fullWidth type="time" label="開始"
                  InputLabelProps={{shrink:true}}
                  value={pref.start} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].start=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.6}>
                <TextField required fullWidth type="time" label="終了"
                  InputLabelProps={{shrink:true}}
                  value={pref.end} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].end=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.2}>
                <TextField required fullWidth type="number" label="人数"
                  value={pref.count} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].count=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.2}>
                <TextField fullWidth type="number" label="クラス数"
                  value={pref.classCount} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].classCount=e.target.value;setPrefs(a);}}/>
              </Grid>
              <Grid item xs={6} sm={1.2}>
                <TextField fullWidth type="number" label="付き添い"
                  value={pref.escortCount} className="req-bg"
                  onChange={e=>{const a=[...prefs];a[idx].escortCount=e.target.value;setPrefs(a);}}/>
              </Grid>
            </Grid>

            {/* --- 振替店舗 & 事前訪問 オプション --- */}
            <Grid container spacing={2} alignItems="center" sx={{mt:1.5}}>
              <Grid item xs={12} sm={4.5}>
                <FormControl component="fieldset" fullWidth>
                  <FormLabel component="legend" sx={{fontWeight:500,fontSize:'1.05em'}}>
                    振替可能店舗
                  </FormLabel>
                  <RadioGroup row value={pref.altApplicable}
                    onChange={e=>{
                      const a=[...prefs]; a[idx].altApplicable=e.target.value;
                      if(e.target.value==='なし') a[idx].altStore='';
                      setPrefs(a);
                    }}>
                    <FormControlLabel value="なし" control={<Radio/>} label="なし"/>
                    <FormControlLabel value="あり" control={<Radio/>} label="あり"/>
                  </RadioGroup>
                </FormControl>
              </Grid>
              {pref.altApplicable==='あり' && (
                <Grid item xs={12} sm={4}>
                  <TextField fullWidth label="振替店舗名"
                    value={pref.altStore}
                    InputProps={{startAdornment:
                      <span className="material-icons"
                            style={{color:'#90caf9',marginRight:8,fontSize:19}}>
                        storefront
                      </span>}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].altStore=e.target.value;setPrefs(a);}}/>
                </Grid>
              )}
            </Grid>

            <Grid container spacing={2} alignItems="center" sx={{mt:0.7}}>
              <Grid item xs={12} sm={4.5}>
                <FormControl component="fieldset" fullWidth>
                  <FormLabel component="legend" sx={{fontWeight:500,fontSize:'1.05em'}}>
                    事前訪問希望
                  </FormLabel>
                  <RadioGroup row value={pref.preVisit}
                    onChange={e=>{
                      const a=[...prefs];a[idx].preVisit=e.target.value;
                      if(e.target.value==='なし'){
                        a[idx].preVisitDate='';a[idx].preVisitTime='';
                      }
                      setPrefs(a);}}>
                    <FormControlLabel value="なし" control={<Radio/>} label="なし"/>
                    <FormControlLabel value="あり" control={<Radio/>} label="あり"/>
                  </RadioGroup>
                </FormControl>
              </Grid>
              {pref.preVisit==='あり'&&(
                <>
                  <Grid item xs={6} sm={4}>
                    <TextField fullWidth type="date" label="訪問日"
                      InputLabelProps={{shrink:true}}
                      value={pref.preVisitDate}
                      onChange={e=>{
                        const a=[...prefs];a[idx].preVisitDate=e.target.value;setPrefs(a);}}/>
                  </Grid>
                  <Grid item xs={6} sm={4}>
                    <TextField fullWidth type="time" label="訪問時間"
                      InputLabelProps={{shrink:true}}
                      value={pref.preVisitTime}
                      onChange={e=>{
                        const a=[...prefs];a[idx].preVisitTime=e.target.value;setPrefs(a);}}/>
                  </Grid>
                </>
              )}
            </Grid>
          </Paper>
        ))}
        {/* --- 希望追加ボタン --- */}
        <Box textAlign="right" sx={{mt:2,mb:1}}>
          <Button variant="contained" color="primary" className="add-btn"
                  startIcon={<span className="material-icons">add_circle</span>}
                  disabled={prefs.length>=5}
                  onClick={()=>prefs.length<5 && setPrefs([...prefs,getPrefItem()])}>
            希望を追加
          </Button>
          <Typography variant="caption" sx={{ml:1,color:'text.secondary'}}>
            ※最大5件まで追加できます
          </Typography>
        </Box>
      </div>
    );
  }

  // -------------------------------------------------------------------
  // テーブル表示コンポーネント（既存ロジックそのまま）
  // -------------------------------------------------------------------
  function PreferencesTable({ prefs, setPrefs }){
    return(
      <TableContainer component={Paper} sx={{mb:2,bgcolor:"#f9fbff"}}>
        <Table size="small">
          <TableHead>
            <TableRow>
              {["並び","店舗名","日付","開始","終了","人数",
                "クラス数","付き添い","振替店舗","事前訪問","操作"]
               .map(h=><TableCell key={h}>{h}</TableCell>)}
            </TableRow>
          </TableHead>
          <TableBody>
            {prefs.map((pref,idx)=>(

              <TableRow key={pref.id}>
                <TableCell>{idx+1}</TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" required
                    value={pref.store}
                    onChange={e=>{
                      const a=[...prefs];a[idx].store=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="date" required
                    value={pref.date} InputLabelProps={{shrink:true}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].date=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="time" required
                    value={pref.start} InputLabelProps={{shrink:true}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].start=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="time" required
                    value={pref.end} InputLabelProps={{shrink:true}}
                    onChange={e=>{
                      const a=[...prefs];a[idx].end=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="number" required
                    value={pref.count}
                    onChange={e=>{
                      const a=[...prefs];a[idx].count=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="number"
                    value={pref.classCount}
                    onChange={e=>{
                      const a=[...prefs];a[idx].classCount=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  <TextField size="small" variant="standard" type="number"
                    value={pref.escortCount}
                    onChange={e=>{
                      const a=[...prefs];a[idx].escortCount=e.target.value;setPrefs(a);}}/>
                </TableCell>
                <TableCell>
                  {pref.altApplicable==="あり"
                    ? <TextField size="small" variant="standard"
                        value={pref.altStore} placeholder="振替店舗名"
                        onChange={e=>{
                          const a=[...prefs];a[idx].altStore=e.target.value;setPrefs(a);}}/>
                    : <Button size="small" color="primary"
                        onClick={()=>{
                          const a=[...prefs];a[idx].altApplicable="あり";setPrefs(a);}}>
                        追加
                      </Button>}
                </TableCell>
                <TableCell>
                  {pref.preVisit==="あり"
                    ? <>
                        <TextField size="small" variant="standard" type="date"
                                   sx={{mb:0.3}}
                                   value={pref.preVisitDate}
                                   onChange={e=>{
                                     const a=[...prefs];a[idx].preVisitDate=e.target.value;setPrefs(a);}}/>
                        <TextField size="small" variant="standard" type="time"
                                   value={pref.preVisitTime}
                                   onChange={e=>{
                                     const a=[...prefs];a[idx].preVisitTime=e.target.value;setPrefs(a);}}/>
                        <Button size="small" color="secondary"
                                onClick={()=>{
                                  const a=[...prefs];
                                  a[idx].preVisit="なし";a[idx].preVisitDate='';a[idx].preVisitTime='';
                                  setPrefs(a);}}>
                          解除
                        </Button>
                      </>
                    : <Button size="small" color="primary"
                        onClick={()=>{
                          const a=[...prefs];a[idx].preVisit="あり";setPrefs(a);}}>
                        追加
                      </Button>}
                </TableCell>
                <TableCell>
                  {prefs.length>1 &&
                    <Button size="small" color="error"
                            onClick={()=>setPrefs(prefs.filter((_,i)=>i!==idx))}>
                      <span className="material-icons" style={{fontSize:20}}>delete</span>
                    </Button>}
                </TableCell>
              </TableRow>
            ))}
            <TableRow>
              <TableCell colSpan={11} align="right">
                <Button variant="contained" size="small" color="primary"
                        startIcon={<span className="material-icons">add_circle</span>}
                        disabled={prefs.length>=5}
                        onClick={()=>prefs.length<5 && setPrefs([...prefs,getPrefItem()])}>
                  希望を追加
                </Button>
                <Typography variant="caption" sx={{ml:2}}>※最大5件まで</Typography>
              </TableCell>
            </TableRow>
          </TableBody>
        </Table>
      </TableContainer>
    );
  }

  // -------------------------------------------------------------------
  // 申込フォームの共通ボディ（カード⇔テーブル切替を含む）
  // -------------------------------------------------------------------
  function VisitFormBody({ form, setForm, onChange, onNum, onFile, type }){
    const [prefView,setPrefView]=React.useState("card");
    const setPrefs=prefs=>setForm(f=>({...f,preferences:prefs}));

    return(
      <Box>
        {/* ---------- ご担当者情報 ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">person</span>
            ご担当者情報 <Typography component="span" color="error"
                             sx={{ml:1,fontWeight:700,fontSize:'1.1em'}}>＊必須</Typography>
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <Grid container spacing={2}>
              <Grid item xs={12}>
                <TextField required fullWidth label="学校名"
                  value={form.schoolName} className="req-bg"
                  onChange={onChange('schoolName')}/>
              </Grid>
              <Grid item xs={12}>
                <TextField required fullWidth label="学年（年生）"
                  value={form.grade} className="req-bg"
                  onChange={onChange('grade')}/>
              </Grid>
              <Grid item xs={12}>
                <TextField required fullWidth label="ご担当者名"
                  value={form.contactName} className="req-bg"
                  onChange={onChange('contactName')}/>
              </Grid>
              <Grid item xs={12}>
                <FormLabel component="legend">電話番号</FormLabel>
                <Box sx={{display:'flex',gap:1}}>
                  {['tel1','tel2','tel3'].map((k,i)=>(
                    <TextField key={k} size="small" sx={{flex:1}}
                      placeholder={i===0?'000':'0000'}
                      value={form[k]} className="req-bg"
                      inputProps={{maxLength:i===0?5:4}}
                      onChange={onNum(k)}/>
                  ))}
                </Box>
              </Grid>
              <Grid item xs={12}>
                <FormLabel component="legend">FAX番号</FormLabel>
                <Box sx={{display:'flex',gap:1}}>
                  {['fax1','fax2','fax3'].map((k,i)=>(
                    <TextField key={k} size="small" sx={{flex:1}}
                      placeholder={i===0?'000':'0000'}
                      value={form[k]}
                      inputProps={{maxLength:i===0?5:4}}
                      onChange={onNum(k)}/>
                  ))}
                </Box>
              </Grid>
              <Grid item xs={12}>
                <TextField required fullWidth type="email"
                  label="連絡可能なメールアドレス"
                  value={form.email} className="req-bg"
                  onChange={onChange('email')}/>
              </Grid>
              <Grid item xs={12}>
                <FormLabel component="legend">ご希望の返信方法</FormLabel>
                <RadioGroup row value={form.sendMethod}
                  onChange={onChange('sendMethod')}>
                  <FormControlLabel value="メール" control={<Radio/>} label="メール"/>
                  <FormControlLabel value="FAX" control={<Radio/>} label="FAX"/>
                </RadioGroup>
                <Typography variant="body2" sx={{mt:1}}>
                  <span className="material-icons"
                        style={{verticalAlign:'middle',fontSize:16,marginRight:2,
                                color:'#ffb300'}}>info</span>
                  記録を残すため、電話での連絡はしていません。（緊急の場合は除く）
                </Typography>
              </Grid>
              <Grid item xs={12}>
                <TextField fullWidth multiline rows={2} label="備考"
                  value={form.remarks} onChange={onChange('remarks')}/>
              </Grid>
            </Grid>
          </Box>
        </div>

  {type === "visit" && (
    <>
      {/* ---------- 申し込み内容 ---------- */}
      <div className="glass-form-section">
        <div className="glass-section-header">
          <span className="material-icons">assignment</span>
          申し込み内容
        </div>
        <Box sx={{ p: { xs:2, sm:3 } }}>
          <FormControl component="fieldset" fullWidth>
            <FormLabel component="legend" sx={{ fontWeight:500 }}>申込内容</FormLabel>
            <RadioGroup
              value={form.applicationType}
              onChange={onChange('applicationType')}
            >
              {['小学生見学','小学生町たんけん','中学生職場訪問','その他'].map(val => (
                <FormControlLabel
                  key={val}
                  value={val}
                  control={<Radio />}
                  label={val}
                />
              ))}
            </RadioGroup>
            {form.applicationType === 'その他' && (
              <TextField
                fullWidth
                label="具体的内容を入力"
                value={form.applicationOther}
                onChange={onChange('applicationOther')}
                sx={{ mt:2 }}
              />
            )}
          </FormControl>
        </Box>
      </div>

      {/* ---------- 希望対応内容 ---------- */}
      <div className="glass-form-section">
        <div className="glass-section-header">
          <span className="material-icons">support_agent</span>
          希望対応内容
        </div>
        <Box sx={{ p: { xs:2, sm:3 } }}>
          <FormControl component="fieldset" fullWidth>
            <FormLabel component="legend" sx={{ fontWeight:500 }}>対応方法</FormLabel>
            <RadioGroup
              value={form.supportType}
              onChange={onChange('supportType')}
            >
              {['従業員による案内','売場見学（案内なしの自由見学）','その他'].map(val => (
                <FormControlLabel
                  key={val}
                  value={val}
                  control={<Radio />}
                  label={val}
                />
              ))}
            </RadioGroup>
            {form.supportType === 'その他' && (
              <TextField
                fullWidth
                label="具体的内容を入力"
                value={form.supportOther}
                onChange={onChange('supportOther')}
                sx={{ mt:2 }}
              />
            )}
          </FormControl>
        </Box>
      </div>
    </>
  )}

        {/* ---------- 希望内容（カード/テーブル切替） ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">list_alt</span>
            希望内容
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <ToggleButtonGroup value={prefView} exclusive
              onChange={(_,v)=>v&&setPrefView(v)} size="small" color="primary"
              sx={{mb:2}}>
              <ToggleButton value="card">
                <span className="material-icons" style={{verticalAlign:'middle'}}>
                  view_module
                </span> カード表示
              </ToggleButton>
              <ToggleButton value="table">
                <span className="material-icons" style={{verticalAlign:'middle'}}>
                  table_view
                </span> テーブル表示
              </ToggleButton>
            </ToggleButtonGroup>
            {type==="exp" && (
              <Box sx={{mb:2}}>
                <Alert severity="info" sx={{mb:1,fontWeight:500}}>
                  <strong>※1学校の同日程でのお申し込み可能店舗数は3店舗までです。</strong>
                </Alert>
                <Alert severity="warning" sx={{fontWeight:500}}>
                  <strong>
                    ※10:30~15:00（休憩1時間含）の受け入れが基本です。<br/>
                    その他の体験時間でも可能な場合がありますのでご相談下さい。
                  </strong>
                </Alert>
              </Box>
            )}
            {prefView==="card"
              ? <PreferencesSortable prefs={form.preferences} setPrefs={setPrefs}/>
              : <PreferencesTable  prefs={form.preferences} setPrefs={setPrefs}/> }
          </Box>
        </div>
        {/* ---------- 連絡事項 ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">chat_bubble_outline</span>
            連絡事項
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <TextField fullWidth multiline rows={3}
              label={type==="exp"?"見学希望内容など":"見学の目的・見学方法など"}
              value={form.contactNotes} onChange={onChange('contactNotes')}/>
          </Box>
        </div>
        {/* ---------- ファイル添付 ---------- */}
        <div className="glass-form-section">
          <div className="glass-section-header">
            <span className="material-icons">attach_file</span>
            ファイル添付
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            <strong>※学校で作成した資料などお持ちでしたら添付してください。</strong>
            <FileDropZone file={form.file} onFile={onFile}/>
          </Box>
        </div>
        {/* ---------- 注意事項＆同意チェック ---------- */}
        <div className="glass-notice-section">
          <div className="glass-section-header notice">
            <span className="material-icons"
                  style={{fontSize:30,marginRight:10,color:'#ff9800'}}>warning_amber</span>
            <span style={{fontWeight:800,fontSize:'1.2em'}}>注意事項</span>
          </div>
          <Box sx={{p:{xs:2,sm:3}}}>
            {type==="exp"
              ? <>
                  <Typography sx={{fontWeight:700,color:'#bf360c',mb:1.3,fontSize:'1.09em'}}>
                    お申し込み前に必ずご確認ください
                  </Typography>
                  <ul style={{paddingLeft:18,marginBottom:8,color:'#795548',fontSize:'1.07em'}}>
                    <li><b>学年でまとめて</b>お申込みくださいますようお願いいたします。</li>
                    <li>店舗と打ち合わせ後、<b>折り返しご連絡</b>いたします。<br/>
                        お申込み数の多い時期は、調整に日数がかかることもございますので、
                        <b>希望日まで余裕をもって</b>お申込みください。</li>
                    <li>諸事情により、希望通りお受けできない場合もございますが、ご了承ください。</li>
                    <li>キャンセルはお早めにご連絡ください。
                        <b>一人でも多くの方に体験</b>していただけるよう、ご協力をお願いいたします。</li>
                    <li>生徒様の不注意によるケガや事故が発生した際、
                        <b>御校で加入されている学校保険等</b>でご対応いただきますようお願いいたします。</li>
                  </ul>
                  <Typography sx={{mt:2,fontWeight:700,color:'#4e342e',fontSize:'1.09em',mb:1.1}}>
                    【 店舗で体験するにあたって 】（サミットストアのみ・コルモピアは除く）
                  </Typography>
                  <ul style={{paddingLeft:18,color:'#5d4037',fontSize:'1.06em'}}>
                    <li>学校の制服で店舗へ出勤（入店）してください。
                        更衣室にて学校指定のジャージに着替えます。ジャージは洗濯済みのものを持参してください。</li>
                    <li>原料・製品への汚染および異物混入を防止するためご協力ください（社員と同じルールです）。</li>
                  </ul>
                </>
              : <>
                  <Typography sx={{fontWeight:700,color:'#bf360c',mb:1.3,fontSize:'1.09em'}}>
                    お申し込み前に必ずご確認ください
                  </Typography>
                  <ul style={{paddingLeft:18,marginBottom:8,color:'#795548',fontSize:'1.07em'}}>
                    <li>店舗と打ち合わせ後、<b>折り返しご連絡</b>いたします。（1週間程度かかる場合があります）<br/>
                        お申込み数の多い時期は、調整に日数がかかることもございます。<b>希望日まで余裕をもって</b>お申し込みください。</li>
                    <li>諸事情により、希望通りお受けできない場合もございますが、ご了承ください。</li>
                    <li>生徒様の不注意によるケガや事故が発生した際、
                        <b>御校で加入されている学校保険等</b>でご対応いただきますようお願いいたします。</li>
                  </ul>
                  <Typography sx={{fontSize:'1em',color:'#8d6e63',mt:1}}>
                    上記の【注意事項】を必ずお読みください。
                  </Typography>
                  </>
            }
            <FormControlLabel
              control={<Checkbox checked={form.ack}
                                 onChange={onChange('ack','checked')}/>}
              label={<span>注意事項を読み、内容に同意します</span>}
              sx={{mt:2,fontWeight:700,
                   color:form.ack?"#1976d2":"#d32f2f"}}/>
          </Box>
        </div>
      </Box>
    );
  }

  // -------------------------------------------------------------------
  // 見学申込 / 体験申込 フォーム本体（送信バリデーションなど）
  //    - onClose: モーダル閉じコールバック
  // -------------------------------------------------------------------
  function VisitForm({ type, onClose }){
    const [form,setForm]=React.useState(getInitialForm());
    const [submitted,setSubmitted]=React.useState(false);
    const [showSnack,setShowSnack]=React.useState(false);

    /* text 用共通ハンドラ */
    const onChange=(k,prop='value')=>e=>setForm(f=>({...f,[k]:e.target[prop]}));

    /* 数字入力：非数文字を除去 */
    const onNum=k=>e=>{
      const val=e.target.value.replace(/[^0-9]/g,'');
      setForm(f=>({...f,[k]:val}));
    };

    /* ファイル選択 */
    const onFile=e=>{
      if(e.target.files&&e.target.files[0])
        setForm(f=>({...f,file:e.target.files[0]}));
    };

    /* 送信（デモなので実際には保存せず Snackbar 表示） */
    const handleSubmit=e=>{
      e.preventDefault();
      setSubmitted(true);
      const isError = !form.schoolName || !form.grade || !form.contactName ||
        !form.tel1 || !form.tel2 || !form.tel3 || !form.email ||
        !form.preferences.some(p=>p.store&&p.date&&p.start&&p.end&&p.count) || !form.ack;
      if(isError) return;
      setShowSnack(true);
      setTimeout(()=>setForm(getInitialForm()),1800);
      setTimeout(()=>setSubmitted(false),2000);
    };

    /* エラーがあるかどうか（送信後のみチェック） */
    const isError = submitted && (
      !form.schoolName || !form.grade || !form.contactName ||
      !form.tel1 || !form.tel2 || !form.tel3 ||
      !form.email || !form.preferences.some(p=>p.store&&p.date&&p.start&&p.end&&p.count) ||
      !form.ack
    );

    return(
      <form autoComplete="off" onSubmit={handleSubmit}>
        <VisitFormBody form={form} setForm={setForm}
          onChange={onChange} onNum={onNum} onFile={onFile} type={type}/>
        <Box sx={{textAlign:'center',py:4}}>
          <Button type="submit" size="large" variant="contained" color="primary"
            sx={{fontWeight:800,px:8,py:1.7,borderRadius:5,
                 background:'linear-gradient(90deg,#2196f3 30%,#1565c0 100%)'}}>
            申込内容を送信
          </Button>
        </Box>
        <Snackbar open={showSnack} autoHideDuration={2500}
          onClose={()=>setShowSnack(false)}
          anchorOrigin={{vertical:'top',horizontal:'center'}}>
          <Alert severity="success" variant="filled"
            sx={{fontWeight:600,fontSize:'1.12em'}}>
            申込内容を仮登録しました。<br/>担当者より折り返しご連絡いたします。
          </Alert>
        </Snackbar>
        {isError && (
          <Alert severity="error" sx={{mt:2,fontWeight:700}}>
            入力に不備があります。必須項目をご確認の上、再度ご送信ください。
          </Alert>
        )}
      </form>
    );
  }

  // -------------------------------------------------------------------
  // 申込内容確認コンポーネント（EntryLookup：元コードを全保持）
  //   - onClose: モーダル閉じコールバック
  // -------------------------------------------------------------------
  function EntryLookup({ onClose }){
    /* ---- ★デモ用ダミーデータ ---- */
    const DUMMY_ENTRIES=[
      {
        id:"APP001",email:"sample1@example.com",
        tel1:"090",tel2:"1234",tel3:"5678",
        fax1:"03",fax2:"1111",fax3:"2222",
        confirmCode:"ABC123", name:"田中 太郎",
        company:"株式会社サンプル",
        applicationDate:"2025-05-20", visitDate:"2025-06-15",
        visitTime:"14:00", purpose:"店舗見学", participants:3,
        status:"confirmed", notes:"駐車場の利用を希望"
      },
      {
        id:"APP002",email:"test@company.co.jp",
        tel1:"080",tel2:"5555",tel3:"2222",
        fax1:"03",fax2:"3333",fax3:"4444",
        confirmCode:"XYZ999", name:"佐藤 花子",
        company:"テスト商事",
        applicationDate:"2025-05-22", visitDate:"2025-06-20",
        visitTime:"10:30", purpose:"職場体験", participants:1,
        status:"pending", notes:""
      },
      {
        id:"APP003",email:"",
        tel1:"070",tel2:"9999",tel3:"0000",
        fax1:"",fax2:"",fax3:"",
        confirmCode:"DEF456", name:"山田 次郎",
        company:"個人事業主",
        applicationDate:"2025-05-25", visitDate:"2025-07-01",
        visitTime:"13:00", purpose:"店舗見学", participants:2,
        status:"cancelled", notes:"キャンセル理由：日程調整困難"
      }
    ];
    const [search,setSearch]=React.useState({email:'',tel:'',fax:'',code:''});
    const [status,setStatus]=React.useState('');
    const [foundEntry,setFoundEntry]=React.useState(null);
    const [errorDetails,setErrorDetails]=React.useState(null);
    const [nextStep,setNextStep]=React.useState('');
    const [showErrDetail,setShowErrDetail]=React.useState(false);

    const analyzeError=searchData=>{
      const errs=[];
      if(!searchData.code.trim()){
        errs.push({type:"missing_required",
                   message:"申込確認番号が入力されていません",
                   solution:"メールまたは電話で受け取った確認番号を入力してください"});
      }
      if(!searchData.email.trim() && !searchData.tel.trim() && !searchData.fax.trim()){
        errs.push({type:"missing_contact",
                   message:"連絡先情報が入力されていません",
                   solution:"メールアドレス、電話番号、FAX番号のいずれか1つを入力してください"});
      }
      const codeMatch = DUMMY_ENTRIES.find(e=>e.confirmCode===searchData.code.trim().toUpperCase());
      const contactMatch = DUMMY_ENTRIES.find(e=>
        (searchData.email && e.email && e.email===searchData.email.trim()) ||
        (searchData.tel && (e.tel1+e.tel2+e.tel3)===searchData.tel.trim()) ||
        (searchData.fax && (e.fax1+e.fax2+e.fax3)===searchData.fax.trim())
      );
      if(!codeMatch && !contactMatch){
        errs.push({type:"not_found",
                   message:"該当する申込情報が見つかりません",
                   solution:"入力内容を確認するか、申込時の資料をご確認ください"});
      }else if(codeMatch && !contactMatch){
        errs.push({type:"contact_mismatch",
                   message:"確認番号は正しいですが、連絡先情報が一致しません",
                   solution:"申込時に使用したメールアドレスまたは電話番号を入力してください"});
      }else if(!codeMatch && contactMatch){
        errs.push({type:"code_mismatch",
                   message:"連絡先は正しいですが、確認番号が一致しません",
                   solution:"申込完了時に発行された確認番号を正確に入力してください"});
      }
      return errs;
    };

    const handleSearch=()=>{
      setNextStep('');
      const errs=analyzeError(search);
      if(errs.length>0){
        setStatus('error'); setErrorDetails(errs); setFoundEntry(null);
        return;
      }
      const found = DUMMY_ENTRIES.find(e=>
        ((search.email && e.email && e.email===search.email.trim()) ||
         (search.tel && (e.tel1+e.tel2+e.tel3)===search.tel.trim()) ||
         (search.fax && (e.fax1+e.fax2+e.fax3)===search.fax.trim())) &&
        e.confirmCode === search.code.trim().toUpperCase()
      );
      if(found){
        setFoundEntry(found); setStatus('success'); setErrorDetails(null);
      }else{
        setStatus('error'); setErrorDetails([{type:"not_found",
          message:"該当する申込情報が見つかりません",
          solution:"入力内容を確認してください"}]);
      }
    };

    const renderReference=()=>{
      if(!foundEntry) return null;
      const colorMap={confirmed:'#4caf50',pending:'#ff9800',cancelled:'#f44336'};
      const textMap ={confirmed:'確定',pending:'確認中',cancelled:'キャンセル'};
      return(
        <Card className="reference-card status-card">
          <CardContent>
            <Box display="flex" justifyContent="space-between" alignItems="center" mb={2}>
              <Typography variant="h6" sx={{fontWeight:600,color:'#4a148c'}}>
                <span className="material-icons"
                      style={{verticalAlign:'middle',marginRight:8}}>assignment</span>
                申込詳細情報
              </Typography>
              <Chip label={textMap[foundEntry.status]||'不明'}
                    sx={{backgroundColor:colorMap[foundEntry.status]||'#9e9e9e',
                         color:'#fff',fontWeight:600}}/>
            </Box>
            <Grid container spacing={3}>
              <Grid item xs={12} md={6}>
                <Paper sx={{p:2,background:'rgba(255,255,255,0.7)'}}>
                  <Typography variant="subtitle2" color="primary"
                    sx={{fontWeight:600,mb:1}}>基本情報</Typography>
                  <ul style={{margin:0,paddingLeft:18}}>
                    <li>氏名：{foundEntry.name}</li>
                    <li>会社名：{foundEntry.company}</li>
                    <li>申込番号：{foundEntry.id}</li>
                  </ul>
                </Paper>
              </Grid>
              <Grid item xs={12} md={6}>
                <Paper sx={{p:2,background:'rgba(255,255,255,0.7)'}}>
                  <Typography variant="subtitle2" color="primary"
                    sx={{fontWeight:600,mb:1}}>訪問予定</Typography>
                  <ul style={{margin:0,paddingLeft:18}}>
                    <li>訪問日：{foundEntry.visitDate}</li>
                    <li>時間：{foundEntry.visitTime}</li>
                    <li>参加人数：{foundEntry.participants}名</li>
                  </ul>
                </Paper>
              </Grid>
              <Grid item xs={12}>
                <Paper sx={{p:2,background:'rgba(255,255,255,0.7)'}}>
                  <Typography variant="subtitle2" color="primary"
                    sx={{fontWeight:600,mb:1}}>目的・備考</Typography>
                  目的: {foundEntry.purpose}<br/>
                  {foundEntry.notes && <>備考: {foundEntry.notes}</>}
                </Paper>
              </Grid>
            </Grid>
            <Box mt={3} display="flex" gap={2} flexWrap="wrap">
              <Button variant="contained" color="primary"
                startIcon={<span className="material-icons">visibility</span>}
                onClick={()=>setNextStep("detail")}>詳細を表示</Button>
              <Button variant="outlined" color="warning"
                startIcon={<span className="material-icons">cancel</span>}
                onClick={()=>setNextStep("cancel")}>キャンセル申請</Button>
              <Button variant="outlined" color="secondary"
                startIcon={<span className="material-icons">edit_calendar</span>}
                onClick={()=>setNextStep("reschedule")}>日程変更申請</Button>
            </Box>
          </CardContent>
        </Card>
      );
    };

    const renderErrorDetails=()=>errorDetails&&(
      <Card className="status-card">
        <CardContent>
          <Box display="flex" alignItems="center" mb={2}>
            <span className="material-icons" style={{color:'#f44336',marginRight:8}}>
              error_outline
            </span>
            <Typography variant="h6" color="error" sx={{fontWeight:600}}>
              検索エラー詳細
            </Typography>
            <IconButton size="small"
              onClick={()=>setShowErrDetail(!showErrDetail)} sx={{ml:'auto'}}>
              <span className="material-icons">
                {showErrDetail?'expand_less':'expand_more'}
              </span>
            </IconButton>
          </Box>
          <Collapse in={showErrDetail}>
            {errorDetails.map((err,i)=>(
              <Box key={i} mb={i<errorDetails.length-1?2:0}>
                <Typography variant="subtitle2"
                  sx={{fontWeight:600,color:'#d32f2f',mb:1}}>
                  <span className="material-icons"
                        style={{verticalAlign:'middle',marginRight:4,fontSize:18}}>
                    warning
                  </span>
                  {err.message}
                </Typography>
                <Typography variant="body2" sx={{color:'#5d4037',fontStyle:'italic'}}>
                  💡 {err.solution}
                </Typography>
              </Box>
            ))}
          </Collapse>
        </CardContent>
      </Card>
    );

    const renderNextFlow=()=>{
      const map={
        detail:{title:"申込詳細照会",icon:"description",severity:"info"},
        cancel:{title:"キャンセル申請",icon:"cancel_presentation",severity:"warning"},
        reschedule:{title:"日程変更申請",icon:"date_range",severity:"success"}
      };
      const f=map[nextStep];
      return f?(
        <Alert severity={f.severity} sx={{mt:3,borderRadius:3}}>
          <Box display="flex" alignItems="center">
            <span className="material-icons" style={{marginRight:8}}>{f.icon}</span>
            <Typography sx={{fontWeight:600}}>
              {f.title}フロー画面です（デモ表示）
            </Typography>
          </Box>
        </Alert>
      ):null;
    };

    return(
      <Box className="glass-effect"
           sx={{p:4,maxWidth:800,mx:'auto',mt:2,mb:4,borderRadius:4}}>
        <Typography variant="h5"
          sx={{mb:3,fontWeight:700,textAlign:'center',color:'#1565c0',
               display:'flex',justifyContent:'center',alignItems:'center',gap:1}}>
          <span className="material-icons" style={{fontSize:32}}>search</span>
          申込内容の確認・参照
        </Typography>
        {status==='' && (
          <>
            <Alert severity="info" sx={{mb:3,borderRadius:3,fontWeight:500}}>
              📧 メールアドレス・📞 電話番号・📠 FAX番号のいずれか1つと、
              🔢 申込確認番号の組み合わせで検索します
            </Alert>
            <Box>
              <TextField fullWidth label="メールアドレス" sx={{mb:2}}
                value={search.email}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#42a5f5',marginRight:8}}>email</span>}}
                onChange={e=>setSearch({...search,email:e.target.value,tel:'',fax:''})}/>
              <Typography align="center"
                          sx={{my:1,fontWeight:600,color:'#90a4ae'}}>または</Typography>
              <TextField fullWidth label="電話番号（ハイフン無し）" sx={{mb:2}}
                value={search.tel}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#66bb6a',marginRight:8}}>phone</span>}}
                onChange={e=>setSearch({...search,tel:e.target.value,email:'',fax:''})}/>
              <Typography align="center"
                          sx={{my:1,fontWeight:600,color:'#90a4ae'}}>または</Typography>
              <TextField fullWidth label="FAX番号（ハイフン無し）"
                value={search.fax}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#ab47bc',marginRight:8}}>print</span>}}
                onChange={e=>setSearch({...search,fax:e.target.value,email:'',tel:''})}/>
            </Box>
            <Box sx={{mt:3}}>
              <TextField fullWidth label="申込確認番号"
                value={search.code}
                InputProps={{startAdornment:
                  <span className="material-icons"
                        style={{color:'#ff7043',marginRight:8}}>vpn_key</span>}}
                onChange={e=>setSearch({...search,code:e.target.value})}/>
            </Box>
            <Button variant="contained" fullWidth sx={{py:2,fontSize:18,fontWeight:700,
                    background:'linear-gradient(45deg,#2196f3 30%,#21cbf3 90%)',mt:3}}
                    onClick={handleSearch}>
              <span className="material-icons" style={{marginRight:8}}>search</span>
              申込内容を検索
            </Button>
          </>
        )}
        {status==='error' && (
          <>
            <Alert severity="error" sx={{borderRadius:3}}>
              申込内容が見つかりませんでした
            </Alert>
            {renderErrorDetails()}
            <Box mt={3}>
              <Button color="inherit" startIcon={<span className="material-icons">refresh</span>}
                onClick={()=>{setStatus('');setErrorDetails(null);}}>
                再検索する
              </Button>
              <Button color="inherit" sx={{ml:2}} onClick={onClose}>
                閉じる
              </Button>
            </Box>
          </>
        )}
        {status==='success' && (
          <>
            <Alert severity="success" sx={{borderRadius:3,mb:2,fontWeight:600}}>
              ✅ 申込情報の確認が完了しました
            </Alert>
            {renderReference()}
            {renderNextFlow()}
            <Box mt={3}>
              <Button color="inherit" onClick={onClose}>
                閉じる
              </Button>
            </Box>
          </>
        )}
      </Box>
    );
  }

  // -------------------------------------------------------------------
  // メイン画面（トップページ＋各申込モーダル/ダイアログ制御）
  // -------------------------------------------------------------------
  function MainApp(){
    // openModal: false/0/1/2
    // 0=体験申込  1=通常見学申込  2=申込内容参照
    const [openModal,setOpenModal]=React.useState(false);

    // モーダルタイトル＋コンテンツ
    const modalMap=[
      {
        title:"見学体験申込フォーム（職場体験・インターン等）",
        content:(closeFn)=><VisitForm type="exp" onClose={closeFn}/>
      },
      {
        title:"通常見学申込フォーム（施設見学）",
        content:(closeFn)=><VisitForm type="visit" onClose={closeFn}/>
      },
      {
        title:"申込内容の確認・参照",
        content:(closeFn)=><EntryLookup onClose={closeFn}/>
      }
    ];

    // トップ画面レイアウト
    return(
<Box
  sx={{
    minHeight: '100vh',
    display: 'flex',
    flexDirection: 'column',
    justifyContent: 'center',
    background: 'none',
    py: { xs: 2, sm: 5 },
  }}
>
  <Box
    className="glass"
    sx={{
      maxWidth: 700,
      mx: 'auto',
      p: { xs: 2.5, sm: 5 },
      borderRadius: 5,
      boxShadow: '0 4px 32px rgba(25,118,210,0.10)',
      mt: { xs: 1, sm: 5 },
      mb: { xs: 2, sm: 5 },
    }}
  >
    <Typography
      variant="h4"
      className="hero-title"
      sx={{
        fontWeight: 900,
        textAlign: 'center',
        color: '#0d47a1',
        mb: 2,
      }}
    >
      <span
        className="material-icons"
        style={{ fontSize: 38, verticalAlign: 'middle' }}
      >
        groups
      </span>
      サミット 見学・体験申込管理システム
    </Typography>
    <Typography align="center" sx={{ mb: 5, color: '#424242' }}>
      <span style={{ fontWeight: 700 }}>
        店舗見学・職場体験の申込／照会
      </span>
      をオンラインで行えます。<br />
      お申込後、担当者より折り返しご連絡いたします。
    </Typography>

    <Grid container spacing={3}>
      {/* 体験申込 */}
      <Grid item xs={12} sm={4}>
        <Paper
          elevation={3}
          sx={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            p: 2,
            borderRadius: 3,
            transition: 'transform .2s, box-shadow .2s',
            '&:hover': {
              transform: 'translateY(-4px) scale(1.02)',
              boxShadow: '0 12px 24px rgba(0,0,0,0.15)',
            },
          }}
        >
          <Box sx={{ textAlign: 'center' }}>
            <span
              className="material-icons"
              style={{ fontSize: 46, color: '#1976d2', marginBottom: 8 }}
            >
              school
            </span>
            <Typography
              variant="h6"
              sx={{ fontWeight: 800, color: '#1565c0', mb: 1 }}
            >
              見学体験申込
            </Typography>
            <Typography variant="body2" sx={{ color: '#1976d2' }}>
              職場体験・インターン・学外学習等
            </Typography>
          </Box>
          <Box sx={{ flexGrow: 1, mt: 1 }}>
            <Typography
              variant="body2"
              sx={{ textAlign: 'center', color: 'text.secondary', px: 1 }}
            >
              職場体験の詳細をご確認いただき、こちらからお申し込みください。
            </Typography>
          </Box>
          <Box sx={{ textAlign: 'center', mt: 2 }}>
            <Button
              variant="contained"
              size="small"
              onClick={() => setOpenModal(0)}
            >
              体験申込
            </Button>
          </Box>
        </Paper>
      </Grid>

      {/* 通常見学申込 */}
      <Grid item xs={12} sm={4}>
        <Paper
          elevation={3}
          sx={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            p: 2,
            borderRadius: 3,
            transition: 'transform .2s, box-shadow .2s',
            '&:hover': {
              transform: 'translateY(-4px) scale(1.02)',
              boxShadow: '0 12px 24px rgba(0,0,0,0.15)',
            },
          }}
        >
          <Box sx={{ textAlign: 'center' }}>
            <span
              className="material-icons"
              style={{ fontSize: 46, color: '#43a047', marginBottom: 8 }}
            >
              store
            </span>
            <Typography
              variant="h6"
              sx={{ fontWeight: 800, color: '#388e3c', mb: 1 }}
            >
              通常見学申込
            </Typography>
            <Typography variant="body2" sx={{ color: '#43a047' }}>
              施設見学・業界研究・視察等
            </Typography>
          </Box>
          <Box sx={{ flexGrow: 1, mt: 1 }}>
            <Typography
              variant="body2"
              sx={{ textAlign: 'center', color: 'text.secondary', px: 1 }}
            >
              施設見学の概要を確認してこちらからお申し込みください。
            </Typography>
          </Box>
          <Box sx={{ textAlign: 'center', mt: 2 }}>
            <Button
              variant="contained"
              size="small"
              onClick={() => setOpenModal(1)}
            >
              見学申込
            </Button>
          </Box>
        </Paper>
      </Grid>

      {/* 申込状況確認 */}
      <Grid item xs={12} sm={4}>
        <Paper
          elevation={3}
          sx={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            p: 2,
            borderRadius: 3,
            transition: 'transform .2s, box-shadow .2s',
            '&:hover': {
              transform: 'translateY(-4px) scale(1.02)',
              boxShadow: '0 12px 24px rgba(0,0,0,0.15)',
            },
          }}
        >
          <Box sx={{ textAlign: 'center' }}>
            <span
              className="material-icons"
              style={{ fontSize: 46, color: '#ff9800', marginBottom: 8 }}
            >
              assignment
            </span>
            <Typography
              variant="h6"
              sx={{ fontWeight: 800, color: '#f57c00', mb: 1 }}
            >
              申込状況確認
            </Typography>
            <Typography variant="body2" sx={{ color: '#ff9800' }}>
              申込内容の参照・変更・キャンセルができます
            </Typography>
          </Box>
          <Box sx={{ flexGrow: 1, mt: 1 }}>
            <Typography
              variant="body2"
              sx={{ textAlign: 'center', color: 'text.secondary', px: 1 }}
            >
              ご自身の申込状況をここからご確認ください。
            </Typography>
          </Box>
          <Box sx={{ textAlign: 'center', mt: 2 }}>
            <Button
              variant="contained"
              size="small"
              onClick={() => setOpenModal(2)}
            >
              確認する
            </Button>
          </Box>
        </Paper>
      </Grid>
    </Grid>
  </Box>

        {/* ================= モーダル（ダイアログ） ================== */}
        <Dialog open={openModal!==false}
          onClose={()=>setOpenModal(false)}
          maxWidth="md" fullWidth scroll="body"
          PaperProps={{sx:{borderRadius:6}}}>
          <DialogTitle sx={{fontWeight:900,py:3,px:4,fontSize:'1.28em'}}>
            {openModal!==false && modalMap[openModal]?.title}
          </DialogTitle>
          <DialogContent sx={{pb:2,px:{xs:1,sm:4},pt:0}}>
            {openModal!==false && modalMap[openModal].content(()=>setOpenModal(false))}
          </DialogContent>
          <DialogActions>
            <Button onClick={()=>setOpenModal(false)} color="inherit">閉じる</Button>
          </DialogActions>
        </Dialog>
      </Box>
    );
  }

  // ---------------------- ルートDOMレンダリング ----------------------
  ReactDOM.createRoot(document.getElementById("root")).render(<MainApp/>);

  </script>
</body>
</html>
