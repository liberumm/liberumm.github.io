<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆReact + MUI ç‰ˆï¼‰</title>

  <!-- ===== ãƒ•ã‚©ãƒ³ãƒˆ & ã‚¢ã‚¤ã‚³ãƒ³ ===== -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/icon?family=Material+Icons" />

  <!-- ===== Tailwindï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼éƒ¨ã®è£…é£¾ãªã©ã§ä½µç”¨ï¼‰===== -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ===== React / ReactDOM ===== -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

  <!-- ===== Babel (for in-browser JSX) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>

  <!-- ===== Emotion ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>

  <!-- ===== MUI (Material-UI) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js"></script>

  <style>
    .hero::before {
      content: '';
      @apply absolute inset-0 bg-black opacity-20;
    }
    @keyframes pulseBubble {
      0%,100% { opacity: 1 }
      50%      { opacity: .5 }
    }
    .bubble {
      animation: pulseBubble 2s cubic-bezier(0.4,0,0.6,1) infinite;
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const {
      Box, Container, Typography, Grid, Paper, Button,
      Chip, Checkbox, Table, TableBody, TableCell, TableContainer,
      TableHead, TableRow, LinearProgress, Collapse, IconButton,
      FormControl, InputLabel, Select, MenuItem, Modal, Badge
    } = MaterialUI;

    // ===== Constants =====
    const CONSTANTS = {
      subStatuses: [
        'ä¾é ¼ä¸­','ä¾é ¼æ¸ˆ','è¦‹ç©ä¸­','è¦‹ç©æ¸ˆ',
        'è­¦å‚™å“¡ä¾é ¼æ¸ˆ','è­¦å‚™å“¡æ‰‹é…ä¸­','è­¦å‚™å“¡æ‰‹é…æ¸ˆ',
        'æ—¥ç¨‹èª¿æ•´ä¸­','æ—¥ç¨‹èª¿æ•´æ¸ˆ','å·¥äº‹æ¸ˆ'
      ],
      actionButtonsMap: {
        'ä¾é ¼ä¸­':       ['æ–°è¦ä¾é ¼ä½œæˆ'],
        'ä¾é ¼æ¸ˆ':       ['å®Ÿæ–½æ¸ˆã¿ä¾é ¼ä½œæˆ'],
        'è¦‹ç©ä¸­':       ['è¦‹ç©ä½œæˆ'],
        'è¦‹ç©æ¸ˆ':       ['è­¦å‚™å“¡ä¾é ¼ä½œæˆ'],
        'è­¦å‚™å“¡ä¾é ¼æ¸ˆ': ['è­¦å‚™å“¡æ‰‹é…'],
        'è­¦å‚™å“¡æ‰‹é…ä¸­': ['è­¦å‚™å“¡æ‰‹é…'],
        'è­¦å‚™å“¡æ‰‹é…æ¸ˆ': ['æ—¥ç¨‹èª¿æ•´'],
        'æ—¥ç¨‹èª¿æ•´ä¸­':   ['æ—¥ç¨‹èª¿æ•´'],
        'æ—¥ç¨‹èª¿æ•´æ¸ˆ':   ['å·¥äº‹å®Œäº†æ›¸ä½œæˆ'],
        'å·¥äº‹æ¸ˆ':       ['å·¥äº‹å®Œäº†æ›¸ä½œæˆ']
      },
      defaultActions: ['æ¡ˆä»¶ç®¡ç†','å±¥æ­´ç®¡ç†'],
      projectNames: [
        'ECã‚µã‚¤ãƒˆãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«','ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³','ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
        'ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªé–‹ç™º','ãƒ‡ãƒ¼ã‚¿åˆ†æåŸºç›¤æ§‹ç¯‰','ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
        'AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå°å…¥','ã‚¯ãƒ©ã‚¦ãƒ‰ç§»è¡Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ','CRM ã‚·ã‚¹ãƒ†ãƒ å°å…¥',
        'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰','ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æœ€é©åŒ–','IoT ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ§‹ç¯‰'
      ],
      managers: ['ç”°ä¸­å¤ªéƒ','ä½è—¤èŠ±å­','éˆ´æœ¨æ¬¡éƒ','å±±ç”°ä¸‰éƒ','ä¼Šè—¤ç¾å’²','é«˜æ©‹å¥å¤ª','ä¸­æ‘æ„›å­','æ¸¡è¾ºæ‹“ä¹Ÿ'],
      taskNames: ['è¦ä»¶å®šç¾©','ãƒ‡ã‚¶ã‚¤ãƒ³è¨­è¨ˆ','é–‹ç™º','ãƒ†ã‚¹ãƒˆ','é‹ç”¨é–‹å§‹','å¸‚å ´èª¿æŸ»','ãƒ„ãƒ¼ãƒ«é¸å®š','å®Ÿè£…']
    };

    // ===== Utility Functions =====
    const generateSampleData = () => {
      const statuses = [...CONSTANTS.subStatuses, 'å®Œäº†'];
      return CONSTANTS.projectNames.map((name,i) => {
        const deadline = new Date(
          2024,
          Math.floor(Math.random()*12),
          Math.floor(Math.random()*28)+1
        ).toISOString().split('T')[0];
        const tasks = Array.from(
          {length: Math.floor(Math.random()*4)+2},
          (_,j) => ({
            id: i*100 + j + 1,
            name: CONSTANTS.taskNames[Math.floor(Math.random()*CONSTANTS.taskNames.length)],
            status: statuses[Math.floor(Math.random()*statuses.length)],
            progress: Math.floor(Math.random()*101),
            selected: false
          })
        );
        return {
          id: i + 1,
          name,
          status: Math.random()<0.2 ? 'å®Œäº†' : 'é€²è¡Œä¸­',
          progress: Math.floor(Math.random()*81)+10,
          deadline,
          manager: CONSTANTS.managers[Math.floor(Math.random()*CONSTANTS.managers.length)],
          selected: false,
          expanded: false,
          tasks
        };
      });
    };

    const statusColor = status => ({
      'å®Œäº†':'success',
      'é€²è¡Œä¸­':'primary',
      'è¨ˆç”»ä¸­':'warning',
      'å¾…æ©Ÿä¸­':'default'
    }[status] || 'default');
    
    const statusIcon = status => ({
      'å®Œäº†':'âœ“','é€²è¡Œä¸­':'â—','è¨ˆç”»ä¸­':'â—‹','å¾…æ©Ÿä¸­':'âš '
    }[status] || 'â—‹');

    // ===== Custom Hooks =====
    const useProjectManagement = () => {
      const [projects, setProjects] = React.useState([]);
      const [activeTab, setActiveTab] = React.useState('all');
      const [activeSubStatus, setActiveSubStatus] = React.useState('allSub');
      const [currentPage, setCurrentPage] = React.useState(1);
      const [itemsPerPage, setItemsPerPage] = React.useState(5);

      React.useEffect(() => {
        setProjects(generateSampleData());
      }, []);

      const filteredByStatus = React.useMemo(() => {
        return activeTab === 'all'
          ? projects
          : projects.filter(p => p.status === activeTab);
      }, [projects, activeTab]);

      const filtered = React.useMemo(() => {
        if (activeSubStatus === 'allSub') return filteredByStatus;
        return filteredByStatus.filter(p =>
          p.tasks.some(t => t.status === activeSubStatus)
        );
      }, [filteredByStatus, activeSubStatus]);

      const totalPages = Math.ceil(filtered.length / itemsPerPage);
      const pageItems = filtered.slice(
        (currentPage - 1) * itemsPerPage,
        currentPage * itemsPerPage
      );

      const stats = React.useMemo(() => ({
        total: projects.length,
        completed: projects.filter(p => p.status === 'å®Œäº†').length,
        inProgress: projects.filter(p => p.status === 'é€²è¡Œä¸­').length,
        planned: projects.filter(p => p.status === 'è¨ˆç”»ä¸­').length
      }), [projects]);

      const selectedCounts = React.useMemo(() => ({
        projects: projects.filter(p => p.selected).length,
        tasks: projects.reduce(
          (tot, p) => tot + p.tasks.filter(t => t.selected).length,
          0
        )
      }), [projects]);

      const toggleProject = id => {
        setProjects(ps => ps.map(p =>
          p.id === id ? { ...p, selected: !p.selected } : p
        ));
      };
      
      const toggleExpand = id => {
        setProjects(ps => ps.map(p =>
          p.id === id ? { ...p, expanded: !p.expanded } : p
        ));
      };
      
      const toggleTask = (pid, tid) => {
        setProjects(ps => ps.map(p => {
          if (p.id !== pid) return p;
          return {
            ...p,
            tasks: p.tasks.map(t =>
              t.id === tid ? { ...t, selected: !t.selected } : { ...t, selected: false }
            )
          };
        }));
      };
      
      const selectAllTasks = (pid, flag) => {
        setProjects(ps => ps.map(p => {
          if (p.id !== pid) return p;
          return {
            ...p,
            tasks: p.tasks.map(t => ({ ...t, selected: flag && t.status === activeSubStatus }))
          };
        }));
      };
      
      const handleTab = tab => {
        setActiveTab(tab);
        setActiveSubStatus('allSub');
        setCurrentPage(1);
      };
      
      const changePage = page => {
        if (page >= 1 && page <= totalPages) {
          setCurrentPage(page);
        }
      };

      return {
        projects, activeTab, activeSubStatus, currentPage, itemsPerPage,
        pageItems, totalPages, stats, selectedCounts, filtered,
        setActiveSubStatus, setCurrentPage, setItemsPerPage,
        toggleProject, toggleExpand, toggleTask, selectAllTasks,
        handleTab, changePage
      };
    };

    // ===== Calendar Utilities =====
    const useCalendar = () => {
      const [currentDate, setCurrentDate] = React.useState(new Date());
      
      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startDay = firstDay.getDay();
        
        const days = [];
        for (let i = 0; i < startDay; i++) {
          days.push(null);
        }
        for (let i = 1; i <= daysInMonth; i++) {
          days.push(new Date(year, month, i));
        }
        return days;
      };
      
      const changeMonth = (delta) => {
        setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + delta, 1));
      };
      
      return { currentDate, getDaysInMonth, changeMonth };
    };

    // ===== Components =====
    const TaskDetailModal = ({ task, project, open, onClose, onAction }) => {
      if (!task) return null;
      
      const availableActions = CONSTANTS.actionButtonsMap[task.status] || [];
      const createdDate = new Date(2024, Math.floor(Math.random()*12), Math.floor(Math.random()*28)+1).toLocaleDateString('ja-JP');
      const dueDate = new Date(2024, Math.floor(Math.random()*12), Math.floor(Math.random()*28)+1).toLocaleDateString('ja-JP');
      
      return (
        <Modal open={open} onClose={onClose}>
          <Box sx={{
            position: 'absolute',
            top: '50%',
            left: '50%',
            transform: 'translate(-50%, -50%)',
            width: 600,
            bgcolor: 'background.paper',
            boxShadow: 24,
            borderRadius: 3,
            maxHeight: '90vh',
            overflow: 'auto'
          }}>
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <Box sx={{ p: 3, borderBottom: '1px solid #e0e0e0', bgcolor: '#f8f9fa' }}>
              <Typography variant="h4" fontWeight={700} color="primary.main" mb={1}>
                {task.name}
              </Typography>
              <Box display="flex" alignItems="center" gap={2}>
                <Chip
                  label={<span>{statusIcon(task.status)} {task.status}</span>}
                  color={statusColor(task.status)}
                  sx={{ fontWeight: 600 }}
                />
                <Typography variant="body2" color="text.secondary">
                  ID: {task.id}
                </Typography>
              </Box>
            </Box>
            
            {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
            <Box sx={{ p: 3 }}>
              <Grid container spacing={3}>
                <Grid item xs={12} md={6}>
                  <Paper variant="outlined" sx={{ p: 2, height: '100%' }}>
                    <Typography variant="h6" color="primary.main" mb={2} display="flex" alignItems="center">
                      ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
                    </Typography>
                    <Box mb={2}>
                      <Typography variant="subtitle2" color="text.secondary">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</Typography>
                      <Typography variant="body1" fontWeight={600}>{project?.name}</Typography>
                    </Box>
                    <Box mb={2}>
                      <Typography variant="subtitle2" color="text.secondary">æ‹…å½“è€…</Typography>
                      <Typography variant="body1">{project?.manager}</Typography>
                    </Box>
                    <Box>
                      <Typography variant="subtitle2" color="text.secondary">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—</Typography>
                      <Box display="flex" alignItems="center" gap={1}>
                        <Box sx={{ width: 120 }}>
                          <LinearProgress variant="determinate" value={project?.progress || 0} />
                        </Box>
                        <Typography variant="body2">{project?.progress || 0}%</Typography>
                      </Box>
                    </Box>
                  </Paper>
                </Grid>
                
                <Grid item xs={12} md={6}>
                  <Paper variant="outlined" sx={{ p: 2, height: '100%' }}>
                    <Typography variant="h6" color="secondary.main" mb={2} display="flex" alignItems="center">
                      âš™ï¸ ã‚¿ã‚¹ã‚¯è©³ç´°
                    </Typography>
                    <Box mb={2}>
                      <Typography variant="subtitle2" color="text.secondary">é€²æ—çŠ¶æ³</Typography>
                      <Box display="flex" alignItems="center" gap={1} mb={1}>
                        <Box sx={{ width: 150 }}>
                          <LinearProgress variant="determinate" value={task.progress} color="success" />
                        </Box>
                        <Typography variant="h6" fontWeight={700} color="success.main">
                          {task.progress}%
                        </Typography>
                      </Box>
                    </Box>
                    <Box mb={2}>
                      <Typography variant="subtitle2" color="text.secondary">ä½œæˆæ—¥</Typography>
                      <Typography variant="body1">{createdDate}</Typography>
                    </Box>
                    <Box>
                      <Typography variant="subtitle2" color="text.secondary">æœŸé™æ—¥</Typography>
                      <Typography variant="body1">{dueDate}</Typography>
                    </Box>
                  </Paper>
                </Grid>
              </Grid>
              
              {availableActions.length > 0 && (
                <Box mt={3}>
                  <Paper variant="outlined" sx={{ p: 2, bgcolor: '#f0f7ff' }}>
                    <Typography variant="h6" color="primary.main" mb={2} display="flex" alignItems="center">
                      âš¡ åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                    </Typography>
                    <Box display="flex" flexWrap="wrap" gap={1}>
                      {availableActions.map(action => (
                        <Button
                          key={action}
                          variant="contained"
                          size="medium"
                          onClick={() => onAction(action, task)}
                          sx={{ minWidth: 120 }}
                        >
                          {action}
                        </Button>
                      ))}
                    </Box>
                  </Paper>
                </Box>
              )}
            </Box>
            
            {/* ãƒ•ãƒƒã‚¿ãƒ¼ */}
            <Box sx={{ p: 3, borderTop: '1px solid #e0e0e0', bgcolor: '#f8f9fa' }}>
              <Box display="flex" gap={2} justifyContent="flex-end">
                <Button onClick={onClose} color="inherit" size="large">
                  é–‰ã˜ã‚‹
                </Button>
                <Button 
                  variant="contained" 
                  onClick={() => onAction('è©³ç´°ç·¨é›†', task)}
                  size="large"
                >
                  è©³ç´°ç·¨é›†
                </Button>
              </Box>
            </Box>
          </Box>
        </Modal>
      );
    };

    const CalendarSection = ({ projects, onTaskClick }) => {
      const { currentDate, getDaysInMonth, changeMonth } = useCalendar();
      const [modalOpen, setModalOpen] = React.useState(false);
      const [modalItems, setModalItems] = React.useState([]);
      const [modalDate, setModalDate] = React.useState('');
      const days = getDaysInMonth(currentDate);
      
      const getItemsForDate = (date) => {
        if (!date) return [];
        const dateStr = date.toISOString().split('T')[0];
        const items = [];
        
        projects.forEach(project => {
          if (project.deadline === dateStr) {
            items.push({ type: 'project', ...project });
          }
          project.tasks.forEach(task => {
            if (Math.random() < 0.15) {
              items.push({ type: 'task', ...task, projectName: project.name });
            }
          });
        });
        return items;
      };
      
      const handleDayClick = (date, items) => {
        if (items.length > 4) {
          setModalItems(items);
          setModalDate(`${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`);
          setModalOpen(true);
        }
      };
      
      return (
        <>
          <Container maxWidth="lg" sx={{ mt: 2, mb: 4 }}>
            <Paper elevation={3} sx={{ p: 3 }}>
              <Box display="flex" justifyContent="space-between" alignItems="center" mb={2}>
                <IconButton onClick={() => changeMonth(-1)}>â€¹</IconButton>
                <Typography variant="h5" fontWeight={600}>
                  {currentDate.getFullYear()}å¹´ {currentDate.getMonth() + 1}æœˆ
                </Typography>
                <IconButton onClick={() => changeMonth(1)}>â€º</IconButton>
              </Box>
              
              <Box display="grid" gridTemplateColumns="repeat(7, 1fr)" gap={1}>
                {['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'].map(day => (
                  <Box key={day} textAlign="center" py={1} fontWeight={600} color="text.secondary">
                    {day}
                  </Box>
                ))}
                
                {days.map((day, index) => {
                  const items = getItemsForDate(day);
                  const displayItems = items.slice(0, 4);
                  const hasMore = items.length > 4;
                  
                  return (
                    <Paper 
                      key={index}
                      variant="outlined" 
                      sx={{ 
                        minHeight: 100, 
                        p: 0.5, 
                        bgcolor: day ? 'white' : '#f5f5f5',
                        opacity: day ? 1 : 0.3,
                        cursor: hasMore ? 'pointer' : 'default'
                      }}
                      onClick={() => day && handleDayClick(day, items)}
                    >
                      {day && (
                        <>
                          <Typography variant="caption" fontWeight={600} display="block" mb={0.5}>
                            {day.getDate()}
                          </Typography>
                          {displayItems.map((item, i) => (
                            <Chip
                              key={i}
                              label={item.type === 'project' ? `P:${item.name.slice(0,4)}` : `T:${item.name.slice(0,4)}`}
                              size="small"
                              color={item.type === 'project' ? 'primary' : 'secondary'}
                              onClick={(e) => {
                                e.stopPropagation();
                                if (item.type === 'task') {
                                  const project = projects.find(p => p.tasks.some(t => t.id === item.id));
                                  onTaskClick(item, project);
                                }
                              }}
                              sx={{ 
                                fontSize: '0.6rem', 
                                height: 14, 
                                mb: 0.2, 
                                display: 'block',
                                cursor: item.type === 'task' ? 'pointer' : 'default',
                                '& .MuiChip-label': { px: 0.5 }
                              }}
                            />
                          ))}
                          {hasMore && (
                            <Badge 
                              badgeContent={`+${items.length - 4}`} 
                              color="error" 
                              sx={{ 
                                '& .MuiBadge-badge': { 
                                  fontSize: '0.6rem', 
                                  minWidth: 16, 
                                  height: 16 
                                } 
                              }}
                            >
                              <Typography variant="caption" color="primary" sx={{ cursor: 'pointer' }}>
                                ã‚‚ã£ã¨è¦‹ã‚‹
                              </Typography>
                            </Badge>
                          )}
                        </>
                      )}
                    </Paper>
                  );
                })}
              </Box>
            </Paper>
          </Container>
          
          <Modal open={modalOpen} onClose={() => setModalOpen(false)}>
            <Box sx={{
              position: 'absolute',
              top: '50%',
              left: '50%',
              transform: 'translate(-50%, -50%)',
              width: 400,
              bgcolor: 'background.paper',
              boxShadow: 24,
              p: 4,
              borderRadius: 2
            }}>
              <Typography variant="h6" mb={2}>{modalDate}ã®äºˆå®š</Typography>
              {modalItems.map((item, i) => (
                <Box key={i} display="flex" alignItems="center" gap={1} mb={1}>
                  <Chip
                    label={item.type === 'project' ? 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ' : 'ã‚¿ã‚¹ã‚¯'}
                    size="small"
                    color={item.type === 'project' ? 'primary' : 'secondary'}
                    onClick={() => {
                      if (item.type === 'task') {
                        const project = projects.find(p => p.tasks.some(t => t.id === item.id));
                        onTaskClick(item, project);
                        setModalOpen(false);
                      }
                    }}
                    sx={{ cursor: item.type === 'task' ? 'pointer' : 'default' }}
                  />
                  <Typography variant="body2">
                    {item.name}
                    {item.projectName && ` (${item.projectName})`}
                  </Typography>
                </Box>
              ))}
              <Button onClick={() => setModalOpen(false)} sx={{ mt: 2 }}>é–‰ã˜ã‚‹</Button>
            </Box>
          </Modal>
        </>
      );
    };

    const HeroSection = ({ stats, selectedCounts }) => (
      <Box className="relative hero overflow-hidden" sx={{ bgcolor:'transparent' }}>
        <Box className="bg-gradient-to-br from-blue-900 via-blue-800 to-purple-900 text-white py-16">
          <span className="absolute top-10 left-10 w-20 h-20 bg-blue-400 rounded-full opacity-20 bubble"></span>
          <span className="absolute top-32 right-20 w-16 h-16 bg-purple-400 rounded-full opacity-20 bubble" style={{animationDelay:'1s'}}></span>
          <span className="absolute bottom-20 left-1/4 w-12 h-12 bg-cyan-400 rounded-full opacity-20 bubble" style={{animationDelay:'.5s'}}></span>
          <Container maxWidth="lg" sx={{position:'relative',zIndex:1,textAlign:'center'}}>
            <Typography
              variant="h2"
              component="h1"
              gutterBottom
              sx={{
                fontWeight: 700,
                background: 'linear-gradient(to right, #06b6d4, #a855f7)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                backgroundClip: 'text',
                color: 'transparent',
                display: 'inline-block',
              }}
            >
              ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
            </Typography>
            <Typography variant="h6" color="rgba(255,255,255,.8)" mb={6}>
              åŠ¹ç‡çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã§ã€ãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã‚’æœ€å¤§åŒ–ã—ã¾ã—ã‚‡ã†
            </Typography>
            <Grid container spacing={2} justifyContent="center">
              {[
                {label:'ç·ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', value:stats.total},
                {label:'é€²è¡Œä¸­',          value:stats.inProgress},
                {label:'å®Œäº†',            value:stats.completed},
                {label:'è¨ˆç”»ä¸­',          value:stats.planned}
              ].map((s, i) => (
                <Grid item xs={6} sm={3} key={i}>
                  <Paper elevation={0} sx={{
                    p:2, textAlign:'center', backdropFilter:'blur(6px)',
                    bgcolor:'rgba(255,255,255,.1)', border:'1px solid rgba(255,255,255,.2)'
                  }}>
                    <Typography variant="h4" fontWeight={700} color="#fff">
                      {s.value}
                    </Typography>
                    <Typography variant="body2" color="rgba(255,255,255,.8)">
                      {s.label}
                    </Typography>
                  </Paper>
                </Grid>
              ))}
            </Grid>
            <Box mt={6} display="inline-flex" gap={3}
                 className="bg-white bg-opacity-10 backdrop-blur-sm px-6 py-3 rounded-full border border-white border-opacity-20">
              <Typography color="#fff">é¸æŠä¸­:</Typography>
              <Typography fontWeight={600} color="#06b6d4">
                ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ {selectedCounts.projects}ä»¶
              </Typography>
              <Typography fontWeight={600} color="#a855f7">
                ã‚¿ã‚¹ã‚¯ {selectedCounts.tasks}ä»¶
              </Typography>
            </Box>
          </Container>
        </Box>
      </Box>
    );

    const ActionButtons = ({ activeSubStatus }) => {
      const allActions = ['æ–°è¦ä¾é ¼ä½œæˆ', 'å®Ÿæ–½æ¸ˆã¿ä¾é ¼ä½œæˆ', 'è¦‹ç©ä½œæˆ', 'è­¦å‚™å“¡ä¾é ¼ä½œæˆ', 'è­¦å‚™å“¡æ‰‹é…', 'æ—¥ç¨‹èª¿æ•´', 'å·¥äº‹å®Œäº†æ›¸ä½œæˆ', ...CONSTANTS.defaultActions];
      const activeActions = CONSTANTS.actionButtonsMap[activeSubStatus] || [];
      
      return (
        <Box sx={{p:2, bgcolor:'#f3f4f6', borderBottom:'1px solid #e5e7eb'}}
             display="flex" flexWrap="wrap" gap={1}>
          {allActions.map(label => {
            const isEnabled = activeActions.includes(label) || CONSTANTS.defaultActions.includes(label);
            return (
              <Button 
                key={label} 
                variant={isEnabled ? "contained" : "outlined"}
                disabled={!isEnabled}
                sx={{ opacity: isEnabled ? 1 : 0.5 }}
              >
                {label}
              </Button>
            );
          })}
        </Box>
      );
    };

    const StatusTabs = ({ activeTab, projects, handleTab }) => (
      <Box sx={{p:2, borderBottom:'1px solid #e5e7eb'}} display="flex" flexWrap="wrap" gap={1}>
        {[
          {id:'all', label:'ã™ã¹ã¦', count:projects.length},
          ...['é€²è¡Œä¸­','å®Œäº†','è¨ˆç”»ä¸­','å¾…æ©Ÿä¸­'].map(s => ({
            id:s, label:s, count:projects.filter(p => p.status===s).length
          }))
        ].map(tab => (
          <Button key={tab.id}
                  variant={activeTab===tab.id?'contained':'outlined'}
                  size="small"
                  onClick={() => handleTab(tab.id)}
                  sx={{textTransform:'none'}}>
            {tab.label}
            <Chip label={tab.count}
                  size="small"
                  color={activeTab===tab.id?'primary':'default'}
                  sx={{ml:1}} />
          </Button>
        ))}
      </Box>
    );

    const SubStatusTabs = ({ activeSubStatus, setActiveSubStatus, setCurrentPage }) => (
      <Box sx={{p:1, borderBottom:'1px solid #e5e7eb'}} display="flex" flexWrap="wrap" gap={1}>
        <Button
          size="small"
          variant={activeSubStatus==='allSub' ? 'contained' : 'outlined'}
          onClick={()=>{ setActiveSubStatus('allSub'); setCurrentPage(1); }}
          sx={{textTransform:'none'}}
        >ã™ã¹ã¦</Button>
        {CONSTANTS.subStatuses.map(ss=>(
          <Button
            key={ss}
            size="small"
            variant={activeSubStatus===ss ? 'contained' : 'outlined'}
            onClick={()=>{ setActiveSubStatus(ss); setCurrentPage(1); }}
            sx={{textTransform:'none'}}
          >{ss}</Button>
        ))}
      </Box>
    );

    const ProjectTable = ({ pageItems, activeSubStatus, toggleProject, toggleExpand, toggleTask, selectAllTasks, onTaskClick }) => (
      <TableContainer>
        <Table>
          <TableHead sx={{background:'#f3f4f6'}}>
            <TableRow>
              <TableCell padding="checkbox">é¸æŠ</TableCell>
              <TableCell padding="checkbox">å±•é–‹</TableCell>
              <TableCell>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</TableCell>
              <TableCell>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</TableCell>
              <TableCell>é€²æ—</TableCell>
              <TableCell>æœŸé™</TableCell>
              <TableCell>æ‹…å½“è€…</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {pageItems.map(project => (
              <React.Fragment key={project.id}>
                <TableRow hover selected={project.selected}>
                  <TableCell padding="checkbox">
                    <Checkbox
                      color="primary"
                      checked={project.selected}
                      onChange={() => toggleProject(project.id)}
                    />
                  </TableCell>
                  <TableCell padding="checkbox">
                    <IconButton size="small" onClick={() => toggleExpand(project.id)}>
                      {project.expanded ? 'â–¼' : 'â–¶'}
                    </IconButton>
                  </TableCell>
                  <TableCell>{project.name}</TableCell>
                  <TableCell>
                    <Chip
                      label={<span>{statusIcon(project.status)} {project.status}</span>}
                      size="small"
                      color={statusColor(project.status)}
                    />
                  </TableCell>
                  <TableCell>
                    <Box display="flex" alignItems="center" gap={1}>
                      <Box sx={{width:120}}>
                        <LinearProgress variant="determinate" value={project.progress} />
                      </Box>
                      <Typography variant="body2">
                        {project.progress}%
                      </Typography>
                    </Box>
                  </TableCell>
                  <TableCell>{project.deadline}</TableCell>
                  <TableCell>{project.manager}</TableCell>
                </TableRow>
                <TableRow>
                  <TableCell style={{paddingBottom:0,paddingTop:0}} colSpan={7}>
                    <Collapse in={project.expanded} timeout="auto" unmountOnExit>
                      <Box sx={{p:2, bgcolor:'#f9fafb', borderLeft:'4px solid #60a5fa'}}>
                        <Box display="flex" justifyContent="space-between" mb={1}>
                          <Typography fontWeight={600}>ã‚¿ã‚¹ã‚¯ä¸€è¦§</Typography>
                          <Box display="flex" gap={1}>
                            <Button onClick={() => selectAllTasks(project.id, true)} size="small">å…¨é¸æŠ</Button>
                            <Button onClick={() => selectAllTasks(project.id, false)} size="small" color="inherit">å…¨è§£é™¤</Button>
                          </Box>
                        </Box>
                        <Table size="small">
                          <TableHead>
                            <TableRow>
                              <TableCell padding="checkbox">é¸æŠ</TableCell>
                              <TableCell>ã‚¿ã‚¹ã‚¯å</TableCell>
                              <TableCell>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</TableCell>
                              <TableCell>é€²æ—</TableCell>
                            </TableRow>
                          </TableHead>
                          <TableBody>
                            {project.tasks.map(task => (
                              <TableRow 
                                key={task.id} 
                                hover 
                                selected={task.selected}
                                onClick={(e) => {
                                  if (e.target.type !== 'checkbox') {
                                    onTaskClick(task, project);
                                  }
                                }}
                                sx={{
                                  bgcolor: task.status === activeSubStatus ? '#e3f2fd' : 'inherit',
                                  cursor: 'pointer'
                                }}
                              >
                                <TableCell padding="checkbox" onClick={(e) => e.stopPropagation()}>
                                  <Checkbox
                                    size="small"
                                    color="primary"
                                    checked={task.selected}
                                    disabled={task.status !== activeSubStatus && activeSubStatus !== 'allSub'}
                                    onChange={() => toggleTask(project.id, task.id)}
                                  />
                                </TableCell>
                                <TableCell>{task.name}</TableCell>
                                <TableCell>
                                  <Chip
                                    label={<span>{statusIcon(task.status)} {task.status}</span>}
                                    size="small"
                                    color={statusColor(task.status)}
                                  />
                                </TableCell>
                                <TableCell>
                                  <Box display="flex" alignItems="center" gap={1}>
                                    <Box sx={{width:80}}>
                                      <LinearProgress variant="determinate" value={task.progress} color="success" />
                                    </Box>
                                    <Typography variant="caption">
                                      {task.progress}%
                                    </Typography>
                                  </Box>
                                </TableCell>
                              </TableRow>
                            ))}
                          </TableBody>
                        </Table>
                      </Box>
                    </Collapse>
                  </TableCell>
                </TableRow>
              </React.Fragment>
            ))}
          </TableBody>
        </Table>
      </TableContainer>
    );

    const Pagination = ({ filtered, currentPage, itemsPerPage, totalPages, setItemsPerPage, setCurrentPage, changePage }) => (
      <Box sx={{p:2, borderTop:'1px solid #e5e7eb'}} display="flex" justifyContent="space-between" alignItems="center">
        <Box display="flex" alignItems="center">
          <Typography variant="body2" color="text.secondary">
            {filtered.length}ä»¶ä¸­ {(currentPage-1)*itemsPerPage+1}ã€œ{Math.min(currentPage*itemsPerPage,filtered.length)}ä»¶ã‚’è¡¨ç¤º
          </Typography>
          <FormControl size="small" sx={{ml:2}}>
            <InputLabel sx={{fontSize:'0.875rem'}}>è¡¨ç¤ºä»¶æ•°</InputLabel>
            <Select
              value={itemsPerPage}
              label="è¡¨ç¤ºä»¶æ•°"
              onChange={e=>{ setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }}
              sx={{minWidth:80}}
            >
              <MenuItem value={5}>5</MenuItem>
              <MenuItem value={10}>10</MenuItem>
              <MenuItem value={15}>15</MenuItem>
              <MenuItem value={20}>20</MenuItem>
            </Select>
          </FormControl>
        </Box>
        <Box display="flex" gap={1}>
          <Button size="small" disabled={currentPage===1} onClick={()=>changePage(currentPage-1)}>å‰ã¸</Button>
          {Array.from({length: totalPages}, (_, i)=>i+1).map(p=>(
            <Button key={p}
                    size="small"
                    variant={p===currentPage?'contained':'outlined'}
                    onClick={()=>changePage(p)}>{p}</Button>
          ))}
          <Button size="small" disabled={currentPage===totalPages} onClick={()=>changePage(currentPage+1)}>æ¬¡ã¸</Button>
        </Box>
      </Box>
    );

    function App(){
      const {
        projects, activeTab, activeSubStatus, currentPage, itemsPerPage,
        pageItems, totalPages, stats, selectedCounts, filtered,
        setActiveSubStatus, setCurrentPage, setItemsPerPage,
        toggleProject, toggleExpand, toggleTask, selectAllTasks,
        handleTab, changePage
      } = useProjectManagement();
      
      const [taskDetailModal, setTaskDetailModal] = React.useState({ open: false, task: null, project: null });
      
      const handleTaskClick = (task, project) => {
        setTaskDetailModal({ open: true, task, project });
      };
      
      const handleTaskAction = (action, task) => {
        console.log(`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ: ${action} - ã‚¿ã‚¹ã‚¯: ${task.name}`);
        // ã“ã“ã§å®Ÿéš›ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè£…
        setTaskDetailModal({ open: false, task: null, project: null });
      };

      return (
        <Box>
          <HeroSection stats={stats} selectedCounts={selectedCounts} />
          <CalendarSection projects={projects} onTaskClick={handleTaskClick} />
          <TaskDetailModal
            task={taskDetailModal.task}
            project={taskDetailModal.project}
            open={taskDetailModal.open}
            onClose={() => setTaskDetailModal({ open: false, task: null, project: null })}
            onAction={handleTaskAction}
          />
          <Container maxWidth="lg" sx={{mt:4, mb:8}}>
            <Paper elevation={3}>
              <ActionButtons activeSubStatus={activeSubStatus} />
              <StatusTabs activeTab={activeTab} projects={projects} handleTab={handleTab} />
              <SubStatusTabs 
                activeSubStatus={activeSubStatus} 
                setActiveSubStatus={setActiveSubStatus} 
                setCurrentPage={setCurrentPage} 
              />
              <ProjectTable 
                pageItems={pageItems}
                activeSubStatus={activeSubStatus}
                toggleProject={toggleProject}
                toggleExpand={toggleExpand}
                toggleTask={toggleTask}
                selectAllTasks={selectAllTasks}
                onTaskClick={handleTaskClick}
              />
              <Pagination 
                filtered={filtered}
                currentPage={currentPage}
                itemsPerPage={itemsPerPage}
                totalPages={totalPages}
                setItemsPerPage={setItemsPerPage}
                setCurrentPage={setCurrentPage}
                changePage={changePage}
              />
            </Paper>
          </Container>
        </Box>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>