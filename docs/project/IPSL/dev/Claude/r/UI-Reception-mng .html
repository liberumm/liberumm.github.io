<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
  content="width=device-width, initial-scale=1" />
  <title>申込管理システム（統合版）</title>
  
  <!-- Fonts & Icons -->
  <link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <link
  rel="stylesheet"
  href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  
  <!-- React / Babel / MUI -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js"></script>
  
  <!-- FullCalendar & Swiper -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/swiper@9.4.1/swiper-bundle.min.css" rel="stylesheet" />
  
  <script src="https://cdn.jsdelivr.net/npm/swiper@9.4.1/swiper-bundle.min.js"></script>
  
  
  <style>
    body { margin:0; font-family:'Roboto',sans-serif; background:#f4f6f8; }
    header { background:#0d47a1; color:#fff; padding:16px; }
    header h1 { margin:0; font-size:1.5rem; }
    main { padding:24px; }
    .paper-section { margin-bottom:16px; }
    .paper-section .MuiTypography-h6 { margin-bottom:8px; }
    table thead th {
      background:#e3f2fd; padding:8px 6px; font-weight:600;
      border-bottom:2px solid rgba(0,0,0,0.12);
    }
    .main-table thead th { position:sticky; top:0; z-index:1; }
    th:not(.wrap), td:not(.wrap) { white-space:nowrap; }
    .expandable, .clickable-row { cursor:pointer; }
    .table-cell-id   { min-width:140px; }
    .table-cell-date { min-width:110px; }
    .table-cell-name { min-width:140px; }
    .table-cell-org  { min-width:160px; }
    
    /* 左右スライドを半透明に */
    .swiper-slide:not(.swiper-slide-active) {
      opacity: 0.5;
      transition: opacity 0.3s, transform 0.3s;
      transform: scale(0.9);   /* 少し小さく */
    }
    
    /* 中央スライドだけフル不透明＆拡大 */
    .swiper-slide-active {
      opacity: 1 !important;
      transform: scale(1.0) !important;
    }
    
  </style>
</head>

<body>
  <header><h1>申込管理システム</h1></header>
  <main><div id="root"></div></main>
  
  <script type="text/babel">
    const {
      Box, Button, Checkbox, Chip, Collapse, Container,
      CssBaseline, Dialog, DialogTitle, DialogContent, DialogActions,
      FormControl, FormControlLabel, FormLabel, Radio, RadioGroup,
      Grid, IconButton, InputLabel, MenuItem, Modal,
      Paper, Select, Table, TableBody, TableCell,
      TableContainer, TableHead, TablePagination, TableRow,
      TextField, ThemeProvider, ToggleButton,
      ToggleButtonGroup, Typography, createTheme
    } = MaterialUI;
    
    const { Fragment, useState } = React;
    
    // 定数
    const VIEW = { header:'申込単位', details:'明細一覧' };
    const GENRE = {
      all:'全て', visit:'店舗見学', experience:'職場体験',
      interview:'店舗取材', shooting:'撮影協力'
    };
    const STATUS = {
      all:'全て', unapproved:'未承認', reproposed:'調整中',
      confirmed:'承認済', rejected:'お断り'
    };
    const COLOR = {
      unapproved:'info', reproposed:'warning',
      confirmed:'success', rejected:'error'
    };
    const TIMES_PANEL = ['09:00-11:00','13:00-15:00','15:00-17:00'];
    const TIMES = [
    '09:00','09:15','09:30','09:45','10:00','10:15','10:30','10:45',
    '11:00','11:15','11:30','11:45','12:00','12:15','12:30','12:45',
    '13:00','13:15','13:30','13:45','14:00','14:15','14:30','14:45','15:00'
    ];
    const CODE = { visit:'VIS', experience:'EXP', interview:'INT', shooting:'SHT' };
    const rand = arr => arr[Math.floor(Math.random()*arr.length)];
    
    // サンプルデータ生成
    function makeApp(index, g){
      const pool=['unapproved','reproposed','confirmed','rejected'];
      return {
        id:`APP-${CODE[g]}-${String(index).padStart(3,'0')}`,
        createdAt:`2025-05-${10+index} 09:00`,
        updatedAt:`2025-05-${10+index} 12:00`,
        name:`${GENRE[g]}申込者${index}`,
        org:(g==='visit'||g==='experience')?`学校${index}`:`企業${index}`,
        gradeDept:(g==='visit'||g==='experience')?`${(index%3)+1}年${(index%4)+1}組`:`部門${(index%5)+1}`,
        genre:g, type:GENRE[g],
        staff:`担当者${index}`, remarks:index%2?'':'確認要',
        details:Array.from({length:3},(_,j)=>({
          tmp:Date.now()+index*10+j,
          desiredDate:`2025-06-${10+index}`, desiredTime:TIMES_PANEL[0],
          reproposedDate:`2025-06-${11+index}`, reproposedTime:TIMES_PANEL[1],
          confirmedDate:`2025-06-${12+index}`, confirmedTime:TIMES_PANEL[2],
          store:`店舗${j+1}`, count:(j+2)*3,
          status:rand(pool), remark:j===2?'再確認要':''
        }))
      };
    }
    const initialData=Object.keys(CODE).flatMap(
    g=>Array.from({length:6},(_,i)=>makeApp(i+1,g))
    );
    
    const transformTaskToEvent = (task) => {
      const project = sampleProjects.find((p) => p.id === task.project_id);
      return {
        title: task.task,
        start: task.dueDate,
        end: task.dueDate,
        color: "#16a085",
        extendedProps: {
          type: "タスク",
          priority: task.priority,
          project_id: task.project_id,
          project_name: project?.name || "未設定",
          requester: task.assignee || "未設定",
          description: task.description,
        },
      };
    };
    
    // ── カレンダー用ダミーデータ ──
    const sampleProjects = [
    { id: "PROJ_001", name: "○○店舗改装工事" /* …省略… */ },
    { id: "PROJ_002", name: "△△店舗定期保守"   /* …省略… */ },
    { id: "PROJ_003", name: "□□新店舗建設"       /* …省略… */ },
    { id: "PROJ_004", name: "××設備更新"         /* …省略… */ },
    { id: "PROJ_005", name: "新規ITシステム導入" /* …省略… */ },
    ];
    
    const sampleTasks = [
    { id:1, project_id:"PROJ_001", task:"工事準備資料の作成", dueDate:"2025-02-02", priority:"High", description:"…", completed:false, assignee:"佐藤花子" },
    /* 他のタスクも同様に定義 */
    ];
    
    // ── カレンダー描画コンポーネント ──
    function CalendarView({ initialDate, events, onEventClick }) {
      const calendarEl = React.useRef(null);
      React.useEffect(() => {
        const calendar = new FullCalendar.Calendar(calendarEl.current, {
          locale: "ja",
          initialDate: initialDate,
          initialView: "dayGridMonth",
          headerToolbar: { left: "", center: "title", right: "" },
          events: events,
          height: "auto",
          dayMaxEvents: 2,
          moreLinkContent: (arg) => `+${arg.num}`,
          eventClick: (info) => {
            info.jsEvent.preventDefault();
            if (onEventClick) onEventClick(info.event);
          },
        });
        calendar.render();
        return () => calendar.destroy();
      }, [initialDate, events, onEventClick]);
      return <div ref={calendarEl} />;
    }
    
    // ── スワイプ可能な月次カルーセル ──
    function CalendarCarousel({ events, onEventClick }) {
      const containerRef = React.useRef(null);
      const swiperRef = React.useRef(null);
      const today = new Date();
      const range = 2; // 前後2か月
      const buildDates = (base) => {
        const arr = [];
        for (let i = -range; i <= range; i++) {
          const d = new Date(base);
          d.setMonth(d.getMonth() + i);
          arr.push(new Date(d));
        }
        return arr;
      };
      const [dates, setDates] = React.useState(buildDates(today));
      const firstSlide = React.useRef(true);
      
      // Swiper 初期化
      React.useEffect(() => {
        swiperRef.current = new Swiper(containerRef.current, {
          initialSlide: range,
          centeredSlides: true,
          slidesPerView: 1.3,
          spaceBetween:70, // スライド間のスペース
          grabCursor: true,
          effect: 'coverflow',           // ← 立体感を出すカバーフローエフェクト
          coverflowEffect: {
            rotate: 0,                   // スライドの回転角度なし
            stretch: 0,                  // スライド間の引き伸ばしなし
            depth: 100,                  // 奥行きを強調
            modifier: 1,                 // 深度の強さ調整
            slideShadows: false,         // 影は CSS で管理する
          },
          loop: false,
          navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
          pagination: { el: ".swiper-pagination", clickable: true },
          on: {
            slideChange() {
              // 初回のみ無視
              if (firstSlide.current) {
                firstSlide.current = false;
                return;
              }
              setDates((prev) => {
                let arr = prev.slice();
                // 左端なら前月を補充
                if (this.activeIndex <= 1) {
                  const first = prev[0];
                  for (let i = 2; i > 0; i--) {
                    const d = new Date(first);
                    d.setMonth(d.getMonth() - i);
                    arr.unshift(d);
                  }
                  this.slideTo(this.activeIndex + 2, 0);
                }
                // 右端なら翌月を補充
                if (this.activeIndex >= arr.length - 2) {
                  const last = arr[arr.length - 1];
                  for (let i = 1; i <= 2; i++) {
                    const d = new Date(last);
                    d.setMonth(d.getMonth() + i);
                    arr.push(d);
                  }
                }
                // FullCalendar がリサイズに追随するように
                window.dispatchEvent(new Event("resize"));
                return arr;
              });
            },
          },
        });
        return () => swiperRef.current.destroy();
      }, []);
      
      // 日付配列が変わったら Swiper を更新
      React.useEffect(() => {
        if (swiperRef.current) swiperRef.current.update();
      }, [dates]);
      
      return (
      <div className="swiper" ref={containerRef}>
        <div className="swiper-wrapper">
          {dates.map((d, i) => (
            <div className="swiper-slide" key={i}>
              <CalendarView
              initialDate={d.toISOString().slice(0, 10)}
              events={events}
              onEventClick={onEventClick}
              />
            </div>
            ))}
          </div>
          <div className="swiper-pagination" />
          <div className="swiper-button-prev" />
          <div className="swiper-button-next" />
        </div>
        );
      }
      
      function App(){
        // 一覧 state
        const [data, setData]=useState(initialData);
        const [mode, setMode]=useState('header');
        const [genre, setGenre]=useState('all');
        const [status, setStatus]=useState('all');
        const [page, setPage]=useState(0);
        const [rpp, setRpp]=useState(10);
        const [openId, setOpenId]=useState(null);
        
        // 例：申込一覧のデータをカレンダー用イベントに変換
        const calendarEvents = data.flatMap(p =>
        p.details.map(d => transformTaskToEvent({
          id: p.id + '_' + d.tmp,
          project_id: 'PROJ_001',       // 必要に応じて紐づけ先を調整
          task: `${p.type} ${p.name}`,
          dueDate: d.desiredDate,
          priority: 'Medium',
          description: d.remark,
          completed: d.status === 'confirmed',
          assignee: p.staff
        }))
        );
        
        // 編集モーダル state
        const [dlg, setDlg]=useState({open:false,app:null,rows:[]});
        // 職場体験フォーム state
        const [expOpen, setExpOpen]=useState(false);
        const initialExp={
          schoolName:'',grade:'',contactName:'',
          tel1:'',tel2:'',tel3:'',
          fax1:'',fax2:'',fax3:'',
          email:'',sendMethod:'メール',remarks:'',
          file:null,
          preferred:[
          {store:'',count:''},{store:'',count:''},{store:'',count:''}
          ],
          altApplicable:'なし',altStore:'',
          periodStart:'',periodEnd:'',
          timeStart:'',timeEnd:'',
          preVisit:'なし',preVisitDate:'',preVisitTime:'',
          contactNotes:'',ack:false
        };
        const [expForm,setExpForm]=useState(initialExp);
        
        // 店舗見学フォーム state
        const [visitOpen,setVisitOpen]=useState(false);
        const initialVisit={
          schoolName:'',grade:'',contactName:'',
          tel1:'',tel2:'',tel3:'',
          fax1:'',fax2:'',fax3:'',
          email:'',sendMethod:'メール',remarks:'',
          applyType:'小学生見学',otherType:'',
          preferredStore:'',altApplicable:'なし',altStore:'',
          studentCount:'',classCount:'',escortCount:'',
          wish1Date:'',wish1Start:'',wish1End:'',
          wish2Date:'',wish2Start:'',wish2End:'',
          wish3Date:'',wish3Start:'',wish3End:'',
          wishContents:'従業員による案内',otherWish:'',
          contactNotes:'',file:null,ack:false
        };
        const [visitForm,setVisitForm]=useState(initialVisit);
        
        // ↓ ここに追加 ↓
        const [replyStatus, setReplyStatus]     = useState('pending');
        const [replyAssignee, setReplyAssignee] = useState('');
        const [replyMessage, setReplyMessage]   = useState('');
        
        // 送信＆クリア関数も同じく定義しておく
        const handleSendReply = () => {
          // ここで API 呼び出しやデータ更新を行う
          console.log({ replyStatus, replyAssignee, replyMessage });
          // 例：モーダルを閉じる or フォームをクリア
          handleClearReply();
        };
        const handleClearReply = () => {
          setReplyStatus('pending');
          setReplyAssignee('');
          setReplyMessage('');
        };
        
        // モーダル open/close
        const openEditModal=app=>setDlg({open:true,app:{...app},rows:app.details.map(d=>({...d}))});
        const closeEditModal=()=>setDlg({open:false,app:null,rows:[]});
        const openExpModal=()=>setExpOpen(true);
        const closeExpModal=()=>setExpOpen(false);
        const openVisitModal=()=>setVisitOpen(true);
        const closeVisitModal=()=>setVisitOpen(false);
        
        // 編集ユーティリティ
        const addEditRow=()=>setDlg(d=>({
          ...d,
          rows:[...d.rows,{
            tmp:Date.now(),desiredDate:'',desiredTime:'',
            reproposedDate:'',reproposedTime:'',
            confirmedDate:'',confirmedTime:'',
            store:'',count:0,status:'unapproved',remark:''
          }]
        }));
        const delEditRow=id=>setDlg(d=>({
          ...d,
          rows:d.rows.filter(r=>r.tmp!==id)
        }));
        const updEditRow=(i,k,v)=>setDlg(d=>{
          const rows=[...d.rows]; rows[i]={...rows[i],[k]:v};
          return{...d,rows};
        });
        
        // 職場体験ユーティリティ
        const onExpChange=key=>e=>setExpForm(f=>({...f,[key]:e.target.value}));
        const onExpNum=key=>e=>setExpForm(f=>({...f,[key]:e.target.value.replace(/\D/g,'')}));
        const onExpFile=e=>setExpForm(f=>({...f,file:e.target.files[0]}));
        const onExpPref=(i,k)=>e=>setExpForm(f=>{
          const p=f.preferred.map((r,idx)=>idx===i?{...r,[k]:e.target.value}:r);
          return{...f,preferred:p};
        });
        const addExpRow=()=>setExpForm(f=>({...f,preferred:[...f.preferred,{store:'',count:''}]}));
        
        // 店舗見学ユーティリティ
        const onVisitChange=key=>e=>setVisitForm(f=>({...f,[key]:e.target.value}));
        const onVisitNum=key=>e=>setVisitForm(f=>({...f,[key]:e.target.value.replace(/\D/g,'')}));
        const onVisitFile=e=>setVisitForm(f=>({...f,file:e.target.files[0]}));
        
        // ステータス判定
        const appStat=app=>{
          if(app.details.some(d=>d.status==='rejected'))return'rejected';
          if(app.details.some(d=>d.status==='reproposed'))return'reproposed';
          if(app.details.every(d=>d.status==='confirmed'))return'confirmed';
          return'unapproved';
        };
        
        // フィルタ→ページング
        const byGenre=data.filter(a=>genre==='all'||a.genre===genre);
        const byStatus=byGenre.filter(a=>status==='all'||a.details.some(d=>d.status===status));
        const parents=byStatus;
        const children=byStatus.flatMap(p=>p.details.map(d=>({parent:p,detail:d})));
        const list=mode==='header'?parents:children;
        const paged=rpp>0? list.slice(page*rpp,page*rpp+rpp):list;
        
        // CSV 出力
        const exportCsv=()=>{
          const rows=[];
          if(mode==='header'){
            rows.push(['','No','状態','申込ID','ジャンル','申込日時','最終更新','申込者名','組織名','担当者','備考']);
            parents.forEach((p,i)=>rows.push([
            '',i+1,STATUS[appStat(p)],p.id,p.type,p.createdAt,p.updatedAt,p.name,p.org,p.staff,p.remarks
            ]));
          } else {
            rows.push(['','No','承認状態','申込ID','確定日付','確定時間','店舗','人数','組織','申込者','学年/部署','希望日付','希望時間','再提案日付','再提案時間','備考']);
            children.forEach((c,i)=>rows.push([
            '',i+1,STATUS[c.detail.status],c.parent.id,
            c.detail.confirmedDate,c.detail.confirmedTime,
            c.detail.store,c.detail.count,
            c.parent.org,c.parent.name,c.parent.gradeDept,
            c.detail.desiredDate,c.detail.desiredTime,
            c.detail.reproposedDate,c.detail.reproposedTime,
            c.detail.remark
            ]));
          }
          const csv=rows.map(r=>r.map(v=>`"${v||''}"`).join(',')).join('\n');
          const blob=new Blob([csv],{type:'text/csv'}), url=URL.createObjectURL(blob);
          const a=document.createElement('a'); a.href=url; a.download=`export_${Date.now()}.csv`; a.click();
          URL.revokeObjectURL(url);
        };
        
        // 編集保存
        const saveEdit=()=>{
          setData(d=>d.map(p=>p.id===dlg.app.id?{...dlg.app,details:dlg.rows}:p));
          closeEditModal();
        };
        
        // 職場体験申込保存
        const saveExp=()=>{
          const idx=data.length+1;
          const id=`APP-EXP-${String(idx).padStart(3,'0')}`;
          const now=new Date(),pad=n=>String(n).padStart(2,'0');
          const ts=`${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
          const details=expForm.preferred.filter(r=>r.store&&r.count).map(r=>({
            tmp:Date.now()+Math.random(),
            desiredDate:expForm.periodStart,desiredTime:expForm.timeStart,
            reproposedDate:'',reproposedTime:'',
            confirmedDate:'',confirmedTime:'',
            store:r.store,count:parseInt(r.count,10),
            status:'unapproved',remark:''
          }));
          const newApp={ id,createdAt:ts,updatedAt:ts,
            name:expForm.contactName,org:expForm.schoolName,
            gradeDept:expForm.grade+'年',genre:'experience',
            type:GENRE.experience,staff:'',remarks:expForm.remarks,
            details
          };
          setData(d=>[newApp,...d]);
          setExpForm(initialExp);
          closeExpModal();
        };
        
        // 店舗見学申込保存
        const saveVisit=()=>{
          const idx=data.length+1;
          const id=`APP-VIS-${String(idx).padStart(3,'0')}`;
          const now=new Date(),pad=n=>String(n).padStart(2,'0');
          const ts=`${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
          const details=[{
            tmp:Date.now(),desiredDate:visitForm.wish1Date,desiredTime:visitForm.wish1Start,
            reproposedDate:'',reproposedTime:'',
            confirmedDate:'',confirmedTime:'',
            store:visitForm.preferredStore,count:visitForm.studentCount,
            status:'unapproved',remark:''
          }];
          const newApp={ id,createdAt:ts,updatedAt:ts,
            name:visitForm.contactName,org:visitForm.schoolName,
            gradeDept:visitForm.grade+'年',genre:'visit',
            type:GENRE.visit,staff:'',remarks:visitForm.remarks,
            details
          };
          setData(d=>[newApp,...d]);
          setVisitForm(initialVisit);
          closeVisitModal();
        };
        
        // Add these after other constants
const REPLY_TYPES = {
  visit: {
    label: "店舗見学",
    templates: {
      accept: {
        label: "受入可",
        subject: "{{S}} {{TT}}{{TN}} 先生　店舗見学受入れのご案内"
      },
      proposal: {
        label: "受入不可（提案）", 
        subject: "{{S}} {{TT}}{{TN}} 先生　店舗見学日程再提案のご案内"
      },
      decline: {
        label: "お断り",
        subject: "{{S}} {{TT}}{{TN}} 先生　店舗見学のお申込みについて" 
      }
    }
  },
  work: {
    label: "職場体験",
    templates: {
      acceptSM: {
        label: "受入可（SM）",
        subject: "{{S}} {{TT}}{{TN}} 先生　職場体験受入れ（SM）ご案内"
      },
      // ...other templates
    }
  }
};

        // Add these to App component state
        const [replyType, setReplyType] = useState('visit');
        const [replyTemplate, setReplyTemplate] = useState('accept');
        const [replyData, setReplyData] = useState({
          title: '',
          teacher: '',
          sender: '広報部 田中',
          sendDate: new Date().toISOString().split('T')[0],
          comment: '',
          reason: ''
        });
        
        // 編集モーダル内の返信管理セクション
        const renderReplyManagement = () => (
          <Box sx={{ mt: 4, borderTop: '1px solid rgba(0,0,0,0.12)', pt: 2 }}>
            <Typography variant="subtitle1" sx={{ mb: 2 }}>返信管理</Typography>
            
            <Grid container spacing={2}>
              {/* Reply Type Select */}
              <Grid item xs={12} sm={6}>
                <FormControl fullWidth size="small">
                  <InputLabel>申込区分</InputLabel>
                  <Select 
                    value={replyType}
                    onChange={e => {
                      setReplyType(e.target.value);
                      setReplyTemplate(Object.keys(REPLY_TYPES[e.target.value].templates)[0]);
                    }}
                  >
                    {Object.entries(REPLY_TYPES).map(([key, val]) => (
                      <MenuItem key={key} value={key}>{val.label}</MenuItem>
                    ))}
                  </Select>
                </FormControl>
              </Grid>
      
              {/* Template Select */}
              <Grid item xs={12} sm={6}>
                <FormControl fullWidth size="small">
                  <InputLabel>返信パターン</InputLabel>
                  <Select
                    value={replyTemplate}
                    onChange={e => setReplyTemplate(e.target.value)}
                  >
                    {Object.entries(REPLY_TYPES[replyType].templates).map(([key, val]) => (
                      <MenuItem key={key} value={key}>{val.label}</MenuItem>
                    ))}
                  </Select>
                </FormControl>
              </Grid>
      
              {/* Reply Data Fields */}
              <Grid item xs={12} sm={6}>
                <TextField
                  fullWidth size="small" label="教諭区分"
                  value={replyData.title}
                  onChange={e => setReplyData({...replyData, title: e.target.value})}
                />
              </Grid>
              <Grid item xs={12} sm={6}>
                <TextField
                  fullWidth size="small" label="担当教諭名"
                  value={replyData.teacher}
                  onChange={e => setReplyData({...replyData, teacher: e.target.value})}
                />
              </Grid>
              <Grid item xs={12} sm={6}>
                <TextField
                  fullWidth size="small" label="送信者"
                  value={replyData.sender}
                  onChange={e => setReplyData({...replyData, sender: e.target.value})}
                />
              </Grid>
              <Grid item xs={12} sm={6}>
                <TextField
                  fullWidth size="small" type="date" label="送信日"
                  value={replyData.sendDate}
                  onChange={e => setReplyData({...replyData, sendDate: e.target.value})}
                  InputLabelProps={{ shrink: true }}
                />
              </Grid>
              
              {/* Conditional Fields */}
              {replyTemplate === 'decline' && (
                <Grid item xs={12}>
                  <TextField
                    fullWidth multiline rows={2}
                    label="お断り理由"
                    value={replyData.reason}
                    onChange={e => setReplyData({...replyData, reason: e.target.value})}
                  />
                </Grid>
              )}
              
              <Grid item xs={12}>
                <TextField
                  fullWidth multiline rows={3}
                  label="備考"
                  value={replyData.comment}
                  onChange={e => setReplyData({...replyData, comment: e.target.value})}
                />
              </Grid>
      
              {/* Preview Area */}
              <Grid item xs={12}>
                <Paper variant="outlined" sx={{ p: 2, bgcolor: 'grey.50' }}>
                  <Typography variant="subtitle2" gutterBottom>プレビュー</Typography>
                  <Typography variant="body2" color="primary">
                    {REPLY_TYPES[replyType].templates[replyTemplate].subject
                      .replace('{{S}}', dlg.app?.org || '')
                      .replace('{{TT}}', replyData.title)
                      .replace('{{TN}}', replyData.teacher)}
                  </Typography>
                </Paper>
              </Grid>
      
              {/* Action Buttons */} 
              <Grid item xs={12} textAlign="right">
                <Button
                  variant="contained"
                  onClick={() => {
                    // Save reply data
                    console.log('Reply data:', {
                      type: replyType,
                      template: replyTemplate,
                      data: replyData,
                      app: dlg.app?.id
                    });
                  }}
                >
                  返信を登録
                </Button>
              </Grid>
            </Grid>
          </Box>
        );
        
        return (
        < Container maxWidth={false} sx={{py:3, bgcolor:'#fff', borderRadius:1, boxShadow:1}}>
        <CssBaseline/>
        
        {/* ── ここからカレンダー表示 ── */}
        <Box sx={{ my: 4 }}>
          <Typography variant="h6" sx={{ mb: 2 }}>カレンダー表示</Typography>
          <CalendarCarousel
          events={calendarEvents}
          onEventClick={(evt) => {
            alert(`イベント: ${evt.title}\n詳細: ${evt.extendedProps.description}`);
          }}
          />
        </Box>
        {/* 操作ボタン */}
        <Grid container spacing={2} alignItems="center" sx={{mb:2}}>
          <Grid item xs={4}><Typography variant="h5">申込一覧</Typography></Grid>
          <Grid item xs={4} textAlign="center">
            <Button variant="contained" onClick={openExpModal}>新規 職場体験申込</Button>
          </Grid>
          <Grid item xs={4} textAlign="right">
            <Button variant="contained" onClick={openVisitModal}>新規 店舗見学申込</Button>
          </Grid>
        </Grid>
        
        {/* フィルタ＆CSV */}
        <Grid container spacing={2} sx={{mb:2}}>
          <Grid item>
            <ToggleButtonGroup size="small" value={mode} exclusive onChange={(_,v)=>v&&setMode(v)}>
              {Object.entries(VIEW).map(([k,l])=><ToggleButton key={k} value={k}>{l}</ToggleButton>)}
            </ToggleButtonGroup>
          </Grid>
          <Grid item><Button variant="outlined" size="small" onClick={exportCsv}>CSV 出力</Button></Grid>
          <Grid item xs>
            <Box sx={{display:'flex',gap:1,flexWrap:'wrap'}}>
              <Typography>ジャンル:</Typography>
              {Object.entries(GENRE).map(([k,l])=>
                <Chip key={k} label={l} size="small" clickable color={genre===k?'primary':'default'} onClick={()=>{setGenre(k);setPage(0);}}/>
                  )}
                </Box>
              </Grid>
              <Grid item xs>
                <Box sx={{display:'flex',gap:1,flexWrap:'wrap'}}>
                  <Typography>状態:</Typography>
                  {Object.entries(STATUS).map(([k,l])=>
                    <Chip key={k} label={l} size="small" clickable color={status===k?'primary':'default'} onClick={()=>{setStatus(k);setPage(0);}}/>
                      )}
                    </Box>
                  </Grid>
                </Grid>
                
                {/* メインテーブル */}
                <Paper elevation={2}>
                  <TableContainer sx={{maxHeight:600}}>
                    <Table size="small" stickyHeader className="main-table">
                      <TableHead>
                        <TableRow>
                          {mode==='header' ? (
                          <>
                          <TableCell/><TableCell>No.</TableCell><TableCell>状態</TableCell>
                          <TableCell className="table-cell-id">申込ID</TableCell>
                          <TableCell>ジャンル</TableCell>
                          <TableCell className="table-cell-date">申込日時</TableCell>
                          <TableCell className="table-cell-date">最終更新</TableCell>
                          <TableCell className="table-cell-name">申込者名</TableCell>
                          <TableCell className="table-cell-org">組織名</TableCell>
                          <TableCell>担当者</TableCell><TableCell>備考</TableCell>
                          </>
                          ) : (
                          <>
                          <TableCell/><TableCell>No.</TableCell><TableCell>承認状態</TableCell>
                          <TableCell className="table-cell-id">申込ID</TableCell>
                          <TableCell className="table-cell-date">確定日付</TableCell>
                          <TableCell className="table-cell-date">確定時間帯</TableCell>
                          <TableCell>店舗名</TableCell><TableCell>人数</TableCell>
                          <TableCell className="table-cell-org">組織名</TableCell>
                          <TableCell className="table-cell-name">申込者名</TableCell>
                          <TableCell>学年/部署</TableCell>
                          <TableCell className="table-cell-date">希望日付</TableCell>
                          <TableCell className="table-cell-date">希望時間帯</TableCell>
                          <TableCell className="table-cell-date">再提案日付</TableCell>
                          <TableCell className="table-cell-date">再提案時間帯</TableCell>
                          </>
                          )}
                        </TableRow>
                      </TableHead>
                      <TableBody>
                        {/* 親一覧 */}
                        {mode==='header' && paged.map((p,idx)=>(
                        <Fragment key={p.id}>
                          <TableRow hover className="expandable">
                            <TableCell><Checkbox disabled/></TableCell>
                            <TableCell onClick={()=>setOpenId(openId===p.id?null:p.id)}>{page*rpp+idx+1}</TableCell>
                            <TableCell><Chip size="small" label={STATUS[appStat(p)]} color={COLOR[appStat(p)]}/></TableCell>
                            <TableCell onClick={()=>openEditModal(p)}>{p.id}</TableCell>
                            <TableCell>{p.type}</TableCell>
                            <TableCell>{p.createdAt}</TableCell>
                            <TableCell>{p.updatedAt}</TableCell>
                            <TableCell>{p.name}</TableCell>
                            <TableCell>{p.org}</TableCell>
                            <TableCell>{p.staff}</TableCell>
                            <TableCell>{p.remarks}</TableCell>
                          </TableRow>
                          <TableRow>
                            <TableCell colSpan={11} sx={{p:0,border:0}}>
                              <Collapse in={openId===p.id} timeout="auto" unmountOnExit>
                                <Box sx={{py:1,px:2,bgcolor:'rgba(0,0,0,0.03)'}}>
                                  <Table size="small">
                                    <TableHead>
                                      <TableRow>
                                        <TableCell>No.</TableCell><TableCell>承認状態</TableCell>
                                        <TableCell className="table-cell-id">申込ID</TableCell>
                                        <TableCell className="table-cell-date">確定日付</TableCell>
                                        <TableCell className="table-cell-date">確定時間帯</TableCell>
                                        <TableCell>店舗名</TableCell><TableCell>人数</TableCell>
                                        <TableCell className="table-cell-org">組織名</TableCell>
                                        <TableCell className="table-cell-name">申込者名</TableCell>
                                        <TableCell>学年/部署</TableCell>
                                        <TableCell className="table-cell-date">希望日付</TableCell>
                                        <TableCell className="table-cell-date">希望時間帯</TableCell>
                                        <TableCell className="table-cell-date">再提案日付</TableCell>
                                        <TableCell className="table-cell-date">再提案時間帯</TableCell>
                                        <TableCell>備考</TableCell>
                                      </TableRow>
                                    </TableHead>
                                    <TableBody>
                                      {p.details.map((d,j)=>(<TableRow key={d.tmp}>
                                        <TableCell>{j+1}</TableCell>
                                        <TableCell><Chip size="small" label={STATUS[d.status]} color={COLOR[d.status]}/></TableCell>
                                        <TableCell>{p.id}</TableCell>
                                        <TableCell>{d.confirmedDate}</TableCell>
                                        <TableCell>{d.confirmedTime}</TableCell>
                                        <TableCell>{d.store}</TableCell>
                                        <TableCell>{d.count}</TableCell>
                                        <TableCell>{p.org}</TableCell>
                                        <TableCell>{p.name}</TableCell>
                                        <TableCell>{p.gradeDept}</TableCell>
                                        <TableCell>{d.desiredDate}</TableCell>
                                        <TableCell>{d.desiredTime}</TableCell>
                                        <TableCell>{d.reproposedDate}</TableCell>
                                        <TableCell>{d.reproposedTime}</TableCell>
                                        <TableCell>{d.remark}</TableCell>
                                      </TableRow>))}
                                    </TableBody>
                                  </Table>
                                </Box>
                              </Collapse>
                            </TableCell>
                          </TableRow>
                        </Fragment>
                        ))}
                        
                        {/* 明細一覧（編集モーダル） */}
                        {mode==='details' && paged.map((c,idx)=>(<TableRow key={c.detail.tmp} hover className="clickable-row" onClick={()=>openEditModal(c.parent)}>
                          <TableCell><Checkbox disabled/></TableCell>
                          <TableCell>{page*rpp+idx+1}</TableCell>
                          <TableCell><Chip size="small" label={STATUS[c.detail.status]} color={COLOR[c.detail.status]}/></TableCell>
                          <TableCell className="table-cell-id">{c.parent.id}</TableCell>
                          <TableCell className="table-cell-date">{c.detail.confirmedDate}</TableCell>
                          <TableCell className="table-cell-date">{c.detail.confirmedTime}</TableCell>
                          <TableCell>{c.detail.store}</TableCell>
                          <TableCell>{c.detail.count}</TableCell>
                          <TableCell className="table-cell-org">{c.parent.org}</TableCell>
                          <TableCell className="table-cell-name">{c.parent.name}</TableCell>
                          <TableCell>{c.parent.gradeDept}</TableCell>
                          <TableCell className="table-cell-date">{c.detail.desiredDate}</TableCell>
                          <TableCell className="table-cell-date">{c.detail.desiredTime}</TableCell>
                          <TableCell className="table-cell-date">{c.detail.reproposedDate}</TableCell>
                          <TableCell className="table-cell-date">{c.detail.reproposedTime}</TableCell>
                        </TableRow>))}
                      </TableBody>
                    </Table>
                  </TableContainer>
                  <TablePagination
                  component="div"
                  rowsPerPageOptions={[5,10,20]}
                  count={list.length}
                  page={page}
                  rowsPerPage={rpp}
                  onPageChange={(_,p)=>setPage(p)}
                  onRowsPerPageChange={e=>{setRpp(+e.target.value);setPage(0);}}
                  />
                </Paper>
                
                {/* 編集モーダル */}
                <Modal open={dlg.open} onClose={closeEditModal}
                maxWidth={false}      // MUI のデフォルト制限を解除
                fullWidth             // 横幅いっぱいを `PaperProps` と組み合わせて使う
                PaperProps={{
                  sx: {
                    width: '90vw',     // ビューポート幅の 90%
                    maxWidth: '90vw'   // 最大も同じく 90% に
                  }
                }}>
                <Box sx={{
                  position:'absolute',top:'50%',left:'50%',
                  transform:'translate(-50%,-50%)',
                  width:'94%',maxWidth:1100,maxHeight:'92vh',
                  bgcolor:'#fff',p:3,boxShadow:24,overflowY:'auto'
                }}>
                {dlg.app&&<>
                  <Typography variant="h6" gutterBottom>申込編集 — {dlg.app.id}</Typography>
                  <Box sx={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:2,mb:3}}>
                    <TextField label="申込者名" value={dlg.app.name}
                    onChange={e=>setDlg(d=>({...d,app:{...d.app,name:e.target.value}}))}/>
                    <TextField label="組織名" value={dlg.app.org}
                    onChange={e=>setDlg(d=>({...d,app:{...d.app,org:e.target.value}}))}/>
                    <FormControl><InputLabel>ジャンル</InputLabel>
                      <Select label="ジャンル" value={dlg.app.genre}
                      onChange={e=>setDlg(d=>({...d,app:{...d.app,genre:e.target.value,type:GENRE[e.target.value]}}))}>
                      {Object.entries(GENRE).filter(([k])=>k!=='all').map(([k,l])=><MenuItem key={k} value={k}>{l}</MenuItem>)}
                    </Select>
                  </FormControl>
                  <TextField label="担当者" value={dlg.app.staff}
                  onChange={e=>setDlg(d=>({...d,app:{...d.app,staff:e.target.value}}))}/>
                  <TextField label="学年/部署" value={dlg.app.gradeDept}
                  onChange={e=>setDlg(d=>({...d,app:{...d.app,gradeDept:e.target.value}}))}/>
                  <TextField label="備考" multiline value={dlg.app.remarks}
                  onChange={e=>setDlg(d=>({...d,app:{...d.app,remarks:e.target.value}}))}/>
                </Box>
                <Typography variant="subtitle1" gutterBottom>明細</Typography>
                <Table size="small">
                  <TableHead>
                    <TableRow>
                      <TableCell>削除</TableCell><TableCell>No.</TableCell><TableCell>承認</TableCell>
                      <TableCell className="table-cell-date">確定日</TableCell><TableCell className="table-cell-date">確定時間</TableCell>
                      <TableCell>店舗</TableCell><TableCell>人数</TableCell>
                      <TableCell className="table-cell-date">希望日</TableCell><TableCell className="table-cell-date">希望時間</TableCell>
                      <TableCell className="table-cell-date">再提案日</TableCell><TableCell className="table-cell-date">再提案時間</TableCell>
                      <TableCell>備考</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {dlg.rows.map((r,i)=>(<TableRow key={r.tmp}>
                      <TableCell>
                        <IconButton size="small" onClick={()=>delEditRow(r.tmp)}>
                          <span className="material-icons">delete</span>
                        </IconButton>
                      </TableCell>
                      <TableCell>{i+1}</TableCell>
                      <TableCell>
                        <FormControl size="small">
                          <Select value={r.status}
                          onChange={e=>updEditRow(i,'status',e.target.value)}>
                          {Object.entries(STATUS).filter(([k])=>k!=='all').map(([k,l])=><MenuItem key={k} value={k}>{l}</MenuItem>)}
                        </Select>
                      </FormControl>
                    </TableCell>
                    <TableCell><TextField size="small" type="date" value={r.confirmedDate}
                      onChange={e=>updEditRow(i,'confirmedDate',e.target.value)}/></TableCell>
                      <TableCell>
                        <FormControl size="small">
                          <Select value={r.confirmedTime}
                          onChange={e=>updEditRow(i,'confirmedTime',e.target.value)}>
                          {TIMES.map(t=><MenuItem key={t} value={t}>{t}</MenuItem>)}
                        </Select>
                      </FormControl>
                    </TableCell>
                    <TableCell><TextField size="small" value={r.store}
                      onChange={e=>updEditRow(i,'store',e.target.value)}/></TableCell>
                      <TableCell><TextField size="small" type="number" value={r.count}
                        onChange={e=>updEditRow(i,'count',parseInt(e.target.value,10)||0)}/></TableCell>
                        <TableCell><TextField size="small" type="date" value={r.desiredDate}
                          onChange={e=>updEditRow(i,'desiredDate',e.target.value)}/></TableCell>
                          <TableCell>
                            <FormControl size="small">  
                              <Select value={r.desiredTime}
                              onChange={e=>updEditRow(i,'desiredTime',e.target.value)}>
                              {TIMES.map(t=><MenuItem key={t} value={t}>{t}</MenuItem>)}
                            </Select>
                          </FormControl>
                        </TableCell>
                        <TableCell><TextField size="small" type="date" value={r.reproposedDate}
                          onChange={e=>updEditRow(i,'reproposedDate',e.target.value)}/></TableCell>
                          <TableCell>
                            <FormControl size="small">
                              <Select value={r.reproposedTime}
                              onChange={e=>updEditRow(i,'reproposedTime',e.target.value)}>
                              {TIMES.map(t=><MenuItem key={t} value={t}>{t}</MenuItem>)}
                            </Select>
                          </FormControl>
                        </TableCell>
                        <TableCell><TextField size="small" value={r.remark}
                          onChange={e=>updEditRow(i,'remark',e.target.value)}/></TableCell>
                        </TableRow>))}
                      </TableBody>
                    </Table>
                    <Button size="small" variant="outlined" sx={{mt:1}} onClick={addEditRow}>明細行追加</Button>
                    <Box sx={{display:'flex',justifyContent:'flex-end',gap:2,mt:3}}>
                      <Button onClick={closeEditModal}>キャンセル</Button>
                      <Button variant="contained" onClick={saveEdit}>保存</Button>
                    </Box>
                    </>}
                    {/* 返信コントロールエリア */}
                    {renderReplyManagement()}
                    </Box>
                  </Modal>
                  
                  {/* 職場体験フォームモーダル */}
                  <Dialog open={expOpen} onClose={closeExpModal} 
                  maxWidth={false}      // MUI のデフォルト制限を解除
                  fullWidth             // 横幅いっぱいを `PaperProps` と組み合わせて使う
                  PaperProps={{
                    sx: {
                      width: '90vw',     // ビューポート幅の 90%
                      maxWidth: '90vw'   // 最大も同じく 90% に
                    }
                  }}>
                  {/* ヘッダー */}
                  <DialogTitle sx={{ bgcolor: 'primary.main', color: '#fff' }}>
                    職場体験 申込
                  </DialogTitle>
                  
                  {/* コンテンツ */}
                  <DialogContent dividers sx={{ bgcolor: 'background.default', p: 3 }}>
                    
                    {/* ご担当者情報 */}
                    <Paper variant="outlined" sx={{ p: 3, mb: 4 ,bgcolor: 'grey.50' }}>
                      <Typography variant="h6" color="primary" gutterBottom>
                        ご担当者情報 <Typography component="span" color="error">(必須)</Typography>
                      </Typography>
                      
                      {/* 学校名 */}
                      <Box sx={{ mb: 2 }}>
                        <TextField
                        fullWidth required
                        label="学校名"
                        defaultValue={visitForm.schoolName}
                        onBlur={e => onVisitChange('schoolName')(e)}
                        />
                      </Box>
                      
                      {/* 学年 */}
                      <Box sx={{ mb: 2 }}>
                        <TextField
                        fullWidth required
                        label="学年（年生）"
                        defaultValue={visitForm.grade}
                        onBlur={e => onVisitChange('grade')(e)}
                        />
                      </Box>
                      
                      {/* ご担当者名 */}
                      <Box sx={{ mb: 2 }}>
                        <TextField
                        fullWidth required
                        label="ご担当者名"
                        defaultValue={visitForm.contactName}
                        onBlur={e => onVisitChange('contactName')(e)}
                        />
                      </Box>
                      
                      {/* 電話番号 */}
                      <Box sx={{ mb: 2 }}>
                        <FormLabel component="legend" sx={{ mb: 1 }}>電話番号</FormLabel>
                        <Box sx={{ display: 'flex', gap: 1 }}>
                          {['tel1','tel2','tel3'].map((k,i) => (
                          <TextField
                          key={k}
                          size="small"
                          sx={{ flex: 1 }}
                          placeholder={i === 0 ? '000' : '0000'}
                          defaultValue={visitForm[k]}
                          inputProps={{ maxLength: i === 0 ? 5 : 4 }}
                          onBlur={e => onVisitNum(k)(e)}
                          />
                          ))}
                        </Box>
                      </Box>
                      
                      {/* FAX番号 */}
                      <Box sx={{ mb: 2 }}>
                        <FormLabel component="legend" sx={{ mb: 1 }}>FAX番号</FormLabel>
                        <Box sx={{ display: 'flex', gap: 1 }}>
                          {['fax1','fax2','fax3'].map((k,i) => (
                          <TextField
                          key={k}
                          size="small"
                          sx={{ flex: 1 }}
                          placeholder={i === 0 ? '000' : '0000'}
                          defaultValue={visitForm[k]}
                          inputProps={{ maxLength: i === 0 ? 5 : 4 }}
                          onBlur={e => onVisitNum(k)(e)}
                          />
                          ))}
                        </Box>
                      </Box>
                      
                      {/* メール */}
                      <Box sx={{ mb: 2 }}>
                        <TextField
                        fullWidth required type="email"
                        label="連絡可能なメールアドレス"
                        defaultValue={visitForm.email}
                        onBlur={e => onVisitChange('email')(e)}
                        />
                      </Box>
                      
                      {/* 返信方法 */}
                      <Box sx={{ mb: 2 }}>
                        <FormLabel component="legend" sx={{ mb: 1 }}>ご希望の返信方法</FormLabel>
                        <RadioGroup row
                        value={visitForm.sendMethod}
                        onChange={onVisitChange('sendMethod')}
                        >
                        <FormControlLabel value="メール" control={<Radio />} label="メール" />
                        <FormControlLabel value="FAX"   control={<Radio />} label="FAX" />
                      </RadioGroup>
                      <Typography variant="body2" sx={{ mt: 1 }}>
                        記録を残すため、電話での連絡はしていません。（緊急の場合は除く）
                      </Typography>
                    </Box>
                    
                    {/* 備考 */}
                    <Box sx={{ mb: 2 }}>
                      <TextField
                      fullWidth multiline rows={2}
                      label="備考"
                      defaultValue={visitForm.remarks}
                      onBlur={e => onVisitChange('remarks')(e)}
                      />
                    </Box>
                  </Paper>
                  
                  {/* ────────── 希望（店舗・振替店舗・日時・人数・クラス数・付き添い人数・事前訪問） ────────── */}
                  <Paper variant="outlined" sx={{ p: 3, mb: 4 ,bgcolor: 'grey.50'}}>
                    <Typography variant="h6" color="primary" gutterBottom>
                      希望（第1希望、第2希望…）
                    </Typography>
                    
                    {/* 初回１行を保証 */}
                    {(!visitForm.preferences || visitForm.preferences.length === 0) &&
                      (setVisitForm(f => ({
                        ...f,
                        preferences: [{
                          store: '',
                          altApplicable: 'なし',
                          altStore: '',
                          date: '',
                          start: '',
                          end: '',
                          count: '',
                          classCount: '',
                          escortCount: '',
                          preVisit: 'なし',
                          preVisitDate: '',
                          preVisitTime: ''
                        }]
                      })), null)
                    }
                    
                    {(visitForm.preferences || []).map((pref, idx) => (
                      <Box key={idx} sx={{ mb: 3, p: 2, border:1, borderColor:'divider', borderRadius:1 }}>
                        {/* 1行目：店舗・日時・人数・クラス数・付き添い人数・削除 */}
                        <Grid container spacing={2} alignItems="center">
                          <Grid item xs={12} sm={3}>
                            <TextField
                            fullWidth label={`店舗${idx+1}`}
                            defaultValue={pref.store}
                            onBlur={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].store=e.target.value;
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            />
                          </Grid>
                          <Grid item xs={6} sm={2}>
                            <TextField
                            fullWidth type="date" label="日付"
                            InputLabelProps={{shrink:true}}
                            defaultValue={pref.date}
                            onBlur={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].date=e.target.value;
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            />
                          </Grid>
                          <Grid item xs={6} sm={1.5}>
                            <TextField
                            fullWidth type="time" label="開始"
                            InputLabelProps={{shrink:true}}
                            defaultValue={pref.start}
                            onBlur={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].start=e.target.value;
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            />
                          </Grid>
                          <Grid item xs={6} sm={1.5}>
                            <TextField
                            fullWidth type="time" label="終了"
                            InputLabelProps={{shrink:true}}
                            defaultValue={pref.end}
                            onBlur={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].end=e.target.value;
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            />
                          </Grid>
                          <Grid item xs={6} sm={1}>
                            <TextField
                            fullWidth type="number" label="人数"
                            defaultValue={pref.count}
                            onBlur={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].count=e.target.value;
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            />
                          </Grid>
                          <Grid item xs={6} sm={1}>
                            <TextField
                            fullWidth type="number" label="クラス数"
                            defaultValue={pref.classCount}
                            onBlur={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].classCount=e.target.value;
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            />
                          </Grid>
                          <Grid item xs={6} sm={1}>
                            <TextField
                            fullWidth type="number" label="付き添い"
                            defaultValue={pref.escortCount}
                            onBlur={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].escortCount=e.target.value;
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            />
                          </Grid>
                          <Grid item xs={12} sm={1} textAlign="right">
                            {idx > 0 && (
                              <Button
                              size="small" color="error"
                              onClick={() => {
                                const arr=visitForm.preferences.filter((_,i)=>i!==idx);
                                setVisitForm({...visitForm, preferences:arr});
                              }}
                              >
                              ×
                            </Button>
                            )}
                          </Grid>
                        </Grid>
                        
                        {/* 2行目：振替可能店舗 */}
                        <Grid container spacing={2} alignItems="center" sx={{ mt: 2 }}>
                          <Grid item xs={12} sm={4}>
                            <FormControl component="fieldset" fullWidth>
                              <FormLabel component="legend">振替可能店舗</FormLabel>
                              <RadioGroup
                              row value={pref.altApplicable}
                              onChange={e => {
                                const arr=[...visitForm.preferences];
                                arr[idx].altApplicable=e.target.value;
                                if(e.target.value==='なし') arr[idx].altStore='';
                                setVisitForm({...visitForm, preferences:arr});
                              }}
                              >
                              <FormControlLabel value="なし" control={<Radio />} label="なし"/>
                              <FormControlLabel value="あり" control={<Radio />} label="あり"/>
                            </RadioGroup>
                          </FormControl>
                        </Grid>
                        {pref.altApplicable==='あり' && (
                        <Grid item xs={12} sm={4}>
                          <TextField
                          fullWidth label="振替店舗名"
                          defaultValue={pref.altStore}
                          onBlur={e => {
                            const arr=[...visitForm.preferences];
                            arr[idx].altStore=e.target.value;
                            setVisitForm({...visitForm, preferences:arr});
                          }}
                          />
                        </Grid>
                        )}
                      </Grid>
                      
                      {/* 3行目：事前訪問希望 */}
                      <Grid container spacing={2} alignItems="center" sx={{ mt: 2 }}>
                        <Grid item xs={12} sm={4}>
                          <FormControl component="fieldset" fullWidth>
                            <FormLabel component="legend">事前訪問希望</FormLabel>
                            <RadioGroup
                            row value={pref.preVisit}
                            onChange={e => {
                              const arr=[...visitForm.preferences];
                              arr[idx].preVisit=e.target.value;
                              if(e.target.value==='なし'){
                                arr[idx].preVisitDate='';
                                arr[idx].preVisitTime='';
                              }
                              setVisitForm({...visitForm, preferences:arr});
                            }}
                            >
                            <FormControlLabel value="なし" control={<Radio />} label="なし"/>
                            <FormControlLabel value="あり" control={<Radio />} label="あり"/>
                          </RadioGroup>
                        </FormControl>
                      </Grid>
                      {pref.preVisit==='あり' && (
                      <>
                      <Grid item xs={6} sm={4}>
                        <TextField
                        fullWidth type="date" label="訪問日"
                        InputLabelProps={{shrink:true}}
                        defaultValue={pref.preVisitDate}
                        onBlur={e => {
                          const arr=[...visitForm.preferences];
                          arr[idx].preVisitDate=e.target.value;
                          setVisitForm({...visitForm, preferences:arr});
                        }}
                        />
                      </Grid>
                      <Grid item xs={6} sm={4}>
                        <TextField
                        fullWidth type="time" label="訪問時間"
                        InputLabelProps={{shrink:true}}
                        defaultValue={pref.preVisitTime}
                        onBlur={e => {
                          const arr=[...visitForm.preferences];
                          arr[idx].preVisitTime=e.target.value;
                          setVisitForm({...visitForm, preferences:arr});
                        }}
                        />
                      </Grid>
                      </>
                      )}
                    </Grid>
                  </Box>
                  ))}
                  
                  {/* 追加ボタン */}
                  <Box textAlign="right" sx={{ mt: 2 }}>
                    <Button
                    size="small"
                    onClick={() => {
                      const arr=[
                      ...(visitForm.preferences||[]),
                      {
                        store:'', altApplicable:'なし', altStore:'',
                        date:'', start:'', end:'',
                        count:'', classCount:'', escortCount:'',
                        preVisit:'なし', preVisitDate:'', preVisitTime:''
                      }
                      ];
                      setVisitForm({...visitForm, preferences:arr});
                    }}
                    >
                    希望を追加
                  </Button>
                </Box>
                <Typography variant="body2" sx={{ mt: 1 }}>
                  ※最大5件まで追加できます。
                </Typography>
              </Paper>
              
              {/* 連絡事項 */}
              <Paper variant="outlined" sx={{ p: 3, mb: 4 ,bgcolor: 'grey.50' }}>
                <Typography variant="h6" color="primary" gutterBottom>
                  連絡事項（見学希望内容など）
                </Typography>
                <Box sx={{ mb: 2 }}>
                  <TextField
                  fullWidth multiline rows={3}
                  label="備考"
                  defaultValue={visitForm.contactNotes}
                  onBlur={e => onVisitChange('contactNotes')(e)}
                  />
                </Box>
              </Paper>
              
              {/* ファイル添付 */}
              <Paper variant="outlined" sx={{ p: 3, mb: 4,bgcolor: 'grey.50' }}>
                <Typography variant="h6" color="primary" gutterBottom>
                  ファイル添付
                </Typography>
                <Box sx={{ mb: 2 }}>
                  <Button variant="outlined" component="label">
                    参照
                    <input
                    hidden type="file"
                    accept=".pdf,.xlsx,.doc,.docx,image/*"
                    onChange={onVisitFile}
                    />
                  </Button>
                </Box>
                {visitForm.file && (
                  <Typography variant="body2" sx={{ mb: 2 }}>
                    選択中: {visitForm.file.name}
                  </Typography>
                  )}
                  <Typography variant="body2">
                    学校で作成した資料などお持ちでしたら添付してください。（PDF、xlsx、word、jpeg）
                  </Typography>
                </Paper>
                
                {/* 注意事項 */}
                <Paper variant="outlined" sx={{ p: 3 ,bgcolor: 'grey.50' }}>
                  <Typography variant="subtitle1" color="secondary" gutterBottom>
                    【注意事項】
                  </Typography>
                  <Typography variant="body2" sx={{ whiteSpace: 'pre-line' }}>
                    ① 学年でまとめてお申込みくださいますようお願い致します。<br/>
                    ② 店舗と打ち合わせ後、折り返しご連絡致します。<br/>
                    　お申込み数の多い時期は、調整に日数がかかることもございます。<br/>
                    　希望日まで余裕をもってお申込みください。<br/>
                    ③ 諸事情により、希望通りお受けできない場合もございますが、ご了承下さい。<br/>
                    ④ キャンセルはお早めにご連絡ください。一人でも多くの方に体験していただけるよう、ご協力をお願い致します。<br/>
                    ⑤ 生徒様の不注意によるケガや事故が発生した際、御校で加入されている学校保険等でご対応いただきますようお願いいたします。<br/>
                    <br/>
                    【 店舗で体験するにあたって 】(サミットストアのみ、コルモピアは除く)<br/>
                    ① 学校の制服で店舗へ出勤(入店)してください。更衣室にて学校指定のジャージに着替えます。<br/>
                    　ジャージは洗濯済みのものを持参してください。<br/>
                    ② 原料、製品への汚染及び異物混入を防止するためご協力下さい。(社員と同じルールです)<br/>
                  </Typography>
                </Paper>
                
              </DialogContent>
              
              {/* フッター */}
              <DialogActions sx={{ px: 3, py: 2 }}>
                <FormControlLabel
                control={<Checkbox checked={visitForm.ack} onChange={onVisitChange('ack')} />}
                label="確認済み"
                />
                <Box sx={{ flexGrow: 1 }} />
                <Button onClick={closeVisitModal}>キャンセル</Button>
                <Button variant="contained" onClick={saveVisit}>送信</Button>
              </DialogActions>
            </Dialog>
            
            
            
            {/* 店舗見学申込モーダル */}
            <Dialog
            open={visitOpen}
            onClose={closeVisitModal}
            maxWidth={false}
            fullWidth
            PaperProps={{
              sx: {
                width: '90vw',
                maxWidth: '90vw',
              }
            }}
            >
            {/* ヘッダー */}
            <DialogTitle sx={{ bgcolor: 'primary.main', color: '#fff' }}>
              店舗見学 申込
            </DialogTitle>
            
            {/* コンテンツ */}
            <DialogContent dividers sx={{ bgcolor: 'background.default', p: 3 }}>
              
              {/* ご担当者情報 */}
              <Paper variant="outlined" sx={{ p: 3, mb: 4, bgcolor: 'grey.50' }}>
                <Typography variant="h6" color="primary" gutterBottom>
                  ご担当者情報 <Typography component="span" color="error">(必須)</Typography>
                </Typography>
                {/* 学校名 */}
                <Box sx={{ mb: 2 }}>
                  <TextField
                  fullWidth required
                  label="学校名"
                  defaultValue={visitForm.schoolName}
                  onBlur={e => onVisitChange('schoolName')(e)}
                  />
                </Box>
                {/* 学年 */}
                <Box sx={{ mb: 2 }}>
                  <TextField
                  fullWidth required
                  label="学年（年生）"
                  defaultValue={visitForm.grade}
                  onBlur={e => onVisitChange('grade')(e)}
                  />
                </Box>
                
                {/* ご担当者名 */}
                <Box sx={{ mb: 2 }}>
                  <TextField
                  fullWidth required
                  label="ご担当者名"
                  defaultValue={visitForm.contactName}
                  onBlur={e => onVisitChange('contactName')(e)}
                  />
                </Box>
                
                {/* 電話番号 */}
                <Box sx={{ mb: 2 }}>
                  <FormLabel component="legend" sx={{ mb: 1 }}>電話番号</FormLabel>
                  <Box sx={{ display: 'flex', gap: 1 }}>
                    {['tel1','tel2','tel3'].map((k,i) => (
                    <TextField
                    key={k}
                    size="small"
                    sx={{ flex: 1 }}
                    placeholder={i === 0 ? '000' : '0000'}
                    defaultValue={visitForm[k]}
                    inputProps={{ maxLength: i === 0 ? 5 : 4 }}
                    onBlur={e => onVisitNum(k)(e)}
                    />
                    ))}
                  </Box>
                </Box>
                
                {/* FAX番号 */}
                <Box sx={{ mb: 2 }}>
                  <FormLabel component="legend" sx={{ mb: 1 }}>FAX番号</FormLabel>
                  <Box sx={{ display: 'flex', gap: 1 }}>
                    {['fax1','fax2','fax3'].map((k,i) => (
                    <TextField
                    key={k}
                    size="small"
                    sx={{ flex: 1 }}
                    placeholder={i === 0 ? '000' : '0000'}
                    defaultValue={visitForm[k]}
                    inputProps={{ maxLength: i === 0 ? 5 : 4 }}
                    onBlur={e => onVisitNum(k)(e)}
                    />
                    ))}
                  </Box>
                </Box>
                
                {/* メール */}
                <Box sx={{ mb: 2 }}>
                  <TextField
                  fullWidth required type="email"
                  label="連絡可能なメールアドレス"
                  defaultValue={visitForm.email}
                  onBlur={e => onVisitChange('email')(e)}
                  />
                </Box>
                
                {/* 返信方法 */}
                <Box sx={{ mb: 2 }}>
                  <FormLabel component="legend" sx={{ mb: 1 }}>ご希望の返信方法</FormLabel>
                  <RadioGroup
                  row
                  value={visitForm.sendMethod}
                  onChange={onVisitChange('sendMethod')}
                  >
                  <FormControlLabel value="メール" control={<Radio />} label="メール" />
                  <FormControlLabel value="FAX"   control={<Radio />} label="FAX" />
                </RadioGroup>
                <Typography variant="body2" sx={{ mt: 1 }}>
                  記録を残すため、電話での連絡はしていません。（緊急の場合は除く）
                </Typography>
              </Box>
              
              {/* 備考 */}
              <Box sx={{ mb: 2 }}>
                <TextField
                fullWidth multiline rows={2}
                label="備考"
                defaultValue={visitForm.remarks}
                onBlur={e => onVisitChange('remarks')(e)}
                />
              </Box>
            </Paper>
            
            {/* 申し込み内容 */}
            <Paper variant="outlined" sx={{ p: 3, mb: 4, bgcolor: 'grey.50' }}>
              <Typography variant="h6" color="primary" gutterBottom>
                申し込み内容
              </Typography>
              <FormControl component="fieldset" fullWidth>
                <RadioGroup
                row
                value={visitForm.applyType}
                onChange={onVisitChange('applyType')}
                >
                <FormControlLabel value="小学生見学" control={<Radio />} label="小学生見学" />
                <FormControlLabel value="小学生町たんけん" control={<Radio />} label="小学生町たんけん" />
                <FormControlLabel value="中学生職場訪問" control={<Radio />} label="中学生職場訪問" />
                <FormControlLabel value="その他" control={<Radio />} label="その他（具体的内容）" />
              </RadioGroup>
            </FormControl>
            {visitForm.applyType === 'その他' && (
            <Box sx={{ mt: 2 }}>
              <TextField
              fullWidth sx={{ mt: 2 }}
              label="具体的内容"
              defaultValue={visitForm.otherType}
              onBlur={e => onVisitChange('otherType')(e)}
              />
            </Box>
            )}
          </Paper>
      
          {/* ────────── 希望内容 ────────── */}
          <Paper variant="outlined" sx={{ p: 3, mb: 4, bgcolor: 'grey.50' }}>
            <Typography variant="h6" color="primary" gutterBottom>
              希望内容
            </Typography>
            <FormControl component="fieldset" fullWidth>
              <RadioGroup
              row
              value={visitForm.wishContents}
              onChange={onVisitChange('wishContents')}
              >
              <FormControlLabel value="従業員による案内" control={<Radio />} label="従業員による案内" />
              <FormControlLabel value="売場見学（案内なしの自由見学）" control={<Radio />} label="売場見学（案内なしの自由見学）" />
              <FormControlLabel value="その他" control={<Radio />} label="その他" />
            </RadioGroup>
          </FormControl>
          {visitForm.wishContents === 'その他' && (
          <Box sx={{ mt: 2 }}>
            <TextField
            fullWidth
            label="具体的内容"
            defaultValue={visitForm.otherWish}
            onBlur={e => onVisitChange('otherWish')(e)}
            />
          </Box>
          )}
        </Paper>
        
        {/* 希望（店舗・振替店舗・日時・人数・クラス数・付き添い人数・事前訪問） */}
        <Paper variant="outlined" sx={{ p: 3, mb: 4, bgcolor: 'grey.50' }}>
          <Typography variant="h6" color="primary" gutterBottom>
            希望（第1希望、第2希望…）
          </Typography>
          
          {/* 初回１行を保証 */}
          {(!visitForm.preferences || visitForm.preferences.length === 0) &&
            (setVisitForm(f => ({
              ...f,
              preferences: [{
                store: '',
                altApplicable: 'なし',
                altStore: '',
                date: '',
                start: '',
                end: '',
                count: '',
                classCount: '',
                escortCount: '',
                preVisit: 'なし',
                preVisitDate: '',
                preVisitTime: ''
              }]
            })), null)
          }
          
          {(visitForm.preferences || []).map((pref, idx) => (
            <Box key={idx} sx={{ mb: 3, p: 2, border:1, borderColor:'divider', borderRadius:1 }}>
              {/* 1行目：店舗・日時・人数・クラス数・付き添い人数・削除 */}
              <Grid container spacing={2} alignItems="center">
                <Grid item xs={12} sm={3}>
                  <TextField
                  fullWidth label={`店舗${idx+1}`}
                  defaultValue={pref.store}
                  onBlur={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].store=e.target.value;
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  />
                </Grid>
                <Grid item xs={6} sm={2}>
                  <TextField
                  fullWidth type="date" label="日付"
                  InputLabelProps={{shrink:true}}
                  defaultValue={pref.date}
                  onBlur={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].date=e.target.value;
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  />
                </Grid>
                <Grid item xs={6} sm={1.5}>
                  <TextField
                  fullWidth type="time" label="開始"
                  InputLabelProps={{shrink:true}}
                  defaultValue={pref.start}
                  onBlur={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].start=e.target.value;
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  />
                </Grid>
                <Grid item xs={6} sm={1.5}>
                  <TextField
                  fullWidth type="time" label="終了"
                  InputLabelProps={{shrink:true}}
                  defaultValue={pref.end}
                  onBlur={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].end=e.target.value;
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  />
                </Grid>
                <Grid item xs={6} sm={1}>
                  <TextField
                  fullWidth type="number" label="人数"
                  defaultValue={pref.count}
                  onBlur={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].count=e.target.value;
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  />
                </Grid>
                <Grid item xs={6} sm={1}>
                  <TextField
                  fullWidth type="number" label="クラス数"
                  defaultValue={pref.classCount}
                  onBlur={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].classCount=e.target.value;
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  />
                </Grid>
                <Grid item xs={6} sm={1}>
                  <TextField
                  fullWidth type="number" label="付き添い"
                  defaultValue={pref.escortCount}
                  onBlur={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].escortCount=e.target.value;
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  />
                </Grid>
                <Grid item xs={12} sm={1} textAlign="right">
                  {idx > 0 && (
                    <Button
                    size="small" color="error"
                    onClick={() => {
                      const arr=visitForm.preferences.filter((_,i)=>i!==idx);
                      setVisitForm({...visitForm, preferences:arr});
                    }}
                    >
                    ×
                  </Button>
                  )}
                </Grid>
              </Grid>
              
              {/* 2行目：振替可能店舗 */}
              <Grid container spacing={2} alignItems="center" sx={{ mt: 2 }}>
                <Grid item xs={12} sm={4}>
                  <FormControl component="fieldset" fullWidth>
                    <FormLabel component="legend">振替可能店舗</FormLabel>
                    <RadioGroup
                    row value={pref.altApplicable}
                    onChange={e => {
                      const arr=[...visitForm.preferences];
                      arr[idx].altApplicable=e.target.value;
                      if(e.target.value==='なし') arr[idx].altStore='';
                      setVisitForm({...visitForm, preferences:arr});
                    }}
                    >
                    <FormControlLabel value="なし" control={<Radio />} label="なし"/>
                    <FormControlLabel value="あり" control={<Radio />} label="あり"/>
                  </RadioGroup>
                </FormControl>
              </Grid>
              {pref.altApplicable==='あり' && (
              <Grid item xs={12} sm={4}>
                <TextField
                fullWidth label="振替店舗名"
                defaultValue={pref.altStore}
                onBlur={e => {
                  const arr=[...visitForm.preferences];
                  arr[idx].altStore=e.target.value;
                  setVisitForm({...visitForm, preferences:arr});
                }}
                />
              </Grid>
              )}
            </Grid>
            
            {/* 3行目：事前訪問希望 */}
            <Grid container spacing={2} alignItems="center" sx={{ mt: 2 }}>
              <Grid item xs={12} sm={4}>
                <FormControl component="fieldset" fullWidth>
                  <FormLabel component="legend">事前訪問希望</FormLabel>
                  <RadioGroup
                  row value={pref.preVisit}
                  onChange={e => {
                    const arr=[...visitForm.preferences];
                    arr[idx].preVisit=e.target.value;
                    if(e.target.value==='なし'){
                      arr[idx].preVisitDate='';
                      arr[idx].preVisitTime='';
                    }
                    setVisitForm({...visitForm, preferences:arr});
                  }}
                  >
                  <FormControlLabel value="なし" control={<Radio />} label="なし"/>
                  <FormControlLabel value="あり" control={<Radio />} label="あり"/>
                </RadioGroup>
              </FormControl>
            </Grid>
            {pref.preVisit==='あり' && (
            <>
            <Grid item xs={6} sm={4}>
              <TextField
              fullWidth type="date" label="訪問日"
              InputLabelProps={{shrink:true}}
              defaultValue={pref.preVisitDate}
              onBlur={e => {
                const arr=[...visitForm.preferences];
                arr[idx].preVisitDate=e.target.value;
                setVisitForm({...visitForm, preferences:arr});
              }}
              />
            </Grid>
            <Grid item xs={6} sm={4}>
              <TextField
              fullWidth type="time" label="訪問時間"
              InputLabelProps={{shrink:true}}
              defaultValue={pref.preVisitTime}
              onBlur={e => {
                const arr=[...visitForm.preferences];
                arr[idx].preVisitTime=e.target.value;
                setVisitForm({...visitForm, preferences:arr});
              }}
              />
            </Grid>
            </>
            )}
          </Grid>
        </Box>
        ))}
        
        {/* 追加ボタン */}
        <Box textAlign="right" sx={{ mt: 2 }}>
          <Button
          size="small"
          onClick={() => {
            const arr=[
            ...(visitForm.preferences||[]),
            {
              store:'', altApplicable:'なし', altStore:'',
              date:'', start:'', end:'',
              count:'', classCount:'', escortCount:'',
              preVisit:'なし', preVisitDate:'', preVisitTime:''
            }
            ];
            setVisitForm({...visitForm, preferences:arr});
          }}
          >
          希望を追加
        </Button>
      </Box>
      <Typography variant="body2" sx={{ mt: 1 }}>
        ※最大5件まで追加できます。
      </Typography>
    </Paper>
    
    {/* ────────── 連絡事項 ────────── */}
    <Paper variant="outlined" sx={{ p: 3, mb: 4, bgcolor: 'grey.50' }}>
      <Typography variant="h6" color="primary" gutterBottom>
        連絡事項（見学の目的・見学方法など）
      </Typography>
      <Box sx={{ mt: 1 }}>
        <TextField
        fullWidth
        multiline
        rows={3}
        defaultValue={visitForm.contactNotes}
        onBlur={e => onVisitChange('contactNotes')(e)}
        />
      </Box>
    </Paper>
    
    {/* ────────── ファイル添付 ────────── */}
    <Paper variant="outlined" sx={{ p: 3, mb: 4, bgcolor: 'grey.50' }}>
      <Typography variant="h6" color="primary" gutterBottom>
        ファイル添付
      </Typography>
      <Box sx={{ mt: 1 }}>
        <Button variant="outlined" component="label">
          参照
          <input
          type="file"
          hidden
          accept=".pdf,.xlsx,.doc,.docx,image/*"
          onChange={onVisitFile}
          />
        </Button>
      </Box>
      {visitForm.file && (
        <Typography variant="body2" sx={{ mt: 1 }}>
          選択中: {visitForm.file.name}
        </Typography>
        )}
        <Typography variant="body2" sx={{ mt: 1 }}>
          学校で作成した資料などお持ちでしたら添付してください。（PDF、xlsx、word、jpeg）
        </Typography>
      </Paper>
      
      {/* ────────── 注意事項 ────────── */}
      <Paper variant="outlined" sx={{ p: 3, mb: 4, bgcolor: 'grey.50' }}>
        <Typography variant="subtitle1" color="secondary" gutterBottom>
          【注意事項】
        </Typography>
        <Typography variant="body2" sx={{ whiteSpace: 'pre-line' }}>
          ① 店舗と打ち合わせ後、折り返しご連絡致します。(1週間程度かかる場合がございます)  <br/>
          　お申込み数の多い時期は、調整に日数がかかることもございます。希望日まで余裕をもってお申し込みください。<br/>  
          ② 諸事情により、希望通りお受けできない場合もございますが、ご了承下さい。<br/>  
          ③ 生徒様の不注意によるケガや事故が発生した際、御校で加入されている学校保険等でご対応いただきますようお願いいたします。<br/>  
          　上記の【注意事項】を必ずお読みください。
        </Typography>
      </Paper>
      
    </DialogContent>
    
    {/* フッター */}
    <DialogActions sx={{ px: 3, py: 2 }}>
      <FormControlLabel
      control={<Checkbox checked={visitForm.ack} onChange={onVisitChange('ack')} />}
      label="確認済み"
      />
      <Box sx={{ flexGrow: 1 }} />
      <Button onClick={closeVisitModal}>キャンセル</Button>
      <Button variant="contained" onClick={saveVisit}>送信</Button>
    </DialogActions>
  </Dialog>

</Container>
);
}

const theme=createTheme({palette:{primary:{main:'#0d47a1'}}});
ReactDOM.render(
<ThemeProvider theme={theme}><App/></ThemeProvider>,
document.getElementById('root')
);
</script>
</body>
</html>
