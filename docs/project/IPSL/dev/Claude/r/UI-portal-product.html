<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>商品ダッシュボード｜モード切替 + リクエスト + PDCA（完全版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts / Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
  <!-- React / Babel / MUI -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js" crossorigin></script>
  <style>
    html,body,#root{height:100%}
    body{margin:0;background:#f7f7f8}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .cards{display:grid;gap:16px;grid-template-columns:repeat(4,minmax(180px,1fr))}
    @media (max-width:1000px){.cards{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:600px){.cards{grid-template-columns:1fr}}
    .mono{font-variant-numeric:tabular-nums;font-feature-settings:"tnum"}
    .mini{font-size:12px;color:#666}
    .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #eee;border-radius:999px;padding:2px 8px;background:#fff}
    .risk-ok{color:#2e7d32}.risk-warn{color:#ef6c00}.risk-danger{color:#c62828}
    .rowHover{cursor:pointer}
    .rowHover:hover{background:#fafafa}
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel" data-presets="env,react">
const {
  AppBar, Toolbar, Typography, Paper, Box, Stack, Chip, Button,
  Card, CardContent, Divider, Grid, ToggleButton, ToggleButtonGroup,
  Dialog, DialogTitle, DialogContent, DialogActions, TextField, MenuItem,
  Snackbar, Alert, Tabs, Tab, LinearProgress, Table, TableHead, TableRow, TableCell, TableBody
} = MaterialUI;

/* ===== マスター/ダミー ===== */
const PRODUCTS=[{id:'P001',sku:'TSH-001',name:'ベーシックTシャツ',price:1990},{id:'P002',sku:'SNE-101',name:'ライトスニーカー',price:5990},{id:'P003',sku:'BAG-777',name:'デイリーバッグ',price:3990}];
const STORES=[{id:'S01',name:'新宿本店',channel:'店舗'},{id:'S02',name:'渋谷店',channel:'店舗'},{id:'S03',name:'名古屋店',channel:'店舗'},{id:'S04',name:'アウトレット木更津',channel:'アウトレット'},{id:'S05',name:'ECサイト',channel:'オンライン'}];
const CHANNELS=[...new Set(STORES.map(s=>s.channel))];

let INVENTORY=[{productId:'P001',storeId:'S01',qty:120},{productId:'P001',storeId:'S02',qty:60},{productId:'P001',storeId:'S03',qty:40},{productId:'P001',storeId:'S04',qty:200},{productId:'P001',storeId:'S05',qty:150},{productId:'P002',storeId:'S01',qty:40},{productId:'P002',storeId:'S02',qty:20},{productId:'P002',storeId:'S03',qty:10},{productId:'P002',storeId:'S04',qty:120},{productId:'P002',storeId:'S05',qty:80},{productId:'P003',storeId:'S01',qty:25},{productId:'P003',storeId:'S02',qty:40},{productId:'P003',storeId:'S03',qty:35},{productId:'P003',storeId:'S04',qty:10},{productId:'P003',storeId:'S05',qty:90}];

function generateSales(seed=42){
  let x=seed; const rand=()=> (x=(x*1664525+1013904223)%4294967296)/4294967296;
  const rows=[]; const today=new Date();
  for(let d=0; d<60; d++){
    const date=new Date(today); date.setDate(date.getDate()-d); const ds=date.toISOString().slice(0,10);
    PRODUCTS.forEach(p=>{
      STORES.forEach(s=>{
        const base=(s.channel==='オンライン'?10:s.channel==='アウトレット'?6:4)*(p.id==='P002'?0.9:p.id==='P003'?0.7:1);
        const w=(date.getDay()===0||date.getDay()===6)?1.3:1.0; const noise=(rand()*0.8+0.6);
        let units=Math.max(0,Math.round(base*w*noise-1));
        const inv=INVENTORY.find(i=>i.productId===p.id&&i.storeId===s.id)?.qty??0;
        if(inv<10) units=Math.min(units, Math.round(inv/5));
        rows.push({productId:p.id,storeId:s.id,date:ds,units,net:units*p.price});
      });
    });
  }
  return rows;
}
let SALES=generateSales();

/* ===== Utils ===== */
const fmtYen=n=>n.toLocaleString('ja-JP',{style:'currency',currency:'JPY',maximumFractionDigits:0});
const sum=(a,sel=x=>x)=>a.reduce((p,c)=>p+sel(c),0);
const byId=list=>Object.fromEntries(list.map(x=>[x.id,x]));
const toDate=s=>new Date(s+'T00:00:00');
const avgDaily=(u,d)=>d>0?u/d:0;
const daysOfSupply=(q,d)=>d>0?q/d:Infinity;
const daysBetween=(a,b)=> Math.max(1, Math.round((toDate(b)-toDate(a))/86400000)+1);

function filterSales({productId,from,to,channels}){
  const storeById=byId(STORES);
  return SALES.filter(r=> r.productId===productId && toDate(r.date)>=toDate(from) && toDate(r.date)<=toDate(to) && channels.includes(storeById[r.storeId].channel));
}
function aggregateByStore(rows,productId){
  const storeById=byId(STORES);
  const invByStore=new Map(INVENTORY.filter(i=>i.productId===productId).map(i=>[i.storeId,i.qty]));
  const map=new Map();
  rows.forEach(r=>{
    const st=storeById[r.storeId];
    if(!map.has(r.storeId)) map.set(r.storeId,{storeId:r.storeId,store:st.name,channel:st.channel,units:0,net:0,inv:invByStore.get(r.storeId)??0,days:new Set()});
    const o=map.get(r.storeId); o.units+=r.units; o.net+=r.net; o.days.add(r.date);
  });
  return [...map.values()].map(x=>({...x,days:x.days.size}));
}
function aggregateByChannel(rows){
  const storeById=byId(STORES); const map=new Map();
  rows.forEach(r=>{
    const ch=storeById[r.storeId].channel;
    if(!map.has(ch)) map.set(ch,{channel:ch,units:0,net:0,stores:new Set(),days:new Set()});
    const o=map.get(ch); o.units+=r.units; o.net+=r.net; o.stores.add(r.storeId); o.days.add(r.date);
  });
  return [...map.values()].map(x=>({...x,stores:x.stores.size,days:x.days.size||1}));
}
function calcTrendSeries(productId,channels,toStr){
  const to=toDate(toStr); const storeById=byId(STORES);
  const day=n=>{const d=new Date(to); d.setDate(d.getDate()-n); return d.toISOString().slice(0,10);};
  const series=[]; for(let i=13;i>=0;i--){ const ds=day(i);
    const val=sum(SALES.filter(r=> r.productId===productId && r.date===ds && channels.includes(storeById[r.storeId].channel)), r=>r.units);
    series.push(val);
  } return series;
}

/* ===== Infographic 部品 ===== */
const Sparkline=({data,width=120,height=36})=>{
  const max=Math.max(...data,1), min=Math.min(...data,0);
  const pts=data.map((v,i)=>`${(i/(data.length-1))*width},${height-((v-min)/(max-min||1))*height}`).join(' ');
  return (<svg width={width} height={height}><polyline fill="none" stroke="currentColor" strokeWidth="2" points={pts}/></svg>);
};
const DosDonut=({dos,goodMin=14,goodMax=60,size=88})=>{
  const r=size/2-8, cx=size/2, cy=size/2, C=2*Math.PI*r, cap=120, v=Math.max(0,Math.min(cap,isFinite(dos)?dos:cap)), dash=C*(v/cap);
  let cls='risk-ok'; if(dos<goodMin) cls='risk-danger'; else if(dos>goodMax) cls='risk-warn';
  return (
    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
      <circle cx={cx} cy={cy} r={r} stroke="#eee" strokeWidth="8" fill="none"/>
      <circle cx={cx} cy={cy} r={r} stroke="currentColor" className={cls} strokeWidth="8" fill="none" strokeDasharray={`${dash} ${C-dash}`} transform={`rotate(-90 ${cx} ${cy})`}/>
      <text x={cx} y={cy} textAnchor="middle" dominantBaseline="central" fontSize="16" className={cls}>{isFinite(dos)?Math.round(dos):'∞'}</text>
    </svg>
  );
};
const KPI=({icon,label,value,sub,right})=>(
  <Card elevation={0} variant="outlined"><CardContent>
    <Stack direction="row" justifyContent="space-between" alignItems="center">
      <Stack spacing={0.5}>
        <Stack direction="row" spacing={0.5} alignItems="center"><span className="material-icons">{icon}</span><span className="mini">{label}</span></Stack>
        <Typography variant="h5" className="mono">{value}</Typography>{sub && <span className="mini">{sub}</span>}
      </Stack>
      {right}
    </Stack>
  </CardContent></Card>
);

/* ===== Next Best Actions ===== */
function nextActions({byStore,targetDays=21,markdownDos=60,minLot=5}){
  const actions=[];
  byStore.forEach(s=>{ const daily=avgDaily(s.units,s.days||1), dos=daysOfSupply(s.inv,daily);
    if(dos<14){ const need=Math.max(minLot, Math.ceil(daily*targetDays - s.inv)); actions.push({kind:'補充',msg:`${s.store} 欠品リスク: +${need}点 補充`,store:s,qty:need,priority:1}); }
  });
  const surplus=byStore.filter(s=> s.inv-avgDaily(s.units,s.days||1)*targetDays>=minLot)
    .sort((a,b)=> (b.inv-avgDaily(b.units,b.days||1)*targetDays)-(a.inv-avgDaily(a.units,a.days||1)*targetDays));
  const shortage=byStore.filter(s=> avgDaily(s.units,s.days||1)*targetDays-s.inv>=minLot)
    .sort((a,b)=> (avgDaily(b.units,b.days||1)*targetDays-b.inv)-(avgDaily(a.units,a.days||1)*targetDays-a.inv));
  let pairs=0; for(let i=0;i<surplus.length && i<2;i++){ for(let j=0;j<shortage.length && j<2;j++){
    if(surplus[i].storeId===shortage[j].storeId) continue;
    const qty=Math.max(minLot, Math.min(Math.floor(surplus[i].inv-avgDaily(surplus[i].units,surplus[i].days||1)*targetDays), Math.ceil(avgDaily(shortage[j].units,shortage[j].days||1)*targetDays-shortage[j].inv)));
    if(qty>0 && pairs<2){ actions.push({kind:'移管',msg:`${surplus[i].store} → ${shortage[j].store} に ${qty}点 移管`,from:surplus[i],to:shortage[j],qty,priority:2}); pairs++; }
  }}; 
  byStore.filter(s=> daysOfSupply(s.inv, avgDaily(s.units,s.days||1))>markdownDos).slice(0,2)
    .forEach(s=> actions.push({kind:'値下げ希望',msg:`${s.store} 高在庫: 値下げ検討`,store:s,priority:3}));
  return actions.sort((a,b)=>a.priority-b.priority).slice(0,3);
}

/* ===== リクエスト保存 ===== */
const REQ_KEY='requests_mode_full_v1';
const loadReq=()=>{ try{ return JSON.parse(localStorage.getItem(REQ_KEY))||[]; }catch(e){ return []; } };
const saveReq=(arr)=> localStorage.setItem(REQ_KEY, JSON.stringify(arr));

/* ===== PDCA 保存 ===== */
const PDCA_KEY = 'pdca_plan_v1';
const loadPDCA = () => { try { return JSON.parse(localStorage.getItem(PDCA_KEY)) || {}; } catch { return {}; } };
const savePDCA = (obj) => localStorage.setItem(PDCA_KEY, JSON.stringify(obj));

/* ===== テーブル共通スタイル ===== */
const th = { textAlign:'left', padding:8, border:'1px solid #eee' };
const td = { padding:8, border:'1px solid #eee' };

/* ===== リクエストダイアログ ===== */
function RequestDialog({open,onClose,onSubmit,product,defaultStore,defaultType,defaultQty}){
  const [type,setType]=React.useState(defaultType||'補充');
  const [storeId,setStoreId]=React.useState(defaultStore?.storeId||STORES[0].id);
  const [qty,setQty]=React.useState(defaultQty||0);
  const [neededBy,setNeededBy]=React.useState(()=>{ const t=new Date(); t.setDate(t.getDate()+7); return t.toISOString().slice(0,10); });
  const [urgency,setUrgency]=React.useState('中');
  const [reason,setReason]=React.useState(''); const [contact,setContact]=React.useState('');

  React.useEffect(()=>{ setType(defaultType||'補充'); setStoreId(defaultStore?.storeId||STORES[0].id); setQty(defaultQty||0); },[open]);

  return (
    <Dialog open={open} onClose={onClose} fullWidth maxWidth="sm">
      <DialogTitle>商品リクエスト</DialogTitle>
      <DialogContent dividers>
        <Grid container spacing={2}>
          <Grid item xs={12} md={4}>
            <TextField select fullWidth size="small" label="種別" value={type} onChange={e=>setType(e.target.value)}>
              <MenuItem value="補充">補充</MenuItem><MenuItem value="移管">移管</MenuItem><MenuItem value="新規仕入">新規仕入</MenuItem><MenuItem value="値下げ希望">値下げ希望</MenuItem>
            </TextField>
          </Grid>
          <Grid item xs={12} md={8}>
            <TextField fullWidth size="small" label="商品" value={`${product.name}（${product.sku}）`} InputProps={{readOnly:true}}/>
          </Grid>
          <Grid item xs={12} md={6}>
            <TextField select fullWidth size="small" label="店舗" value={storeId} onChange={e=>setStoreId(e.target.value)}>
              {STORES.map(s=> <MenuItem key={s.id} value={s.id}>{s.name}（{s.channel}）</MenuItem>)}
            </TextField>
          </Grid>
          <Grid item xs={6} md={3}>
            <TextField type="number" size="small" label="数量" value={qty} onChange={e=>setQty(Number(e.target.value)||0)} />
          </Grid>
          <Grid item xs={6} md={3}>
            <TextField type="date" size="small" label="希望日" value={neededBy} onChange={e=>setNeededBy(e.target.value)} InputLabelProps={{shrink:true}}/>
          </Grid>
          <Grid item xs={12}><TextField fullWidth size="small" label="理由" value={reason} onChange={e=>setReason(e.target.value)} /></Grid>
          <Grid item xs={12}><TextField fullWidth size="small" label="連絡先" value={contact} onChange={e=>setContact(e.target.value)} /></Grid>
        </Grid>
      </DialogContent>
      <DialogActions>
        <Button onClick={onClose}>キャンセル</Button>
        <Button variant="contained" onClick={()=>{
          const st=STORES.find(s=>s.id===storeId);
          onSubmit({
            id:'REQ-'+Date.now(), createdAt:new Date().toISOString(), status:'未処理',
            type, productId:product.id, sku:product.sku, productName:product.name,
            storeId:st.id, store:st.name, channel:st.channel,
            qty, neededBy, urgency, reason, contact
          });
        }}>登録</Button>
      </DialogActions>
    </Dialog>
  );
}

/* ===== リクエスト一覧パネル ===== */
function RequestsPanel({product,channels}){
  const [rows,setRows]=React.useState(loadReq());
  const [status,setStatus]=React.useState('ALL');

  const filtered=rows.filter(r=>
    (status==='ALL'||r.status===status) && r.productId===product.id && channels.includes(r.channel)
  ).sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt));

  const update=(id,patch)=>{ const next=rows.map(r=> r.id===id? {...r,...patch}:r); setRows(next); saveReq(next); };
  const exportCSV=()=>{
    const header=['id','createdAt','status','type','product','store','channel','qty','neededBy','urgency','reason','contact'];
    const lines=[header.join(',')].concat(filtered.map(r=>[
      r.id,r.createdAt,r.status,r.type,`"${r.productName}(${r.sku})"`,`"${r.store}"`,r.channel,r.qty,r.neededBy,r.urgency,`"${(r.reason||'').replace(/"/g,'""')}"`,`"${(r.contact||'').replace(/"/g,'""')}"`
    ].join(',')));
    const blob=new Blob([lines.join('\n')],{type:'text/csv'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='requests.csv'; a.click(); URL.revokeObjectURL(url);
  };
  const exportJSON=()=>{
    const blob=new Blob([JSON.stringify(filtered,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='requests.json'; a.click(); URL.revokeObjectURL(url);
  };
  const importJSON=(file)=>{
    const r=new FileReader();
    r.onload=()=>{ try{ const arr=JSON.parse(r.result); const next=[...rows,...arr]; setRows(next); saveReq(next); alert('JSONを読み込みました'); }catch{ alert('JSONの形式が不正です'); } };
    r.readAsText(file,'utf-8');
  };

  return (
    <Paper variant="outlined" sx={{p:2}}>
      <b>アクションキュー（リクエスト一覧）</b>
      <Divider sx={{my:1}}/>
      <Stack direction="row" spacing={1} alignItems="center" flexWrap="wrap" sx={{mb:1}}>
        <TextField select size="small" label="ステータス" value={status} onChange={e=>setStatus(e.target.value)}>
          <MenuItem value="ALL">ALL</MenuItem><MenuItem value="未処理">未処理</MenuItem><MenuItem value="承認">承認</MenuItem><MenuItem value="却下">却下</MenuItem><MenuItem value="完了">完了</MenuItem>
        </TextField>
        <Button variant="outlined" onClick={exportCSV} startIcon={<span className="material-icons">download</span>}>CSV出力</Button>
        <Button variant="outlined" onClick={exportJSON} startIcon={<span className="material-icons">save</span>}>JSON出力</Button>
        <Button variant="outlined" component="label" startIcon={<span className="material-icons">upload_file</span>}>
          JSONインポート<input type="file" hidden accept=".json" onChange={(e)=>e.target.files[0]&&importJSON(e.target.files[0])}/>
        </Button>
      </Stack>
      <div style={{overflow:'auto'}}>
        <table style={{width:'100%', borderCollapse:'collapse'}}>
          <thead>
            <tr style={{background:'#fafafa'}}>
              <th style={th}>作成</th><th style={th}>ステータス</th><th style={th}>種別</th><th style={th}>店舗</th>
              <th style={{...th,textAlign:'right'}}>数量</th><th style={th}>希望日</th><th style={th}>理由</th><th style={th}>操作</th>
            </tr>
          </thead>
          <tbody>
            {filtered.length===0? (
              <tr><td colSpan="8" style={{padding:8,color:'#777',textAlign:'center'}}>リクエストはありません</td></tr>
            ): filtered.map(r=>(
              <tr key={r.id}>
                <td style={td}>{new Date(r.createdAt).toLocaleString('ja-JP')}</td>
                <td style={td}>{r.status}</td>
                <td style={td}>{r.type}</td>
                <td style={td}>{r.store}（{r.channel}）</td>
                <td style={{...td,textAlign:'right'}}>{r.qty??'-'}</td>
                <td style={td}>{r.neededBy}</td>
                <td style={{...td,maxWidth:240,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}} title={r.reason}>{r.reason}</td>
                <td style={td}>
                  <Stack direction="row" spacing={1}>
                    <Button size="small" onClick={()=>update(r.id,{status:'承認'})}>承認</Button>
                    <Button size="small" onClick={()=>update(r.id,{status:'却下'})}>却下</Button>
                    <Button size="small" onClick={()=>update(r.id,{status:'完了'})}>完了</Button>
                  </Stack>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </Paper>
  );
}

/* ===== PDCA Panel ===== */
function PDCAStatusChip({ok, label}) {
  const color = ok ? '#2e7d32' : '#c62828';
  return <span style={{display:'inline-block',padding:'2px 8px',border:`1px solid ${color}`,color,borderRadius:999,fontSize:12}}>{label}</span>;
}

function PDCA({product, from, to, channels, totals, dosOverall, actions, onQuick, onEdit}) {
  const [tab, setTab] = React.useState(0); // 0:Plan 1:Do 2:Check 3:Act
  const initial = loadPDCA();
  const [salesTarget, setSalesTarget] = React.useState(initial.salesTarget ?? Math.round(totals.net * 1.1));
  const [dosTarget, setDosTarget]     = React.useState(initial.dosTarget ?? 21);
  const [hypo, setHypo]               = React.useState(initial.hypo ?? '（例）週末はオンライン強化／アウトレットは値下げで回転');
  const [review, setReview]           = React.useState(initial.review ?? '');

  React.useEffect(()=> {
    savePDCA({ salesTarget, dosTarget, hypo, review });
  }, [salesTarget, dosTarget, hypo, review]);

  // Do（この期間内に作成したリクエスト）
  const allReq = loadReq();
  const inRange = (iso) => {
    const d = iso.slice(0,10);
    return d >= from && d <= to;
  };
  const doRows = allReq
    .filter(r => r.productId===product.id && channels.includes(r.channel) && inRange(r.createdAt))
    .sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt));

  // Check（差分）
  const netOK = totals.net >= salesTarget;
  const dosOK = isFinite(dosOverall) ? Math.round(dosOverall) <= dosTarget : false;
  const netDelta = totals.net - salesTarget;
  const dosDelta = (isFinite(dosOverall) ? Math.round(dosOverall) : Infinity) - dosTarget;
  const netRate  = salesTarget>0 ? Math.round((totals.net / salesTarget)*100) : 0;

  return (
    <Paper variant="outlined" sx={{p:2, mb:2}}>
      <Stack direction="row" justifyContent="space-between" alignItems="center">
        <Stack direction="row" spacing={1} alignItems="center">
          <span className="material-icons">donut_small</span>
          <b>PDCA</b>
          <span style={{fontSize:12,color:'#666'}}>期間: {from}〜{to} ／ 商品: {product.name}</span>
        </Stack>
        <Tabs value={tab} onChange={(e,v)=>setTab(v)} variant="scrollable" scrollButtons="auto" sx={{minHeight:36}}>
          <Tab label="Plan" sx={{minHeight:36}} />
          <Tab label="Do"   sx={{minHeight:36}} />
          <Tab label="Check" sx={{minHeight:36}} />
          <Tab label="Act"  sx={{minHeight:36}} />
        </Tabs>
      </Stack>
      <Divider sx={{my:1}}/>

      {/* Plan */}
      {tab===0 && (
        <Stack spacing={2}>
          <Grid container spacing={2}>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth size="small" type="number" label="売上目標（期間合計・円）"
                value={salesTarget} onChange={e=>setSalesTarget(Number(e.target.value)||0)}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth size="small" type="number" label="在庫日数目標（DOS・日）"
                value={dosTarget} onChange={e=>setDosTarget(Number(e.target.value)||0)}
              />
            </Grid>
            <Grid item xs={12}>
              <TextField
                fullWidth size="small" label="施策の仮説 / ねらい"
                value={hypo} onChange={e=>setHypo(e.target.value)}
                placeholder="例）オンラインは広告連動でCV増、店舗は移管＋端数値下げで回転を上げる"
              />
            </Grid>
          </Grid>

          <Box>
            <div style={{fontSize:12,color:'#666',marginBottom:4}}>進捗（目標に対する売上達成率）</div>
            <LinearProgress variant="determinate" value={Math.max(0, Math.min(100, netRate))} />
            <div style={{fontSize:12, marginTop:4}}>
              {netRate}%（{totals.net.toLocaleString('ja-JP')} / {salesTarget.toLocaleString('ja-JP')} 円）
            </div>
          </Box>
        </Stack>
      )}

      {/* Do */}
      {tab===1 && (
        <Stack spacing={1}>
          {doRows.length===0 ? (
            <Typography color="text.secondary">この期間のリクエストはありません。</Typography>
          ) : doRows.map(r=>(
            <Paper key={r.id} variant="outlined" sx={{p:1}}>
              <Stack direction="row" justifyContent="space-between" alignItems="center">
                <div style={{fontSize:14}}>
                  <b>{r.type}</b>｜{r.store}（{r.channel}）｜{r.qty??'-'}点
                  <span style={{color:'#666',marginLeft:8}}>{new Date(r.createdAt).toLocaleString('ja-JP')}</span>
                </div>
                <div style={{display:'flex',gap:8,alignItems:'center'}}>
                  <PDCAStatusChip ok={r.status==='承認' || r.status==='完了'} label={r.status}/>
                </div>
              </Stack>
            </Paper>
          ))}
          <span style={{fontSize:12,color:'#666'}}>※ Infographic の「Next Actions」からもワンクリック起票できます。</span>
        </Stack>
      )}

      {/* Check */}
      {tab===2 && (
        <Grid container spacing={2}>
          <Grid item xs={12} md={6}>
            <Card variant="outlined">
              <CardContent>
                <div style={{fontSize:12,color:'#666',display:'flex',alignItems:'center',gap:6}}>
                  <span className="material-icons" style={{fontSize:18}}>attach_money</span>売上
                </div>
                <Typography variant="h5" className="mono" sx={{mt:0.5}}>
                  {totals.net.toLocaleString('ja-JP')} 円
                </Typography>
                <div style={{display:'flex',gap:8,alignItems:'center',marginTop:4}}>
                  <PDCAStatusChip ok={totals.net >= (loadPDCA().salesTarget ?? 0)} label={totals.net >= (loadPDCA().salesTarget ?? 0) ? '達成' : '未達'} />
                </div>
              </CardContent>
            </Card>
          </Grid>
          <Grid item xs={12} md={6}>
            <Card variant="outlined">
              <CardContent>
                <div style={{fontSize:12,color:'#666',display:'flex',alignItems:'center',gap:6}}>
                  <span className="material-icons" style={{fontSize:18}}>speed</span>在庫日数（全体）
                </div>
                <Typography variant="h5" className="mono" sx={{mt:0.5}}>
                  {isFinite(dosOverall)? Math.round(dosOverall) : '∞'} 日
                </Typography>
              </CardContent>
            </Card>
          </Grid>
        </Grid>
      )}

      {/* Act */}
      {tab===3 && (
        <Stack spacing={1}>
          {actions.length===0 ? (
            <Typography color="text.secondary">今すぐの優先アクションはありません。</Typography>
          ) : actions.map((a,i)=>(
            <Paper key={i} variant="outlined" sx={{p:1}}>
              <Stack direction="row" justifyContent="space-between" alignItems="center">
                <Stack direction="row" spacing={1} alignItems="center">
                  <Chip size="small" color={a.kind==='補充'?'primary':(a.kind==='移管'?'secondary':'default')}
                        icon={<span className="material-icons" style={{fontSize:16}}>{a.kind==='補充'?'add':'swap_horiz'}</span>}
                        label={a.kind}/>
                  <Typography>{a.msg}</Typography>
                </Stack>
                <Stack direction="row" spacing={1}>
                  <Button size="small" variant="outlined" onClick={()=>onEdit(a)}>編集して登録</Button>
                  <Button size="small" variant="contained" onClick={()=>onQuick(a)}>即登録</Button>
                </Stack>
              </Stack>
            </Paper>
          ))}
        </Stack>
      )}
    </Paper>
  );
}

/* ===== メイン ===== */
function App(){
  const today=new Date(); const d=n=>{const t=new Date(today); t.setDate(t.getDate()-n); return t.toISOString().slice(0,10);};
  const [product,setProduct]=React.useState(PRODUCTS[0]);
  const [from,setFrom]=React.useState(d(28));
  const [to,setTo]=React.useState(d(0));
  const [channels,setChannels]=React.useState(CHANNELS);

  // 閾値（Plan相当）
  const [targetDays,setTargetDays]=React.useState(21);
  const [markdownDos,setMarkdownDos]=React.useState(60);
  const [minLot,setMinLot]=React.useState(5);

  // モード
  const urlMode=new URLSearchParams(location.search).get('mode');
  const LS_KEY='dash_mode_v1';
  const [mode,setMode]=React.useState(()=> urlMode || localStorage.getItem(LS_KEY) || 'infographic');
  React.useEffect(()=>{ localStorage.setItem(LS_KEY, mode); const u=new URL(location); u.searchParams.set('mode',mode); history.replaceState(null,'',u); },[mode]);
  React.useEffect(()=>{ const onKey=e=>{ if(e.key?.toLowerCase()==='i') setMode('infographic'); if(e.key?.toLowerCase()==='d') setMode('detail'); }; window.addEventListener('keydown',onKey); return ()=>window.removeEventListener('keydown',onKey); },[]);

  // 集計（選択商品）
  const rows=React.useMemo(()=> filterSales({productId:product.id,from,to,channels}),[product,from,to,channels]);
  const byStore=React.useMemo(()=> aggregateByStore(rows,product.id),[rows,product]);
  const byCh=React.useMemo(()=> aggregateByChannel(rows),[rows]);
  const totalUnits=sum(rows,r=>r.units), totalNet=sum(rows,r=>r.net);
  const invTotal=sum(INVENTORY.filter(i=>i.productId===product.id && channels.includes(STORES.find(s=>s.id===i.storeId).channel)), i=>i.qty);
  const daily=sum(byStore,s=>avgDaily(s.units,s.days||1));
  const dosOverall=daily>0? invTotal/daily : Infinity;
  const trendSeries=calcTrendSeries(product.id,channels,to);
  const actions=nextActions({byStore,targetDays,markdownDos,minLot});
  const totals = { units: totalUnits, net: totalNet, invTotal };

  // ===== “対応推奨” 算出（一覧/チャネル別で使用） =====
  const periodDays = daysBetween(from,to);

  // チャネル別（選択商品）
  const selectedProductChannelRows = CHANNELS.filter(ch => channels.includes(ch)).map(ch=>{
    const chRows = filterSales({productId:product.id, from, to, channels:[ch]});
    const aggr = aggregateByChannel(chRows).find(x=>x.channel===ch) || {units:0, net:0, days:1};
    const inv = sum(INVENTORY.filter(i=>i.productId===product.id && STORES.find(s=>s.id===i.storeId).channel===ch), i=>i.qty);
    const daily = (aggr.units || 0) / (aggr.days || periodDays || 1);
    const dos = daysOfSupply(inv, daily);
    let rec='—', tone='ok';
    if(dos<14){ rec=`欠品リスク：補充`; tone='danger'; }
    else if(dos>markdownDos){ rec=`高在庫：値下げ/移管`; tone='warn'; }
    return {channel:ch, units:aggr.units||0, net:aggr.net||0, inv, daily, dos, rec, tone};
  });

  // 全商品スキャン（一覧）
  const attentionList = PRODUCTS.map(p=>{
    const rows = filterSales({productId:p.id, from, to, channels});
    const units = sum(rows,r=>r.units);
    const net   = sum(rows,r=>r.net);
    const inv   = sum(INVENTORY.filter(i=>i.productId===p.id && channels.includes(STORES.find(s=>s.id===i.storeId).channel)), i=>i.qty);
    const daily = units/(periodDays||1);
    const dos   = daysOfSupply(inv, daily);
    // チャネルアンバランス（移管候補）
    const perCh = CHANNELS.filter(c=>channels.includes(c)).map(c=>{
      const r=filterSales({productId:p.id,from,to,channels:[c]});
      const u=sum(r,x=>x.units); const d=(new Set(r.map(x=>x.date)).size)||1;
      const invCh=sum(INVENTORY.filter(i=>i.productId===p.id && STORES.find(s=>s.id===i.storeId).channel===c), i=>i.qty);
      return {dos:daysOfSupply(invCh, u/d), ch:c};
    });
    const hasShort=perCh.some(x=>x.dos<14); const hasLong=perCh.some(x=>x.dos>targetDays+14);
    let rec='—', score=0;
    if(dos<14){ rec='補充候補'; score=100-(dos||0); }
    else if(hasShort && hasLong){ rec='移管候補（チャネル偏在）'; score=90; }
    else if(dos>markdownDos){ rec='値下げ/移管候補（高在庫）'; score=dos; }
    return {product:p, units, net, inv, daily, dos, rec, score};
  }).filter(r=> r.rec!=='—').sort((a,b)=> (b.score)-(a.score)).slice(0,12);

  // リクエスト（Next Action → 1クリック登録）
  const [snack,setSnack]=React.useState(false);
  const addQuickRequest=(a)=>{
    const payload={id:'REQ-'+Date.now(),createdAt:new Date().toISOString(),status:'未処理',type:a.kind,productId:product.id,sku:product.sku,productName:product.name,
      storeId:(a.store?.storeId||a.to?.storeId||a.from?.storeId),store:(a.store?.store||a.to?.store||a.from?.store),channel:(a.store?.channel||a.to?.channel||a.from?.channel),
      qty:a.qty??null,neededBy:new Date().toISOString().slice(0,10)};
    const arr=loadReq(); arr.unshift(payload); saveReq(arr); setSnack(true);
  };

  // CSV 読み込み（Detail用）
  const loadSalesCSV=f=>{ const r=new FileReader(); r.onload=()=>{ const lines=r.result.split(/\r?\n/).filter(Boolean);
    SALES=lines.slice(1).map(l=>{ const [productId,storeId,date,units,net]=l.split(','); return {productId,storeId,date,units:Number(units),net:Number(net)};}); alert('売上CSVを読み込みました'); };
    r.readAsText(f,'utf-8'); };
  const loadInvCSV=f=>{ const r=new FileReader(); r.onload=()=>{ const lines=r.result.split(/\r?\n/).filter(Boolean);
    INVENTORY=lines.slice(1).map(l=>{ const [productId,storeId,qty]=l.split(','); return {productId,storeId,qty:Number(qty)};}); alert('在庫CSVを読み込みました'); };
    r.readAsText(f,'utf-8'); };

  // リクエストダイアログ
  const [dlgOpen,setDlgOpen]=React.useState(false);
  const [dlgPreset,setDlgPreset]=React.useState({});
  const openDialogFromAction=(a)=>{ setDlgPreset({ defaultType:a.kind, defaultStore:a.store||a.to||a.from, defaultQty:a.qty }); setDlgOpen(true); };
  const onDialogSubmit=(req)=>{ const arr=loadReq(); arr.unshift(req); saveReq(arr); setDlgOpen(false); setSnack(true); };

  // 表示切替（対応推奨テーブル：選択商品/全商品）
  const [attnTab, setAttnTab] = React.useState('selected'); // 'selected' | 'list'

  return (
    <>
      <AppBar position="static" color="inherit" elevation={0}>
        <Toolbar className="wrap">
          <span className="material-icons" style={{marginRight:8}}>insights</span>
          <Typography variant="h6" sx={{flexGrow:1}}>商品ダッシュボード</Typography>
          <ToggleButtonGroup exclusive size="small" value={mode} onChange={(e,v)=> v && setMode(v)}>
            <ToggleButton value="infographic"><span className="material-icons" style={{fontSize:16,marginRight:4}}>dashboard</span>Infographic</ToggleButton>
            <ToggleButton value="detail"><span className="material-icons" style={{fontSize:16,marginRight:4}}>table_view</span>Detail</ToggleButton>
          </ToggleButtonGroup>
        </Toolbar>
      </AppBar>

      <div className="wrap">
        {/* フィルタ（共通） */}
        <Paper variant="outlined" sx={{p:1.5, mb:2}}>
          <Stack direction="row" gap={1} alignItems="center" flexWrap="wrap">
            <Typography>商品</Typography>
            <select value={product.id} onChange={e=>setProduct(PRODUCTS.find(p=>p.id===e.target.value))}>
              {PRODUCTS.map(p=><option key={p.id} value={p.id}>{p.name}（{p.sku}）</option>)}
            </select>
            <span className="pill"><span className="material-icons" style={{fontSize:16}}>event</span>
              <input type="date" value={from} onChange={e=>setFrom(e.target.value)}/>〜
              <input type="date" value={to} onChange={e=>setTo(e.target.value)}/>
            </span>
            <span className="pill"><span className="material-icons" style={{fontSize:16}}>tune</span>
              目標DOS <input type="number" value={targetDays} onChange={e=>setTargetDays(Number(e.target.value))} style={{width:56}}/>
              ／ 値下げDOS <input type="number" value={markdownDos} onChange={e=>setMarkdownDos(Number(e.target.value))} style={{width:56}}/>
              ／ 最小ロット <input type="number" value={minLot} onChange={e=>setMinLot(Number(e.target.value))} style={{width:56}}/>
            </span>
            <span className="pill">
              {CHANNELS.map(ch=>{
                const on=channels.includes(ch);
                return <Chip key={ch} label={ch} variant={on?'filled':'outlined'} size="small"
                  onClick={()=> setChannels(prev=> on? prev.filter(x=>x!==ch): [...prev, ch]) } sx={{mr:0.5}}/>;
              })}
            </span>
          </Stack>
        </Paper>

        {mode==='infographic' ? (
          <>
            {/* KPI */}
            <div className="cards" style={{marginBottom:16}}>
              <KPI icon="sell" label="売上（期間）" value={fmtYen(totalNet)} sub={`${totalUnits.toLocaleString()} 点`} right={<Sparkline data={trendSeries}/>}/>
              <KPI icon="inventory_2" label="在庫合計" value={`${invTotal.toLocaleString()} 点`}/>
              <KPI icon="speed" label="在庫日数（全体）" value={isFinite(dosOverall)?`${Math.round(dosOverall)} 日`:'∞'} right={<DosDonut dos={dosOverall}/>}/>
              <KPI icon="flag" label="目標" value={`DOS ${targetDays}日`} sub={`値下げ ${markdownDos}日 / 最小ロット ${minLot}`}/>
            </div>

            {/* PDCA */}
            <PDCA
              product={product}
              from={from}
              to={to}
              channels={channels}
              totals={{units: totalUnits, net: totalNet, invTotal}}
              dosOverall={dosOverall}
              actions={actions}
              onQuick={addQuickRequest}
              onEdit={openDialogFromAction}
            />

            {/* Next Best Actions */}
            <Paper variant="outlined" sx={{p:2, mb:2}}>
              <Stack direction="row" alignItems="center" justifyContent="space-between">
                <Stack direction="row" gap={1} alignItems="center">
                  <span className="material-icons">recommend</span><b>Next Actions</b>
                  <span className="mini" style={{color:'#666'}}>（最大3件）</span>
                </Stack>
                <span className="mini" style={{color:'#666'}}>I / D キーでモード切替</span>
              </Stack>
              <Divider sx={{my:1}}/>
              {actions.length===0 ? <Typography color="text.secondary">今すぐの優先アクションはありません。</Typography> : (
                <Stack gap={1}>
                  {actions.map((a,i)=>(
                    <Paper key={i} variant="outlined" sx={{p:1.2}}>
                      <Stack direction="row" justifyContent="space-between" alignItems="center">
                        <Stack direction="row" gap={1} alignItems="center">
                          <Chip size="small" color={a.kind==='補充'?'primary':(a.kind==='移管'?'secondary':'default')}
                                icon={<span className="material-icons" style={{fontSize:16}}>{a.kind==='補充'?'add':'swap_horiz'}</span>} label={a.kind}/>
                          <Typography>{a.msg}</Typography>
                        </Stack>
                        <Stack direction="row" spacing={1}>
                          <Button size="small" variant="outlined" onClick={()=>openDialogFromAction(a)}>編集して登録</Button>
                          <Button size="small" variant="contained" onClick={()=>addQuickRequest(a)}>即登録</Button>
                        </Stack>
                      </Stack>
                    </Paper>
                  ))}
                </Stack>
              )}
            </Paper>

            {/* === 新規：対応推奨テーブル（アクションパネル直下） === */}
            <Paper variant="outlined" sx={{p:2, mb:2}}>
              <Stack direction="row" alignItems="center" justifyContent="space-between">
                <b>フォローが必要な状況</b>
                <ToggleButtonGroup exclusive size="small" value={attnTab} onChange={(e,v)=> v && setAttnTab(v)}>
                  <ToggleButton value="selected">選択商品のチャネル別</ToggleButton>
                  <ToggleButton value="list">対応推奨商品一覧</ToggleButton>
                </ToggleButtonGroup>
              </Stack>
              <Divider sx={{my:1}}/>

              {attnTab==='selected' ? (
                <div style={{overflow:'auto'}}>
                  <table style={{width:'100%', borderCollapse:'collapse'}}>
                    <thead>
                      <tr style={{background:'#fafafa'}}>
                        <th style={th}>チャネル</th>
                        <th style={{...th,textAlign:'right'}}>販売数</th>
                        <th style={{...th,textAlign:'right'}}>売上</th>
                        <th style={{...th,textAlign:'right'}}>在庫</th>
                        <th style={{...th,textAlign:'right'}}>日販</th>
                        <th style={{...th,textAlign:'right'}}>DOS</th>
                        <th style={th}>推奨</th>
                      </tr>
                    </thead>
                    <tbody>
                      {selectedProductChannelRows.map(r=>(
                        <tr key={r.channel}>
                          <td style={td}>{r.channel}</td>
                          <td style={{...td,textAlign:'right'}}>{r.units.toLocaleString()}</td>
                          <td style={{...td,textAlign:'right'}}>{fmtYen(r.net)}</td>
                          <td style={{...td,textAlign:'right'}}>{r.inv.toLocaleString()}</td>
                          <td style={{...td,textAlign:'right'}}>{r.daily.toFixed(2)}</td>
                          <td style={{...td,textAlign:'right',color: r.dos<14?'#c62828':(r.dos>markdownDos?'#ef6c00':'#2e7d32')}}>{isFinite(r.dos)?Math.round(r.dos):'∞'}</td>
                          <td style={td}>{r.rec}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                  <Box mt={1} className="mini" color="text.secondary">※ 目安：欠品&lt;14日 / 高在庫&gt;{markdownDos}日</Box>
                </div>
              ) : (
                <div style={{overflow:'auto'}}>
                  <table style={{width:'100%', borderCollapse:'collapse'}}>
                    <thead>
                      <tr style={{background:'#fafafa'}}>
                        <th style={th}>SKU</th>
                        <th style={th}>商品名</th>
                        <th style={{...th,textAlign:'right'}}>売上（期間）</th>
                        <th style={{...th,textAlign:'right'}}>在庫合計</th>
                        <th style={{...th,textAlign:'right'}}>日販</th>
                        <th style={{...th,textAlign:'right'}}>DOS</th>
                        <th style={th}>推奨アクション</th>
                      </tr>
                    </thead>
                    <tbody>
                      {attentionList.length===0 ? (
                        <tr><td colSpan="7" style={{padding:8,color:'#777',textAlign:'center'}}>特に対応が必要な商品はありません</td></tr>
                      ) : attentionList.map((r,i)=>(
                        <tr key={r.product.id} className="rowHover" onClick={()=>{ setProduct(r.product); setAttnTab('selected'); }}>
                          <td style={td} className="mono">{r.product.sku}</td>
                          <td style={td}>{r.product.name}</td>
                          <td style={{...td,textAlign:'right'}}>{fmtYen(r.net)}</td>
                          <td style={{...td,textAlign:'right'}}>{r.inv.toLocaleString()}</td>
                          <td style={{...td,textAlign:'right'}}>{r.daily.toFixed(2)}</td>
                          <td style={{...td,textAlign:'right',color:r.dos<14?'#c62828':(r.dos>markdownDos?'#ef6c00':'#2e7d32')}}>{isFinite(r.dos)?Math.round(r.dos):'∞'}</td>
                          <td style={td}><b>{r.rec}</b></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                  <Box mt={1} className="mini" color="text.secondary">行クリックで当該商品にフォーカスします。</Box>
                </div>
              )}
            </Paper>
          </>
        ) : (
          <>
            {/* Detail モード：テーブル＋PDCA＋リクエスト一覧＋CSV */}
            <Grid container spacing={2}>
              <Grid item xs={12} md={7}>
                {/* チャンネル別 */}
                <Paper variant="outlined" sx={{p:2, mb:2}}>
                  <b>チャンネル別</b><Divider sx={{my:1}}/>
                  <div style={{overflow:'auto'}}>
                    <table style={{width:'100%', borderCollapse:'collapse'}}>
                      <thead><tr style={{background:'#fafafa'}}>
                        <th style={th}>チャンネル</th>
                        <th style={{...th,textAlign:'right'}}>販売数</th>
                        <th style={{...th,textAlign:'right'}}>売上</th>
                        <th style={{...th,textAlign:'right'}}>店舗数</th>
                      </tr></thead>
                      <tbody>
                        {byCh.map(r=>(
                          <tr key={r.channel}>
                            <td style={td}>{r.channel}</td>
                            <td style={{...td,textAlign:'right'}}>{r.units.toLocaleString()}</td>
                            <td style={{...td,textAlign:'right'}}>{fmtYen(r.net)}</td>
                            <td style={{...td,textAlign:'right'}}>{r.stores}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </Paper>

                {/* 店舗別 */}
                <Paper variant="outlined" sx={{p:2}}>
                  <b>店舗別</b><Divider sx={{my:1}}/>
                  <div style={{overflow:'auto'}}>
                    <table style={{width:'100%', borderCollapse:'collapse'}}>
                      <thead><tr style={{background:'#fafafa'}}>
                        <th style={th}>店舗</th><th style={th}>チャネル</th>
                        <th style={{...th,textAlign:'right'}}>販売数</th>
                        <th style={{...th,textAlign:'right'}}>売上</th>
                        <th style={{...th,textAlign:'right'}}>在庫</th>
                        <th style={{...th,textAlign:'right'}}>日販</th>
                        <th style={{...th,textAlign:'right'}}>DOS</th>
                      </tr></thead>
                      <tbody>
                        {byStore.map(s=>{
                          const daily=avgDaily(s.units,s.days||1), dos=daysOfSupply(s.inv,daily);
                          return (
                            <tr key={s.storeId}>
                              <td style={td}>{s.store}</td>
                              <td style={td}>{s.channel}</td>
                              <td style={{...td,textAlign:'right'}}>{s.units.toLocaleString()}</td>
                              <td style={{...td,textAlign:'right'}}>{fmtYen(s.net)}</td>
                              <td style={{...td,textAlign:'right'}}>{s.inv.toLocaleString()}</td>
                              <td style={{...td,textAlign:'right'}}>{daily.toFixed(2)}</td>
                              <td style={{...td,textAlign:'right'}}>{isFinite(dos)?Math.round(dos):'∞'}</td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                </Paper>
              </Grid>

              <Grid item xs={12} md={5}>
                {/* PDCA（Detail側にも表示） */}
                <PDCA
                  product={product}
                  from={from}
                  to={to}
                  channels={channels}
                  totals={{units: totalUnits, net: totalNet, invTotal}}
                  dosOverall={dosOverall}
                  actions={actions}
                  onQuick={addQuickRequest}
                  onEdit={openDialogFromAction}
                />

                {/* リクエスト一覧 */}
                <RequestsPanel product={product} channels={channels}/>

                {/* CSV */}
                <Paper variant="outlined" sx={{p:2, mt:2}}>
                  <b>CSV読み込み</b><Divider sx={{my:1}}/>
                  <Stack direction="row" spacing={2} flexWrap="wrap">
                    <Button variant="outlined" component="label" startIcon={<span className="material-icons">file_upload</span>}>
                      売上CSV<input type="file" hidden accept=".csv" onChange={(e)=>e.target.files[0] && loadSalesCSV(e.target.files[0])}/>
                    </Button>
                    <Button variant="outlined" component="label" startIcon={<span className="material-icons">inventory_2</span>}>
                      在庫CSV<input type="file" hidden accept=".csv" onChange={(e)=>e.target.files[0] && loadInvCSV(e.target.files[0])}/>
                    </Button>
                    <span className="mini" style={{color:'#666'}}>売上CSV: productId,storeId,date,units,net / 在庫CSV: productId,storeId,qty</span>
                  </Stack>
                </Paper>
              </Grid>
            </Grid>
          </>
        )}
      </div>

      {/* リクエストダイアログ */}
      <RequestDialog
        open={dlgOpen}
        onClose={()=>setDlgOpen(false)}
        onSubmit={onDialogSubmit}
        product={product}
        defaultStore={dlgPreset.defaultStore}
        defaultType={dlgPreset.defaultType}
        defaultQty={dlgPreset.defaultQty}
      />

      <Snackbar open={snack} autoHideDuration={1200} onClose={()=>setSnack(false)} anchorOrigin={{vertical:'bottom',horizontal:'center'}}>
        <Alert severity="success" variant="filled">リクエストを登録しました</Alert>
      </Snackbar>
    </>
  );
}

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
</script>
</body>
</html>
