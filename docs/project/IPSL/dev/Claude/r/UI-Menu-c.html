<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MR & AI Chat – 3D Carousel</title>

  <!-- Fonts & MUI -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js" crossorigin></script>

  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: Roboto, system-ui, -apple-system, "Segoe UI", Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #eef1f7 0%, #f6f7fb 100%);
    }
    
    #root {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    
    .glass {
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      background: rgba(255,255,255,0.7);
      border: 1px solid rgba(255,255,255,0.6);
      box-shadow: 0 10px 30px rgba(76,87,125,.08);
      border-radius: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .glass:hover {
      box-shadow: 0 15px 40px rgba(76,87,125,.12);
      transform: translateY(-2px);
    }
    
    .menu-icon {
      border-radius: 16px;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      margin: 0 auto;
      transition: transform .25s ease, box-shadow .25s ease, filter .25s ease, opacity .2s ease;
      box-shadow: 0 8px 22px rgba(50,50,93,.12), 0 4px 12px rgba(0,0,0,.08);
      position: relative;
      overflow: hidden;
    }
    
    .menu-icon:hover {
      transform: translateY(-3px) scale(1.02);
      filter: brightness(1.03);
    }
    
    .menu-label {
      font-size: .85rem;
      margin-top: 8px;
      text-align: center;
      color: #556;
      font-weight: 500;
    }
    
    .menu-item.editing .menu-icon {
      outline: 2px dashed rgba(40,53,147,.45);
      outline-offset: 4px;
      cursor: grab;
    }
    
    @media (max-width: 600px) {
      .menu-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
      }
      .menu-icon .material-icons {
        font-size: 22px;
      }
      .menu-label {
        font-size: .72rem;
        margin-top: 4px;
      }
    }
    
    .carousel-3d {
      perspective: 1200px;
      position: relative;
      overflow: hidden;
    }
    
    .carousel-container {
      transform-style: preserve-3d;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      width: 100%;
      height: 100%;
    }
    
    .carousel-slide {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      background: rgba(255,255,255,0.9);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .carousel-nav:hover {
      background: rgba(255,255,255,1);
      transform: translateY(-50%) scale(1.1);
    }
    
    .carousel-nav.prev {
      left: 20px;
    }
    
    .carousel-nav.next {
      right: 20px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const {
      AppBar, Toolbar, Typography, Box, Grid, Paper, IconButton,
      TextField, Button, Switch, FormControlLabel, Container,
      CssBaseline, ThemeProvider, createTheme, Divider, Chip, SwipeableDrawer,
      Tooltip, Avatar, Stack, Alert, useMediaQuery, ButtonGroup, InputAdornment, Snackbar
    } = MaterialUI;

    // ====== 定数 ======
    const DEFAULT_MENU = [
      { key:"home", icon:"home", label:"ホーム", color:"#f44336" },
      { key:"person", icon:"person", label:"プロフィール", color:"#e91e63" },
      { key:"mail", icon:"mail", label:"メッセージ", color:"#9c27b0" },
      { key:"settings", icon:"settings", label:"設定", color:"#673ab7" },
      { key:"camera", icon:"photo_camera", label:"カメラ", color:"#3f51b5" },
      { key:"map", icon:"map", label:"マップ", color:"#2196f3" },
      { key:"event", icon:"event", label:"カレンダー", color:"#03a9f4" },
      { key:"shop", icon:"shopping_cart", label:"ショップ", color:"#00bcd4" },
      { key:"help", icon:"help", label:"ヘルプ", color:"#009688" },
      { key:"info", icon:"info", label:"情報", color:"#4caf50" },
      { key:"phone", icon:"phone", label:"連絡先", color:"#ff9800" },
      { key:"music", icon:"music_note", label:"音楽", color:"#795548" },
    ];

    const theme = createTheme({
      palette: { mode:'light', primary:{ main:'#283593' }, secondary:{ main:'#00bcd4' },
        background:{ default:'transparent', paper:'rgba(255,255,255,0.7)'} },
      shape:{ borderRadius:14 },
      typography:{ button:{ textTransform:'none', fontWeight:600 } }
    });

    function MenuGrid({ setSelectedApp }){
      const [items] = React.useState(DEFAULT_MENU);
      const [edit, setEdit] = React.useState(false);

      return (
        <Paper className="glass" sx={{ py:2, px:1, mx:{ md:2 }, mb:{ xs:1.5, md:2 } }} elevation={0}>
          <Box sx={{ display:'flex', alignItems:'center', justifyContent:'space-between', px:1, pb:1 }}>
            <Typography variant="subtitle2" sx={{ color:'#556', fontWeight:700 }}>クイックメニュー</Typography>
            <Button size="small" variant={edit?"contained":"outlined"} color={edit?"primary":"inherit"}
                    onClick={()=>setEdit(v=>!v)}
                    startIcon={<span className="material-icons">{edit?"done":"edit"}</span>}>
              {edit?"完了":"編集"}
            </Button>
          </Box>

          <Grid container spacing={2} justifyContent="center">
            {items.map((it, i)=>(
              <Grid item key={it.key} xs={3} sm={2} md={1} sx={{ textAlign:'center' }}>
                <div className={`menu-item ${edit?"editing":""}`}
                  onClick={!edit && setSelectedApp ? ()=>setSelectedApp(it) : undefined}
                  style={{ cursor: !edit ? 'pointer' : 'grab' }}>
                  <div className="menu-icon" style={{ backgroundColor: it.color }}>
                    <span className="material-icons">{it.icon}</span>
                  </div>
                  <div className="menu-label">
                    {it.label}
                  </div>
                </div>
              </Grid>
            ))}
          </Grid>
        </Paper>
      );
    }

    function App(){
      const [selectedApps, setSelectedApps] = React.useState([]);
      const [currentSlide, setCurrentSlide] = React.useState(0);
      const [isFullscreen, setIsFullscreen] = React.useState(false);
      const [showAIAssistant, setShowAIAssistant] = React.useState(true);
      const isMobile = useMediaQuery('(max-width:600px)');
      
      const addApp = (app) => {
        setSelectedApps(prev => {
          const existingIndex = prev.findIndex(a => a.key === app.key);
          if (existingIndex !== -1) {
            setCurrentSlide(existingIndex);
            return prev;
          }
          const newApps = [...prev, app];
          setCurrentSlide(newApps.length - 1);
          return newApps;
        });
      };
      
      const removeApp = (index) => {
        setSelectedApps(prev => {
          const newApps = prev.filter((_, i) => i !== index);
          if (newApps.length === 0) return [];
          setCurrentSlide(Math.min(currentSlide, newApps.length - 1));
          return newApps;
        });
      };
      
      const nextSlide = () => setCurrentSlide(prev => (prev + 1) % selectedApps.length);
      const prevSlide = () => setCurrentSlide(prev => (prev - 1 + selectedApps.length) % selectedApps.length);

      return (
        <Box sx={{ minHeight:'100vh', display:'flex', flexDirection:'column' }}>
          <AppBar position="sticky" elevation={8}
            sx={{ background:'linear-gradient(90deg, #283593 0%, #3949ab 50%, #1e88e5 100%)' }}>
            <Toolbar sx={{ minHeight:{ xs:64, sm:72 }, position:'relative', gap:1 }}>
              <Typography variant="h6" sx={{ fontWeight:700, letterSpacing:.2 }}>Assistant</Typography>
              <Box sx={{ flex:1 }} />
              <Tooltip title="通知"><IconButton color="inherit" aria-label="通知">
                <span className="material-icons">notifications</span>
              </IconButton></Tooltip>
              <Tooltip title="アカウント"><IconButton color="inherit" aria-label="アカウント">
                <span className="material-icons">account_circle</span>
              </IconButton></Tooltip>
            </Toolbar>
          </AppBar>

          <Container maxWidth={isFullscreen ? false : "lg"} sx={{ flex:1, py:{ xs:1, sm:2 }, px: isFullscreen ? 0 : undefined }}>
            {selectedApps.length > 0 ? (
              <Box className="carousel-3d" sx={{ 
                position: isFullscreen ? 'fixed' : 'relative',
                top: isFullscreen ? 0 : 'auto',
                left: isFullscreen ? 0 : 'auto',
                width: isFullscreen ? '100vw' : '100%',
                height: isFullscreen ? '100vh' : { xs:'50vh', sm:'60vh', md:'70vh' },
                zIndex: isFullscreen ? 9999 : 'auto',
                bgcolor: isFullscreen ? 'background.default' : 'transparent'
              }}>
                <div className="carousel-container" style={{
                  transform: `rotateY(${-currentSlide * (isMobile ? 90 : 60)}deg)`
                }}>
                  {selectedApps.map((app, index) => {
                    const angle = index * (isMobile ? 90 : 60);
                    const isActive = index === currentSlide;
                    const translateZ = isMobile ? (isActive ? '200px' : '150px') : (isActive ? '400px' : '300px');
                    return (
                      <Paper key={app.key} className="glass carousel-slide" variant="outlined" style={{
                        transform: `rotateY(${angle}deg) translateZ(${translateZ})`,
                        opacity: isActive ? 1 : 0.6,
                        zIndex: isActive ? 10 : 1,
                        width: isMobile ? '90%' : '100%',
                        height: isMobile ? '90%' : '100%',
                        left: isMobile ? '5%' : '0',
                        top: isMobile ? '5%' : '0'
                      }}>
                        <Box sx={{ display:'flex', alignItems:'center', justifyContent:'space-between', p:{ xs:1.5, sm:2 }, borderBottom:'1px solid rgba(0,0,0,0.1)' }}>
                          <Box sx={{ display:'flex', alignItems:'center', gap:1.5 }}>
                            <Avatar sx={{ bgcolor: app.color, width:{ xs:32, sm:40 }, height:{ xs:32, sm:40 } }}>
                              <span className="material-icons" style={{ fontSize: isMobile ? '18px' : '24px' }}>{app.icon}</span>
                            </Avatar>
                            <Typography variant={isMobile ? "subtitle1" : "h6"} sx={{ fontWeight:700 }}>{app.label}</Typography>
                          </Box>
                          <Stack direction="row" spacing={1}>
                            <Tooltip title={isFullscreen ? "ウィンドウモード" : "全画面モード"}>
                              <IconButton size={isMobile ? "small" : "medium"} onClick={()=>setIsFullscreen(!isFullscreen)}>
                                <span className="material-icons">{isFullscreen ? 'fullscreen_exit' : 'fullscreen'}</span>
                              </IconButton>
                            </Tooltip>
                            <Tooltip title="閉じる">
                              <IconButton size={isMobile ? "small" : "medium"} onClick={()=>removeApp(index)}>
                                <span className="material-icons">close</span>
                              </IconButton>
                            </Tooltip>
                          </Stack>
                        </Box>
                        <Box sx={{ p:{ xs:2, sm:3 }, height:'calc(100% - 80px)', display:'flex', alignItems:'center', justifyContent:'center' }}>
                          <Typography variant={isMobile ? "h5" : "h4"} color="text.secondary" sx={{ textAlign:'center' }}>
                            {app.label} アプリケーション
                          </Typography>
                        </Box>
                      </Paper>
                    );
                  })}
                </div>
                {selectedApps.length > 1 && (
                  <>
                    <div className="carousel-nav prev" onClick={prevSlide} style={{
                      width: isMobile ? '36px' : '48px',
                      height: isMobile ? '36px' : '48px',
                      left: isMobile ? '10px' : '20px'
                    }}>
                      <span className="material-icons" style={{ fontSize: isMobile ? '18px' : '24px' }}>chevron_left</span>
                    </div>
                    <div className="carousel-nav next" onClick={nextSlide} style={{
                      width: isMobile ? '36px' : '48px',
                      height: isMobile ? '36px' : '48px',
                      right: isMobile ? '10px' : '20px'
                    }}>
                      <span className="material-icons" style={{ fontSize: isMobile ? '18px' : '24px' }}>chevron_right</span>
                    </div>
                  </>
                )}
              </Box>
            ) : showAIAssistant ? (
              <Paper className="glass" sx={{ p:3, position:'relative' }} variant="outlined">
                <Box sx={{ display:'flex', alignItems:'center', gap:1.5, mb:1 }}>
                  <Avatar sx={{ bgcolor:'primary.main' }}><span className="material-icons">smart_toy</span></Avatar>
                  <Typography variant="h6" sx={{ fontWeight:700 }}>AIアシスタント</Typography>
                </Box>
                <Typography variant="body2" color="text.secondary">
                  クイックメニューからアプリを選択すると3Dカルーセルで表示されます。
                </Typography>
              </Paper>
            ) : null}
          </Container>

          <MenuGrid setSelectedApp={addApp} />

          <Box component="footer" sx={{ textAlign:'center', p:2, color:'white',
            background:'linear-gradient(90deg, #283593 0%, #1e88e5 100%)', boxShadow:'0 -8px 24px rgba(0,0,0,0.08)' }}>
            <Typography variant="caption">&copy; 2025 My Company - All Rights Reserved.</Typography>
          </Box>
        </Box>
      );
    }

    function Root(){
      return (
        <ThemeProvider theme={theme}>
          <CssBaseline />
          <App />
        </ThemeProvider>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<Root/>);
  </script>
</body>
</html>