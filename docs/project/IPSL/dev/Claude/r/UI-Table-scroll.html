<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ページスクロール固定ヘッダー付きテーブル</title>
  <!-- Roboto & Icons -->
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <!-- React & Babel -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <!-- Emotion & MUI -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js"></script>
  <style>
    body { margin: 16px; font-family: Roboto, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const {
      styled,
      useTheme,
      Box,
      Paper,
      Typography,
      TextField,
      Table,
      TableHead,
      TableRow,
      TableCell,
      TableBody,
      TablePagination
    } = MaterialUI;

    //――――――――――――――――――――――――――――――――
    // スティッキーセルの定義
    //――――――――――――――――――――――――――――――――
    // 先頭のヘッダーセル（縦横固定）
    const StickyFirstHeaderCell = styled(TableCell)(({ theme }) => ({
      position: 'sticky',
      top: 0,
      left: 0,
      backgroundColor: theme.palette.background.paper,
      zIndex: theme.zIndex.appBar + 1,
      whiteSpace: 'nowrap',
    }));
    // その他のヘッダーセル（縦固定のみ）
    const StickyHeaderCell = styled(TableCell)(({ theme }) => ({
      position: 'sticky',
      top: 0,
      backgroundColor: theme.palette.background.paper,
      zIndex: theme.zIndex.appBar,
      whiteSpace: 'nowrap',
    }));
    // 本文の先頭セル（横固定のみ）
    const StickyFirstBodyCell = styled(TableCell)(({ theme }) => ({
      position: 'sticky',
      left: 0,
      backgroundColor: theme.palette.background.paper,
      zIndex: theme.zIndex.appBar,
      whiteSpace: 'nowrap',
    }));

    //――――――――――――――――――――――――――――――――
    // メインコンポーネント
    //――――――――――――――――――――――――――――――――
    function App() {
      const theme = useTheme();
      const headers = ['列1','列2','列3','列4','列5','列6','列7'];
      const allRows = Array.from({ length: 100 }, (_, i) =>
        headers.map(h => `データ${i+1}-${h}`)
      );

      const [filterText, setFilterText] = useState('');
      const [page, setPage] = useState(0);
      const [rowsPerPage, setRowsPerPage] = useState(10);

      // フィルタリング
      const filtered = allRows.filter(row =>
        row.some(cell => cell.includes(filterText))
      );
      const minWidth = headers.length * 120; // 列数 × 列幅想定

      return (
        <Box>
          <Typography variant="h5" gutterBottom>データ一覧</Typography>
          <Box mb={2}>
            <TextField
              label="検索"
              variant="outlined"
              size="small"
              value={filterText}
              onChange={e => { setFilterText(e.target.value); setPage(0); }}
            />
          </Box>

          <Paper>
            {/* 横スクロールだけ許可。overflowY は visible ＝ ページ縦スクロールに委任 */}
            <div style={{
              overflowX: 'auto',
              overflowY: 'visible'
            }}>
              <Table sx={{ minWidth }} size="small">
                <TableHead>
                  <TableRow>
                    <StickyFirstHeaderCell>列1</StickyFirstHeaderCell>
                    {headers.slice(1).map((h, i) => (
                      <StickyHeaderCell key={i}>
                        <strong>{h}</strong>
                      </StickyHeaderCell>
                    ))}
                  </TableRow>
                </TableHead>

                <TableBody>
                  {filtered
                    .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)
                    .map((row, ri) => (
                      <TableRow key={ri}>
                        <StickyFirstBodyCell>
                          {row[0]}
                        </StickyFirstBodyCell>
                        {row.slice(1).map((cell, ci) => (
                          <TableCell key={ci} sx={{ whiteSpace: 'nowrap' }}>
                            {cell}
                          </TableCell>
                        ))}
                      </TableRow>
                  ))}
                </TableBody>
              </Table>
            </div>

            <TablePagination
              component="div"
              count={filtered.length}
              page={page}
              onPageChange={(_, p) => setPage(p)}
              rowsPerPage={rowsPerPage}
              onRowsPerPageChange={e => {
                setRowsPerPage(+e.target.value);
                setPage(0);
              }}
              rowsPerPageOptions={[5, 10, 25, 50]}
            />
          </Paper>
        </Box>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>