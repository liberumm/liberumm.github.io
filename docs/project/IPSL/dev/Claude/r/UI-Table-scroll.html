<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Stickyヘッダー + 上部スクロールバー（React + MUI）</title>

  <!-- ===== フォント & アイコン ===== -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/icon?family=Material+Icons" />

  <!-- ===== Tailwind ===== -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ===== React / ReactDOM ===== -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

  <!-- ===== Babel (JSXサポート) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.8/babel.min.js"></script>

  <!-- ===== Emotion (MUIで使用) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>

  <!-- ===== MUI ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js"></script>

  <style>
    /* スクロールバー上部用 */
    .scrollbar-top {
      height: 16px;
      overflow-x: auto;
      overflow-y: hidden;
      position: sticky;
      top: 0;
      z-index: 100;
      background-color: #f3f4f6;
    }

    .scrollbar-top-inner {
      height: 1px;
    }

    thead th {
      position: sticky;
      top: 16px; /* スクロールバーの高さ分 */
      background: white;
      z-index: 50;
    }
  </style>
</head>
<body class="bg-gray-50 p-4">

  <div id="root"></div>

  <script type="text/babel">

    const {
      Table, TableBody, TableCell, TableContainer,
      TableHead, TableRow, Paper
    } = MaterialUI;

    function StickyHeaderTable() {
      const headers = ['項目1', '項目2', '項目3', '項目4', '項目5', '項目6', '項目7'];
      const rows = Array.from({ length: 20 }, (_, i) => headers.map(h => `データ${i + 1}-${h}`));

      const tableRef = React.useRef();
      const scrollRef = React.useRef();
      const fakeScrollRef = React.useRef();

      // 横幅を同期
      React.useEffect(() => {
        const syncScrollWidth = () => {
          if (tableRef.current && scrollRef.current && fakeScrollRef.current) {
            fakeScrollRef.current.firstChild.style.width = tableRef.current.scrollWidth + 'px';
          }
        };

        syncScrollWidth();
        window.addEventListener('resize', syncScrollWidth);
        return () => window.removeEventListener('resize', syncScrollWidth);
      }, []);

      // スクロール同期
      React.useEffect(() => {
        const real = scrollRef.current;
        const fake = fakeScrollRef.current;

        const onRealScroll = () => { fake.scrollLeft = real.scrollLeft; };
        const onFakeScroll = () => { real.scrollLeft = fake.scrollLeft; };

        real.addEventListener('scroll', onRealScroll);
        fake.addEventListener('scroll', onFakeScroll);

        return () => {
          real.removeEventListener('scroll', onRealScroll);
          fake.removeEventListener('scroll', onFakeScroll);
        };
      }, []);

      return (
        <div className="w-full">
          {/* 横スクロールバー（上） */}
          <div className="scrollbar-top" ref={fakeScrollRef}>
            <div className="scrollbar-top-inner"></div>
          </div>

          {/* テーブル本体 */}
          <div className="overflow-x-auto max-h-[400px]" ref={scrollRef}>
            <TableContainer component={Paper}>
              <Table ref={tableRef}>
                <TableHead>
                  <TableRow>
                    {headers.map((header, i) => (
                      <TableCell key={i} className="font-bold">{header}</TableCell>
                    ))}
                  </TableRow>
                </TableHead>
                <TableBody>
                  {rows.map((row, rowIndex) => (
                    <TableRow key={rowIndex}>
                      {row.map((cell, cellIndex) => (
                        <TableCell key={cellIndex}>{cell}</TableCell>
                      ))}
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<StickyHeaderTable />);
  </script>

</body>
</html>