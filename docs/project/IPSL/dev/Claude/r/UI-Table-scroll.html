<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>折り返しなし・Stickyヘッダー + 上部スクロールバー</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <!-- React / ReactDOM -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>

  <!-- Emotion -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11/dist/emotion-styled.umd.min.js"></script>

  <!-- MUI -->
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5/umd/material-ui.production.min.js"></script>

  <style>
    body {
      font-family: Roboto, sans-serif;
      margin: 16px;
      background-color: #f5f5f5;
    }

    .scrollbar-top {
      height: 16px;
      overflow-x: auto;
      overflow-y: hidden;
      position: sticky;
      top: 0;
      background-color: #e0e0e0;
      z-index: 100;
    }

    .scrollbar-top-inner {
      height: 1px;
    }

    thead th {
      position: sticky;
      top: 16px;
      background: #ffffff;
      z-index: 10;
    }

    .table-wrapper {
      overflow-x: auto;
      max-height: 400px;
      border: 1px solid #ccc;
      background: white;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const {
      Table, TableBody, TableCell, TableContainer,
      TableHead, TableRow, Paper
    } = MaterialUI;

    function StickyHeaderTable() {
      const headers = ['列1', '非常に長い列名その1', '列3', '列4', '長いデータ列5', '列6', '列7'];
      const rows = Array.from({ length: 20 }, (_, i) =>
        headers.map(h => `データ${i + 1}-${h}-長い文字列`)
      );

      const tableRef = React.useRef();
      const scrollRef = React.useRef();
      const fakeScrollRef = React.useRef();

      React.useEffect(() => {
        const syncScrollWidth = () => {
          if (tableRef.current && fakeScrollRef.current) {
            fakeScrollRef.current.firstChild.style.width = tableRef.current.scrollWidth + 'px';
          }
        };
        syncScrollWidth();
        window.addEventListener('resize', syncScrollWidth);
        return () => window.removeEventListener('resize', syncScrollWidth);
      }, []);

      React.useEffect(() => {
        const real = scrollRef.current;
        const fake = fakeScrollRef.current;

        const syncReal = () => { real.scrollLeft = fake.scrollLeft; };
        const syncFake = () => { fake.scrollLeft = real.scrollLeft; };

        real.addEventListener('scroll', syncFake);
        fake.addEventListener('scroll', syncReal);

        return () => {
          real.removeEventListener('scroll', syncFake);
          fake.removeEventListener('scroll', syncReal);
        };
      }, []);

      return (
        <div>
          <div className="scrollbar-top" ref={fakeScrollRef}>
            <div className="scrollbar-top-inner"></div>
          </div>

          <div className="table-wrapper" ref={scrollRef}>
            <TableContainer>
              <Table ref={tableRef}>
                <TableHead>
                  <TableRow>
                    {headers.map((header, i) => (
                      <TableCell
                        key={i}
                        sx={{ whiteSpace: 'nowrap', fontWeight: 'bold' }}
                      >
                        {header}
                      </TableCell>
                    ))}
                  </TableRow>
                </TableHead>
                <TableBody>
                  {rows.map((row, rowIndex) => (
                    <TableRow key={rowIndex}>
                      {row.map((cell, cellIndex) => (
                        <TableCell
                          key={cellIndex}
                          sx={{ whiteSpace: 'nowrap' }}
                        >
                          {cell}
                        </TableCell>
                      ))}
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<StickyHeaderTable />);
  </script>
</body>
</html>