<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>MUI テーブル（ブラッシュアップ版）</title>
  <!-- Roboto & Icons -->
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <!-- React & Babel -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <!-- Emotion & MUI -->
  <script src="https://cdn.jsdelivr.net/npm/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.3/umd/material-ui.production.min.js"></script>
  <style>
    body { font-family: Roboto, sans-serif; margin: 16px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const {
      Box, Paper, Table, TableBody, TableCell, TableContainer,
      TableHead, TableRow, TablePagination, TextField, Typography,
      useMediaQuery, IconButton
    } = MaterialUI;
    const { styled, useTheme } = window['@emotion/styled'] || {};

    // ゼブラストライプ＋先頭列固定スタイル
    const StyledTableRow = styled(TableRow)(({ theme }) => ({
      '&:nth-of-type(odd)': {
        backgroundColor: theme.palette.action.hover,
      },
    }));
    const StickyFirstCell = styled(TableCell)(({ theme }) => ({
      position: 'sticky',
      left: 0,
      backgroundColor: theme.palette.background.default,
      zIndex: theme.zIndex.appBar,
    }));

    function EnhancedTable() {
      const theme = useTheme();
      const isSmDown = useMediaQuery(theme.breakpoints.down('sm'));

      // サンプルデータ
      const headers = ['列1','列2','列3','列4','列5','列6','列7'];
      const allRows = Array.from({ length: 100 }, (_, i) =>
        headers.map(h => `データ${i+1}-${h}`)
      );

      // ページネーション＆検索
      const [page, setPage] = React.useState(0);
      const [rowsPerPage, setRowsPerPage] = React.useState(10);
      const [filterText, setFilterText] = React.useState('');

      const filtered = allRows.filter(row =>
        row.some(cell => cell.includes(filterText))
      );

      const handleChangePage = (_, newPage) => setPage(newPage);
      const handleChangeRowsPerPage = e => {
        setRowsPerPage(+e.target.value);
        setPage(0);
      };

      return (
        <Box>
          <Typography variant="h5" gutterBottom>
            データ一覧
          </Typography>
          <Box mb={2} display="flex" alignItems="center">
            <TextField
              label="検索"
              variant="outlined"
              size="small"
              value={filterText}
              onChange={e => setFilterText(e.target.value)}
            />
          </Box>
          <TableContainer component={Paper} sx={{ maxHeight: 400 }}>
            <Table stickyHeader>
              <TableHead>
                <TableRow>
                  {headers.map((h, i) => {
                    const CellComp = i === 0 ? StickyFirstCell : TableCell;
                    return (
                      <CellComp
                        key={h}
                        sx={{
                          backgroundColor: theme.palette.primary.light,
                          color: theme.palette.primary.contrastText,
                          ...(isSmDown && i > 3 && { display: 'none' })
                        }}
                      >
                        <strong>{h}</strong>
                      </CellComp>
                    );
                  })}
                </TableRow>
              </TableHead>
              <TableBody>
                {filtered
                  .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)
                  .map((row, ri) => (
                    <StyledTableRow key={ri}>
                      {row.map((cell, ci) => {
                        const CellComp = ci === 0 ? StickyFirstCell : TableCell;
                        return (
                          <CellComp
                            key={ci}
                            sx={isSmDown && ci > 3 ? { display: 'none' } : {}}
                          >
                            {cell}
                          </CellComp>
                        );
                      })}
                    </StyledTableRow>
                  ))
                }
              </TableBody>
            </Table>
          </TableContainer>
          <TablePagination
            component="div"
            count={filtered.length}
            page={page}
            onPageChange={handleChangePage}
            rowsPerPage={rowsPerPage}
            onRowsPerPageChange={handleChangeRowsPerPage}
            rowsPerPageOptions={[5, 10, 25, 50]}
          />
        </Box>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<EnhancedTable />);
  </script>
</body>
</html>