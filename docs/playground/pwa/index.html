<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PWA App Badge</title>
    <link rel="manifest" href="./manifest.json" />
    <!-- Materialize CSS (Material UIライクなスタイル) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  </head>
  <body>
    <!-- AppBar (ナビゲーションバー) -->
    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo center">My PWA App</a>
      </div>
    </nav>

    <main class="container" style="margin-top: 20px;">
      <div class="row">
        <div class="col s12">
          <h5>Notification Permission</h5>
          <p id="permission"></p>
        </div>
      </div>

      <div class="row">
        <div class="col s12 m6 l2">
          <button class="btn waves-effect waves-light push">Push</button>
        </div>
        <div class="col s12 m6 l2">
          <button class="btn waves-effect waves-light badge">Badge</button>
        </div>
        <div class="col s12 m6 l2">
          <button class="btn waves-effect waves-light clear">Clear</button>
        </div>
        <div class="col s12 m6 l2">
          <button class="btn waves-effect waves-light reload">Reload</button>
        </div>
        <div class="col s12 m6 l2">
          <button class="btn waves-effect waves-light default">Default</button>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="page-footer">
      <div class="container">
        <div class="row">
          <div class="col s12">
            <h6 class="white-text">Footer Content</h6>
            <p class="grey-text text-lighten-4">ここにお好きな情報を記載できます。</p>
          </div>
        </div>
      </div>
      <div class="footer-copyright">
        <div class="container">
          © 2025 My PWA App
        </div>
      </div>
    </footer>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script type="module">
      // ページ読み込み時に通知の許可状態をチェック
      document.addEventListener('DOMContentLoaded', () => {
        if (window.Notification) {
          document.getElementById('permission').innerText = 'Notification permission: ' + Notification.permission;
        } else {
          document.getElementById('permission').innerText = 'Your browser does not support notifications.';
        }
      });

      // 各ボタンのイベントリスナー設定
      document.querySelector('.push').addEventListener('click', requestPermission);
      document.querySelector('.badge').addEventListener('click', () => {
        // 1〜9のランダムな数値をバッジとしてセット
        navigator.setAppBadge(Math.floor(Math.random() * 9) + 1);
      });
      document.querySelector('.clear').addEventListener('click', () => {
        navigator.setAppBadge(0);
      });
      document.querySelector('.reload').addEventListener('click', () => {
        location.reload();
      });
      document.querySelector('.default').addEventListener('click', resetDefault);

      function requestPermission() {
        if (!window.Notification) return;
        Notification.requestPermission().then((permission) => {
          document.getElementById('permission').innerText = 'Notification permission: ' + permission;
        });
      }

      // Defaultボタンで初期状態に戻す関数
      function resetDefault() {
        // バッジを0にリセット
        navigator.setAppBadge(0);
        // 通知許可状態の表示を初期状態に戻す
        if (window.Notification) {
          document.getElementById('permission').innerText = 'Notification permission: ' + Notification.permission;
        } else {
          document.getElementById('permission').innerText = 'Your browser does not support notifications.';
        }
      }
    </script>
  </body>
</html>