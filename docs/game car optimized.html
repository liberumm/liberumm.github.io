<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>„É¢„ÉÄ„É≥„Çπ„É≠„ÉÉ„Éà„Ç´„Éº„Ç≤„Éº„É† - 8„ÅÆÂ≠ó„É¨„Ç§„Ç¢„Ç¶„ÉàÔºàÁ≠âË∑ùÈõ¢„É¨„Éº„É≥Ôºâ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --primary-cyan: #00ffff;
            --primary-magenta: #ff00ff;
            --primary-yellow: #ffff00;
            --bg-dark: #0c0c0c;
            --bg-mid: #1a1a2e;
            --bg-light: #16213e;
            --track-glow: rgba(0,255,255,0.3);
            --winner-gold: #ffd700;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Orbitron', monospace;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            background:
                radial-gradient(circle at 20% 50%, rgba(120,119,198,0.3), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,119,198,0.3), transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120,219,255,0.3), transparent 50%),
                linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-mid) 50%, var(--bg-light) 100%);
            overflow: hidden; position: relative;
        }
        
        body::before {
            content: '';
            position: fixed; inset: 0;
            background: repeating-linear-gradient(
                0deg, transparent, transparent 2px,
                rgba(255,255,255,0.03) 2px, rgba(255,255,255,0.03) 4px
            );
            pointer-events: none; z-index: 1;
        }

        #gameContainer {
            position: relative; width: 900px; height: 500px;
            background: radial-gradient(ellipse at center,
                        rgba(15,32,39,0.9) 0%, rgba(32,58,67,0.8) 50%, rgba(44,83,100,0.7) 100%);
            border-radius: 250px;
            box-shadow:
                0 0 100px rgba(0,255,255,0.2),
                0 0 200px rgba(255,0,255,0.1),
                inset 0 0 100px rgba(0,0,0,0.5),
                0 20px 80px rgba(0,0,0,0.8);
            transform: perspective(1000px) rotateX(5deg);
            overflow: visible; z-index: 10;
        }

        .track {
            position: absolute; inset: 0;
            border: 6px solid;
            border-image: linear-gradient(45deg, var(--primary-cyan), var(--primary-magenta), var(--primary-yellow), var(--primary-cyan)) 1;
            border-radius: 250px; box-sizing: border-box; z-index: 1;
            box-shadow: inset 0 0 50px var(--track-glow), 0 0 30px rgba(0,255,255,0.5);
            animation: trackGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes trackGlow {
            0% { box-shadow: inset 0 0 50px var(--track-glow), 0 0 30px rgba(0,255,255,0.5); }
            100% { box-shadow: inset 0 0 80px rgba(255,0,255,0.4), 0 0 50px rgba(255,0,255,0.6); }
        }

        #trackSvg { position: absolute; inset: 0; z-index: 2; }
        .laneGuide { fill: none; stroke: rgba(255,255,255,0.28); stroke-width: 2; stroke-dasharray: 8 8; }
        .centerPath { fill: none; stroke: rgba(0,255,255,0.35); stroke-width: 4; }

        .car {
            position: absolute; width: 28px; height: 14px;
            border-radius: 6px; transform-origin: center;
            transition: transform 0.08s linear;
            box-shadow: 0 0 15px rgba(255,255,255,0.6), 0 4px 20px rgba(0,0,0,0.8);
            filter: brightness(1.2); z-index: 10;
        }
        
        .car::before, .car::after {
            content: ''; position: absolute; border-radius: 50%;
            top: 50%; transform: translateY(-50%);
        }
        
        .car::before {
            width: 8px; height: 8px; left: 3px;
            background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0.8) 50%, transparent 100%);
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
            animation: headlightFlicker 0.1s ease-in-out infinite alternate;
        }
        
        .car::after {
            width: 6px; height: 6px; right: 3px;
            background: radial-gradient(circle, rgba(255,50,50,1) 0%, rgba(255,0,0,0.8) 50%, transparent 100%);
            box-shadow: 0 0 8px rgba(255,0,0,0.8);
        }
        
        @keyframes headlightFlicker { 0% { opacity: 0.9; } 100% { opacity: 1; } }

        .car-trail, .particle {
            position: absolute; border-radius: 50%; pointer-events: none; z-index: 5;
        }
        
        .car-trail {
            width: 2px; height: 2px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 100%);
            animation: trailFade 0.8s ease-out forwards;
        }
        
        .particle { animation: particleFloat 2s ease-out forwards; }
        
        @keyframes trailFade { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 0; transform: scale(0.2); } }
        @keyframes particleFloat { 0% { opacity: 1; transform: translate(0,0) scale(1); } 100% { opacity: 0; transform: translate(var(--dx),var(--dy)) scale(0.2); } }

        .controls {
            position: absolute; bottom: -100px; left: 50%;
            transform: translateX(-50%); display: flex; gap: 20px; z-index: 100;
        }
        
        .btn {
            padding: 15px 30px; font-size: 16px; font-weight: 700;
            font-family: 'Orbitron', monospace; border: none; border-radius: 30px; cursor: pointer;
            position: relative; text-transform: uppercase; letter-spacing: 2px;
            transition: all 0.3s ease; overflow: hidden;
        }
        
        .btn::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }
        
        .btn:hover::before { left: 100%; }
        .btn:hover { transform: translateY(-3px); }
        
        #startButton {
            background: linear-gradient(45deg, #00ff88, #00cc66); color: #003322;
            box-shadow: 0 0 30px rgba(0,255,136,0.5), 0 6px 20px rgba(0,0,0,0.4);
        }
        
        #startButton:hover { box-shadow: 0 0 40px rgba(0,255,136,0.8), 0 8px 30px rgba(0,0,0,0.6); }
        
        #resetButton {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: #fff;
            box-shadow: 0 0 30px rgba(255,107,107,0.5), 0 6px 20px rgba(0,0,0,0.4);
        }
        
        #resetButton:hover { box-shadow: 0 0 40px rgba(255,107,107,0.8), 0 8px 30px rgba(0,0,0,0.6); }

        .lap-counter {
            position: absolute; font-family: 'Orbitron', monospace;
            font-size: 13px; font-weight: 700; color: var(--primary-cyan);
            background: linear-gradient(135deg, rgba(0,255,255,0.1) 0%, rgba(0,100,100,0.2) 50%, rgba(0,50,50,0.3) 100%);
            padding: 10px 15px; border-radius: 25px; border: 2px solid rgba(0,255,255,0.4);
            backdrop-filter: blur(15px); transition: all 0.3s ease;
            box-shadow: 0 0 20px var(--track-glow), inset 0 0 20px rgba(0,255,255,0.1);
            z-index: 15;
        }
        
        .lap-counter.finished {
            background: linear-gradient(135deg, var(--winner-gold), #ffb300); 
            color: #333; border-color: var(--winner-gold);
            animation: championPulse 1.5s infinite;
            box-shadow: 0 0 30px rgba(255,215,0,0.8), inset 0 0 20px rgba(255,215,0,0.2);
        }
        
        @keyframes championPulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        .info-panel {
            position: absolute; font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(20,20,40,0.8) 100%);
            padding: 20px; border-radius: 15px; font-size: 14px; font-weight: 700; color: var(--primary-cyan);
            box-shadow: 0 0 30px var(--track-glow), inset 0 0 20px rgba(0,255,255,0.1);
            z-index: 20;
        }
        
        .race-stats { top: 30px; left: 30px; min-width: 220px; }
        
        .speedometer {
            top: 30px; right: 30px; width: 120px; height: 120px;
            background: radial-gradient(circle, rgba(0,0,0,0.9) 0%, rgba(20,20,40,0.8) 70%, rgba(0,255,255,0.1) 100%);
            border-radius: 50%; border: 3px solid rgba(0,255,255,0.6);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 12px;
        }

        .finish-line {
            position: absolute; top: 50%; width: 6px; height: 50px;
            background: repeating-linear-gradient(0deg, #000 0, #000 5px, #fff 5px, #fff 10px);
            transform: translateY(-50%);
            box-shadow: 0 0 20px rgba(255,255,255,0.6);
            animation: finishLineGlow 2s ease-in-out infinite alternate; z-index: 3;
        }
        
        @keyframes finishLineGlow { 
            0% { box-shadow: 0 0 20px rgba(255,255,255,0.6); } 
            100% { box-shadow: 0 0 40px rgba(255,255,255,1); } 
        }

        .leader-indicator {
            position: absolute; width: 35px; height: 35px;
            background: radial-gradient(circle, var(--winner-gold) 0%, rgba(255,140,0,0.8) 70%, transparent 100%);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-family: 'Orbitron', monospace; font-size: 14px; font-weight: 900; color: white;
            border: 2px solid rgba(255,255,255,0.8);
            box-shadow: 0 0 20px rgba(255,215,0,0.8);
            animation: leaderGlow 2s infinite; z-index: 15;
        }
        
        @keyframes leaderGlow { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .winner-banner {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
            background: linear-gradient(135deg, rgba(255,215,0,0.9) 0%, rgba(255,140,0,0.9) 50%, rgba(255,69,0,0.9) 100%);
            color: white; padding: 30px 50px; border-radius: 20px;
            font-family: 'Orbitron', monospace; font-size: 24px; font-weight: 900; text-align: center;
            display: none; z-index: 50; box-shadow: 0 0 80px rgba(255,215,0,0.8), 0 20px 40px rgba(0,0,0,0.6);
            border: 3px solid rgba(255,255,255,0.8); animation: victorySlideIn 0.8s ease;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        @keyframes victorySlideIn {
            0%   { opacity: 0; transform: translate(-50%,-50%) scale(0.3) rotateY(180deg); }
            50%  { opacity: 1; transform: translate(-50%,-50%) scale(1.1) rotateY(0deg); }
            100% { opacity: 1; transform: translate(-50%,-50%) scale(1) rotateY(0deg); }
        }

        @keyframes twinkle { 
            0%,100% { opacity:0; transform:scale(0.5) } 
            50% { opacity:1; transform:scale(1) } 
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div class="track"></div>
        <svg id="trackSvg" viewBox="0 0 900 500" aria-hidden="true"></svg>
        <div class="finish-line" id="finishLine"></div>
        <div id="cars"></div>

        <div class="info-panel race-stats">
            <div>üèÅ „É¨„Éº„ÇπÁµ±Ë®à</div>
            <div id="raceTime">ÁµåÈÅéÊôÇÈñì: 0.0Áßí</div>
            <div id="leader">„É™„Éº„ÉÄ„Éº: ---</div>
        </div>

        <div class="info-panel speedometer">
            <div>ÈÄüÂ∫¶</div>
            <div id="avgSpeed">0 km/h</div>
        </div>

        <div class="winner-banner" id="winnerBanner">üèÜ ÂÑ™Âãù„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ üèÜ</div>

        <div class="controls">
            <button id="startButton" class="btn">„Çπ„Çø„Éº„Éà</button>
            <button id="resetButton" class="btn">„É™„Çª„ÉÉ„Éà</button>
        </div>
    </div>

    <script>
    class SlotCarGame {
        constructor() {
            this.config = {
                numLanes: 6,
                lapsToFinish: 3,
                centerX: 450,
                centerY: 250,
                a: 330,
                samples: 600,
                laneGap: 18,
                speedRange: { min: 80, max: 120 },
                epsForTangent: 1
            };

            this.state = {
                cars: [],
                isRunning: false,
                animationFrameId: null,
                raceStartTime: 0,
                lastTs: 0,
                winner: null,
                leaderIndicator: null
            };

            this.elements = {
                gameContainer: document.getElementById('gameContainer'),
                carsContainer: document.getElementById('cars'),
                startButton: document.getElementById('startButton'),
                resetButton: document.getElementById('resetButton'),
                winnerBanner: document.getElementById('winnerBanner'),
                raceTime: document.getElementById('raceTime'),
                leader: document.getElementById('leader'),
                avgSpeed: document.getElementById('avgSpeed'),
                svg: document.getElementById('trackSvg'),
                finishLine: document.getElementById('finishLine')
            };

            this.carData = {
                names: ['„Éç„Ç™„É≥','„Çµ„Ç§„Éê„Éº','„Éó„É©„Ç∫„Éû','„É¨„Éº„Ç∂„Éº','„Éï„Ç©„Éà„É≥','„ÇØ„Ç©„É≥„Çø„É†'],
                colors: [
                    'linear-gradient(45deg,#ff6b6b,#ee5a52)',
                    'linear-gradient(45deg,#4ecdc4,#44a08d)',
                    'linear-gradient(45deg,#45b7d1,#2196f3)',
                    'linear-gradient(45deg,#f9ca24,#f0932b)',
                    'linear-gradient(45deg,#6c5ce7,#a29bfe)',
                    'linear-gradient(45deg,#00b894,#00cec9)'
                ]
            };

            this.laneOffsets = Array.from({length: this.config.numLanes}, 
                (_, i) => (i - (this.config.numLanes - 1) / 2) * this.config.laneGap);

            this.init();
            this.bindEvents();
            this.startBackgroundEffect();
        }

        buildLemniscatePath(cx, cy, a, nSamples) {
            const pts = [];
            for (let i = 0; i < nSamples; i++) {
                const t = (i / (nSamples - 1)) * Math.PI * 2;
                const x = cx + a * Math.cos(t);
                const y = cy + (a / 2) * Math.sin(2 * t);
                pts.push([x, y]);
            }
            return `M ${pts[0][0]},${pts[0][1]}` + pts.slice(1).map(p => ` L ${p[0]},${p[1]}`).join('');
        }

        drawTrackAndGuides() {
            this.elements.svg.innerHTML = '';
            
            const centerPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            centerPath.setAttribute('d', this.buildLemniscatePath(
                this.config.centerX, this.config.centerY, this.config.a, this.config.samples));
            centerPath.setAttribute('class', 'centerPath');
            centerPath.setAttribute('id', 'centerPath');
            this.elements.svg.appendChild(centerPath);

            this.elements.finishLine.style.left = `${this.config.centerX + this.config.a - 3}px`;
            this.elements.finishLine.style.top = '50%';

            const totalLen = centerPath.getTotalLength();
            this.laneOffsets.forEach((offset, idx) => {
                let d = '';
                for (let i = 0; i < this.config.samples; i++) {
                    const s = (i / (this.config.samples - 1)) * totalLen;
                    const p = centerPath.getPointAtLength(s);
                    const p2 = centerPath.getPointAtLength((s + this.config.epsForTangent) % totalLen);
                    const tx = p2.x - p.x, ty = p2.y - p.y;
                    const len = Math.hypot(tx, ty) || 1;
                    const nx = -ty / len, ny = tx / len;
                    const x = p.x + nx * offset;
                    const y = p.y + ny * offset;
                    d += (i === 0 ? `M ${x},${y}` : ` L ${x},${y}`);
                }
                const guide = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                guide.setAttribute('d', d);
                guide.setAttribute('class', 'laneGuide');
                this.elements.svg.appendChild(guide);
            });
        }

        init() {
            this.elements.carsContainer.innerHTML = '';
            document.querySelectorAll('.lap-counter').forEach(el => el.remove());
            if (this.state.leaderIndicator) this.state.leaderIndicator.remove();
            
            this.state.winner = null;
            this.elements.winnerBanner.style.display = 'none';

            this.drawTrackAndGuides();

            const centerPath = document.getElementById('centerPath');
            const totalLen = centerPath.getTotalLength();

            this.state.cars = [];
            for (let i = 0; i < this.config.numLanes; i++) {
                const carEl = document.createElement('div');
                carEl.className = 'car';
                carEl.style.background = this.carData.colors[i];
                this.elements.carsContainer.appendChild(carEl);

                const lapCounter = document.createElement('div');
                lapCounter.className = 'lap-counter';
                lapCounter.textContent = `${this.carData.names[i]}: 0/${this.config.lapsToFinish}Âë®`;
                lapCounter.style.left = '20px';
                lapCounter.style.top = `${80 + i * 40}px`;
                this.elements.gameContainer.appendChild(lapCounter);

                const baseSpeed = this.config.speedRange.min + 
                    Math.random() * (this.config.speedRange.max - this.config.speedRange.min);
                
                this.state.cars.push({
                    element: carEl,
                    name: this.carData.names[i],
                    s: Math.random() * totalLen * 0.2,
                    baseSpeed,
                    laps: 0,
                    lapCounter,
                    finished: false,
                    laneOffset: this.laneOffsets[i],
                });
            }

            this.state.leaderIndicator = document.createElement('div');
            this.state.leaderIndicator.className = 'leader-indicator';
            this.state.leaderIndicator.textContent = 'üëë';
            this.elements.gameContainer.appendChild(this.state.leaderIndicator);

            this.updateUI();
        }

        updateUI() {
            this.elements.avgSpeed.textContent = '0 km/h';
            this.elements.leader.textContent = '„É™„Éº„ÉÄ„Éº: ---';
            this.elements.raceTime.textContent = 'ÁµåÈÅéÊôÇÈñì: 0.0Áßí';
        }

        createEffect(x, y, type = 'normal') {
            const element = document.createElement('div');
            const dx = (Math.random() - 0.5) * 100;
            const dy = (Math.random() - 0.5) * 100;
            
            element.style.setProperty('--dx', dx + 'px');
            element.style.setProperty('--dy', dy + 'px');
            element.style.left = x + 'px';
            element.style.top = y + 'px';

            if (type === 'spark') {
                element.className = 'particle';
                element.style.width = '3px';
                element.style.height = '3px';
                element.style.background = 'radial-gradient(circle,#ffff00,#ff8800)';
                element.style.boxShadow = '0 0 10px #ffff00';
                this.elements.gameContainer.appendChild(element);
                setTimeout(() => element.remove(), 2000);
            } else if (type === 'trail') {
                element.className = 'car-trail';
                element.style.width = '2px';
                element.style.height = '2px';
                element.style.background = 'radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 100%)';
                this.elements.gameContainer.appendChild(element);
                setTimeout(() => element.remove(), 800);
            }
        }

        updateCars(ts) {
            if (!this.state.isRunning) return;

            const nowSec = (Date.now() - this.state.raceStartTime) / 1000;
            this.elements.raceTime.textContent = `ÁµåÈÅéÊôÇÈñì: ${nowSec.toFixed(1)}Áßí`;

            if (!this.state.lastTs) this.state.lastTs = ts;
            const dt = Math.min(0.05, (ts - this.state.lastTs) / 1000);
            this.state.lastTs = ts;

            const centerPath = document.getElementById('centerPath');
            const totalLen = centerPath.getTotalLength();

            let leaderCar = null;
            let maxProg = -Infinity;
            let allFinished = true;
            let totalSpeed = 0;
            let activeCount = 0;

            this.state.cars.forEach(car => {
                if (car.finished) return;

                const jitter = 1 + (Math.random() - 0.5) * 0.10;
                const speed = car.baseSpeed * jitter;
                let sNext = car.s + speed * dt;

                if (sNext >= totalLen) {
                    sNext -= totalLen;
                    car.laps++;
                    car.lapCounter.textContent = `${car.name}: ${car.laps}/${this.config.lapsToFinish}Âë®`;

                    const p0 = centerPath.getPointAtLength(0);
                    for (let i = 0; i < 10; i++) {
                        setTimeout(() => this.createEffect(p0.x, p0.y, 'spark'), i * 30);
                    }

                    if (car.laps >= this.config.lapsToFinish) {
                        car.finished = true;
                        car.lapCounter.classList.add('finished');
                        if (!this.state.winner) {
                            this.state.winner = car;
                            this.elements.winnerBanner.innerHTML = 
                                `üèÜ ${car.name} ÂÑ™ÂãùÔºÅ üèÜ<br><span style="font-size:18px;">„Çø„Ç§„É†: ${nowSec.toFixed(2)}Áßí</span>`;
                            this.elements.winnerBanner.style.display = 'block';
                        }
                    }
                }
                car.s = sNext;

                const p = centerPath.getPointAtLength(car.s);
                const p2 = centerPath.getPointAtLength((car.s + this.config.epsForTangent) % totalLen);
                const tx = p2.x - p.x, ty = p2.y - p.y;
                const len = Math.hypot(tx, ty) || 1;
                const nx = -ty / len, ny = tx / len;
                const x = p.x + nx * car.laneOffset;
                const y = p.y + ny * car.laneOffset;
                const angleDeg = Math.atan2(ty, tx) * 180 / Math.PI;

                car.element.style.left = `${x - 14}px`;
                car.element.style.top = `${y - 7}px`;
                car.element.style.transform = `rotate(${angleDeg}deg)`;

                if (Math.random() < 0.10) this.createEffect(x, y, 'trail');
                if (Math.random() < 0.05) this.createEffect(x, y, 'spark');

                const prog = car.laps * totalLen + car.s;
                if (prog > maxProg) {
                    maxProg = prog;
                    leaderCar = car;
                }

                allFinished = false;
                totalSpeed += speed;
                activeCount++;
            });

            if (leaderCar) {
                this.elements.leader.textContent = `„É™„Éº„ÉÄ„Éº: ${leaderCar.name}`;
                const p = centerPath.getPointAtLength(leaderCar.s);
                const p2 = centerPath.getPointAtLength((leaderCar.s + this.config.epsForTangent) % totalLen);
                const tx = p2.x - p.x, ty = p2.y - p.y;
                const len = Math.hypot(tx, ty) || 1;
                const nx = -ty / len, ny = tx / len;
                const lx = p.x + nx * leaderCar.laneOffset;
                const ly = p.y + ny * leaderCar.laneOffset;
                this.state.leaderIndicator.style.left = `${lx - 17.5}px`;
                this.state.leaderIndicator.style.top = `${ly - 45}px`;
            }

            if (activeCount > 0) {
                const pxPerSecAvg = totalSpeed / activeCount;
                const kmh = pxPerSecAvg * 0.20;
                this.elements.avgSpeed.textContent = `${kmh.toFixed(0)} km/h`;
            }

            if (allFinished) {
                this.state.isRunning = false;
                this.elements.startButton.textContent = '„Çπ„Çø„Éº„Éà';
                this.state.leaderIndicator.style.display = 'none';
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const x = Math.random() * 900;
                        const y = Math.random() * 500;
                        this.createEffect(x, y, 'spark');
                    }, i * 80);
                }
                return;
            }

            this.state.animationFrameId = requestAnimationFrame(ts => this.updateCars(ts));
        }

        toggleRace() {
            if (this.state.isRunning) {
                this.state.isRunning = false;
                cancelAnimationFrame(this.state.animationFrameId);
                this.elements.startButton.textContent = '„Çπ„Çø„Éº„Éà';
                this.state.leaderIndicator.style.display = 'none';
            } else {
                if (this.state.winner) this.init();
                this.state.isRunning = true;
                this.state.raceStartTime = Date.now();
                this.state.lastTs = 0;
                this.state.animationFrameId = requestAnimationFrame(ts => this.updateCars(ts));
                this.elements.startButton.textContent = '„Çπ„Éà„ÉÉ„Éó';
                this.state.leaderIndicator.style.display = 'block';
            }
        }

        reset() {
            this.state.isRunning = false;
            cancelAnimationFrame(this.state.animationFrameId);
            this.init();
            this.elements.startButton.textContent = '„Çπ„Çø„Éº„Éà';
        }

        bindEvents() {
            this.elements.startButton.addEventListener('click', () => this.toggleRace());
            this.elements.resetButton.addEventListener('click', () => this.reset());
        }

        startBackgroundEffect() {
            const animate = () => {
                if (Math.random() < 0.02) {
                    const star = document.createElement('div');
                    Object.assign(star.style, {
                        position: 'fixed',
                        left: `${Math.random() * window.innerWidth}px`,
                        top: `${Math.random() * window.innerHeight}px`,
                        width: '2px',
                        height: '2px',
                        background: '#fff',
                        borderRadius: '50%',
                        pointerEvents: 'none',
                        zIndex: '1',
                        animation: 'twinkle 3s ease-in-out forwards'
                    });
                    document.body.appendChild(star);
                    setTimeout(() => star.remove(), 3000);
                }
                requestAnimationFrame(animate);
            };
            animate();
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        new SlotCarGame();
    });
    </script>
</body>
</html>